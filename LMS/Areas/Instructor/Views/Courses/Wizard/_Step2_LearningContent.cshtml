@model LMS.Areas.Instructor.ViewModels.CourseWizardViewModel

<div class="step-2-learning-content">
    <!-- Learning Outcomes -->
    <div class="form-section">
        <h5 class="form-section-title">
            <i class="feather-target"></i>
            ما سيتعلمه الطالب
            <span class="badge bg-soft-danger text-danger ms-2">مطلوب (3 على الأقل)</span>
        </h5>
        <p class="text-muted mb-4">أضف النقاط الرئيسية التي سيتعلمها الطالب بعد إكمال الدورة. كن محدداً وقابلاً للقياس.</p>

        <div id="learningOutcomesContainer">
            @if (Model.LearningOutcomes != null && Model.LearningOutcomes.Any())
            {
                for (int i = 0; i < Model.LearningOutcomes.Count; i++)
                {
                    <div class="input-group mb-3 outcome-item">
                        <span class="input-group-text bg-soft-primary text-primary">
                            <i class="feather-check-circle"></i>
                        </span>
                        <input type="text" 
                               class="form-control" 
                               name="LearningOutcomes[@i]" 
                               value="@Model.LearningOutcomes[i]"
                               placeholder="مثال: فهم مبادئ البرمجة الأساسية">
                        <button class="btn btn-outline-danger" type="button" onclick="removeOutcome(this)">
                            <i class="feather-trash-2"></i>
                        </button>
                    </div>
                }
            }
            else
            {
                for (int i = 0; i < 3; i++)
                {
                    <div class="input-group mb-3 outcome-item">
                        <span class="input-group-text bg-soft-primary text-primary">
                            <i class="feather-check-circle"></i>
                        </span>
                        <input type="text" 
                               class="form-control" 
                               name="LearningOutcomes[@i]" 
                               placeholder="مثال: @(i == 0 ? "فهم مبادئ البرمجة الأساسية" : i == 1 ? "بناء تطبيقات عملية" : "حل المشكلات البرمجية")">
                        <button class="btn btn-outline-danger" type="button" onclick="removeOutcome(this)" @(i < 3 ? "disabled" : "")>
                            <i class="feather-trash-2"></i>
                        </button>
                    </div>
                }
            }
        </div>

        <button type="button" class="btn btn-sm btn-light-brand" onclick="addOutcome()">
            <i class="feather-plus me-2"></i>
            إضافة نقطة تعلم
        </button>
    </div>

    <!-- Requirements -->
    <div class="form-section">
        <h5 class="form-section-title">
            <i class="feather-list"></i>
            المتطلبات الأساسية
            <span class="badge bg-soft-danger text-danger ms-2">مطلوب (1 على الأقل)</span>
        </h5>
        <p class="text-muted mb-4">حدد ما يحتاج الطالب معرفته أو امتلاكه قبل البدء في الدورة.</p>

        <div id="requirementsContainer">
            @if (Model.Requirements != null && Model.Requirements.Any())
            {
                for (int i = 0; i < Model.Requirements.Count; i++)
                {
                    <div class="input-group mb-3 requirement-item">
                        <span class="input-group-text bg-soft-warning text-warning">
                            <i class="feather-alert-circle"></i>
                        </span>
                        <input type="text" 
                               class="form-control" 
                               name="Requirements[@i]" 
                               value="@Model.Requirements[i]"
                               placeholder="مثال: معرفة أساسية بالكمبيوتر">
                        <button class="btn btn-outline-danger" type="button" onclick="removeRequirement(this)">
                            <i class="feather-trash-2"></i>
                        </button>
                    </div>
                }
            }
            else
            {
                <div class="input-group mb-3 requirement-item">
                    <span class="input-group-text bg-soft-warning text-warning">
                        <i class="feather-alert-circle"></i>
                    </span>
                    <input type="text" 
                           class="form-control" 
                           name="Requirements[0]" 
                           placeholder="مثال: معرفة أساسية بالكمبيوتر">
                    <button class="btn btn-outline-danger" type="button" onclick="removeRequirement(this)" disabled>
                        <i class="feather-trash-2"></i>
                    </button>
                </div>
            }
        </div>

        <button type="button" class="btn btn-sm btn-light-brand" onclick="addRequirement()">
            <i class="feather-plus me-2"></i>
            إضافة متطلب
        </button>
    </div>

    <!-- Target Audience -->
    <div class="form-section">
        <h5 class="form-section-title">
            <i class="feather-users"></i>
            الجمهور المستهدف
            <span class="badge bg-soft-secondary text-secondary ms-2">اختياري</span>
        </h5>
        <p class="text-muted mb-4">حدد الفئة المستهدفة من هذه الدورة لمساعدة الطلاب على معرفة إذا كانت مناسبة لهم.</p>

        <div id="targetAudienceContainer">
            @if (Model.TargetAudience != null && Model.TargetAudience.Any())
            {
                for (int i = 0; i < Model.TargetAudience.Count; i++)
                {
                    <div class="input-group mb-3 audience-item">
                        <span class="input-group-text bg-soft-info text-info">
                            <i class="feather-user"></i>
                        </span>
                        <input type="text" 
                               class="form-control" 
                               name="TargetAudience[@i]" 
                               value="@Model.TargetAudience[i]"
                               placeholder="مثال: المبتدئين في البرمجة">
                        <button class="btn btn-outline-danger" type="button" onclick="removeAudience(this)">
                            <i class="feather-trash-2"></i>
                        </button>
                    </div>
                }
            }
            else
            {
                <div class="input-group mb-3 audience-item">
                    <span class="input-group-text bg-soft-info text-info">
                        <i class="feather-user"></i>
                    </span>
                    <input type="text" 
                           class="form-control" 
                           name="TargetAudience[0]" 
                           placeholder="مثال: المبتدئين في البرمجة">
                    <button class="btn btn-outline-danger" type="button" onclick="removeAudience(this)">
                        <i class="feather-trash-2"></i>
                    </button>
                </div>
            }
        </div>

        <button type="button" class="btn btn-sm btn-light-brand" onclick="addAudience()">
            <i class="feather-plus me-2"></i>
            إضافة فئة مستهدفة
        </button>
    </div>

    <!-- Estimated Duration -->
    <div class="form-section">
        <h5 class="form-section-title">
            <i class="feather-clock"></i>
            المدة المقدرة
        </h5>

        <div class="row">
            <div class="col-md-6">
                <label class="form-label fw-bold">المدة التقديرية للدورة (بالساعات)</label>
                <input asp-for="EstimatedDurationHours" 
                       type="number" 
                       class="form-control" 
                       min="0" 
                       max="1000" 
                       step="0.5"
                       placeholder="مثال: 10">
                <small class="text-muted">سيتم حسابها تلقائياً من محتوى الدورة إن لم تحدد</small>
            </div>
        </div>
    </div>
</div>

<script>
    let outcomeIndex = @(Model.LearningOutcomes?.Count ?? 3);
    let requirementIndex = @(Model.Requirements?.Count ?? 1);
    let audienceIndex = @(Model.TargetAudience?.Count ?? 1);

    function addOutcome() {
        const container = document.getElementById('learningOutcomesContainer');
        const html = `
            <div class="input-group mb-3 outcome-item">
                <span class="input-group-text bg-soft-primary text-primary">
                    <i class="feather-check-circle"></i>
                </span>
                <input type="text" class="form-control" name="LearningOutcomes[${outcomeIndex}]" placeholder="أضف نقطة تعلم جديدة...">
                <button class="btn btn-outline-danger" type="button" onclick="removeOutcome(this)">
                    <i class="feather-trash-2"></i>
                </button>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', html);
        outcomeIndex++;
        updateOutcomeButtons();
    }

    function removeOutcome(btn) {
        if (document.querySelectorAll('.outcome-item').length > 3) {
            btn.closest('.outcome-item').remove();
            reindexItems('learningOutcomesContainer', 'LearningOutcomes', 'outcome-item');
        }
        updateOutcomeButtons();
    }

    function updateOutcomeButtons() {
        const items = document.querySelectorAll('.outcome-item');
        items.forEach((item, index) => {
            const btn = item.querySelector('button');
            btn.disabled = items.length <= 3;
        });
    }

    function addRequirement() {
        const container = document.getElementById('requirementsContainer');
        const html = `
            <div class="input-group mb-3 requirement-item">
                <span class="input-group-text bg-soft-warning text-warning">
                    <i class="feather-alert-circle"></i>
                </span>
                <input type="text" class="form-control" name="Requirements[${requirementIndex}]" placeholder="أضف متطلب جديد...">
                <button class="btn btn-outline-danger" type="button" onclick="removeRequirement(this)">
                    <i class="feather-trash-2"></i>
                </button>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', html);
        requirementIndex++;
        updateRequirementButtons();
    }

    function removeRequirement(btn) {
        if (document.querySelectorAll('.requirement-item').length > 1) {
            btn.closest('.requirement-item').remove();
            reindexItems('requirementsContainer', 'Requirements', 'requirement-item');
        }
        updateRequirementButtons();
    }

    function updateRequirementButtons() {
        const items = document.querySelectorAll('.requirement-item');
        items.forEach((item, index) => {
            const btn = item.querySelector('button');
            btn.disabled = items.length <= 1;
        });
    }

    function addAudience() {
        const container = document.getElementById('targetAudienceContainer');
        const html = `
            <div class="input-group mb-3 audience-item">
                <span class="input-group-text bg-soft-info text-info">
                    <i class="feather-user"></i>
                </span>
                <input type="text" class="form-control" name="TargetAudience[${audienceIndex}]" placeholder="أضف فئة مستهدفة...">
                <button class="btn btn-outline-danger" type="button" onclick="removeAudience(this)">
                    <i class="feather-trash-2"></i>
                </button>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', html);
        audienceIndex++;
    }

    function removeAudience(btn) {
        btn.closest('.audience-item').remove();
        reindexItems('targetAudienceContainer', 'TargetAudience', 'audience-item');
    }

    function reindexItems(containerId, fieldName, itemClass) {
        const container = document.getElementById(containerId);
        const items = container.querySelectorAll('.' + itemClass);
        items.forEach((item, index) => {
            const input = item.querySelector('input');
            input.name = `${fieldName}[${index}]`;
        });
    }

    // Initialize button states
    document.addEventListener('DOMContentLoaded', function() {
        updateOutcomeButtons();
        updateRequirementButtons();
    });
</script>

