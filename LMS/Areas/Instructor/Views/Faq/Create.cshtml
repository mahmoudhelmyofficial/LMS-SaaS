@model LMS.Areas.Instructor.ViewModels.FaqFormViewModel

@{
    ViewData["Title"] = Html.T("إضافة سؤال شائع", "Add FAQ");
    ViewData["Subtitle"] = Html.T("إضافة سؤال جديد للأسئلة الشائعة", "Add new FAQ question");
    var indexUrl = Url.Action("Index");
}

@await Html.PartialAsync("_PageHeader", new ViewDataDictionary(ViewData)
{
    { "ActionButtons", Html.Raw($@"
        <a href='{indexUrl}' class='btn btn-light'>
            <i class='feather-arrow-right me-2'></i>
            " + Html.T("العودة", "Back") + @"
        </a>
    ") }
})

<div class="main-content">
    @await Html.PartialAsync("_AlertMessages")

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger mb-4">
            <h6 class="alert-heading mb-2">
                <i class="feather-alert-circle me-2"></i>
                @Html.T("يرجى تصحيح الأخطاء التالية:", "Please correct the following errors:")
            </h6>
            @Html.ValidationSummary(false, "", new { @class = "mb-0" })
        </div>
    }

    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("إضافة سؤال شائع جديد", "Add new FAQ question")</h5>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post">
                        @Html.AntiForgeryToken()

                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <!-- Course Selection -->
                        <div class="mb-4">
                            <label asp-for="CourseId" class="form-label">@Html.T("الدورة", "Course")</label>
                            <select asp-for="CourseId" class="form-select" id="courseSelect">
                                <option value="">@Html.T("-- اختر الدورة (اختياري) --", "-- Choose course (optional) --")</option>
                                @if (ViewBag.Courses != null)
                                {
                                    foreach (var course in ViewBag.Courses as IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>)
                                    {
                                        <option value="@course.Value" selected="@course.Selected">@course.Text</option>
                                    }
                                }
                            </select>
                            <div class="form-text">@Html.T("اختر الدورة المرتبطة بهذا السؤال (اختياري)", "Choose the course linked to this question (optional)")</div>
                            <span asp-validation-for="CourseId" class="text-danger"></span>
                        </div>

                        <!-- Lesson Selection -->
                        <div class="mb-4" id="lessonContainer" style="display: none;">
                            <label asp-for="LessonId" class="form-label">@Html.T("الدرس", "Lesson")</label>
                            <select asp-for="LessonId" class="form-select" id="lessonSelect" disabled>
                                <option value="">@Html.T("-- اختر الدرس (اختياري) --", "-- Choose lesson (optional) --")</option>
                            </select>
                            <div class="form-text">@Html.T("اختر الدرس المرتبط بهذا السؤال (اختياري)", "Choose the lesson linked to this question (optional)")</div>
                            <span asp-validation-for="LessonId" class="text-danger"></span>
                        </div>

                        <!-- Question -->
                        <div class="mb-4">
                            <label asp-for="Question" class="form-label required">@Html.T("السؤال", "Question")</label>
                            <textarea asp-for="Question" class="form-control" rows="3" placeholder="@Html.T("اكتب السؤال بشكل واضح ومباشر...", "Write the question clearly and directly...")" required></textarea>
                            <span asp-validation-for="Question" class="text-danger"></span>
                        </div>

                        <!-- Answer -->
                        <div class="mb-4">
                            <label asp-for="Answer" class="form-label required">@Html.T("الإجابة", "Answer")</label>
                            <textarea asp-for="Answer" class="form-control" rows="6" placeholder="@Html.T("اكتب الإجابة التفصيلية للسؤال...", "Write the detailed answer to the question...")" required></textarea>
                            <div class="form-text">@Html.T("اكتب إجابة واضحة وشاملة للسؤال", "Write a clear and comprehensive answer")</div>
                            <span asp-validation-for="Answer" class="text-danger"></span>
                        </div>

                        <!-- Category and Display Order -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label asp-for="Category" class="form-label">@Html.T("التصنيف", "Category")</label>
                                <select asp-for="Category" class="form-select">
                                    <option value="">@Html.T("-- اختر التصنيف --", "-- Choose category --")</option>
                                    <option value="عام">@Html.T("عام", "General")</option>
                                    <option value="تقني">@Html.T("تقني", "Technical")</option>
                                    <option value="محتوى">@Html.T("محتوى", "Content")</option>
                                    <option value="دفع">@Html.T("دفع", "Payment")</option>
                                    <option value="شهادات">@Html.T("شهادات", "Certificates")</option>
                                </select>
                                <span asp-validation-for="Category" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="DisplayOrder" class="form-label">@Html.T("ترتيب العرض", "Display order")</label>
                                <input asp-for="DisplayOrder" type="number" class="form-control" min="0" value="0" />
                                <div class="form-text">@Html.T("رقم أقل = يظهر أولاً", "Lower number = appears first")</div>
                                <span asp-validation-for="DisplayOrder" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex gap-2 justify-content-end">
                            <a href="@Url.Action("Index")" class="btn btn-light">
                                <i class="feather-x me-2"></i>
                                @Html.T("إلغاء", "Cancel")
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-check me-2"></i>
                                @Html.T("إضافة السؤال", "Add question")
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Tips Card -->
            <div class="card border-info">
                <div class="card-body">
                    <h6 class="fw-bold mb-3">
                        <i class="feather-lightbulb text-info me-2"></i>
                        @Html.T("نصائح لكتابة أسئلة شائعة فعالة", "Tips for writing effective FAQs")
                    </h6>
                    <ul class="mb-0">
                        <li class="mb-2">@Html.T("اكتب أسئلة واضحة ومباشرة يبحث عنها الطلاب فعلاً", "Write clear, direct questions students actually search for")</li>
                        <li class="mb-2">@Html.T("قدم إجابات شاملة وسهلة الفهم", "Provide comprehensive, easy-to-understand answers")</li>
                        <li class="mb-2">@Html.T("استخدم التصنيفات لتنظيم الأسئلة بشكل أفضل", "Use categories to organize questions better")</li>
                        <li>@Html.T("رتب الأسئلة حسب الأهمية والشيوع", "Order questions by importance and frequency")</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        window.__faqCreateI18n = {
            chooseLesson: @Html.Raw(Json.Serialize(Html.T("-- اختر الدرس (اختياري) --", "-- Choose lesson (optional) --").ToString())),
            noLessons: @Html.Raw(Json.Serialize(Html.T("لا توجد دروس متاحة", "No lessons available").ToString())),
            errorLoadingLessons: @Html.Raw(Json.Serialize(Html.T("حدث خطأ أثناء جلب الدروس", "An error occurred while loading lessons").ToString()))
        };
    </script>
    <script>
        $(document).ready(function () {
            var i = window.__faqCreateI18n;
            $('#courseSelect').change(function () {
                var courseId = $(this).val();
                var $lessonContainer = $('#lessonContainer');
                var $lessonSelect = $('#lessonSelect');

                if (courseId) {
                    // Show lesson container
                    $lessonContainer.show();

                    // Fetch lessons for the selected course
                    $.ajax({
                        url: '@Url.Action("GetLessons")',
                        type: 'GET',
                        data: { courseId: courseId },
                        success: function (lessons) {
                            $lessonSelect.empty();
                            $lessonSelect.append('<option value="">' + i.chooseLesson + '</option>');
                            
                            if (lessons && lessons.length > 0) {
                                lessons.forEach(function (lesson) {
                                    $lessonSelect.append('<option value="' + lesson.id + '">' + lesson.moduleTitle + ' - ' + lesson.title + '</option>');
                                });
                                $lessonSelect.prop('disabled', false);
                            } else {
                                $lessonSelect.append('<option value="">' + i.noLessons + '</option>');
                                $lessonSelect.prop('disabled', true);
                            }
                        },
                        error: function () {
                            alert(i.errorLoadingLessons);
                        }
                    });
                } else {
                    // Hide lesson container
                    $lessonContainer.hide();
                    $lessonSelect.empty();
                    $lessonSelect.prop('disabled', true);
                }
            });

            // Trigger change on page load if course is selected
            if ($('#courseSelect').val()) {
                $('#courseSelect').trigger('change');
            }
        });
    </script>
}

