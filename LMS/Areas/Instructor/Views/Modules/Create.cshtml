@model LMS.Areas.Instructor.ViewModels.ModuleCreateViewModel

@{
    ViewData["Title"] = Html.T("إنشاء وحدة جديدة", "Create New Module");
    ViewData["Subtitle"] = (Html.T("إضافة وحدة جديدة للدورة:", "Add new module for course:") + " " + (ViewBag.Course?.Title ?? "")).ToString();
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    @await Html.PartialAsync("_AlertMessages")

    <form asp-action="Create" method="post" id="moduleForm" data-msg-title="@Html.T("يرجى إدخال عنوان صحيح (3 أحرف على الأقل)", "Please enter a valid title (at least 3 characters)")">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="CourseId" />
        
        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                <!-- Basic Information -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-info me-2 text-primary"></i>
                            @Html.T("معلومات الوحدة", "Module information")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <div class="col-lg-12">
                                <label class="form-label">@Html.T("عنوان الوحدة", "Module title") <span class="text-danger">*</span></label>
                                <input asp-for="Title" class="form-control" placeholder="@Html.T("مثال: مقدمة في البرمجة", "e.g. Introduction to Programming")" required autofocus>
                                <span asp-validation-for="Title" class="text-danger"></span>
                                <div class="form-text">
                                    <i class="feather-info me-1"></i>
                                    @Html.T("اختر عنواناً واضحاً يصف محتوى الوحدة", "Choose a clear title that describes the module content")
                                </div>
                            </div>

                            <div class="col-lg-12">
                                <label class="form-label">@Html.T("وصف الوحدة", "Module description")</label>
                                <textarea asp-for="Description" class="form-control" rows="6" placeholder="@Html.T("وصف تفصيلي عن محتوى الوحدة وأهدافها", "Detailed description of module content and objectives")"></textarea>
                                <span asp-validation-for="Description" class="text-danger"></span>
                                <div class="form-text">
                                    @Html.T("اشرح ما سيتعلمه الطلاب في هذه الوحدة", "Explain what students will learn in this module")
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Course Context -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-book-open me-2 text-primary"></i>
                            @Html.T("معلومات الدورة", "Course information")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex align-items-center p-3 bg-soft-primary rounded">
                            <div class="avatar-text avatar-lg bg-primary text-white me-3">
                                <i class="feather-book-open fs-4"></i>
                            </div>
                            <div class="flex-1">
                                <h6 class="mb-1">@ViewBag.Course?.Title</h6>
                                <p class="text-muted small mb-0">
                                    <i class="feather-layers me-1"></i>
                                    @ViewBag.Course?.Modules?.Count @Html.T("وحدات حالياً", "modules currently")
                                </p>
                            </div>
                            <a href="@Url.Action("CreateWizard", "Courses", new { id = Model.CourseId, step = 3 })" class="btn btn-sm btn-light">
                                <i class="feather-eye me-2"></i>
                                @Html.T("عرض الدورة", "View course")
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Tips Card -->
                <div class="card stretch stretch-full mb-4 border-0 bg-soft-info">
                    <div class="card-body">
                        <h6 class="mb-3">
                            <i class="feather-lightbulb me-2 text-info"></i>
                            @Html.T("نصائح لإنشاء وحدة فعالة", "Tips for creating an effective module")
                        </h6>
                        <ul class="mb-0 ps-3">
                            <li class="mb-2">@Html.T("اختر عنواناً واضحاً ومحدداً يعكس محتوى الوحدة", "Choose a clear, specific title that reflects the module content")</li>
                            <li class="mb-2">@Html.T("قسّم المحتوى إلى وحدات منطقية ومتسلسلة", "Split content into logical, sequential modules")</li>
                            <li class="mb-2">@Html.T("اكتب وصفاً شاملاً يوضح أهداف التعلم", "Write a comprehensive description of learning objectives")</li>
                            <li class="mb-2">@Html.T("رتب الوحدات بشكل تدريجي من السهل إلى الصعب", "Order modules progressively from easy to hard")</li>
                            <li>@Html.T("أضف الدروس للوحدة بعد إنشائها", "Add lessons to the module after creating it")</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Publishing Options -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-settings me-2 text-primary"></i>
                            @Html.T("إعدادات النشر", "Publishing settings")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-light-warning border-0 mb-3">
                            <div class="d-flex">
                                <i class="feather-info fs-5 me-2"></i>
                                <div>
                                    <small class="d-block mb-1"><strong>@Html.T("ملاحظة:", "Note:")</strong></small>
                                    <small>@Html.T("سيتم إنشاء الوحدة كمسودة. يمكنك نشرها بعد إضافة الدروس.", "The module will be created as draft. You can publish it after adding lessons.")</small>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex align-items-center justify-content-between p-3 bg-soft-secondary rounded mb-3">
                            <div class="d-flex align-items-center">
                                <i class="feather-file-text fs-4 text-secondary me-3"></i>
                                <div>
                                    <strong class="d-block">@Html.T("حالة الوحدة", "Module status")</strong>
                                    <small class="text-muted">@Html.T("مسودة", "Draft")</small>
                                </div>
                            </div>
                            <span class="badge bg-soft-secondary text-secondary">
                                <i class="feather-edit-2"></i>
                            </span>
                        </div>

                        <div class="d-flex align-items-center justify-content-between p-3 bg-soft-info rounded">
                            <div class="d-flex align-items-center">
                                <i class="feather-hash fs-4 text-info me-3"></i>
                                <div>
                                    <strong class="d-block">@Html.T("الترتيب", "Order")</strong>
                                    <small class="text-muted">@Html.T("تلقائي", "Automatic")</small>
                                </div>
                            </div>
                            <span class="badge bg-soft-info text-info">
                                @Html.T("آخر وحدة", "Last module")
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Next Steps -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-check-circle me-2 text-success"></i>
                            @Html.T("الخطوات التالية", "Next steps")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-marker bg-primary"></div>
                                <div class="timeline-content">
                                    <h6 class="mb-1">@Html.T("إنشاء الوحدة", "Create module")</h6>
                                    <small class="text-muted">@Html.T("الخطوة الحالية", "Current step")</small>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-marker bg-secondary"></div>
                                <div class="timeline-content">
                                    <h6 class="mb-1">@Html.T("إضافة الدروس", "Add lessons")</h6>
                                    <small class="text-muted">@Html.T("بعد الإنشاء", "After creation")</small>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-marker bg-secondary"></div>
                                <div class="timeline-content">
                                    <h6 class="mb-1">@Html.T("إضافة المحتوى", "Add content")</h6>
                                    <small class="text-muted">@Html.T("فيديوهات ومرفقات", "Videos and attachments")</small>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-marker bg-secondary"></div>
                                <div class="timeline-content">
                                    <h6 class="mb-1">@Html.T("نشر الوحدة", "Publish module")</h6>
                                    <small class="text-muted">@Html.T("عند الاكتمال", "When complete")</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="card stretch stretch-full">
                    <div class="card-body">
                        <button type="submit" class="btn btn-primary w-100 mb-2">
                            <i class="feather-check me-2"></i>
                            @Html.T("إنشاء الوحدة", "Create module")
                        </button>
                        <a href="@Url.Action("CreateWizard", "Courses", new { id = Model.CourseId, step = 3 })" class="btn btn-light w-100">
                            <i class="feather-x me-2"></i>
                            @Html.T("إلغاء", "Cancel")
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<style>
    .timeline {
        position: relative;
        padding: 0;
    }
    
    .timeline-item {
        position: relative;
        padding-right: 30px;
        padding-bottom: 20px;
    }
    
    .timeline-item:last-child {
        padding-bottom: 0;
    }
    
    .timeline-item:not(:last-child)::before {
        content: '';
        position: absolute;
        right: 7px;
        top: 20px;
        height: calc(100% - 10px);
        width: 2px;
        background: #e5e7eb;
    }
    
    .timeline-marker {
        position: absolute;
        right: 0;
        top: 5px;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        border: 2px solid #fff;
    }
    
    .timeline-content {
        padding-right: 10px;
    }
</style>

@section Scripts {
    <script>
        // Form validation
        document.getElementById('moduleForm').addEventListener('submit', function(e) {
            const title = document.getElementById('Title').value.trim();

            if (!title || title.length < 3) {
                e.preventDefault();
                alert(document.getElementById('moduleForm').getAttribute('data-msg-title'));
                return false;
            }

            return true;
        });

        // Auto-focus on title input
        document.getElementById('Title')?.focus();
    </script>
    
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

