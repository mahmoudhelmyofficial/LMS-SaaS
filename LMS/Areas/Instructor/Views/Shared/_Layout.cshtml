@inject LMS.Services.Interfaces.IPlatformSettingsService PlatformSettings
@{
    var _platformName = await PlatformSettings.GetPlatformNameAsync();
    var _platformFavicon = await PlatformSettings.GetPlatformFaviconAsync();
}
<!DOCTYPE html>
<html lang="@Html.Lang()" dir="@Html.Dir()">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="@Html.T("منصة", "Platform") @_platformName - @Html.T("لوحة تحكم المدرس", "Instructor Dashboard")" />
    <meta name="author" content="@_platformName" />
    <partial name="_PwaMeta" />
    <title>@ViewData["Title"] - @Html.T("لوحة تحكم المدرس", "Instructor Dashboard") - @_platformName</title>
    
    <!-- Anti-Forgery Token is available via hidden input in the page -->
    
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="@Url.Content(string.IsNullOrEmpty(_platformFavicon) ? "~/assets/images/favicon.ico" : "~" + _platformFavicon)" />
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="~/assets/css/bootstrap.min.css" />
    
    <!-- Vendors CSS -->
    <link rel="stylesheet" type="text/css" href="~/assets/vendors/css/vendors.min.css" />
    <link rel="stylesheet" type="text/css" href="~/assets/vendors/css/feather.min.css" />
    <link rel="stylesheet" type="text/css" href="~/assets/vendors/css/daterangepicker.min.css" />
    
    <!-- Custom Theme CSS -->
    <link rel="stylesheet" type="text/css" href="~/assets/css/theme.min.css" />
    
    <!-- Mobile Responsive CSS -->
    <link rel="stylesheet" type="text/css" href="~/css/responsive-mobile.css" />
    
    <!-- Brand Identity CSS -->
    <link rel="stylesheet" type="text/css" href="~/css/brand-identity.css" />
    
    <!-- Site CSS - Global styles including modal fix -->
    <link rel="stylesheet" type="text/css" href="~/css/site.css" asp-append-version="true" />
    
    <!-- PerfectScrollbar CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/perfect-scrollbar/1.5.5/css/perfect-scrollbar.min.css" />
    
    <!-- Google Fonts - Cairo for Arabic -->
    @if (Html.IsRtl())
    {
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    }
    
    <!-- Conditional RTL/LTR Styles -->
    @if (Html.IsRtl())
    {
    <style>
        body {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: rtl;
            text-align: right;
        }
        
        /* Sidebar positioning for RTL */
        .nxl-navigation {
            position: fixed;
            top: 0;
            left: auto !important;
            right: 0 !important;
            width: 280px;
            height: 100vh;
            background-color: #fff;
            box-shadow: 0 0 15px rgba(0,0,0,.05);
            z-index: 1030;
            transition: all 0.3s ease;
        }
        
        .nxl-container {
            margin-left: 0 !important;
            margin-right: 280px !important;
            min-height: auto !important;
            display: flex;
            flex-direction: column;
            padding-top: 0px !important;
        }
        
        /* Header styles */
        .nxl-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 280px;
            height: 70px;
            background-color: #fff;
            border-bottom: 1px solid #eee;
            z-index: 1020;
            display: flex;
            align-items: center;
        }
        
        .header-wrapper {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            height: 100%;
        }
        
        /* Minimenu adjustments */
        html.minimenu .nxl-container {
            margin-right: 140px !important;
            min-height: auto !important;
        }
        
        html.minimenu .nxl-navigation {
            width: 120px !important;
        }
        
        html.minimenu .nxl-header {
            right: 120px;
        }
        
        /* Minimenu footer adjustment */
        html.minimenu .footer {
            right: 120px !important;
        }
        
        /* Dropdown arrow rotation for RTL */
        .nxl-arrow i {
            transform: rotate(180deg);
            transition: transform 0.25s ease;
        }
        
        .nxl-hasmenu.nxl-trigger .nxl-arrow i,
        .nxl-hasmenu.open .nxl-arrow i {
            transform: rotate(90deg);
        }
        
        /* RTL utility overrides */
        .ms-auto {
            margin-left: 0 !important;
            margin-right: auto !important;
        }
        
        .me-auto {
            margin-right: 0 !important;
            margin-left: auto !important;
        }
        
        /* Header layout for RTL */
        .header-wrapper {
            display: flex;
            justify-content: space-between;
        }
        
        .header-right {
            margin-right: auto !important;
            margin-left: 0 !important;
        }
        
        /* Mobile responsive */
        @@media (max-width: 1199px) {
            .nxl-container {
                margin-right: 0 !important;
                min-height: auto !important;
            }
            
            .nxl-navigation {
                right: -280px !important;
            }
            
            .nxl-header {
                left: 0 !important;
                right: 0 !important;
                width: 100% !important;
                height: 60px !important;
            }
            
            .nxl-content {
                padding-top: 60px !important;
            }
            
            /* Page header tablet adjustments */
            .page-header {
                margin: -1.5rem -1.5rem 1.5rem -1.5rem !important;
            }
            
            body.nxl-navigation-show .nxl-navigation {
                right: 0 !important;
            }
            
            /* Footer responsive - full width on mobile/tablet */
            .footer {
                right: 0 !important;
            }
        }
        
        @@media (max-width: 767px) {
            .nxl-header {
                height: 56px !important;
            }
            
            .header-wrapper {
                padding: 0 0.75rem !important;
                height: 56px !important;
            }
            
            .nxl-content {
                padding-top: 56px !important;
            }
            
            /* Main content mobile padding */
            .main-content {
                padding: 1rem !important;
            }
            
            /* Page header mobile adjustments */
            .page-header {
                padding: 0.75rem 1rem !important;
                margin: -1rem -1rem 1rem -1rem !important;
            }
            
            .page-header-title {
                margin-left: 1rem;
                padding-left: 1rem;
            }
            
            /* Mobile dropdown fix */
            .nxl-header .dropdown-menu {
                position: fixed !important;
                top: 56px !important;
                left: 10px !important;
                right: 10px !important;
                width: calc(100vw - 20px) !important;
                max-width: none !important;
                max-height: calc(100vh - 76px) !important;
                overflow-y: auto !important;
            }
        }
        
        /* Header dropdown styles */
        .nxl-header .dropdown,
        .nxl-header .nxl-h-item {
            position: relative;
        }
        
        .nxl-header .dropdown-menu {
            position: absolute;
            top: 100%;
            z-index: 1050;
            display: none;
            min-width: 200px;
            padding: 0.5rem 0;
            margin-top: 0.5rem;
            background-color: #fff;
            border: 1px solid rgba(0,0,0,.1);
            border-radius: 0.5rem;
            box-shadow: 0 0.5rem 1.5rem rgba(0,0,0,.15);
        }
        
        .nxl-header .dropdown-menu.show {
            display: block !important;
        }
        
        /* RTL: Dropdowns open towards center (left edge anchored) */
        .nxl-header .dropdown-menu-end,
        .nxl-header .dropdown-menu {
            left: 0 !important;
            right: auto !important;
        }
        
        /* Dropdown toggle active state */
        .header-dropdown-toggle.active {
            background-color: var(--primary-soft, #e8f0fb) !important;
            color: var(--primary, #004aad) !important;
        }
        
        /* Breadcrumb spacing for RTL */
        .breadcrumb {
            display: flex;
            flex-wrap: wrap;
            padding: 0;
            margin: 0 1.5rem;
            list-style: none;
            gap: 0.25rem;
            align-items: center;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .breadcrumb-item a {
            color: #6c757d;
            text-decoration: none;
        }
        
        .breadcrumb-item a:hover {
            color: var(--primary, #004aad);
        }
        
        .breadcrumb-item.active,
        .breadcrumb-item:last-child {
            color: #333;
            font-weight: 600;
        }
        
        .breadcrumb-item + .breadcrumb-item {
            padding-right: 0;
        }
        
        .breadcrumb-item + .breadcrumb-item::before {
            content: ">";
            padding: 0 0.75rem;
            color: #adb5bd;
            font-size: 0.75rem;
        }
        
        
        /* Main content wrapper - standard padding */
        .main-content {
            padding: 1.5rem;
        }
        
        /* Page header styling - Full width, no gap from navbar */
        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            margin: -1.5rem -1.5rem 1.5rem -1.5rem !important;
            flex-wrap: wrap;
            gap: 1rem;
            background-color: #fff;
            border-bottom: 1px solid #eee;
        }
        
        .page-header-left {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .page-header-title {
            margin-left: 1.5rem;
            padding-left: 1.5rem;
            border-left: 3px solid var(--primary, #004aad);
        }
        
        .page-header-title h5 {
            margin: 0;
            font-weight: 700;
            color: #333;
            font-size: 1.25rem;
        }
        
        .page-header-right {
            display: flex;
            align-items: center;
        }
        
        /* Submenu link styles */
        .nxl-submenu .nxl-link {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        .nxl-submenu .nxl-link:hover {
            color: var(--primary, #004aad);
            background-color: rgba(0, 74, 173, 0.05);
        }
        
        .nxl-submenu .nxl-link.active {
            color: var(--primary, #004aad);
            font-weight: 600;
        }
        
        /* Sidebar submenu styles */
        .nxl-submenu {
            display: none;
            list-style: none;
            margin: 0;
            padding: 0.5rem 0 0.5rem 1rem;
            background-color: rgba(0,0,0,.02);
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.25s ease-out, padding 0.25s ease-out;
        }
        
        .nxl-hasmenu.nxl-trigger > .nxl-submenu,
        .nxl-hasmenu.open > .nxl-submenu {
            display: block;
            max-height: 500px;
            transition: max-height 0.3s ease-in;
        }
        
        /* Navbar content scrollbar */
        .navbar-content {
            position: relative;
            height: calc(100vh - 80px);
            overflow: hidden;
        }
        
        .navbar-wrapper {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .m-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #eee;
            min-height: 100px;
            display: flex;
            align-items: center;
        }
        
        .b-brand {
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        
        .b-brand img {
            max-width: 100%;
            height: auto;
            object-fit: contain;
        }
        
        /* Navbar item styles */
        .nxl-navbar {
            list-style: none;
            margin: 0;
            padding: 1rem 0;
        }
        
        .nxl-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            text-decoration: none;
            color: #333;
            border-radius: 0.375rem;
            margin: 0 0.5rem;
            transition: all 0.2s;
        }
        
        .nxl-link:hover {
            background-color: rgba(0, 74, 173, 0.1);
            color: var(--primary, #004aad);
        }
        
        .nxl-micon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 0.75rem;
        }
        
        .nxl-mtext {
            flex: 1;
        }
        
        .nxl-caption {
            padding: 1rem 1.5rem 0.5rem;
        }
        
        .nxl-caption label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #999;
        }
        
        .logo-sm { display: none; }
        html.minimenu .logo-lg { display: none; }
        html.minimenu .logo-sm { display: block; }
        
        /* Header dropdown toggle */
        .header-dropdown-toggle {
            display: flex !important;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background-color: #f5f5f5;
            color: #333;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .header-dropdown-toggle:hover,
        .header-dropdown-toggle.active {
            background-color: var(--primary-soft, #e8f0fb);
            color: var(--primary, #004aad);
        }
        
        .header-dropdown-toggle i,
        .header-dropdown-toggle .avatar-text {
            pointer-events: none;
        }
        
        .nxl-h-item {
            position: relative;
            margin: 0 0.25rem;
        }
        
        .nxl-h-badge {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 10px;
            min-width: 18px;
            height: 18px;
            padding: 0 4px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Avatar styles */
        .avatar-text {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: 600;
        }
        
        .avatar-md {
            width: 40px;
            height: 40px;
            font-size: 14px;
        }
        
        .avatar-sm {
            width: 32px;
            height: 32px;
            font-size: 12px;
        }
        
        /* Dropdown item styling */
        .dropdown-item {
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: #333;
            transition: background-color 0.2s;
        }
        
        .dropdown-item:hover {
            background-color: #f8f9fa;
        }
        
        .dropdown-item i {
            width: 18px;
        }
        
        /* Notifications styling */
        .notifications-head {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .notifications-item {
            display: flex;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .notifications-item:hover {
            background-color: #f8f9fa;
        }
        
        .notifications-desc {
            flex: 1;
            margin-right: 0.75rem;
        }
        
        .notifications-footer {
            padding: 0.75rem;
            border-top: 1px solid #eee;
        }
        
        .nxl-notifications-menu {
            min-width: 320px !important;
        }
        
        .nxl-user-dropdown {
            min-width: 220px !important;
        }
        
        .dropdown-header {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        /* Search dropdown */
        .nxl-search-dropdown {
            min-width: 300px !important;
            padding: 1rem !important;
        }
        
        /* Navigation toggle */
        .nxl-navigation-toggle a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .nxl-navigation-toggle a:hover {
            background-color: var(--primary-soft, #e8f0fb);
            color: var(--primary, #004aad);
        }
        
        .nxl-navigation-toggle a i {
            font-size: 20px;
        }
        
        /* Hamburger menu styling */
        .hamburger {
            cursor: pointer;
            padding: 10px;
        }
        
        .hamburger-box {
            width: 20px;
            height: 16px;
            position: relative;
        }
        
        .hamburger-inner,
        .hamburger-inner::before,
        .hamburger-inner::after {
            width: 20px;
            height: 2px;
            background-color: #333;
            position: absolute;
            transition: transform 0.15s ease;
        }
        
        .hamburger-inner {
            top: 50%;
            transform: translateY(-50%);
        }
        
        .hamburger-inner::before {
            content: '';
            top: -6px;
        }
        
        .hamburger-inner::after {
            content: '';
            bottom: -6px;
        }
    </style>
    }
    else
    {
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: ltr;
            text-align: left;
        }
        
        /* Sidebar positioning for LTR */
        .nxl-navigation {
            position: fixed;
            top: 0;
            left: 0;
            right: auto !important;
            width: 280px;
            height: 100vh;
            background-color: #fff;
            box-shadow: 0 0 15px rgba(0,0,0,.05);
            z-index: 1030;
            transition: all 0.3s ease;
        }
        
        .nxl-container {
            margin-left: 280px !important;
            margin-right: 0 !important;
            min-height: auto !important;
            display: flex;
            flex-direction: column;
            padding-top: 0px !important;
        }
        
        /* Header styles */
        .nxl-header {
            position: fixed;
            top: 0;
            left: 280px;
            right: 0;
            height: 70px;
            background-color: #fff;
            border-bottom: 1px solid #eee;
            z-index: 1020;
            display: flex;
            align-items: center;
        }
        
        .header-wrapper {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            height: 100%;
        }
        
        /* Minimenu adjustments */
        html.minimenu .nxl-container {
            margin-left: 140px !important;
            min-height: auto !important;
        }
        
        html.minimenu .nxl-navigation {
            width: 120px !important;
        }
        
        html.minimenu .nxl-header {
            left: 120px;
        }
        
        /* Minimenu footer adjustment */
        html.minimenu .footer {
            left: 120px !important;
        }
        
        /* Dropdown arrow */
        .nxl-arrow i {
            transition: transform 0.25s ease;
        }
        
        .nxl-hasmenu.nxl-trigger .nxl-arrow i,
        .nxl-hasmenu.open .nxl-arrow i {
            transform: rotate(90deg);
        }
        
        /* Mobile responsive */
        @@media (max-width: 1199px) {
            .nxl-container {
                margin-left: 0 !important;
                min-height: auto !important;
            }
            
            .nxl-navigation {
                left: -280px !important;
            }
            
            .nxl-header {
                left: 0 !important;
                right: 0 !important;
                width: 100% !important;
                height: 60px !important;
            }
            
            .nxl-content {
                padding-top: 60px !important;
            }
            
            .page-header {
                margin: -1.5rem -1.5rem 1.5rem -1.5rem !important;
            }
            
            body.nxl-navigation-show .nxl-navigation {
                left: 0 !important;
            }
            
            .footer {
                left: 0 !important;
            }
        }
        
        @@media (max-width: 767px) {
            .nxl-header {
                height: 56px !important;
            }
            
            .header-wrapper {
                padding: 0 0.75rem !important;
                height: 56px !important;
            }
            
            .nxl-content {
                padding-top: 56px !important;
            }
            
            .main-content {
                padding: 1rem !important;
            }
            
            .page-header {
                padding: 0.75rem 1rem !important;
                margin: -1rem -1rem 1rem -1rem !important;
            }
            
            .page-header-title {
                margin-right: 1rem;
                padding-right: 1rem;
            }
            
            .nxl-header .dropdown-menu {
                position: fixed !important;
                top: 56px !important;
                left: 10px !important;
                right: 10px !important;
                width: calc(100vw - 20px) !important;
                max-width: none !important;
                max-height: calc(100vh - 76px) !important;
                overflow-y: auto !important;
            }
        }
        
        /* Header dropdown styles */
        .nxl-header .dropdown,
        .nxl-header .nxl-h-item {
            position: relative;
        }
        
        .nxl-header .dropdown-menu {
            position: absolute;
            top: 100%;
            z-index: 1050;
            display: none;
            min-width: 200px;
            padding: 0.5rem 0;
            margin-top: 0.5rem;
            background-color: #fff;
            border: 1px solid rgba(0,0,0,.1);
            border-radius: 0.5rem;
            box-shadow: 0 0.5rem 1.5rem rgba(0,0,0,.15);
        }
        
        .nxl-header .dropdown-menu.show {
            display: block !important;
        }
        
        /* LTR: Dropdowns open towards right */
        .nxl-header .dropdown-menu-end,
        .nxl-header .dropdown-menu {
            right: 0 !important;
            left: auto !important;
        }
        
        .header-dropdown-toggle.active {
            background-color: var(--primary-soft, #e8f0fb) !important;
            color: var(--primary, #004aad) !important;
        }
        
        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            flex-wrap: wrap;
            padding: 0;
            margin: 0 1.5rem;
            list-style: none;
            gap: 0.25rem;
            align-items: center;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .breadcrumb-item a {
            color: #6c757d;
            text-decoration: none;
        }
        
        .breadcrumb-item a:hover {
            color: var(--primary, #004aad);
        }
        
        .breadcrumb-item.active,
        .breadcrumb-item:last-child {
            color: #333;
            font-weight: 600;
        }
        
        .breadcrumb-item + .breadcrumb-item::before {
            content: ">";
            padding: 0 0.75rem;
            color: #adb5bd;
            font-size: 0.75rem;
        }
        
        /* Main content */
        .main-content {
            padding: 1.5rem;
        }
        
        /* Page header */
        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            margin: -1.5rem -1.5rem 1.5rem -1.5rem !important;
            flex-wrap: wrap;
            gap: 1rem;
            background-color: #fff;
            border-bottom: 1px solid #eee;
        }
        
        .page-header-left {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .page-header-title {
            margin-right: 1.5rem;
            padding-right: 1.5rem;
            border-right: 3px solid var(--primary, #004aad);
        }
        
        .page-header-title h5 {
            margin: 0;
            font-weight: 700;
            color: #333;
            font-size: 1.25rem;
        }
        
        .page-header-right {
            display: flex;
            align-items: center;
        }
        
        /* Submenu link styles */
        .nxl-submenu .nxl-link {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        .nxl-submenu .nxl-link:hover {
            color: var(--primary, #004aad);
            background-color: rgba(0, 74, 173, 0.05);
        }
        
        .nxl-submenu .nxl-link.active {
            color: var(--primary, #004aad);
            font-weight: 600;
        }
        
        /* Sidebar submenu */
        .nxl-submenu {
            display: none;
            list-style: none;
            margin: 0;
            padding: 0.5rem 0 0.5rem 1rem;
            background-color: rgba(0,0,0,.02);
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.25s ease-out, padding 0.25s ease-out;
        }
        
        .nxl-hasmenu.nxl-trigger > .nxl-submenu,
        .nxl-hasmenu.open > .nxl-submenu {
            display: block;
            max-height: 500px;
            transition: max-height 0.3s ease-in;
        }
        
        /* Navbar */
        .navbar-content {
            position: relative;
            height: calc(100vh - 80px);
            overflow: hidden;
        }
        
        .navbar-wrapper {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .m-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #eee;
            min-height: 100px;
            display: flex;
            align-items: center;
        }
        
        .b-brand {
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        
        .b-brand img {
            max-width: 100%;
            height: auto;
            object-fit: contain;
        }
        
        .nxl-navbar {
            list-style: none;
            margin: 0;
            padding: 1rem 0;
        }
        
        .nxl-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            text-decoration: none;
            color: #333;
            border-radius: 0.375rem;
            margin: 0 0.5rem;
            transition: all 0.2s;
        }
        
        .nxl-link:hover {
            background-color: rgba(0, 74, 173, 0.1);
            color: var(--primary, #004aad);
        }
        
        .nxl-micon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
        }
        
        .nxl-mtext {
            flex: 1;
        }
        
        .nxl-caption {
            padding: 1rem 1.5rem 0.5rem;
        }
        
        .nxl-caption label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #999;
        }
        
        .logo-sm { display: none; }
        html.minimenu .logo-lg { display: none; }
        html.minimenu .logo-sm { display: block; }
        
        /* Header dropdown toggle */
        .header-dropdown-toggle {
            display: flex !important;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background-color: #f5f5f5;
            color: #333;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .header-dropdown-toggle:hover,
        .header-dropdown-toggle.active {
            background-color: var(--primary-soft, #e8f0fb);
            color: var(--primary, #004aad);
        }
        
        .header-dropdown-toggle i,
        .header-dropdown-toggle .avatar-text {
            pointer-events: none;
        }
        
        .nxl-h-item {
            position: relative;
            margin: 0 0.25rem;
        }
        
        .nxl-h-badge {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 10px;
            min-width: 18px;
            height: 18px;
            padding: 0 4px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .avatar-text {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: 600;
        }
        
        .avatar-md {
            width: 40px;
            height: 40px;
            font-size: 14px;
        }
        
        .avatar-sm {
            width: 32px;
            height: 32px;
            font-size: 12px;
        }
        
        .dropdown-item {
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: #333;
            transition: background-color 0.2s;
        }
        
        .dropdown-item:hover {
            background-color: #f8f9fa;
        }
        
        .dropdown-item i {
            width: 18px;
        }
        
        .notifications-head {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .notifications-item {
            display: flex;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .notifications-item:hover {
            background-color: #f8f9fa;
        }
        
        .notifications-desc {
            flex: 1;
            margin-left: 0.75rem;
        }
        
        .notifications-footer {
            padding: 0.75rem;
            border-top: 1px solid #eee;
        }
        
        .nxl-notifications-menu {
            min-width: 320px !important;
        }
        
        .nxl-user-dropdown {
            min-width: 220px !important;
        }
        
        .dropdown-header {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .nxl-search-dropdown {
            min-width: 300px !important;
            padding: 1rem !important;
        }
        
        .nxl-navigation-toggle a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .nxl-navigation-toggle a:hover {
            background-color: var(--primary-soft, #e8f0fb);
            color: var(--primary, #004aad);
        }
        
        .nxl-navigation-toggle a i {
            font-size: 20px;
        }
        
        .hamburger {
            cursor: pointer;
            padding: 10px;
        }
        
        .hamburger-box {
            width: 20px;
            height: 16px;
            position: relative;
        }
        
        .hamburger-inner,
        .hamburger-inner::before,
        .hamburger-inner::after {
            width: 20px;
            height: 2px;
            background-color: #333;
            position: absolute;
            transition: transform 0.15s ease;
        }
        
        .hamburger-inner {
            top: 50%;
            transform: translateY(-50%);
        }
        
        .hamburger-inner::before {
            content: '';
            top: -6px;
        }
        
        .hamburger-inner::after {
            content: '';
            bottom: -6px;
        }
    </style>
    }
    
    @RenderSection("Styles", required: false)
</head>

<body>
    <!-- Locale strings for JS (AR/EN) - extended by views via Object.assign(window.__T, {...}) -->
    <script>
        window.__T = window.__T || {};
        (function() {
            var t = {
                Error: '@Html.Raw(Html.T("حدث خطأ", "An error occurred").Replace("\\", "\\\\").Replace("'", "\\'"))',
                Processing: '@Html.Raw(Html.T("جاري المعالجة...", "Processing...").Replace("\\", "\\\\").Replace("'", "\\'"))',
                Success: '@Html.Raw(Html.T("تمت العملية بنجاح", "Success").Replace("\\", "\\\\").Replace("'", "\\'"))',
                Close: '@Html.Raw(Html.T("إغلاق", "Close").Replace("\\", "\\\\").Replace("'", "\\'"))',
                ConfirmDelete: '@Html.Raw(Html.T("هل أنت متأكد من الحذف؟", "Are you sure you want to delete?").Replace("\\", "\\\\").Replace("'", "\\'"))'
            };
            Object.assign(window.__T, t);
        })();
    </script>
    <!--! [Start] Navigation Menu !-->
    @await Html.PartialAsync("~/Areas/Instructor/Views/Shared/_Sidebar.cshtml")
    <!--! [End] Navigation Menu !-->
    
    <!--! [Start] Header !-->
    @await Html.PartialAsync("~/Areas/Instructor/Views/Shared/_Header.cshtml")
    <!--! [End] Header !-->
    
    <main class="nxl-container">
        <div class="nxl-content" style="flex: 1 0 auto;">
            <div class="main-content" style="height: auto; display: block;">
                @RenderBody()
            </div>
        </div>
        
        <!-- Footer Spacer -->
        <div style="height: 80px;"></div>
        
        <!-- Fixed Footer -->
        <footer class="footer" style="position: fixed; bottom: 0; @(Html.IsRtl() ? "left: 0; right: 280px;" : "right: 0; left: 280px;") height: 40px; background-color: #f8f9fa; border-top: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: center; z-index: 1000;">
            <p class="fs-11 text-muted fw-medium text-uppercase mb-0 copyright">
                <span>&copy; @DateTime.Now.Year @Html.T("منصة WEBUILDER.", "WEBUILDER Platform.")</span>
                <span class="d-none d-sm-inline-block">@Html.T("جميع الحقوق محفوظة.", "All rights reserved.")</span>
            </p>
        </footer>
    </main>
    
    <!-- Media Picker Modal -->
    @await Html.PartialAsync("_MediaPickerModal")
    
    <!-- jQuery -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    
    <!-- Bootstrap Bundle -->
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- PerfectScrollbar -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/perfect-scrollbar/1.5.5/perfect-scrollbar.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Site.js - Global scripts including modal fix -->
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/pwa-register.js" asp-append-version="true"></script>
    <script src="~/js/instructor-push-subscribe.js" asp-append-version="true"></script>
    
    <!-- Media Picker JavaScript -->
    <script src="~/js/media-picker.js" asp-append-version="true"></script>
    
    <script>
        (function() {
            'use strict';
            
            document.addEventListener('DOMContentLoaded', function() {
                initSidebar();
                initHeaderDropdowns();
                initMobileToggle();
                initScrollbar();
            });
            
            function initSidebar() {
                var STORAGE_KEY = 'instructor_sidebar_state';
                
                // Use event delegation for better reliability
                var navContent = document.querySelector('.navbar-content');
                if (!navContent) return;
                
                // Mark initialized to prevent duplicate handlers
                if (navContent.dataset.sidebarInitialized) return;
                navContent.dataset.sidebarInitialized = 'true';
                
                navContent.addEventListener('click', function(e) {
                    // Find the clicked link within a hasmenu item
                    var link = e.target.closest('.nxl-hasmenu > .nxl-link');
                    if (!link) return;
                    
                    // Only handle if it's a toggle link (javascript:void(0) or has arrow)
                    var hasArrow = link.querySelector('.nxl-arrow');
                    var href = link.getAttribute('href');
                    if (!hasArrow && href && href !== 'javascript:void(0);') return;
                    
                    e.preventDefault();
                    e.stopPropagation();
                    
                    var parent = link.parentElement;
                    var isOpen = parent.classList.contains('nxl-trigger');
                    
                    // Close all other open menus first (accordion behavior)
                    document.querySelectorAll('.nxl-hasmenu.nxl-trigger, .nxl-hasmenu.open').forEach(function(openMenu) {
                        if (openMenu !== parent) {
                            openMenu.classList.remove('nxl-trigger');
                            openMenu.classList.remove('open');
                        }
                    });
                    
                    // Toggle current menu
                    if (isOpen) {
                        parent.classList.remove('nxl-trigger');
                        parent.classList.remove('open');
                    } else {
                        parent.classList.add('nxl-trigger');
                        parent.classList.add('open');
                    }
                    
                    // Save state to localStorage
                    saveMenuState();
                });
                
                // Save menu state
                function saveMenuState() {
                    var openMenus = [];
                    document.querySelectorAll('.nxl-hasmenu.nxl-trigger, .nxl-hasmenu.open').forEach(function(menu) {
                        var link = menu.querySelector('.nxl-link .nxl-mtext');
                        if (link) {
                            openMenus.push(link.textContent.trim());
                        }
                    });
                    try {
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(openMenus));
                    } catch (e) { /* ignore */ }
                }
                
                // Restore menu state
                function restoreMenuState() {
                    try {
                        var saved = localStorage.getItem(STORAGE_KEY);
                        if (saved) {
                            var openMenus = JSON.parse(saved);
                            document.querySelectorAll('.nxl-hasmenu').forEach(function(menu) {
                                var link = menu.querySelector('.nxl-link .nxl-mtext');
                                if (link && openMenus.includes(link.textContent.trim())) {
                                    menu.classList.add('nxl-trigger');
                                    menu.classList.add('open');
                                }
                            });
                        }
                    } catch (e) { /* ignore */ }
                }
                
                // Initialize: ensure active menus are open and restore saved state
                document.querySelectorAll('.nxl-hasmenu.active').forEach(function(menu) {
                    menu.classList.add('nxl-trigger');
                    menu.classList.add('open');
                });
                
                restoreMenuState();
            }
            
            function initHeaderDropdowns() {
                var isProcessingTouch = false;
                
                // Core toggle function
                function toggleDropdown(toggle) {
                    var parent = toggle.closest('.dropdown, .nxl-h-item');
                    if (!parent) return false;
                    
                    var menu = parent.querySelector('.dropdown-menu');
                    if (!menu) return false;
                    
                    var isOpen = menu.classList.contains('show');
                    
                    // Close all other dropdowns first
                    closeAllDropdowns();
                    
                    // Toggle current dropdown
                    if (!isOpen) {
                        menu.classList.add('show');
                        toggle.classList.add('active');
                        menu.setAttribute('data-just-opened', 'true');
                        setTimeout(function() {
                            menu.removeAttribute('data-just-opened');
                        }, 200);
                    }
                    return true;
                }
                
                // Handle click events on dropdown toggles
                document.addEventListener('click', function(e) {
                    // Skip if we just processed a touch event
                    if (isProcessingTouch) {
                        isProcessingTouch = false;
                        return;
                    }
                    
                    var toggle = e.target.closest('.header-dropdown-toggle');
                    
                    if (toggle) {
                        e.preventDefault();
                        e.stopPropagation();
                        toggleDropdown(toggle);
                        return;
                    }
                    
                    // Check if clicked inside a dropdown menu (don't close)
                    var insideDropdownMenu = e.target.closest('.nxl-h-item .dropdown-menu');
                    if (insideDropdownMenu && !insideDropdownMenu.hasAttribute('data-just-opened')) {
                        return;
                    }
                    
                    // Close dropdowns when clicking outside
                    var insideHeaderItem = e.target.closest('.nxl-h-item');
                    if (!insideHeaderItem) {
                        closeAllDropdowns();
                    }
                }, true); // Use capture phase
                
                // Handle touch events for mobile - using touchstart for better responsiveness
                document.addEventListener('touchstart', function(e) {
                    var toggle = e.target.closest('.header-dropdown-toggle');
                    if (toggle) {
                        e.preventDefault();
                        isProcessingTouch = true;
                        toggleDropdown(toggle);
                    }
                }, { passive: false });
                
                // Handle Escape key to close dropdowns
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        closeAllDropdowns();
                    }
                });
            }
            
            function closeAllDropdowns() {
                document.querySelectorAll('.nxl-h-item .dropdown-menu.show').forEach(function(m) {
                    m.classList.remove('show');
                    m.removeAttribute('data-just-opened');
                });
                document.querySelectorAll('.header-dropdown-toggle.active').forEach(function(t) {
                    t.classList.remove('active');
                });
            }
            
            function initMobileToggle() {
                var toggle = document.getElementById('mobile-collapse');
                var sidebarCloseBtn = document.getElementById('sidebar-close-btn');
                var miniBtn = document.getElementById('menu-mini-button');
                var expandBtn = document.getElementById('menu-expend-button');
                
                if (toggle) {
                    toggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.body.classList.toggle('nxl-navigation-show');
                    });
                }
                
                // Sidebar close button handler
                if (sidebarCloseBtn) {
                    sidebarCloseBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.body.classList.remove('nxl-navigation-show');
                    });
                }
                
                // Menu mini/expand buttons
                if (miniBtn) {
                    miniBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.documentElement.classList.add('minimenu');
                        this.style.display = 'none';
                        if (expandBtn) expandBtn.style.display = 'block';
                    });
                }
                
                if (expandBtn) {
                    expandBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.documentElement.classList.remove('minimenu');
                        this.style.display = 'none';
                        if (miniBtn) miniBtn.style.display = 'block';
                    });
                }
                
                // Close sidebar when clicking on overlay
                document.addEventListener('click', function(e) {
                    if (document.body.classList.contains('nxl-navigation-show')) {
                        var navigation = document.querySelector('.nxl-navigation');
                        var header = document.querySelector('.nxl-header');
                        var isClickInsideNav = navigation && navigation.contains(e.target);
                        var isClickOnToggle = toggle && toggle.contains(e.target);
                        var isClickInsideHeader = header && header.contains(e.target);
                        
                        // Don't close sidebar when clicking inside header or navigation
                        if (!isClickInsideNav && !isClickOnToggle && !isClickInsideHeader) {
                            document.body.classList.remove('nxl-navigation-show');
                        }
                    }
                });
            }
            
            function initScrollbar() {
                var nav = document.querySelector('.navbar-content');
                if (nav && typeof PerfectScrollbar !== 'undefined') {
                    new PerfectScrollbar(nav, { suppressScrollX: true });
                }
            }
        })();
    </script>
    
    <!-- SignalR for Real-time Notifications -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer"></script>
    <script src="~/js/notification-hub.js" asp-append-version="true"></script>
    
    @RenderSection("Scripts", required: false)
</body>
</html>
