@model LMS.Areas.Instructor.ViewModels.InstructorSettingsViewModel

@{
    ViewData["Title"] = Html.T("الإعدادات", "Settings");
    ViewData["Subtitle"] = Html.T("إدارة إعدادات حسابك وتفضيلاتك", "Manage account settings and preferences");
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    @await Html.PartialAsync("_AlertMessages")

    <form asp-action="Settings" method="post">
        @Html.AntiForgeryToken()
        
        <div class="row">
            <!-- Profile Information -->
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("المعلومات الشخصية", "Personal information")</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label asp-for="FirstName" class="form-label"></label>
                                <input asp-for="FirstName" class="form-control" />
                                <span asp-validation-for="FirstName" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="LastName" class="form-label"></label>
                                <input asp-for="LastName" class="form-control" />
                                <span asp-validation-for="LastName" class="text-danger"></span>
                            </div>
                            <div class="col-12">
                                <label asp-for="Email" class="form-label"></label>
                                <input asp-for="Email" class="form-control" readonly />
                                <small class="text-muted">لا يمكن تعديل البريد الإلكتروني</small>
                            </div>
                            <div class="col-12">
                                <label asp-for="Headline" class="form-label"></label>
                                <input asp-for="Headline" class="form-control" placeholder="@Html.T("مثال: مطور ويب خبير | مدرب معتمد", "e.g. Expert web developer | Certified trainer")" />
                                <span asp-validation-for="Headline" class="text-danger"></span>
                            </div>
                            <div class="col-12">
                                <label asp-for="Bio" class="form-label"></label>
                                <textarea asp-for="Bio" class="form-control" rows="3" placeholder="@Html.T("نبذة مختصرة عنك...", "A brief about you...")"></textarea>
                                <span asp-validation-for="Bio" class="text-danger"></span>
                            </div>
                            <div class="col-12">
                                <label asp-for="InstructorBio" class="form-label"></label>
                                <textarea asp-for="InstructorBio" class="form-control" rows="5" placeholder="@Html.T("سيرة ذاتية تفصيلية كمدرس...", "Detailed bio as an instructor...")"></textarea>
                                <span asp-validation-for="InstructorBio" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="Country" class="form-label"></label>
                                <input asp-for="Country" class="form-control" />
                                <span asp-validation-for="Country" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="City" class="form-label"></label>
                                <input asp-for="City" class="form-control" />
                                <span asp-validation-for="City" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="Website" class="form-label"></label>
                                <input asp-for="Website" class="form-control" placeholder="https://example.com" />
                                <span asp-validation-for="Website" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="TimeZone" class="form-label"></label>
                                <select asp-for="TimeZone" asp-items="ViewBag.Timezones" class="form-select"></select>
                                <span asp-validation-for="TimeZone" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="Language" class="form-label"></label>
                                <select asp-for="Language" class="form-select">
                                    <option value="ar">@Html.T("العربية", "Arabic")</option>
                                    <option value="en">@Html.T("English", "English")</option>
                                </select>
                                <span asp-validation-for="Language" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Settings -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("إعدادات الدفع", "Payment settings")</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-12">
                                <label asp-for="PayoutMethod" class="form-label"></label>
                                <select asp-for="PayoutMethod" class="form-select" id="payoutMethodSelect" asp-items="ViewBag.PaymentMethods"></select>
                                <span asp-validation-for="PayoutMethod" class="text-danger"></span>
                            </div>

                            <!-- PayPal Details -->
                            <div class="col-12 paypal-section" style="display: none;">
                                <label asp-for="PayPalEmail" class="form-label">
                                    بريد PayPal <span class="text-danger">*</span>
                                </label>
                                <input asp-for="PayPalEmail" class="form-control" type="email" placeholder="your-email@example.com" />
                                <span asp-validation-for="PayPalEmail" class="text-danger"></span>
                                <small class="text-muted">البريد الإلكتروني المسجل في حساب PayPal</small>
                            </div>

                            <!-- Bank Details -->
                            <div class="bank-section" style="display: none;">
                                <div class="col-12">
                                    <label asp-for="BankName" class="form-label">
                                        اسم البنك <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="BankName" class="form-control" placeholder="@Html.T("مثال: البنك الأهلي المصري", "e.g. National Bank of Egypt")" />
                                    <span asp-validation-for="BankName" class="text-danger"></span>
                                </div>
                                <div class="col-12">
                                    <label asp-for="BankAccountName" class="form-label">
                                        اسم صاحب الحساب <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="BankAccountName" class="form-control" placeholder="@Html.T("الاسم كما يظهر في البطاقة", "Name as it appears on the card")" />
                                    <span asp-validation-for="BankAccountName" class="text-danger"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="BankAccountNumber" class="form-label">
                                        رقم الحساب البنكي <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="BankAccountNumber" class="form-control" placeholder="123456789012" />
                                    <span asp-validation-for="BankAccountNumber" class="text-danger"></span>
                                </div>
                                <div class="col-md-6">
                                    <label asp-for="IBAN" class="form-label">@Html.T("رمز IBAN", "IBAN")</label>
                                    <input asp-for="IBAN" class="form-control" placeholder="EG123456789012345678901234" />
                                    <span asp-validation-for="IBAN" class="text-danger"></span>
                                    <small class="text-muted">مطلوب للتحويلات الدولية</small>
                                </div>
                                <div class="col-12">
                                    <label asp-for="SwiftCode" class="form-label">@Html.T("رمز SWIFT/BIC", "SWIFT/BIC code")</label>
                                    <input asp-for="SwiftCode" class="form-control" placeholder="NBEGEGCXXXX" maxlength="11" />
                                    <span asp-validation-for="SwiftCode" class="text-danger"></span>
                                    <small class="text-muted">اختياري - مطلوب للتحويلات الدولية (8-11 حرف)</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notification Preferences -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("تفضيلات الإشعارات", "Notification preferences")</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch">
                            <input asp-for="EmailNotifications" class="form-check-input" type="checkbox" />
                            <label asp-for="EmailNotifications" class="form-check-label"></label>
                        </div>
                        <small class="text-muted">ستتلقى إشعارات حول طلبات الطلاب، المبيعات، والتحديثات المهمة</small>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <a href="@Url.Action("Index")" class="btn btn-light">
                                <i class="feather-x me-2"></i>إلغاء
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-save me-2"></i>حفظ الإعدادات
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar - Account Stats -->
            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("حالة الحساب", "Account status")</h5>
                    </div>
                    <div class="card-body">
                        @if (Model.IsApproved)
                        {
                            <div class="alert alert-success mb-3">
                                <i class="feather-check-circle me-2"></i>
                                حسابك مُفعّل
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-warning mb-3">
                                <i class="feather-alert-circle me-2"></i>
                                في انتظار الموافقة
                            </div>
                        }

                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">التقييم</span>
                                <span class="fw-bold">
                                    <i class="feather-star text-warning"></i>
                                    @Model.AverageRating.ToString("F1")
                                </span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">إجمالي الطلاب</span>
                                <span class="fw-bold">@Model.TotalStudents</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">معدل العمولة</span>
                                <span class="fw-bold text-warning">@Model.CommissionRate.ToString("F0")%</span>
                            </div>
                        </div>

                        <hr />

                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="text-muted">إجمالي الأرباح</span>
                                <span class="fw-bold text-success">@Model.TotalEarnings.ToEGP()</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">الرصيد المتاح</span>
                                <span class="fw-bold text-primary">@Model.AvailableBalance.ToEGP()</span>
                            </div>
                        </div>

                        <a href="@Url.Action("Index", "Earnings")" class="btn btn-soft-primary w-100">
                            @if (ViewBag.DefaultCurrencySymbol != null)
                            {
                                <span style="font-weight: bold; margin-left: 8px;">@ViewBag.DefaultCurrencySymbol</span>
                            }
                            else
                            {
                                <i class="feather-dollar-sign me-2"></i>
                            }
                            عرض الأرباح
                        </a>
                    </div>
                </div>

                <!-- Quick Links -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("روابط سريعة", "Quick links")</h5>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            <a href="@Url.Action("Index", "Profile")" class="list-group-item list-group-item-action">
                                <i class="feather-user me-3"></i>
                                الملف الشخصي
                            </a>
                            <a href="@Url.Action("Edit", "Profile")" class="list-group-item list-group-item-action">
                                <i class="feather-edit me-3"></i>
                                تعديل الملف الشخصي
                            </a>
                            <a href="@Url.Action("PaymentSettings", "Profile")" class="list-group-item list-group-item-action">
                                <i class="feather-credit-card me-3"></i>
                                إعدادات الدفع
                            </a>
                            <a href="@Url.Action("Index", "Courses")" class="list-group-item list-group-item-action">
                                <i class="feather-book me-3"></i>
                                دوراتي
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
    
    <script>
        $(document).ready(function () {
            // Show/hide payment method fields based on selection
            function togglePaymentFields() {
                var method = $('#payoutMethodSelect').val();
                
                $('.paypal-section, .bank-section').hide();
                
                if (method === 'PayPal') {
                    $('.paypal-section').show();
                } else if (method === 'BankTransfer') {
                    $('.bank-section').show();
                }
            }

            // Initialize on page load
            togglePaymentFields();

            // Handle changes
            $('#payoutMethodSelect').on('change', function() {
                togglePaymentFields();
            });
        });
    </script>
}

