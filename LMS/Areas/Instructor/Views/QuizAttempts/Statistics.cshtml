@model LMS.Areas.Instructor.ViewModels.QuizAttemptStatisticsViewModel

@{
    ViewData["Title"] = Html.T("إحصائيات الاختبارات", "Quiz Statistics");
}

@await Html.PartialAsync("_PageHeader", new ViewDataDictionary(ViewData)
{
    { "ActionButtons", Html.Raw("<a href='" + Url.Action("Index") + "' class='btn btn-light'><i class='feather-arrow-right me-2'></i>" + Html.T("العودة للمحاولات", "Back to attempts") + "</a>") }
})

<div class="main-content">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <form method="get" class="row g-3">
                        <div class="col-md-5">
                            <label class="form-label">الدورة</label>
                            <select name="courseId" class="form-select" onchange="this.form.submit()">
                                <option value="">@Html.T("جميع الدورات", "All Courses")</option>
                                @if (ViewBag.Courses != null)
                                {
                                    foreach (var course in ViewBag.Courses as IEnumerable<LMS.Domain.Entities.Courses.Course>)
                                    {
                                        <option value="@course.Id" selected="@(ViewBag.CourseId == course.Id)">@course.Title</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="col-md-5">
                            <label class="form-label">الاختبار</label>
                            <select name="quizId" class="form-select" onchange="this.form.submit()">
                                <option value="">جميع الاختبارات</option>
                                @if (ViewBag.Quizzes != null)
                                {
                                    foreach (var quiz in ViewBag.Quizzes as IEnumerable<LMS.Domain.Entities.Assessments.Quiz>)
                                    {
                                        <option value="@quiz.Id" selected="@(ViewBag.QuizId == quiz.Id)">@quiz.Title</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary w-100"><i class="feather-filter me-2"></i>تصفية</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-xxl-3 col-md-6">
            @await Html.PartialAsync("_StatCard", new ViewDataDictionary(ViewData)
            {
                { "Label", "إجمالي المحاولات" },
                { "Value", Model.TotalAttempts },
                { "Icon", "file-text" },
                { "Color", "primary" }
            })
        </div>
        <div class="col-xxl-3 col-md-6">
            @await Html.PartialAsync("_StatCard", new ViewDataDictionary(ViewData)
            {
                { "Label", "الناجحون" },
                { "Value", Model.PassedCount },
                { "Icon", "check-circle" },
                { "Color", "success" }
            })
        </div>
        <div class="col-xxl-3 col-md-6">
            @await Html.PartialAsync("_StatCard", new ViewDataDictionary(ViewData)
            {
                { "Label", "الراسبون" },
                { "Value", Model.FailedCount },
                { "Icon", "x-circle" },
                { "Color", "danger" }
            })
        </div>
        <div class="col-xxl-3 col-md-6">
            @await Html.PartialAsync("_StatCard", new ViewDataDictionary(ViewData)
            {
                { "Label", "متوسط الدرجة" },
                { "Value", Model.AverageScore.ToString("F1") + "%" },
                { "Icon", "trending-up" },
                { "Color", "info" }
            })
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("الدرجات", "Scores")</h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled mb-0">
                        <li class="d-flex justify-content-between py-2 border-bottom">
                            <span>أعلى درجة</span>
                            <strong class="text-success">@Model.HighestScore.ToString("F1")%</strong>
                        </li>
                        <li class="d-flex justify-content-between py-2 border-bottom">
                            <span>متوسط الدرجة</span>
                            <strong class="text-primary">@Model.AverageScore.ToString("F1")%</strong>
                        </li>
                        <li class="d-flex justify-content-between py-2">
                            <span>أقل درجة</span>
                            <strong class="text-danger">@Model.LowestScore.ToString("F1")%</strong>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("الأداء", "Performance")</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>معدل النجاح</span>
                            <strong>@((Model.TotalAttempts > 0 ? (Model.PassedCount * 100.0 / Model.TotalAttempts) : 0).ToString("F1"))%</strong>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-success" style="width: @((Model.TotalAttempts > 0 ? (Model.PassedCount * 100.0 / Model.TotalAttempts) : 0).ToString("F1"))%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>متوسط الوقت</span>
                            <strong>@Model.AverageTimeMinutes.ToString("F1") دقيقة</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

