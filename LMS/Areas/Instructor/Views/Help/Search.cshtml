@{
    ViewData["Title"] = "نتائج البحث";
    var query = ViewBag.SearchQuery as string ?? "";
}

@await Html.PartialAsync("_HelpStyles")

<!-- Page Header -->
<div class="page-header">
    <div class="page-header-left d-flex align-items-center">
        <div class="page-header-title">
            <h5 class="m-0">نتائج البحث</h5>
        </div>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-area="Instructor" asp-controller="Dashboard" asp-action="Index">الرئيسية</a></li>
            <li class="breadcrumb-item"><a asp-action="Index">مركز المساعدة</a></li>
            <li class="breadcrumb-item active">نتائج البحث</li>
        </ol>
    </div>
</div>

<div class="row">
    <div class="col-lg-3 mb-4">
        @await Html.PartialAsync("_HelpSidebar", "Search")
    </div>
    
    <div class="col-lg-9">
        <!-- Search Box -->
        <div class="help-section">
            <div class="help-search" style="max-width: 100%;">
                <form asp-action="Search" method="get" style="position: relative;">
                    <input type="text" name="query" value="@query" 
                           placeholder="ابحث عن موضوع..." 
                           class="form-control form-control-lg" 
                           style="padding-right: 3rem; border-radius: 12px;" />
                    <button type="submit" class="btn btn-link" 
                            style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%);">
                        <i class="feather-search text-muted"></i>
                    </button>
                </form>
            </div>
        </div>
        
        @if (!string.IsNullOrEmpty(query))
        {
            <div class="help-section">
                <h4 class="mb-4">نتائج البحث عن: "@query"</h4>
                
                @{
                    var queryLower = query.ToLower();
                    var results = new List<(string Title, string Description, string Action, string Icon, string Color)>();
                    
                    // Search in all topics
                    if (queryLower.Contains("دورة") || queryLower.Contains("إنشاء") || queryLower.Contains("course"))
                    {
                        results.Add(("إنشاء الدورات", "دليل شامل لإنشاء دورات احترافية", "CourseCreation", "book-open", "green"));
                    }
                    if (queryLower.Contains("محتوى") || queryLower.Contains("درس") || queryLower.Contains("وحدة") || queryLower.Contains("اختبار"))
                    {
                        results.Add(("إدارة المحتوى", "الوحدات والدروس والاختبارات", "ContentManagement", "layers", "purple"));
                    }
                    if (queryLower.Contains("مباشر") || queryLower.Contains("live") || queryLower.Contains("جلسة") || queryLower.Contains("بث"))
                    {
                        results.Add(("الجلسات المباشرة", "البث المباشر وجدولة المحتوى", "LiveSessions", "video", "red"));
                    }
                    if (queryLower.Contains("أرباح") || queryLower.Contains("سحب") || queryLower.Contains("دفع") || queryLower.Contains("مال") || queryLower.Contains("كوبون"))
                    {
                        results.Add(("الأرباح والتسويق", "الأرباح والكوبونات والتسويق", "EarningsMarketing", "dollar-sign", "orange"));
                    }
                    if (queryLower.Contains("طالب") || queryLower.Contains("تقييم") || queryLower.Contains("رسالة"))
                    {
                        results.Add(("إدارة الطلاب", "التواصل والتقييمات والمتابعة", "StudentManagement", "users", "teal"));
                    }
                    if (queryLower.Contains("تحليل") || queryLower.Contains("إحصائ") || queryLower.Contains("تقرير"))
                    {
                        results.Add(("التحليلات", "فهم الإحصائيات والتقارير", "Analytics", "bar-chart-2", "indigo"));
                    }
                    if (queryLower.Contains("ملف") || queryLower.Contains("شخصي") || queryLower.Contains("حساب") || queryLower.Contains("بداية"))
                    {
                        results.Add(("دليل البدء", "إعداد حسابك وخطواتك الأولى", "GettingStarted", "play-circle", "blue"));
                    }
                    if (queryLower.Contains("باقة") || queryLower.Contains("bundle"))
                    {
                        results.Add(("إنشاء الباقات", "تجميع الدورات بسعر مخفض", "CourseCreation", "package", "green"));
                    }
                    if (queryLower.Contains("مسار") || queryLower.Contains("path"))
                    {
                        results.Add(("مسارات التعلم", "تنظيم رحلة تعليمية متسلسلة", "CourseCreation", "git-branch", "green"));
                    }
                    
                    // If no specific results, show general topics
                    if (!results.Any())
                    {
                        results.Add(("دليل البدء السريع", "تعرف على لوحة التحكم", "GettingStarted", "play-circle", "blue"));
                        results.Add(("إنشاء الدورات", "دليل إنشاء الدورات", "CourseCreation", "book-open", "green"));
                        results.Add(("الأسئلة الشائعة", "إجابات على الأسئلة المتكررة", "FAQ", "help-circle", "pink"));
                    }
                }
                
                <div class="row g-3">
                    @foreach (var result in results)
                    {
                        <div class="col-md-6">
                            <a asp-action="@result.Action" class="d-block p-4 bg-light rounded-3 text-decoration-none text-dark hover-shadow" 
                               style="transition: all 0.2s ease;">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="flex-shrink-0">
                                        <div class="feature-icon @result.Color" style="width: 48px; height: 48px; font-size: 18px;">
                                            <i class="feather-@result.Icon"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">@result.Title</h6>
                                        <p class="mb-0 text-muted small">@result.Description</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                    }
                </div>
            </div>
        }
        else
        {
            <div class="help-section text-center py-5">
                <i class="feather-search text-muted" style="font-size: 4rem;"></i>
                <h4 class="mt-3">ابحث عن موضوع</h4>
                <p class="text-muted">اكتب كلمة البحث في المربع أعلاه</p>
            </div>
        }
        
        <!-- Popular Topics -->
        <div class="help-section">
            <h5 class="mb-3"><i class="feather-trending-up text-primary me-2"></i> المواضيع الأكثر بحثاً</h5>
            <div class="d-flex flex-wrap gap-2">
                <a asp-action="Search" asp-route-query="إنشاء دورة" class="btn btn-outline-secondary btn-sm">إنشاء دورة</a>
                <a asp-action="Search" asp-route-query="سحب الأرباح" class="btn btn-outline-secondary btn-sm">سحب الأرباح</a>
                <a asp-action="Search" asp-route-query="جلسة مباشرة" class="btn btn-outline-secondary btn-sm">جلسة مباشرة</a>
                <a asp-action="Search" asp-route-query="رفع فيديو" class="btn btn-outline-secondary btn-sm">رفع فيديو</a>
                <a asp-action="Search" asp-route-query="كوبون خصم" class="btn btn-outline-secondary btn-sm">كوبون خصم</a>
                <a asp-action="Search" asp-route-query="إنشاء اختبار" class="btn btn-outline-secondary btn-sm">إنشاء اختبار</a>
            </div>
        </div>
    </div>
</div>

<style>
    .hover-shadow:hover {
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }
</style>

