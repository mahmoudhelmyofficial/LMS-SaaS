@model LMS.Domain.Entities.Financial.WithdrawalMethod

@{
    ViewData["Title"] = Html.T("تفاصيل طريقة السحب", "Withdrawal method details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الإدارة المالية", "Financial"), null),
        (Html.T("طرق السحب", "Withdrawal methods"), Url.Action("Index", "WithdrawalMethods")),
        (Html.T("التفاصيل", "Details"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        (Html.T("تعديل", "Edit"), "feather-edit", Url.Action("Edit", "WithdrawalMethods", new { id = Model.Id }), "btn-primary")
    };
    ViewData["HeaderActions"] = actions;
}

@section Styles {
    <style>
        .method-icon-large {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }
        .info-row {
            border-bottom: 1px solid #e5e7eb;
            padding: 12px 0;
        }
        .info-row:last-child {
            border-bottom: none;
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<!-- Main Content -->
<div class="main-content">
    <div class="row">
        <!-- Status Card -->
        <div class="col-lg-12 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body text-center py-4">
                    @if (!string.IsNullOrEmpty(Model.IconUrl))
                    {
                        <img src="@Model.IconUrl" alt="@Model.DisplayName" class="method-icon-large mb-3" />
                    }
                    else
                    {
                        <div class="avatar-text avatar-xxl rounded bg-soft-primary text-primary mb-3 mx-auto">
                            <i class="feather-credit-card" style="font-size: 2.5rem;"></i>
                        </div>
                    }
                    <h3 class="mb-2">@Model.DisplayName</h3>
                    <p class="text-muted mb-3">@Model.MethodType</p>
                    @if (Model.IsEnabled)
                    {
                        <span class="badge bg-soft-success text-success fs-6 px-3 py-2">
                            <i class="feather-check-circle me-1"></i>
                            مفعلة
                        </span>
                    }
                    else
                    {
                        <span class="badge bg-soft-danger text-danger fs-6 px-3 py-2">
                            <i class="feather-x-circle me-1"></i>
                            معطلة
                        </span>
                    }
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="col-xxl-3 col-md-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-primary text-primary">
                            <i class="feather-trending-up"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("إجمالي الطلبات", "Total requests")</span>
                            <h3 class="fw-bolder d-block">@ViewBag.TotalRequests.ToString("N0")</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xxl-3 col-md-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-warning text-warning">
                            <i class="feather-clock"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("معلقة", "Pending")</span>
                            <h3 class="fw-bolder d-block">@ViewBag.PendingRequests.ToString("N0")</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xxl-3 col-md-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-success text-success">
                            <i class="feather-check-circle"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("موافق عليها", "Approved")</span>
                            <h3 class="fw-bolder d-block">@ViewBag.ApprovedRequests.ToString("N0")</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xxl-3 col-md-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-info text-info">
                            <i class="feather-dollar-sign"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("إجمالي المبلغ", "Total amount")</span>
                            <h3 class="fw-bolder d-block">@ViewBag.TotalAmount.ToEGP()</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Basic Information -->
        <div class="col-lg-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("المعلومات الأساسية", "Basic information")</h5>
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <label class="text-muted">@Html.T("اسم الطريقة", "Method name")</label>
                        <p class="fw-semibold mb-0">@Model.Name</p>
                    </div>
                    <div class="info-row">
                        <label class="text-muted">@Html.T("الاسم المعروض", "Display name")</label>
                        <p class="fw-semibold mb-0">@Model.DisplayName</p>
                    </div>
                    <div class="info-row">
                        <label class="text-muted">@Html.T("نوع الطريقة", "Method type")</label>
                        <p class="mb-0"><span class="badge bg-soft-info text-info">@Model.MethodType</span></p>
                    </div>
                    <div class="info-row">
                        <label class="text-muted">@Html.T("الوصف", "Description")</label>
                        <p class="mb-0">@(Model.Description ?? "لا يوجد وصف")</p>
                    </div>
                    <div class="info-row">
                        <label class="text-muted">@Html.T("وقت المعالجة", "Processing time")</label>
                        <p class="mb-0">@(Model.ProcessingTime ?? "غير محدد")</p>
                    </div>
                    <div class="info-row">
                        <label class="text-muted">@Html.T("ترتيب العرض", "Display order")</label>
                        <p class="fw-semibold mb-0">#@Model.DisplayOrder</p>
                    </div>
                    <div class="info-row">
                        <label class="text-muted">@Html.T("تاريخ الإنشاء", "Created date")</label>
                        <p class="mb-0">@Model.CreatedAt.ToString("dd/MM/yyyy hh:mm tt")</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Limits and Fees -->
        <div class="col-lg-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("الحدود والرسوم", "Limits and fees")</h5>
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <label class="text-muted">@Html.T("الحد الأدنى للسحب", "Min withdrawal")</label>
                        <p class="fw-bold text-primary mb-0">@Model.MinAmount.ToEGP()</p>
                    </div>
                    <div class="info-row">
                        <label class="text-muted">@Html.T("الحد الأقصى للسحب", "Max withdrawal")</label>
                        <p class="fw-bold text-primary mb-0">@Model.MaxAmount.ToEGP()</p>
                    </div>
                    <div class="info-row">
                        <label class="text-muted">@Html.T("رسوم النسبة المئوية", "Percentage fee")</label>
                        <p class="mb-0">
                            @if (Model.FeePercentage > 0)
                            {
                                <span class="badge bg-soft-warning text-warning">@Model.FeePercentage%</span>
                            }
                            else
                            {
                                <span class="text-muted">@Html.T("لا يوجد", "None")</span>
                            }
                        </p>
                    </div>
                    <div class="info-row">
                        <label class="text-muted">@Html.T("الرسوم الثابتة", "Fixed fee")</label>
                        <p class="mb-0">
                            @if (Model.FixedFee > 0)
                            {
                                <span class="badge bg-soft-warning text-warning">@Model.FixedFee.ToEGP()</span>
                            }
                            else
                            {
                                <span class="text-muted">@Html.T("لا يوجد", "None")</span>
                            }
                        </p>
                    </div>
                    <div class="info-row">
                        <label class="text-muted">@Html.T("إجمالي الرسوم", "Total fees")</label>
                        <p class="mb-0">
                            @if (Model.FeePercentage == 0 && Model.FixedFee == 0)
                            {
                                <span class="badge bg-soft-success text-success">@Html.T("مجاني", "Free")</span>
                            }
                            else
                            {
                                <span class="text-dark">
                                    @if (Model.FeePercentage > 0)
                                    {
                                        <text>@Model.FeePercentage% </text>
                                    }
                                    @if (Model.FeePercentage > 0 && Model.FixedFee > 0)
                                    {
                                        <text>+ </text>
                                    }
                                    @if (Model.FixedFee > 0)
                                    {
                                        <text>@Model.FixedFee.ToEGP()</text>
                                    }
                                </span>
                            }
                        </p>
                    </div>
                    <div class="info-row">
                        <label class="text-muted">@Html.T("مثال على الرسوم (لمبلغ 1000 ر.س)", "Fee example (for 1000 amount)")</label>
                        @{
                            var exampleAmount = 1000m;
                            var calculatedFee = (exampleAmount * Model.FeePercentage / 100) + Model.FixedFee;
                            var netAmount = exampleAmount - calculatedFee;
                        }
                        <p class="mb-0">
                            <span class="text-danger">@Html.T("رسوم", "Fee"): @calculatedFee.ToEGP()</span> |
                            <span class="text-success">@Html.T("صافي", "Net"): @netAmount.ToEGP()</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Settings -->
        <div class="col-lg-12 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("الإعدادات المتقدمة", "Advanced settings")</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-row">
                                <label class="text-muted">@Html.T("العملات المدعومة", "Supported currencies")</label>
                                <p class="mb-0">
                                    <code class="text-dark">@Model.SupportedCurrencies</code>
                                </p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-row">
                                <label class="text-muted">@Html.T("الحقول المطلوبة", "Required fields")</label>
                                <p class="mb-0">
                                    <code class="text-dark">@Model.RequiredFields</code>
                                </p>
                            </div>
                        </div>
                        @if (!string.IsNullOrEmpty(Model.Instructions))
                        {
                            <div class="col-12">
                                <div class="info-row">
                                    <label class="text-muted">@Html.T("التعليمات", "Instructions")</label>
                                    <div class="alert alert-info mt-2 mb-0">
                                        @Model.Instructions
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="col-lg-12">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex gap-2 justify-content-between">
                        <form method="post" asp-action="ToggleEnabled" asp-route-id="@Model.Id">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-@(Model.IsEnabled ? "warning" : "success")">
                                <i class="feather-toggle-@(Model.IsEnabled ? "left" : "right") me-2"></i>
                                @(Model.IsEnabled ? Html.T("تعطيل", "Disable") : Html.T("تفعيل", "Enable")) @Html.T("الطريقة", "method")
                            </button>
                        </form>
                        <div class="d-flex gap-2">
                            <a href="@Url.Action("Index", "WithdrawalMethods")" class="btn btn-light">
                                <i class="feather-list me-2"></i>
                                العودة للقائمة
                            </a>
                            <a href="@Url.Action("Edit", "WithdrawalMethods", new { id = Model.Id })" class="btn btn-primary">
                                <i class="feather-edit me-2"></i>
                                تعديل
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

