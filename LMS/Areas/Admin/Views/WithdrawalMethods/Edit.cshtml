@model LMS.Areas.Admin.ViewModels.WithdrawalMethodViewModel

@{
    ViewData["Title"] = Html.T("تعديل طريقة السحب", "Edit withdrawal method");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الإدارة المالية", "Financial management"), null),
        (Html.T("طرق السحب", "Withdrawal methods"), Url.Action("Index", "WithdrawalMethods")),
        (Html.T("تعديل", "Edit"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@await Html.PartialAsync("_PageHeader")

<!-- Main Content -->
<div class="main-content">
    <div class="row">
        <div class="col-lg-12">
            <!-- Usage Warning -->
            @if (Model.UsageCount > 0)
            {
                <div class="alert alert-warning mb-4">
                    <i class="feather-alert-triangle me-2"></i>
                    <strong>@Html.T("تحذير:", "Warning:")</strong> @Html.T("هذه الطريقة مستخدمة في", "This method is used in") <strong>@Model.UsageCount</strong> @Html.T("عملية سحب. التعديلات ستؤثر على العمليات المستقبلية فقط.", "withdrawal(s). Changes will affect future operations only.")
                </div>
            }

            <form asp-action="Edit" method="post" class="needs-validation" novalidate>
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="Id" />
                <input type="hidden" asp-for="UsageCount" />
                <input type="hidden" asp-for="CreatedAt" />
                
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("المعلومات الأساسية", "Basic information")</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label asp-for="Name" class="form-label required">@Html.T("اسم الطريقة (بالإنجليزية)", "Method name (English)")</label>
                                <input asp-for="Name" class="form-control" placeholder="@Html.T("مثال: bank_transfer", "e.g. bank_transfer")" required />
                                <span asp-validation-for="Name" class="text-danger"></span>
                                <small class="text-muted">@Html.T("يستخدم في النظام (بدون مسافات)", "Used in system (no spaces)")</small>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="DisplayName" class="form-label required">@Html.T("الاسم المعروض", "Display name")</label>
                                <input asp-for="DisplayName" class="form-control" placeholder="@Html.T("تحويل بنكي", "Bank transfer")" required />
                                <span asp-validation-for="DisplayName" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="MethodType" class="form-label required">@Html.T("نوع الطريقة", "Method type")</label>
                                <select asp-for="MethodType" class="form-select" required>
                                    <option value="">-- @Html.T("اختر النوع", "Select type") --</option>
                                    <option value="BankTransfer">@Html.T("تحويل بنكي", "Bank transfer")</option>
                                    <option value="PayPal">PayPal</option>
                                    <option value="Payoneer">Payoneer</option>
                                    <option value="Stripe">Stripe</option>
                                    <option value="Check">@Html.T("شيك", "Check")</option>
                                    <option value="Cryptocurrency">@Html.T("عملة رقمية", "Cryptocurrency")</option>
                                    <option value="MobileWallet">@Html.T("محفظة إلكترونية", "Mobile wallet")</option>
                                    <option value="Other">@Html.T("أخرى", "Other")</option>
                                </select>
                                <span asp-validation-for="MethodType" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="IconUrl" class="form-label">@Html.T("رابط الأيقونة", "Icon URL")</label>
                                <input asp-for="IconUrl" class="form-control" placeholder="https://example.com/icon.png" />
                                <span asp-validation-for="IconUrl" class="text-danger"></span>
                            </div>

                            <div class="col-12">
                                <label asp-for="Description" class="form-label">@Html.T("الوصف", "Description")</label>
                                <textarea asp-for="Description" class="form-control" rows="3" placeholder="@Html.T("وصف طريقة السحب...", "Description of the withdrawal method...")"></textarea>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("الحدود والرسوم", "Limits and fees")</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label asp-for="MinAmount" class="form-label required">@Html.T("الحد الأدنى للسحب", "Minimum withdrawal")</label>
                                <div class="input-group">
                                    <input asp-for="MinAmount" type="number" step="0.01" class="form-control" required />
                                    <span class="input-group-text">@Html.T("ر.س", "SAR")</span>
                                </div>
                                <span asp-validation-for="MinAmount" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="MaxAmount" class="form-label required">@Html.T("الحد الأقصى للسحب", "Maximum withdrawal")</label>
                                <div class="input-group">
                                    <input asp-for="MaxAmount" type="number" step="0.01" class="form-control" required />
                                    <span class="input-group-text">@Html.T("ر.س", "SAR")</span>
                                </div>
                                <span asp-validation-for="MaxAmount" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="FeePercentage" class="form-label">@Html.T("رسوم النسبة المئوية", "Fee percentage")</label>
                                <div class="input-group">
                                    <input asp-for="FeePercentage" type="number" step="0.01" class="form-control" />
                                    <span class="input-group-text">%</span>
                                </div>
                                <span asp-validation-for="FeePercentage" class="text-danger"></span>
                                <small class="text-muted">@Html.T("أدخل 0 إذا لم تكن هناك رسوم نسبية", "Enter 0 if no percentage fee")</small>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="FixedFee" class="form-label">@Html.T("رسوم ثابتة", "Fixed fee")</label>
                                <div class="input-group">
                                    <input asp-for="FixedFee" type="number" step="0.01" class="form-control" />
                                    <span class="input-group-text">@Html.T("ر.س", "SAR")</span>
                                </div>
                                <span asp-validation-for="FixedFee" class="text-danger"></span>
                                <small class="text-muted">@Html.T("أدخل 0 إذا لم تكن هناك رسوم ثابتة", "Enter 0 if no fixed fee")</small>
                            </div>

                            <div class="col-12">
                                <div class="alert alert-info">
                                    <i class="feather-info me-2"></i>
                                    <strong>@Html.T("ملاحظة:", "Note:")</strong> @Html.T("سيتم احتساب الرسوم النهائية: المبلغ × نسبة الرسوم + الرسوم الثابتة", "Final fee = Amount × Fee % + Fixed fee")
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("الإعدادات المتقدمة", "Advanced settings")</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label asp-for="ProcessingTime" class="form-label">@Html.T("وقت المعالجة", "Processing time")</label>
                                <input asp-for="ProcessingTime" class="form-control" placeholder="@Html.T("3-5 أيام عمل", "3-5 business days")" />
                                <span asp-validation-for="ProcessingTime" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="DisplayOrder" class="form-label">@Html.T("ترتيب العرض", "Display order")</label>
                                <input asp-for="DisplayOrder" type="number" class="form-control" />
                                <span asp-validation-for="DisplayOrder" class="text-danger"></span>
                                <small class="text-muted">@Html.T("الترتيب في قائمة طرق السحب", "Order in withdrawal methods list")</small>
                            </div>

                            <div class="col-md-12">
                                <label asp-for="SupportedCurrencies" class="form-label">@Html.T("العملات المدعومة (JSON)", "Supported currencies (JSON)")</label>
                                <textarea asp-for="SupportedCurrencies" class="form-control font-monospace" rows="2"></textarea>
                                <span asp-validation-for="SupportedCurrencies" class="text-danger"></span>
                                <small class="text-muted">@Html.T("مصفوفة JSON للعملات المدعومة", "JSON array of supported currencies")</small>
                            </div>

                            <div class="col-md-12">
                                <label asp-for="RequiredFields" class="form-label">@Html.T("الحقول المطلوبة (JSON)", "Required fields (JSON)")</label>
                                <textarea asp-for="RequiredFields" class="form-control font-monospace" rows="3"></textarea>
                                <span asp-validation-for="RequiredFields" class="text-danger"></span>
                                <small class="text-muted">@Html.T("مصفوفة JSON للحقول التي يجب على المستخدم ملؤها", "JSON array of fields the user must fill")</small>
                            </div>

                            <div class="col-12">
                                <label asp-for="Instructions" class="form-label">@Html.T("تعليمات السحب", "Withdrawal instructions")</label>
                                <textarea asp-for="Instructions" class="form-control" rows="4" placeholder="@Html.T("أدخل التعليمات التفصيلية لكيفية استخدام هذه الطريقة...", "Enter detailed instructions on how to use this method...")"></textarea>
                                <span asp-validation-for="Instructions" class="text-danger"></span>
                            </div>

                            <div class="col-12">
                                <div class="form-check form-switch">
                                    <input asp-for="IsEnabled" class="form-check-input" type="checkbox" id="isEnabledSwitch" />
                                    <label class="form-check-label" for="isEnabledSwitch">
                                        @Html.T("تفعيل طريقة السحب", "Enable withdrawal method")
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card stretch stretch-full">
                    <div class="card-body">
                        <div class="d-flex gap-2 justify-content-between">
                            <a href="@Url.Action("Details", "WithdrawalMethods", new { id = Model.Id })" class="btn btn-light">
                                <i class="feather-eye me-2"></i>
                                @Html.T("عرض التفاصيل", "View details")
                            </a>
                            <div class="d-flex gap-2">
                                <a href="@Url.Action("Index", "WithdrawalMethods")" class="btn btn-light">
                                    <i class="feather-x me-2"></i>
                                    إلغاء
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="feather-save me-2"></i>
                                    حفظ التغييرات
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        // Form validation
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault()
                            event.stopPropagation()
                        }
                        form.classList.add('was-validated')
                    }, false)
                })
        })()
    </script>
}

