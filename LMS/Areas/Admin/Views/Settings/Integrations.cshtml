@model List<LMS.Domain.Entities.Settings.PlatformSetting>
@{
    ViewData["Title"] = Html.T("التكاملات", "Integrations");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الإعدادات", "Settings"), Url.Action("Index", "Settings")),
        (Html.T("التكاملات", "Integrations"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    
    // Helper to get setting value
    string GetSetting(string key, string defaultValue = "") => 
        Model?.FirstOrDefault(s => s.Key == key)?.Value ?? defaultValue;
    
    bool GetBoolSetting(string key, bool defaultValue = false) =>
        Model?.FirstOrDefault(s => s.Key == key)?.Value?.ToLower() == "true" || 
        (Model?.All(s => s.Key != key) == true && defaultValue);
}

@section Styles {
    <style>
        .integration-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        .integration-card:hover {
            border-color: #3454d1;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .integration-logo {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<!-- Main Content -->
<div class="main-content">
    <form asp-action="Integrations" method="post">
        @Html.AntiForgeryToken()
        
        <div class="row">
            <!-- Analytics & Tracking -->
            <div class="col-lg-12 mb-4">
                <h5 class="mb-3">@Html.T("التحليلات والتتبع", "Analytics & Tracking")</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card integration-card">
                            <div class="card-body">
                                <div class="d-flex align-items-start justify-content-between mb-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="integration-logo bg-soft-danger text-danger">
                                            <i class="feather-bar-chart-2"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">@Html.T("Google Analytics", "Google Analytics")</h6>
                                            <small class="text-muted">@Html.T("تحليلات الويب", "Web analytics")</small>
                                        </div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input type="hidden" name="settings[GoogleAnalyticsEnabled]" value="false" />
                                        <input class="form-check-input" type="checkbox" name="settings[GoogleAnalyticsEnabled]" value="true" @(GetBoolSetting("GoogleAnalyticsEnabled") ? "checked" : "")>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("معرف التتبع", "Tracking ID")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[GoogleAnalyticsId]" 
                                           value="@GetSetting("GoogleAnalyticsId")" placeholder="@Html.T("UA-XXXXXXXXX-X أو G-XXXXXXXXXX", "UA-XXXXXXXXX-X or G-XXXXXXXXXX")">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <div class="card integration-card">
                            <div class="card-body">
                                <div class="d-flex align-items-start justify-content-between mb-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="integration-logo bg-soft-primary text-primary">
                                            <i class="feather-facebook"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">@Html.T("Facebook Pixel", "Facebook Pixel")</h6>
                                            <small class="text-muted">@Html.T("تتبع التحويلات", "Conversion tracking")</small>
                                        </div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input type="hidden" name="settings[FacebookPixelEnabled]" value="false" />
                                        <input class="form-check-input" type="checkbox" name="settings[FacebookPixelEnabled]" value="true" @(GetBoolSetting("FacebookPixelEnabled") ? "checked" : "")>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("معرف Pixel", "Pixel ID")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[FacebookPixelId]" 
                                           value="@GetSetting("FacebookPixelId")" placeholder="@Html.T("أدخل معرف Pixel", "Enter Pixel ID")">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Email Services -->
            <div class="col-lg-12 mb-4">
                <h5 class="mb-3">@Html.T("خدمات البريد الإلكتروني", "Email services")</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card integration-card">
                            <div class="card-body">
                                <div class="d-flex align-items-start justify-content-between mb-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="integration-logo bg-soft-warning text-warning">
                                            <i class="feather-mail"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">SendGrid</h6>
                                            <small class="text-muted">@Html.T("خدمة إرسال البريد", "Email delivery service")</small>
                                        </div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input type="hidden" name="settings[SendGridEnabled]" value="false" />
                                        <input class="form-check-input" type="checkbox" name="settings[SendGridEnabled]" value="true" @(GetBoolSetting("SendGridEnabled") ? "checked" : "")>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("مفتاح API", "API Key")</label>
                                    <input type="password" class="form-control form-control-sm" name="settings[SendGridApiKey]" 
                                           value="@GetSetting("SendGridApiKey")" placeholder="SG...">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("البريد المرسل", "From Email")</label>
                                    <input type="email" class="form-control form-control-sm" name="settings[SendGridFromEmail]" 
                                           value="@GetSetting("SendGridFromEmail")" placeholder="noreply@example.com">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <div class="card integration-card">
                            <div class="card-body">
                                <div class="d-flex align-items-start justify-content-between mb-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="integration-logo bg-soft-info text-info">
                                            <i class="feather-send"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">@Html.T("Mailgun", "Mailgun")</h6>
                                            <small class="text-muted">@Html.T("خدمة إرسال البريد", "Email delivery service")</small>
                                        </div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input type="hidden" name="settings[MailgunEnabled]" value="false" />
                                        <input class="form-check-input" type="checkbox" name="settings[MailgunEnabled]" value="true" @(GetBoolSetting("MailgunEnabled") ? "checked" : "")>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("مفتاح API", "API Key")</label>
                                    <input type="password" class="form-control form-control-sm" name="settings[MailgunApiKey]" 
                                           value="@GetSetting("MailgunApiKey")" placeholder="@Html.T("أدخل مفتاح API", "Enter API key")">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("النطاق", "Domain")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[MailgunDomain]" 
                                           value="@GetSetting("MailgunDomain")" placeholder="mg.example.com">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cloud Storage -->
            <div class="col-lg-12 mb-4">
                <h5 class="mb-3">@Html.T("التخزين السحابي", "Cloud Storage")</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card integration-card">
                            <div class="card-body">
                                <div class="d-flex align-items-start justify-content-between mb-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="integration-logo bg-soft-primary text-primary">
                                            <i class="feather-cloud"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">@Html.T("Amazon S3", "Amazon S3")</h6>
                                            <small class="text-muted">@Html.T("خدمة تخزين ملفات", "File storage service")</small>
                                        </div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input type="hidden" name="settings[S3Enabled]" value="false" />
                                        <input class="form-check-input" type="checkbox" name="settings[S3Enabled]" value="true" @(GetBoolSetting("S3Enabled") ? "checked" : "")>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("مفتاح الوصول", "Access Key")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[S3AccessKey]" 
                                           value="@GetSetting("S3AccessKey")" placeholder="AKIA...">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("المفتاح السري", "Secret Key")</label>
                                    <input type="password" class="form-control form-control-sm" name="settings[S3SecretKey]" 
                                           value="@GetSetting("S3SecretKey")" placeholder="@Html.T("أدخل المفتاح السري", "Enter secret key")">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("اسم الحاوية", "Bucket Name")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[S3BucketName]" 
                                           value="@GetSetting("S3BucketName")" placeholder="my-bucket">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("المنطقة", "Region")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[S3Region]" 
                                           value="@GetSetting("S3Region")" placeholder="us-east-1">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <div class="card integration-card">
                            <div class="card-body">
                                <div class="d-flex align-items-start justify-content-between mb-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="integration-logo bg-soft-success text-success">
                                            <i class="feather-droplet"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">@Html.T("DigitalOcean Spaces", "DigitalOcean Spaces")</h6>
                                            <small class="text-muted">@Html.T("خدمة تخزين ملفات", "File storage service")</small>
                                        </div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input type="hidden" name="settings[SpacesEnabled]" value="false" />
                                        <input class="form-check-input" type="checkbox" name="settings[SpacesEnabled]" value="true" @(GetBoolSetting("SpacesEnabled") ? "checked" : "")>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("مفتاح الوصول", "Access Key")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[SpacesAccessKey]" 
                                           value="@GetSetting("SpacesAccessKey")" placeholder="@Html.T("أدخل مفتاح الوصول", "Enter access key")">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("المفتاح السري", "Secret Key")</label>
                                    <input type="password" class="form-control form-control-sm" name="settings[SpacesSecretKey]" 
                                           value="@GetSetting("SpacesSecretKey")" placeholder="@Html.T("أدخل المفتاح السري", "Enter secret key")">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("اسم المساحة", "Space Name")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[SpacesName]" 
                                           value="@GetSetting("SpacesName")" placeholder="my-space">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("نقطة النهاية", "Endpoint")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[SpacesEndpoint]" 
                                           value="@GetSetting("SpacesEndpoint")" placeholder="nyc3.digitaloceanspaces.com">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Social Login -->
            <div class="col-lg-12 mb-4">
                <h5 class="mb-3">تسجيل الدخول الاجتماعي</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card integration-card">
                            <div class="card-body">
                                <div class="d-flex align-items-start justify-content-between mb-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="integration-logo bg-soft-primary text-primary">
                                            <i class="feather-facebook"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">@Html.T("Facebook Login", "Facebook Login")</h6>
                                            <small class="text-muted">@Html.T("تسجيل الدخول بفيسبوك", "Sign in with Facebook")</small>
                                        </div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input type="hidden" name="settings[FacebookLoginEnabled]" value="false" />
                                        <input class="form-check-input" type="checkbox" name="settings[FacebookLoginEnabled]" value="true" @(GetBoolSetting("FacebookLoginEnabled") ? "checked" : "")>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("معرف التطبيق", "App ID")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[FacebookAppId]" 
                                           value="@GetSetting("FacebookAppId")" placeholder="@Html.T("أدخل معرف التطبيق", "Enter app ID")">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("سر التطبيق", "App Secret")</label>
                                    <input type="password" class="form-control form-control-sm" name="settings[FacebookAppSecret]" 
                                           value="@GetSetting("FacebookAppSecret")" placeholder="@Html.T("أدخل مفتاح التطبيق", "Enter app secret")">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <div class="card integration-card">
                            <div class="card-body">
                                <div class="d-flex align-items-start justify-content-between mb-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="integration-logo bg-soft-danger text-danger">
                                            <i class="feather-mail"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">@Html.T("Google Login", "Google Login")</h6>
                                            <small class="text-muted">@Html.T("تسجيل الدخول بجوجل", "Sign in with Google")</small>
                                        </div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input type="hidden" name="settings[GoogleLoginEnabled]" value="false" />
                                        <input class="form-check-input" type="checkbox" name="settings[GoogleLoginEnabled]" value="true" @(GetBoolSetting("GoogleLoginEnabled") ? "checked" : "")>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("معرف العميل", "Client ID")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[GoogleClientId]" 
                                           value="@GetSetting("GoogleClientId")" placeholder="@Html.T("أدخل معرف العميل", "Enter client ID")">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("سر العميل", "Client Secret")</label>
                                    <input type="password" class="form-control form-control-sm" name="settings[GoogleClientSecret]" 
                                           value="@GetSetting("GoogleClientSecret")" placeholder="@Html.T("أدخل مفتاح العميل", "Enter client secret")">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <div class="card integration-card">
                            <div class="card-body">
                                <div class="d-flex align-items-start justify-content-between mb-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="integration-logo bg-soft-info text-info">
                                            <i class="feather-twitter"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">@Html.T("Twitter Login", "Twitter Login")</h6>
                                            <small class="text-muted">@Html.T("تسجيل الدخول بتويتر", "Sign in with Twitter")</small>
                                        </div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input type="hidden" name="settings[TwitterLoginEnabled]" value="false" />
                                        <input class="form-check-input" type="checkbox" name="settings[TwitterLoginEnabled]" value="true" @(GetBoolSetting("TwitterLoginEnabled") ? "checked" : "")>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("مفتاح API", "API Key")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[TwitterApiKey]" 
                                           value="@GetSetting("TwitterApiKey")" placeholder="@Html.T("أدخل مفتاح API", "Enter API key")">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("سر API", "API Secret")</label>
                                    <input type="password" class="form-control form-control-sm" name="settings[TwitterApiSecret]" 
                                           value="@GetSetting("TwitterApiSecret")" placeholder="@Html.T("أدخل مفتاح API السري", "Enter API secret")">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <div class="card integration-card">
                            <div class="card-body">
                                <div class="d-flex align-items-start justify-content-between mb-3">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="integration-logo bg-soft-dark text-dark">
                                            <i class="feather-github"></i>
                                        </div>
                                        <div>
                                            <h6 class="mb-0">@Html.T("GitHub Login", "GitHub Login")</h6>
                                            <small class="text-muted">@Html.T("تسجيل الدخول بجيت هب", "Sign in with GitHub")</small>
                                        </div>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input type="hidden" name="settings[GitHubLoginEnabled]" value="false" />
                                        <input class="form-check-input" type="checkbox" name="settings[GitHubLoginEnabled]" value="true" @(GetBoolSetting("GitHubLoginEnabled") ? "checked" : "")>
                                    </div>
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("معرف العميل", "Client ID")</label>
                                    <input type="text" class="form-control form-control-sm" name="settings[GitHubClientId]" 
                                           value="@GetSetting("GitHubClientId")" placeholder="@Html.T("أدخل معرف العميل", "Enter client ID")">
                                </div>
                                <div class="mb-2">
                                    <label class="form-label small">@Html.T("سر العميل", "Client Secret")</label>
                                    <input type="password" class="form-control form-control-sm" name="settings[GitHubClientSecret]" 
                                           value="@GetSetting("GitHubClientSecret")" placeholder="@Html.T("أدخل مفتاح العميل", "Enter client secret")">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <p class="text-muted mb-0">
                                <i class="feather-info me-1"></i>
                                تأكد من إدخال بيانات الاعتماد الصحيحة قبل تفعيل أي تكامل.
                            </p>
                            <div class="d-flex gap-2">
                                <a asp-action="Index" class="btn btn-outline-secondary">
                                    <i class="feather-arrow-right me-1"></i>
                                    @Html.T("رجوع", "Back")
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="feather-save me-2"></i>
                                    @Html.T("حفظ جميع الإعدادات", "Save all settings")
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
