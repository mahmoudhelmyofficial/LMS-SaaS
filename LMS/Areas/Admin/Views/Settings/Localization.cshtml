@model IEnumerable<LMS.Domain.Entities.Settings.PlatformSetting>

@{
    ViewData["Title"] = Html.T("إعدادات اللغة والتوطين", "Language & Localization Settings");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الإعدادات", "Settings"), Url.Action("Index", "Settings")),
        (Html.T("اللغة والتوطين", "Language & Localization"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var defaultSettings = ViewBag.DefaultSettings as Dictionary<string, string> ?? new Dictionary<string, string>();
    var languages = ViewBag.Languages as Dictionary<string, string> ?? new Dictionary<string, string>();
    var timezones = ViewBag.Timezones as dynamic ?? new List<dynamic>();
    
    string GetValue(string key)
    {
        var setting = Model.FirstOrDefault(s => s.Key == key);
        if (setting != null) return setting.Value ?? "";
        return defaultSettings.ContainsKey(key) ? defaultSettings[key] : "";
    }
}

@await Html.PartialAsync("_PageHeader")

<!-- Main Content -->
<div class="main-content">
    <form asp-action="SaveLocalization" method="post">
        @Html.AntiForgeryToken()
        <div class="row">
            <!-- Language Settings -->
            <div class="col-lg-6">
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-globe me-2"></i>
                            @Html.T("إعدادات اللغة", "Language Settings")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">@Html.T("اللغة الافتراضية", "Default Language")</label>
                            <select name="settings[DefaultLanguage]" class="form-select">
                                @foreach (var lang in languages)
                                {
                                    <option value="@lang.Key" selected="@(GetValue("DefaultLanguage") == lang.Key)">@lang.Value</option>
                                }
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input type="hidden" name="settings[EnableRtl]" value="false" />
                                <input class="form-check-input" type="checkbox" name="settings[EnableRtl]" value="true" @(GetValue("EnableRtl") == "true" ? "checked" : "")>
                                <label class="form-check-label">@Html.T("تفعيل اتجاه النص من اليمين لليسار (RTL)", "Enable Right-to-Left text direction (RTL)")</label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input type="hidden" name="settings[EnableMultiLanguage]" value="false" />
                                <input class="form-check-input" type="checkbox" name="settings[EnableMultiLanguage]" value="true" @(GetValue("EnableMultiLanguage") == "true" ? "checked" : "")>
                                <label class="form-check-label">@Html.T("تفعيل تعدد اللغات", "Enable Multi-Language")</label>
                            </div>
                            <small class="text-muted">@Html.T("يتيح للمستخدمين اختيار لغة العرض", "Allows users to choose the display language")</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Date & Time Settings -->
            <div class="col-lg-6">
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-clock me-2"></i>
                            @Html.T("إعدادات التاريخ والوقت", "Date & Time Settings")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">@Html.T("المنطقة الزمنية", "Timezone")</label>
                            <select name="settings[DefaultTimezone]" class="form-select">
                                @if (timezones != null)
                                {
                                    foreach (var tz in timezones)
                                    {
                                        <option value="@tz.Id" selected="@(GetValue("DefaultTimezone") == tz.Id.ToString())">@tz.Name</option>
                                    }
                                }
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">@Html.T("صيغة التاريخ", "Date Format")</label>
                            <select name="settings[DateFormat]" class="form-select">
                                <option value="dd/MM/yyyy" selected="@(GetValue("DateFormat") == "dd/MM/yyyy")">@Html.T("يوم/شهر/سنة (31/12/2024)", "Day/Month/Year (31/12/2024)")</option>
                                <option value="MM/dd/yyyy" selected="@(GetValue("DateFormat") == "MM/dd/yyyy")">@Html.T("شهر/يوم/سنة (12/31/2024)", "Month/Day/Year (12/31/2024)")</option>
                                <option value="yyyy-MM-dd" selected="@(GetValue("DateFormat") == "yyyy-MM-dd")">@Html.T("سنة-شهر-يوم (2024-12-31)", "Year-Month-Day (2024-12-31)")</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">@Html.T("صيغة الوقت", "Time Format")</label>
                            <select name="settings[TimeFormat]" class="form-select">
                                <option value="HH:mm" selected="@(GetValue("TimeFormat") == "HH:mm")">@Html.T("24 ساعة (14:30)", "24-hour (14:30)")</option>
                                <option value="hh:mm tt" selected="@(GetValue("TimeFormat") == "hh:mm tt")">@Html.T("12 ساعة (02:30 PM)", "12-hour (02:30 PM)")</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Currency Settings -->
            <div class="col-lg-6">
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-dollar-sign me-2"></i>
                            @Html.T("إعدادات العملة", "Currency Settings")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">@Html.T("رمز العملة", "Currency Code")</label>
                            <select name="settings[CurrencyCode]" class="form-select">
                                <option value="SAR" selected="@(GetValue("CurrencyCode") == "SAR")">@Html.T("ريال سعودي (SAR)", "Saudi Riyal (SAR)")</option>
                                <option value="AED" selected="@(GetValue("CurrencyCode") == "AED")">@Html.T("درهم إماراتي (AED)", "UAE Dirham (AED)")</option>
                                <option value="KWD" selected="@(GetValue("CurrencyCode") == "KWD")">@Html.T("دينار كويتي (KWD)", "Kuwaiti Dinar (KWD)")</option>
                                <option value="EGP" selected="@(GetValue("CurrencyCode") == "EGP")">@Html.T("جنيه مصري (EGP)", "Egyptian Pound (EGP)")</option>
                                <option value="USD" selected="@(GetValue("CurrencyCode") == "USD")">@Html.T("دولار أمريكي (USD)", "US Dollar (USD)")</option>
                                <option value="EUR" selected="@(GetValue("CurrencyCode") == "EUR")">@Html.T("يورو (EUR)", "Euro (EUR)")</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">@Html.T("رمز العملة للعرض", "Currency Display Symbol")</label>
                            <input type="text" name="settings[CurrencySymbol]" class="form-control" value="@GetValue("CurrencySymbol")" placeholder="@Html.T("ر.س", "SAR")" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-end gap-2">
                            <a asp-action="General" class="btn btn-outline-secondary">
                                <i class="feather-x me-1"></i>
                                @Html.T("إلغاء", "Cancel")
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-save me-1"></i>
                                @Html.T("حفظ الإعدادات", "Save Settings")
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

