@model LMS.Domain.Entities.Notifications.PushNotificationSetting

@{
    ViewData["Title"] = Html.T("تفاصيل إعدادات الإشعارات الفورية", "Push notification settings details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("لوحة التحكم", "Dashboard"), Url.Action("Index", "Dashboard")),
        (Html.T("إعدادات الإشعارات الفورية", "Push notification settings"), Url.Action("Index", "PushNotificationSettings")),
        (Html.T("التفاصيل", "Details"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <div class="col-lg-8">
            <!-- User Info -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl bg-soft-primary text-primary">
                            @if (Model.User != null)
                            {
                                <span class="fs-4">@Model.User.FirstName.Substring(0, 1)@Model.User.LastName.Substring(0, 1)</span>
                            }
                            else
                            {
                                <i class="feather-user"></i>
                            }
                        </div>
                        <div>
                            @if (Model.User != null)
                            {
                                <h4 class="fw-bold mb-1">@Model.User.FirstName @Model.User.LastName</h4>
                                <p class="text-muted mb-0">@Model.User.Email</p>
                            }
                            else
                            {
                                <h4 class="fw-bold mb-1">مستخدم محذوف</h4>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Device Information -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-smartphone me-2"></i>معلومات الجهاز
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-borderless">
                            <tbody>
                                <tr>
                                    <td class="text-muted" style="width: 200px;">
                                        <i class="feather-smartphone me-2"></i>نوع الجهاز
                                    </td>
                                    <td class="fw-semibold">@(Model.DeviceType ?? "غير محدد")</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">
                                        <i class="feather-key me-2"></i>رمز الجهاز
                                    </td>
                                    <td>
                                        <code class="small">@(Model.DeviceToken?.Length > 50 ? Model.DeviceToken.Substring(0, 50) + "..." : Model.DeviceToken ?? "N/A")</code>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-muted">
                                        <i class="feather-calendar me-2"></i>تاريخ التسجيل
                                    </td>
                                    <td class="fw-semibold">@Model.CreatedAt.ToString("yyyy/MM/dd hh:mm tt")</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">
                                        <i class="feather-clock me-2"></i>آخر تحديث
                                    </td>
                                    <td class="fw-semibold">@Model.UpdatedAt</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">
                                        <i class="feather-activity me-2"></i>الحالة
                                    </td>
                                    <td>
                                        @if (Model.IsActive)
                                        {
                                            <span class="badge bg-success">نشط</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">غير نشط</span>
                                        }
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Push Notification Types -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-bell me-2"></i>أنواع الإشعارات المفعلة
                    </h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <i class="feather-message-circle text-primary me-2"></i>
                                <strong>الرسائل</strong>
                            </div>
                            <span class="badge @(Model.EnableMessages ? "bg-success" : "bg-secondary")">
                                @(Model.EnableMessages ? "مفعل" : "معطل")
                            </span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <i class="feather-book text-info me-2"></i>
                                <strong>تحديثات الدورة</strong>
                            </div>
                            <span class="badge @(Model.EnableCourseUpdates ? "bg-success" : "bg-secondary")">
                                @(Model.EnableCourseUpdates ? "مفعل" : "معطل")
                            </span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <i class="feather-speaker text-warning me-2"></i>
                                <strong>الإعلانات</strong>
                            </div>
                            <span class="badge @(Model.EnableAnnouncements ? "bg-success" : "bg-secondary")">
                                @(Model.EnableAnnouncements ? "مفعل" : "معطل")
                            </span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <i class="feather-bell text-danger me-2"></i>
                                <strong>التذكيرات</strong>
                            </div>
                            <span class="badge @(Model.EnableReminders ? "bg-success" : "bg-secondary")">
                                @(Model.EnableReminders ? "مفعل" : "معطل")
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notification Preferences -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-settings me-2"></i>تفضيلات الإشعارات
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="text-muted small">الأصوات</label>
                                <p class="fw-semibold">@(Model.EnableSound ? "مفعلة" : "معطلة")</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="text-muted small">الاهتزاز</label>
                                <p class="fw-semibold">@(Model.EnableVibration ? "مفعل" : "معطل")</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="text-muted small">الشارة</label>
                                <p class="fw-semibold">@(Model.EnableBadge ? "مفعلة" : "معطلة")</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="text-muted small">الإشعارات الهادئة</label>
                                <p class="fw-semibold">@(Model.QuietHoursEnabled ? "مفعلة" : "معطلة")</p>
                            </div>
                        </div>
                    </div>

                    @if (Model.QuietHoursEnabled && Model.QuietHoursStart.HasValue && Model.QuietHoursEnd.HasValue)
                    {
                        <div class="alert alert-info">
                            <i class="feather-moon me-2"></i>
                            <strong>الأوقات الهادئة:</strong> من @Model.QuietHoursStart.Value.ToString(@"hh\:mm") إلى @Model.QuietHoursEnd.Value.ToString(@"hh\:mm")
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Actions -->
            <div class="card stretch stretch-full mb-4" style="position: sticky; top: 20px;">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-settings me-2"></i>إجراءات
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a asp-action="Index" class="btn btn-light">
                            <i class="feather-arrow-right me-2"></i>العودة للقائمة
                        </a>
                        @if (Model.User != null)
                        {
                            <a asp-controller="Users" asp-action="Details" asp-route-id="@Model.UserId" class="btn btn-outline-primary">
                                <i class="feather-user me-2"></i>عرض المستخدم
                            </a>
                        }
                        <button class="btn btn-outline-info" onclick="sendTestNotification()">
                            <i class="feather-send me-2"></i>إرسال إشعار تجريبي
                        </button>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-bar-chart-2 me-2"></i>الإحصائيات
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-3 pb-3 border-bottom">
                        <span class="text-muted">الأنواع المفعلة</span>
                        <strong>@{
                            var enabledCount = 0;
                            if (Model.EnableMessages) enabledCount++;
                            if (Model.EnableCourseUpdates) enabledCount++;
                            if (Model.EnableAnnouncements) enabledCount++;
                            if (Model.EnableReminders) enabledCount++;
                        }@enabledCount/4</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-3 pb-3 border-bottom">
                        <span class="text-muted">مدة التسجيل</span>
                        <strong>@((DateTime.UtcNow - Model.CreatedAt).Days) يوم</strong>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span class="text-muted">آخر تحديث</span>
                        <strong>@((DateTime.UtcNow - Model.UpdatedAt).Value.Days) يوم</strong>
                    </div>
                </div>
            </div>

            <!-- Device Token -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-key me-2"></i>رمز الجهاز
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-light">
                        <code class="small text-break">@(Model.DeviceToken ?? "N/A")</code>
                    </div>
                    <button class="btn btn-sm btn-outline-primary w-100" onclick="copyToken()">
                        <i class="feather-copy me-2"></i>نسخ الرمز
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        window.__PushDetailsT = {
            copied: '@Html.Raw(Html.T("تم نسخ الرمز بنجاح", "Token copied successfully").Replace("'", "\\'"))',
            confirmTest: '@Html.Raw(Html.T("هل تريد إرسال إشعار تجريبي لهذا الجهاز؟", "Do you want to send a test notification to this device?").Replace("'", "\\'"))',
            comingSoon: '@Html.Raw(Html.T("سيتم إضافة هذه الميزة قريباً", "This feature will be added soon").Replace("'", "\\'"))'
        };
        function copyToken() {
            const token = '@Model.DeviceToken';
            navigator.clipboard.writeText(token).then(function() {
                alert(window.__PushDetailsT.copied);
            });
        }

        function sendTestNotification() {
            if (confirm(window.__PushDetailsT.confirmTest)) {
                // Implement test notification
                alert(window.__PushDetailsT.comingSoon);
            }
        }
    </script>
}

