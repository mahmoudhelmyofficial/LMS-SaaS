@model LMS.Areas.Admin.ViewModels.CountryRestrictionViewModel

@{
    ViewData["Title"] = Html.T("Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠØ¯ Ø¬ØºØ±Ø§ÙÙŠ", "Add country restriction");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…", "Dashboard"), Url.Action("Index", "Dashboard")),
        (Html.T("Ø§Ù„Ø£Ù…Ø§Ù†", "Security"), Url.Action("Dashboard", "Security")),
        (Html.T("Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©", "Country restrictions"), Url.Action("CountryRestrictions", "Security")),
        (Html.T("Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠØ¯ Ø¬Ø¯ÙŠØ¯", "Add new restriction"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@section Styles {
    <style>
        .form-card {
            border-right: 4px solid #f59e0b;
        }
        .info-box {
            background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
        }
        .country-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .country-card {
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .country-card:hover {
            border-color: #f59e0b;
            background: #fef3c7;
            transform: translateY(-3px);
        }
        .country-card.selected {
            border-color: #f59e0b;
            background: #fef3c7;
        }
        .country-flag {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        .restriction-preview {
            background: var(--gradient-hero, linear-gradient(135deg, #004aad 0%, #0055c4 50%, #1a5cb9 100%));
            border-radius: 12px;
            padding: 25px;
            color: white;
            position: sticky;
            top: 20px;
        }
        .preview-map {
            width: 100%;
            height: 200px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            margin-bottom: 20px;
        }
        .restriction-type-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .restriction-type-card:hover, .restriction-type-card.active {
            background: rgba(255,255,255,0.2);
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <div class="col-lg-8">
            <!-- Info Box -->
            <div class="info-box mb-4">
                <div class="row align-items-center">
                    <div class="col-md-2 text-center">
                        <i class="feather-map" style="font-size: 4rem;"></i>
                    </div>
                    <div class="col-md-10">
                        <h5 class="text-white mb-2">Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©</h5>
                        <p class="mb-0 opacity-90">
                            Ù‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ. ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø¸Ø± Ø£Ùˆ Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ø¯ÙˆÙ„ Ù…Ø­Ø¯Ø¯Ø©.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Form -->
            <div class="card form-card">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-map-pin me-2"></i>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
                    </h5>
                </div>
                <div class="card-body">
                    <form asp-action="AddCountryRestriction" method="post">
                        @Html.AntiForgeryToken()
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <!-- Country Selection -->
                        <div class="mb-4">
                            <label class="form-label required">
                                <i class="feather-globe me-2"></i>Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø©
                            </label>
                            <input type="hidden" asp-for="CountryCode" id="countryCodeInput" />
                            <input type="hidden" asp-for="CountryName" id="countryNameInput" />
                            
                            <div class="country-selector" id="countrySelector">
                                <div class="country-card" data-code="EG" data-name="Ù…ØµØ±">
                                    <div class="country-flag">ğŸ‡ªğŸ‡¬</div>
                                    <strong>Ù…ØµØ±</strong>
                                </div>
                                <div class="country-card" data-code="SA" data-name="Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">
                                    <div class="country-flag">ğŸ‡¸ğŸ‡¦</div>
                                    <strong>Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</strong>
                                </div>
                                <div class="country-card" data-code="AE" data-name="Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª">
                                    <div class="country-flag">ğŸ‡¦ğŸ‡ª</div>
                                    <strong>Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</strong>
                                </div>
                                <div class="country-card" data-code="KW" data-name="Ø§Ù„ÙƒÙˆÙŠØª">
                                    <div class="country-flag">ğŸ‡°ğŸ‡¼</div>
                                    <strong>Ø§Ù„ÙƒÙˆÙŠØª</strong>
                                </div>
                                <div class="country-card" data-code="QA" data-name="Ù‚Ø·Ø±">
                                    <div class="country-flag">ğŸ‡¶ğŸ‡¦</div>
                                    <strong>Ù‚Ø·Ø±</strong>
                                </div>
                                <div class="country-card" data-code="BH" data-name="Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†">
                                    <div class="country-flag">ğŸ‡§ğŸ‡­</div>
                                    <strong>Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†</strong>
                                </div>
                                <div class="country-card" data-code="OM" data-name="Ø¹Ù…Ø§Ù†">
                                    <div class="country-flag">ğŸ‡´ğŸ‡²</div>
                                    <strong>Ø¹Ù…Ø§Ù†</strong>
                                </div>
                                <div class="country-card" data-code="JO" data-name="Ø§Ù„Ø£Ø±Ø¯Ù†">
                                    <div class="country-flag">ğŸ‡¯ğŸ‡´</div>
                                    <strong>Ø§Ù„Ø£Ø±Ø¯Ù†</strong>
                                </div>
                                <div class="country-card" data-code="LB" data-name="Ù„Ø¨Ù†Ø§Ù†">
                                    <div class="country-flag">ğŸ‡±ğŸ‡§</div>
                                    <strong>Ù„Ø¨Ù†Ø§Ù†</strong>
                                </div>
                                <div class="country-card" data-code="IQ" data-name="Ø§Ù„Ø¹Ø±Ø§Ù‚">
                                    <div class="country-flag">ğŸ‡®ğŸ‡¶</div>
                                    <strong>Ø§Ù„Ø¹Ø±Ø§Ù‚</strong>
                                </div>
                                <div class="country-card" data-code="SY" data-name="Ø³ÙˆØ±ÙŠØ§">
                                    <div class="country-flag">ğŸ‡¸ğŸ‡¾</div>
                                    <strong>Ø³ÙˆØ±ÙŠØ§</strong>
                                </div>
                                <div class="country-card" data-code="YE" data-name="Ø§Ù„ÙŠÙ…Ù†">
                                    <div class="country-flag">ğŸ‡¾ğŸ‡ª</div>
                                    <strong>Ø§Ù„ÙŠÙ…Ù†</strong>
                                </div>
                                <div class="country-card" data-code="PS" data-name="ÙÙ„Ø³Ø·ÙŠÙ†">
                                    <div class="country-flag">ğŸ‡µğŸ‡¸</div>
                                    <strong>ÙÙ„Ø³Ø·ÙŠÙ†</strong>
                                </div>
                                <div class="country-card" data-code="MA" data-name="Ø§Ù„Ù…ØºØ±Ø¨">
                                    <div class="country-flag">ğŸ‡²ğŸ‡¦</div>
                                    <strong>Ø§Ù„Ù…ØºØ±Ø¨</strong>
                                </div>
                                <div class="country-card" data-code="DZ" data-name="Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±">
                                    <div class="country-flag">ğŸ‡©ğŸ‡¿</div>
                                    <strong>Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</strong>
                                </div>
                                <div class="country-card" data-code="TN" data-name="ØªÙˆÙ†Ø³">
                                    <div class="country-flag">ğŸ‡¹ğŸ‡³</div>
                                    <strong>ØªÙˆÙ†Ø³</strong>
                                </div>
                                <div class="country-card" data-code="LY" data-name="Ù„ÙŠØ¨ÙŠØ§">
                                    <div class="country-flag">ğŸ‡±ğŸ‡¾</div>
                                    <strong>Ù„ÙŠØ¨ÙŠØ§</strong>
                                </div>
                                <div class="country-card" data-code="SD" data-name="Ø§Ù„Ø³ÙˆØ¯Ø§Ù†">
                                    <div class="country-flag">ğŸ‡¸ğŸ‡©</div>
                                    <strong>Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</strong>
                                </div>
                                <div class="country-card" data-code="SO" data-name="Ø§Ù„ØµÙˆÙ…Ø§Ù„">
                                    <div class="country-flag">ğŸ‡¸ğŸ‡´</div>
                                    <strong>Ø§Ù„ØµÙˆÙ…Ø§Ù„</strong>
                                </div>
                                <div class="country-card" data-code="DJ" data-name="Ø¬ÙŠØ¨ÙˆØªÙŠ">
                                    <div class="country-flag">ğŸ‡©ğŸ‡¯</div>
                                    <strong>Ø¬ÙŠØ¨ÙˆØªÙŠ</strong>
                                </div>
                                <div class="country-card" data-code="KM" data-name="Ø¬Ø²Ø± Ø§Ù„Ù‚Ù…Ø±">
                                    <div class="country-flag">ğŸ‡°ğŸ‡²</div>
                                    <strong>Ø¬Ø²Ø± Ø§Ù„Ù‚Ù…Ø±</strong>
                                </div>
                                <div class="country-card" data-code="MR" data-name="Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§">
                                    <div class="country-flag">ğŸ‡²ğŸ‡·</div>
                                    <strong>Ù…ÙˆØ±ÙŠØªØ§Ù†ÙŠØ§</strong>
                                </div>
                            </div>
                            <span asp-validation-for="CountryCode" class="text-danger"></span>
                            <small class="text-muted d-block mt-2">
                                <i class="feather-info me-1"></i>Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙŠØ¯ Ø¹Ù„ÙŠÙ‡Ø§
                            </small>
                        </div>

                        <!-- Restriction Type -->
                        <div class="mb-4">
                            <label asp-for="RestrictionType" class="form-label required">
                                <i class="feather-shield me-2"></i>Ù†ÙˆØ¹ Ø§Ù„Ù‚ÙŠØ¯
                            </label>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="form-check form-check-lg border rounded p-3">
                                        <input asp-for="RestrictionType" class="form-check-input" type="radio" value="Block" id="blockType" checked />
                                        <label class="form-check-label" for="blockType">
                                            <strong class="text-danger">
                                                <i class="feather-x-circle me-2"></i>Ø­Ø¸Ø±
                                            </strong>
                                            <small class="d-block text-muted mt-1">Ù…Ù†Ø¹ Ø§Ù„ÙˆØµÙˆÙ„ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆÙ„Ø©</small>
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check form-check-lg border rounded p-3">
                                        <input asp-for="RestrictionType" class="form-check-input" type="radio" value="Allow" id="allowType" />
                                        <label class="form-check-label" for="allowType">
                                            <strong class="text-success">
                                                <i class="feather-check-circle me-2"></i>Ø³Ù…Ø§Ø­
                                            </strong>
                                            <small class="d-block text-muted mt-1">Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¯ÙˆÙ„Ø© ÙÙ‚Ø·</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <span asp-validation-for="RestrictionType" class="text-danger"></span>
                        </div>

                        <!-- Reason -->
                        <div class="mb-4">
                            <label asp-for="Reason" class="form-label required">
                                <i class="feather-file-text me-2"></i>Ø³Ø¨Ø¨ Ø§Ù„Ù‚ÙŠØ¯
                            </label>
                            <textarea asp-for="Reason" class="form-control" rows="4" placeholder="@Html.T("Ø§Ø°ÙƒØ± Ø³Ø¨Ø¨ ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø°Ø§ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ...", "State the reason for applying this geographic restriction...")"></textarea>
                            <span asp-validation-for="Reason" class="text-danger"></span>
                        </div>

                        <!-- Alert Box -->
                        <div class="alert alert-warning">
                            <h6 class="alert-heading">
                                <i class="feather-alert-triangle me-2"></i>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù‡Ù…Ø©
                            </h6>
                            <ul class="mb-0 ps-3">
                                <li>Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ© ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</li>
                                <li>ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù‚ÙŠØ¯ Ù„Ø§ ÙŠØªØ¹Ø§Ø±Ø¶ Ù…Ø¹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø¹Ù…Ù„Ùƒ</li>
                                <li>ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„ Ø£Ùˆ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù‚ÙŠØ¯ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª</li>
                                <li>Ø§Ù„Ù‚ÙŠÙˆØ¯ ØªØ·Ø¨Ù‚ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ù†ÙˆØ§Ù† IP Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…</li>
                            </ul>
                        </div>

                        <!-- Actions -->
                        <div class="d-flex gap-2 justify-content-end">
                            <a asp-action="CountryRestrictions" class="btn btn-light">
                                <i class="feather-x me-2"></i>Ø¥Ù„ØºØ§Ø¡
                            </a>
                            <button type="submit" class="btn btn-warning">
                                <i class="feather-map-pin me-2"></i>Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚ÙŠØ¯
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Preview -->
            <div class="restriction-preview">
                <h6 class="text-white mb-3">
                    <i class="feather-eye me-2"></i>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù‚ÙŠØ¯
                </h6>
                
                <div class="preview-map" id="previewMap">
                    <i class="feather-map"></i>
                </div>

                <div class="text-center mb-4">
                    <h5 class="text-white" id="previewCountry">Ø§Ø®ØªØ± Ø¯ÙˆÙ„Ø©</h5>
                    <span class="badge bg-white text-dark" id="previewType">Ø­Ø¸Ø±</span>
                </div>

                <div class="restriction-type-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Ù†ÙˆØ¹ Ø§Ù„Ù‚ÙŠØ¯:</span>
                        <span class="fw-bold" id="restrictionTypeText">Ø­Ø¸Ø±</span>
                    </div>
                </div>

                <div class="restriction-type-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø©:</span>
                        <span class="fw-bold" id="countryCodeDisplay">--</span>
                    </div>
                </div>

                <div class="bg-white bg-opacity-10 rounded p-3">
                    <h6 class="text-white mb-3">
                        <i class="feather-info me-2"></i>Ù…Ø§Ø°Ø§ ÙŠØ­Ø¯Ø«ØŸ
                    </h6>
                    <p class="small mb-0" id="effectDescription">
                        Ø³ÙŠØªÙ… Ù…Ù†Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©.
                    </p>
                </div>
            </div>

            <!-- Tips -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="feather-lightbulb me-2"></i>Ù†ØµØ§Ø¦Ø­
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <i class="feather-check-circle text-success me-2"></i>
                        <small>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø¨Ø­ÙƒÙ…Ø© Ù„ØªØ¬Ù†Ø¨ ÙÙ‚Ø¯Ø§Ù† Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ØªÙ…Ù„ÙŠÙ†</small>
                    </div>
                    <div class="mb-3">
                        <i class="feather-check-circle text-success me-2"></i>
                        <small>Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù‚ÙŠÙˆØ¯ Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙØ¹Ø§Ù„ÙŠØªÙ‡Ø§</small>
                    </div>
                    <div class="mb-0">
                        <i class="feather-check-circle text-success me-2"></i>
                        <small>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… VPN Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Country selection
            $('.country-card').on('click', function() {
                $('.country-card').removeClass('selected');
                $(this).addClass('selected');
                
                const code = $(this).data('code');
                const name = $(this).data('name');
                const flag = $(this).find('.country-flag').text();
                
                $('#countryCodeInput').val(code);
                $('#countryNameInput').val(name);
                $('#previewCountry').text(name);
                $('#countryCodeDisplay').text(code);
                $('#previewMap').html(flag);
            });

            // Restriction type change
            $('input[name="RestrictionType"]').on('change', function() {
                const type = $(this).val();
                const typeText = type === 'Block' ? 'Ø­Ø¸Ø±' : 'Ø³Ù…Ø§Ø­';
                const badgeClass = type === 'Block' ? 'bg-danger' : 'bg-success';
                const description = type === 'Block' 
                    ? 'Ø³ÙŠØªÙ… Ù…Ù†Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©.'
                    : 'Ø³ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ ÙÙ‚Ø· Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø§Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©.';
                
                $('#restrictionTypeText').text(typeText);
                $('#previewType').removeClass('bg-danger bg-success').addClass(badgeClass).text(typeText);
                $('#effectDescription').text(description);
            });

            // Form validation
            $('form').on('submit', function(e) {
                if (!$('#countryCodeInput').val()) {
                    e.preventDefault();
                    alert('@Html.Raw(Html.T("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¯ÙˆÙ„Ø©", "Please select a country").Replace("'", "\\'"))');
                    return false;
                }
            });
        });
    </script>
}
