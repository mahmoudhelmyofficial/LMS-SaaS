@model LMS.Areas.Admin.ViewModels.QuestionBankViewModel

@{
    ViewData["Title"] = Html.T("إنشاء بنك أسئلة جديد", "Create new question bank");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("التقييمات", "Assessments"), null),
        (Html.T("بنك الأسئلة", "Question Bank"), Url.Action("Index", "QuestionBank")),
        (Html.T("إنشاء بنك جديد", "Create Question Bank"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var categories = ViewBag.Categories as List<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>;
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <style>
        .bank-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <form asp-action="Create" method="post" id="bankForm">
        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

        <div class="row">
            <!-- Main Form -->
            <div class="col-lg-8">
                <!-- Basic Information -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-info me-2"></i>
                            @Html.T("المعلومات الأساسية", "Basic information")
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Name -->
                        <div class="form-group mb-4">
                            <label asp-for="Name" class="form-label">
                                @Html.T("اسم البنك", "Bank name") <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Name" class="form-control form-control-lg" placeholder="@Html.T("مثال: بنك أسئلة البرمجة المتقدمة", "e.g. Advanced programming question bank")" id="bankName" />
                            <span asp-validation-for="Name" class="text-danger"></span>
                            <small class="form-text text-muted">
                                <i class="feather-info"></i>
                                @Html.T("اختر اسماً واضحاً يعبر عن محتوى البنك", "Choose a clear name that describes the bank content")
                            </small>
                        </div>

                        <!-- Description -->
                        <div class="form-group mb-4">
                            <label asp-for="Description" class="form-label">
                                @Html.T("الوصف", "Description")
                            </label>
                            <textarea asp-for="Description" class="form-control" rows="4" placeholder="@Html.T("وصف مختصر لمحتوى بنك الأسئلة...", "Brief description of the question bank...")" id="bankDescription"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                            <div class="d-flex justify-content-between mt-1">
                                <small class="form-text text-muted">
                                    <i class="feather-info"></i>
                                    @Html.T("اشرح نوع الأسئلة ومستواها", "Describe the question type and level")
                                </small>
                                <small class="text-muted" id="charCount">0 / 500</small>
                            </div>
                        </div>

                        <!-- Category -->
                        <div class="form-group mb-4">
                            <label asp-for="CategoryId" class="form-label">
                                @Html.T("التصنيف", "Category")
                            </label>
                            <select asp-for="CategoryId" class="form-select select2">
                                <option value="">-- @Html.T("اختر التصنيف (اختياري)", "Select category (optional)") --</option>
                                @if (categories != null)
                                {
                                    @foreach (var category in categories)
                                    {
                                        <option value="@category.Value">@category.Text</option>
                                    }
                                }
                            </select>
                            <span asp-validation-for="CategoryId" class="text-danger"></span>
                            <small class="form-text text-muted">
                                <i class="feather-info"></i>
                                @Html.T("اختر تصنيفاً مناسباً لتنظيم البنوك", "Choose a category to organize banks")
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-settings me-2"></i>
                            @Html.T("الإعدادات", "Settings")
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Is Public -->
                        <div class="form-group mb-4">
                            <div class="form-check form-switch">
                                <input asp-for="IsPublic" class="form-check-input" type="checkbox" id="isPublicSwitch" />
                                <label class="form-check-label" for="isPublicSwitch">
                                    <i class="feather-globe me-2"></i>
                                    <strong>@Html.T("بنك عام", "Public bank")</strong>
                                </label>
                            </div>
                            <small class="form-text text-muted d-block mt-2">
                                @Html.T("إذا كان البنك عاماً، يمكن لجميع المدربين استخدامه في اختباراتهم", "If the bank is public, all instructors can use it in their quizzes")
                            </small>
                        </div>

                        <!-- Is Active -->
                        <div class="form-group">
                            <div class="form-check form-switch">
                                <input asp-for="IsActive" class="form-check-input" type="checkbox" id="isActiveSwitch" checked />
                                <label class="form-check-label" for="isActiveSwitch">
                                    <i class="feather-check-circle me-2"></i>
                                    <strong>@Html.T("نشط", "Active")</strong>
                                </label>
                            </div>
                            <small class="form-text text-muted d-block mt-2">
                                @Html.T("البنوك النشطة فقط متاحة للاستخدام", "Only active banks are available for use")
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Submit Buttons -->
                <div class="card stretch stretch-full">
                    <div class="card-body">
                        <div class="d-flex gap-2 justify-content-end">
                            <a asp-action="Index" class="btn btn-light">
                                <i class="feather-x me-2"></i>
                                @Html.T("إلغاء", "Cancel")
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-check me-2"></i>
                                @Html.T("إنشاء البنك", "Create bank")
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Preview Card -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-eye me-2"></i>
                            @Html.T("معاينة", "Preview")
                        </h5>
                    </div>
                    <div class="card-body text-center">
                        <div class="bank-icon text-white">
                            <i class="feather-database" style="font-size: 3rem;"></i>
                        </div>
                        <h5 class="fw-bold mb-2" id="previewName">@Html.T("بنك أسئلة جديد", "New question bank")</h5>
                        <p class="text-muted" id="previewDescription">@Html.T("الوصف سيظهر هنا...", "Description will appear here...")</p>
                        <hr class="my-3">
                        <div class="d-flex justify-content-around">
                            <div>
                                <h5 class="fw-bold text-primary mb-1">0</h5>
                                <small class="text-muted">@Html.T("أسئلة", "Questions")</small>
                            </div>
                            <div>
                                <h5 class="fw-bold text-success mb-1">
                                    <i class="feather-check-circle"></i>
                                </h5>
                                <small class="text-muted" id="previewStatus">@Html.T("نشط", "Active")</small>
                            </div>
                        </div>
                        <div class="alert alert-info mt-3 mb-0">
                            <i class="feather-info me-2"></i>
                            <small>@Html.T("يمكنك إضافة الأسئلة بعد إنشاء البنك", "You can add questions after creating the bank")</small>
                        </div>
                    </div>
                </div>

                <!-- Tips Card -->
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-lightbulb me-2"></i>
                            @Html.T("نصائح", "Tips")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="vstack gap-2">
                            <div class="alert alert-light mb-0">
                                <i class="feather-check me-2 text-success"></i>
                                <small>@Html.T("استخدم أسماء واضحة ومحددة", "Use clear and specific names")</small>
                            </div>
                            <div class="alert alert-light mb-0">
                                <i class="feather-check me-2 text-success"></i>
                                <small>@Html.T("صنف البنوك حسب المواضيع", "Categorize banks by topic")</small>
                            </div>
                            <div class="alert alert-light mb-0">
                                <i class="feather-check me-2 text-success"></i>
                                <small>@Html.T("اجعل البنك عاماً لمشاركته", "Make the bank public to share it")</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Initialize Select2
            $('.select2').select2({
                dir: 'rtl',
                language: 'ar'
            });

            // Character count
            $('#bankDescription').on('input', function() {
                const length = $(this).val().length;
                $('#charCount').text(length + ' / 500');
            });

            // Live preview
            $('#bankName').on('input', function() {
                const name = $(this).val() || 'بنك أسئلة جديد';
                $('#previewName').text(name);
            });

            $('#bankDescription').on('input', function() {
                const desc = $(this).val() || 'الوصف سيظهر هنا...';
                $('#previewDescription').text(desc);
            });

            $('#isActiveSwitch').on('change', function() {
                if ($(this).is(':checked')) {
                    $('#previewStatus').text('نشط');
                } else {
                    $('#previewStatus').text('غير نشط');
                }
            });
        });
    </script>
}

