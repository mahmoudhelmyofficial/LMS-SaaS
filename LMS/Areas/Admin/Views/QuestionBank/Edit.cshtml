@model LMS.Areas.Admin.ViewModels.QuestionBankViewModel

@{
    ViewData["Title"] = Html.T("تعديل بنك الأسئلة", "Edit Question Bank");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("التقييمات", "Assessments"), null),
        (Html.T("بنك الأسئلة", "Question Bank"), Url.Action("Index", "QuestionBank")),
        (Html.T("تعديل البنك", "Edit Bank"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var categories = ViewBag.Categories as List<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>;
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <form asp-action="Edit" asp-route-id="@Model.Id" method="post" id="bankForm">
        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
        <input asp-for="Id" type="hidden" />

        <div class="row">
            <div class="col-lg-8">
                <!-- Basic Information -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-info me-2"></i>
                            @Html.T("المعلومات الأساسية", "Basic Information")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="form-group mb-4">
                            <label asp-for="Name" class="form-label">
                                @Html.T("اسم البنك", "Bank Name") <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Name" class="form-control form-control-lg" />
                            <span asp-validation-for="Name" class="text-danger"></span>
                        </div>

                        <div class="form-group mb-4">
                            <label asp-for="Description" class="form-label">@Html.T("الوصف", "Description")</label>
                            <textarea asp-for="Description" class="form-control" rows="4"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <div class="form-group mb-4">
                            <label asp-for="CategoryId" class="form-label">@Html.T("التصنيف", "Category")</label>
                            <select asp-for="CategoryId" class="form-select select2">
                                <option value="">-- @Html.T("اختر التصنيف (اختياري)", "Select category (optional)") --</option>
                                @if (categories != null)
                                {
                                    @foreach (var category in categories)
                                    {
                                        <option value="@category.Value" selected="@(category.Value == Model.CategoryId?.ToString())">@category.Text</option>
                                    }
                                }
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-settings me-2"></i>
                            @Html.T("الإعدادات", "Settings")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="form-group mb-4">
                            <div class="form-check form-switch">
                                <input asp-for="IsPublic" class="form-check-input" type="checkbox" id="isPublicSwitch" />
                                <label class="form-check-label" for="isPublicSwitch">
                                    <i class="feather-globe me-2"></i>
                                    <strong>@Html.T("بنك عام", "Public Bank")</strong>
                                </label>
                            </div>
                            <small class="form-text text-muted d-block mt-2">
                                @Html.T("يمكن لجميع المدربين استخدام البنوك العامة", "All instructors can use public banks")
                            </small>
                        </div>

                        <div class="form-group">
                            <div class="form-check form-switch">
                                <input asp-for="IsActive" class="form-check-input" type="checkbox" id="isActiveSwitch" />
                                <label class="form-check-label" for="isActiveSwitch">
                                    <i class="feather-check-circle me-2"></i>
                                    <strong>@Html.T("نشط", "Active")</strong>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Submit Buttons -->
                <div class="card stretch stretch-full">
                    <div class="card-body">
                        <div class="d-flex gap-2 justify-content-end">
                            <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-light">
                                <i class="feather-x me-2"></i>
                                @Html.T("إلغاء", "Cancel")
                            </a>
                            <a asp-action="Index" class="btn btn-secondary">
                                <i class="feather-list me-2"></i>
                                @Html.T("قائمة البنوك", "Bank List")
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-check me-2"></i>
                                @Html.T("حفظ التغييرات", "Save Changes")
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Info Card -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-info me-2"></i>
                            @Html.T("معلومات", "Info")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="vstack gap-2">
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">@Html.T("المعرف", "ID"):</span>
                                <span class="fw-semibold">#@Model.Id</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">@Html.T("تاريخ الإنشاء", "Created"):</span>
                                <span class="fw-semibold">@DateTime.Now.ToString("dd/MM/yyyy")</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-zap me-2"></i>
                            @Html.T("إجراءات سريعة", "Quick actions")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-light-brand">
                                <i class="feather-eye me-2"></i>
                                @Html.T("عرض التفاصيل", "View details")
                            </a>
                            <a asp-action="AddQuestion" asp-route-bankId="@Model.Id" class="btn btn-light-brand">
                                <i class="feather-plus me-2"></i>
                                إضافة سؤال
                            </a>
                            <hr class="my-2">
                            <button type="button" class="btn btn-danger" onclick="deleteBank()">
                                <i class="feather-trash-2 me-2"></i>
                                حذف البنك
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- Delete Form -->
<form id="deleteForm" asp-action="Delete" asp-route-id="@Model.Id" method="post" style="display: none;">
    @Html.AntiForgeryToken()
</form>

@section Scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    
    <script>
        $(document).ready(function() {
            $('.select2').select2({ dir: 'rtl', language: 'ar' });
        });

        function deleteBank() {
            if (confirm('@Html.Raw(Html.T("هل أنت متأكد من حذف بنك الأسئلة؟ سيتم حذف جميع الأسئلة المرتبطة به.", "Are you sure you want to delete this question bank? All associated questions will be deleted.").Replace("'", "\\'"))')) {
                document.getElementById('deleteForm').submit();
            }
        }
    </script>
}

