@model IEnumerable<LMS.Domain.Entities.Notifications.SmsTemplate>

@{
    ViewData["Title"] = Html.T("قوالب الرسائل النصية", "SMS templates");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الإعدادات", "Settings"), Url.Action("Index", "Settings")),
        (Html.T("قوالب SMS", "SMS Templates"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        (Html.T("إضافة قالب", "Add Template"), "feather-plus", Url.Action("Create", "SmsTemplates"), "btn-primary")
    };
    ViewData["HeaderActions"] = actions;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        @if (Model != null && Model.Any())
        {
            @foreach (var template in Model)
            {
                <div class="col-lg-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex align-items-start justify-content-between mb-3">
                                <div>
                                    <h6 class="mb-1">@template.Name</h6>
                                    <small class="text-muted">@template.Type</small>
                                </div>
                                @if (template.IsActive)
                                {
                                    <span class="badge bg-soft-success text-success">نشط</span>
                                }
                                else
                                {
                                    <span class="badge bg-soft-secondary text-secondary">معطل</span>
                                }
                            </div>
                            <div class="bg-light p-3 rounded mb-3" style="max-height: 80px; overflow: hidden;">
                                <p class="small mb-0">@template.Content</p>
                            </div>
                            <div class="d-flex gap-2">
                                <a href="@Url.Action("Edit", "SmsTemplates", new { id = template.Id })" class="btn btn-sm btn-light flex-grow-1">
                                    <i class="feather-edit me-1"></i>
                                    تعديل
                                </a>
                                <button class="btn btn-sm btn-light" onclick="sendTest('@template.Id')">
                                    <i class="feather-send"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body text-center py-5">
                        <i class="feather-message-square fs-1 text-muted mb-3"></i>
                        <h5>لا توجد قوالب رسائل نصية</h5>
                        <a href="@Url.Action("Create", "SmsTemplates")" class="btn btn-primary">
                            <i class="feather-plus me-2"></i>
                            إضافة قالب
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        function sendTest(templateId) {
            var phone = prompt('@Html.Raw(Html.T("أدخل رقم الهاتف للاختبار:", "Enter phone number for test:").Replace("'", "\\'"))');
            if (phone) {
                alert('@Html.Raw(Html.T("سيتم إرسال رسالة تجريبية إلى:", "A test message will be sent to:").Replace("'", "\\'"))' + ' ' + phone);
            }
        }
    </script>
}
