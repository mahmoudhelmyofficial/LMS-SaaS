@using LMS.Domain.Enums
@model LMS.Domain.Entities.Notifications.Notification

@{
    ViewData["Title"] = Html.T("تفاصيل الإشعار", "Notification details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الإشعارات", "Notifications"), Url.Action("Index", "Notifications")),
        (Html.T("تفاصيل الإشعار", "Notification details"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@section Styles {
    <style>
        .notification-header {
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .notification-header.type-info { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .notification-header.type-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .notification-header.type-warning { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .notification-header.type-error { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <div class="col-lg-8">
            <!-- Notification Header -->
            <div class="notification-header type-@Model.Type.ToString().ToLower() text-white">
                <div class="d-flex align-items-start gap-3">
                    <div class="avatar-text avatar-lg bg-white bg-opacity-25">
                        @switch (Model.Type)
                        {
                            case NotificationType.Success:
                                <i class="feather-check-circle text-white"></i>
                                break;
                            case NotificationType.Warning:
                                <i class="feather-alert-triangle text-white"></i>
                                break;
                            case NotificationType.Error:
                                <i class="feather-alert-circle text-white"></i>
                                break;
                            default:
                                <i class="feather-info text-white"></i>
                                break;
                        }
                    </div>
                    <div class="flex-grow-1">
                        <h3 class="text-white mb-2">@Model.Title</h3>
                        <div class="d-flex align-items-center gap-3 text-white-50">
                            <span>
                                <i class="feather-clock me-1"></i>
                                @Model.CreatedAt.ToString("dd/MM/yyyy - HH:mm")
                            </span>
                            @if (Model.IsRead)
                            {
                                <span>
                                    <i class="feather-check me-1"></i>
                                    مقروء
                                </span>
                            }
                            else
                            {
                                <span>
                                    <i class="feather-circle me-1"></i>
                                    غير مقروء
                                </span>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- Message Content -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-message-circle me-2"></i>
                        محتوى الإشعار
                    </h5>
                </div>
                <div class="card-body">
                    <p class="mb-0" style="white-space: pre-wrap; line-height: 1.8;">@Model.Message</p>
                </div>
            </div>

            <!-- Action URL -->
            @if (!string.IsNullOrEmpty(Model.ActionUrl))
            {
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-link me-2"></i>
                            رابط الإجراء
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <p class="mb-1 text-muted">@Model.ActionUrl</p>
                                @if (!string.IsNullOrEmpty(Model.ActionText))
                                {
                                    <small class="text-muted">نص الزر: @Model.ActionText</small>
                                }
                            </div>
                            <a href="@Model.ActionUrl" target="_blank" class="btn btn-primary">
                                <i class="feather-external-link me-2"></i>
                                @(Model.ActionText ?? "فتح الرابط")
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="col-lg-4">
            <!-- User Info -->
            @if (Model.User != null)
            {
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-user me-2"></i>
                            المستلم
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <div class="avatar-text avatar-lg bg-soft-primary text-primary mx-auto mb-2">
                                @Model.User.FirstName?.Substring(0, 1)
                            </div>
                            <h6 class="fw-bold mb-1">@Model.User.FirstName @Model.User.LastName</h6>
                            <small class="text-muted">@Model.User.Email</small>
                        </div>
                        <div class="d-grid">
                            <a asp-controller="Users" asp-action="Details" asp-route-id="@Model.UserId" class="btn btn-light btn-sm">
                                <i class="feather-external-link me-2"></i>
                                عرض الملف الشخصي
                            </a>
                        </div>
                    </div>
                </div>
            }

            <!-- Details -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-info me-2"></i>
                        التفاصيل
                    </h5>
                </div>
                <div class="card-body">
                    <div class="vstack gap-3">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">النوع:</span>
                            <span class="badge @GetTypeBadgeClass(Model.Type)">@GetTypeText(Model.Type)</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">الحالة:</span>
                            @if (Model.IsRead)
                            {
                                <span class="badge bg-soft-success text-success">مقروء</span>
                            }
                            else
                            {
                                <span class="badge bg-soft-warning text-warning">غير مقروء</span>
                            }
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">تاريخ الإنشاء:</span>
                            <span>@Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</span>
                        </div>
                        @if (Model.ReadAt.HasValue)
                        {
                            <div class="d-flex justify-content-between">
                                <span class="text-muted">تاريخ القراءة:</span>
                                <span>@Model.ReadAt.Value.ToString("dd/MM/yyyy HH:mm")</span>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-zap me-2"></i>
                        إجراءات
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        @if (!Model.IsRead)
                        {
                            <form asp-action="MarkAsRead" asp-route-id="@Model.Id" method="post">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-success w-100">
                                    <i class="feather-check me-2"></i>
                                    تحديد كمقروء
                                </button>
                            </form>
                        }
                        <a asp-action="Index" class="btn btn-light">
                            <i class="feather-arrow-right me-2"></i>
                            العودة للقائمة
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    string GetTypeBadgeClass(NotificationType type)
    {
        return type switch
        {
            NotificationType.Success => "bg-soft-success text-success",
            NotificationType.Warning => "bg-soft-warning text-warning",
            NotificationType.Error => "bg-soft-danger text-danger",
            _ => "bg-soft-info text-info"
        };
    }

    string GetTypeText(NotificationType type)
    {
        return type switch
        {
            NotificationType.Success => "نجاح",
            NotificationType.Warning => "تحذير",
            NotificationType.Error => "خطأ",
            _ => "معلومات"
        };
    }
}

