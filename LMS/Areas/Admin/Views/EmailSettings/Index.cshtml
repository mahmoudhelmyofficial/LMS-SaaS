@model List<LMS.Domain.Entities.Settings.PlatformSetting>
@{
    ViewData["Title"] = Html.T("إعدادات البريد الإلكتروني", "Email settings");
    ViewData["Breadcrumbs"] = new List<(string Name, string Url)>
    {
        (Html.T("الإعدادات", "Settings"), Url.Action("Index", "Settings")),
        (Html.T("البريد الإلكتروني", "Email"), "")
    };
}

<div class="main-content">
    <!-- Stats Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="avatar avatar-lg bg-soft-primary rounded">
                                <i class="feather-mail fs-4 text-primary"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3 class="mb-0">@ViewBag.TotalEmails</h3>
                            <span class="text-muted fs-12">@Html.T("إجمالي الرسائل", "Total messages")</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="avatar avatar-lg bg-soft-success rounded">
                                <i class="feather-check-circle fs-4 text-success"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3 class="mb-0">@ViewBag.SentEmails</h3>
                            <span class="text-muted fs-12">@Html.T("تم الإرسال", "Sent")</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="avatar avatar-lg bg-soft-warning rounded">
                                <i class="feather-clock fs-4 text-warning"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3 class="mb-0">@ViewBag.PendingEmails</h3>
                            <span class="text-muted fs-12">@Html.T("قيد الانتظار", "Pending")</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="avatar avatar-lg bg-soft-danger rounded">
                                <i class="feather-x-circle fs-4 text-danger"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3 class="mb-0">@ViewBag.FailedEmails</h3>
                            <span class="text-muted fs-12">@Html.T("فشل الإرسال", "Failed")</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card border-0 shadow-sm">
        <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="feather-mail me-2"></i>@Html.T("إعدادات خادم البريد SMTP", "SMTP mail server settings")</h5>
        </div>
        <div class="card-body">
            <form asp-action="Save" method="post">
                @Html.AntiForgeryToken()
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">@Html.T("خادم SMTP", "SMTP server")</label>
                        <input type="text" name="SmtpHost" class="form-control" 
                               value="@Model?.FirstOrDefault(s => s.Key == "SmtpHost")?.Value" 
                               placeholder="smtp.example.com">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">@Html.T("المنفذ", "Port")</label>
                        <input type="number" name="SmtpPort" class="form-control" 
                               value="@(Model?.FirstOrDefault(s => s.Key == "SmtpPort")?.Value ?? "587")" 
                               placeholder="587">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">@Html.T("اسم المستخدم", "Username")</label>
                        <input type="text" name="SmtpUsername" class="form-control" 
                               value="@Model?.FirstOrDefault(s => s.Key == "SmtpUsername")?.Value" 
                               placeholder="user@example.com">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">@Html.T("كلمة المرور", "Password")</label>
                        <input type="password" name="SmtpPassword" class="form-control" 
                               placeholder="@(string.IsNullOrEmpty(Model?.FirstOrDefault(s => s.Key == "SmtpPassword")?.Value) ? Html.T("أدخل كلمة المرور", "Enter password").ToString() : "••••••••••••")">
                        <small class="form-text text-muted">@Html.T("اتركه فارغاً للاحتفاظ بكلمة المرور الحالية", "Leave blank to keep current password")</small>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">@Html.T("البريد المرسل منه", "From address")</label>
                        <input type="email" name="FromAddress" class="form-control" 
                               value="@Model?.FirstOrDefault(s => s.Key == "EmailFromAddress")?.Value" 
                               placeholder="noreply@example.com">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">@Html.T("اسم المرسل", "Sender name")</label>
                        <input type="text" name="FromName" class="form-control" 
                               value="@Model?.FirstOrDefault(s => s.Key == "EmailFromName")?.Value" 
                               placeholder="@Html.T("منصة LMS", "LMS Platform")">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">@Html.T("البريد للرد", "Reply-to address")</label>
                        <input type="email" name="ReplyToAddress" class="form-control" 
                               value="@Model?.FirstOrDefault(s => s.Key == "EmailReplyTo")?.Value" 
                               placeholder="support@example.com">
                    </div>
                    <div class="col-md-6">
                        <input type="hidden" name="SmtpEnableSsl" value="false" />
                        <div class="form-check form-switch mt-4">
                            <input type="checkbox" name="SmtpEnableSsl" value="true" class="form-check-input" 
                                   @(Model?.FirstOrDefault(s => s.Key == "SmtpEnableSsl")?.Value == "true" || Model?.FirstOrDefault(s => s.Key == "SmtpEnableSsl")?.Value == null ? "checked" : "")>
                            <label class="form-check-label">@Html.T("تفعيل SSL/TLS", "Enable SSL/TLS")</label>
                        </div>
                        <input type="hidden" name="IsEnabled" value="false" />
                        <div class="form-check form-switch mt-2">
                            <input type="checkbox" name="IsEnabled" value="true" class="form-check-input" 
                                   @(Model?.FirstOrDefault(s => s.Key == "EmailEnabled")?.Value == "true" ? "checked" : "")>
                            <label class="form-check-label">@Html.T("تفعيل البريد الإلكتروني", "Enable email")</label>
                        </div>
                    </div>
                </div>

                <div class="mt-4 d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="feather-save me-2"></i>@Html.T("حفظ الإعدادات", "Save settings")
                    </button>
                    <a asp-action="Logs" class="btn btn-outline-secondary">
                        <i class="feather-list me-2"></i>@Html.T("سجل البريد", "Email log")
                    </a>
                </div>
            </form>
        </div>
    </div>

    <!-- Test Email Section -->
    <div class="card border-0 shadow-sm mt-4">
        <div class="card-header bg-transparent">
            <h5 class="mb-0"><i class="feather-send me-2"></i>@Html.T("اختبار البريد الإلكتروني", "Test email")</h5>
        </div>
        <div class="card-body">
            <form asp-action="TestConnection" method="post">
                @Html.AntiForgeryToken()
                <div class="row g-3 align-items-end">
                    <div class="col-md-8">
                        <label class="form-label">@Html.T("بريد الاختبار", "Test email address")</label>
                        <input type="email" name="testEmail" class="form-control" 
                               placeholder="@Html.T("أدخل بريدك الإلكتروني لاختبار الإعدادات", "Enter your email to test settings")">
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-outline-primary w-100">
                            <i class="feather-send me-2"></i>@Html.T("إرسال بريد اختباري", "Send test email")
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

