@model LMS.Domain.Entities.Certifications.CertificateTemplate

@{
    ViewData["Title"] = Html.T("تفاصيل القالب", "Template details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("قوالب الشهادات", "Certificate Templates"), Url.Action("Index", "CertificateTemplates")),
        (Model.Name, null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        (Html.T("تعديل", "Edit"), "feather-edit", Url.Action("Edit", "CertificateTemplates", new { id = Model.Id }), "btn-primary"),
        (Html.T("معاينة", "Preview"), "feather-external-link", Url.Action("Preview", "CertificateTemplates", new { id = Model.Id }), "btn-success")
    };
    ViewData["HeaderActions"] = actions;
    var usageCount = ViewBag.UsageCount ?? 0;
}

@section Styles {
    <style>
        .info-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
        }
        .code-preview {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 1.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            max-height: 400px;
            overflow-y: auto;
        }
        .certificate-preview-box {
            border: 2px dashed #e9ecef;
            border-radius: 8px;
            padding: 2rem;
            background: var(--gradient-hero, linear-gradient(135deg, #004aad 0%, #0055c4 50%, #1a5cb9 100%));
            color: white;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<!-- Main Content -->
<div class="main-content">
    <div class="row">
        <!-- Template Info -->
        <div class="col-lg-8">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("معلومات القالب", "Template Information")</h5>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <div class="col-12">
                            <div class="info-card">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="text-muted fs-12 mb-1">@Html.T("اسم القالب", "Template Name")</label>
                                        <h6 class="fw-bold">@Model.Name</h6>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="text-muted fs-12 mb-1">@Html.T("الحالة", "Status")</label>
                                        <div>
                                            @if (Model.IsActive)
                                            {
                                                <span class="badge bg-soft-success text-success">@Html.T("نشط", "Active")</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-soft-secondary text-secondary">@Html.T("غير نشط", "Inactive")</span>
                                            }
                                            @if (Model.IsDefault)
                                            {
                                                <span class="badge bg-soft-warning text-warning ms-2">
                                                    <i class="feather-star"></i> @Html.T("افتراضي", "Default")
                                                </span>
                                            }
                                        </div>
                                    </div>
                                    @if (!string.IsNullOrEmpty(Model.Description))
                                    {
                                        <div class="col-12 mb-3">
                                            <label class="text-muted fs-12 mb-1">@Html.T("الوصف", "Description")</label>
                                            <p class="mb-0">@Model.Description</p>
                                        </div>
                                    }
                                    <div class="col-md-4 mb-3">
                                        <label class="text-muted fs-12 mb-1">@Html.T("العرض", "Width")</label>
                                        <p class="fw-semibold mb-0">@Model.Width px</p>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="text-muted fs-12 mb-1">@Html.T("الارتفاع", "Height")</label>
                                        <p class="fw-semibold mb-0">@Model.Height px</p>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="text-muted fs-12 mb-1">@Html.T("الاتجاه", "Orientation")</label>
                                        <p class="fw-semibold mb-0">
                                            <i class="feather-layout me-1"></i>
                                            @Model.Orientation
                                        </p>
                                    </div>
                                    @if (!string.IsNullOrEmpty(Model.BackgroundImageUrl))
                                    {
                                        <div class="col-12 mb-3">
                                            <label class="text-muted fs-12 mb-1">@Html.T("صورة الخلفية", "Background Image")</label>
                                            <p class="mb-0">
                                                <a href="@Model.BackgroundImageUrl" target="_blank" class="text-primary">
                                                    <i class="feather-image me-1"></i>
                                                    @Html.T("عرض الصورة", "View Image")
                                                </a>
                                            </p>
                                        </div>
                                    }
                                    <div class="col-md-6 mb-3">
                                        <label class="text-muted fs-12 mb-1">@Html.T("تاريخ الإنشاء", "Created At")</label>
                                        <p class="mb-0">@Model.CreatedAt.ToString("dd/MM/yyyy hh:mm tt")</p>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="text-muted fs-12 mb-1">@Html.T("آخر تحديث", "Last Updated")</label>
                                        <p class="mb-0">@(Model.UpdatedAt?.ToString("dd/MM/yyyy hh:mm tt") ?? Html.T("لم يتم التحديث", "Not updated"))</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- HTML Content -->
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">@Html.T("محتوى HTML", "HTML Content")</h6>
                            <div class="code-preview">
                                <pre class="mb-0">@Model.HtmlContent</pre>
                            </div>
                        </div>

                        <!-- CSS Styles -->
                        @if (!string.IsNullOrEmpty(Model.CssStyles))
                        {
                            <div class="col-12">
                                <h6 class="fw-bold mb-3">@Html.T("أنماط CSS", "CSS Styles")</h6>
                                <div class="code-preview">
                                    <pre class="mb-0">@Model.CssStyles</pre>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Preview -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("معاينة", "Preview")</h5>
                </div>
                <div class="card-body">
                    <div class="certificate-preview-box">
                        <div class="text-center">
                            <i class="feather-award" style="font-size: 4rem;"></i>
                            <h4 class="mt-3">@Model.Name</h4>
                            <p class="mb-0">@Model.Width × @Model.Height</p>
                        </div>
                    </div>
                    <div class="d-grid gap-2 mt-3">
                        <a href="@Url.Action("Preview", "CertificateTemplates", new { id = Model.Id })" 
                           target="_blank" 
                           class="btn btn-primary">
                            <i class="feather-external-link me-2"></i>
                            @Html.T("فتح المعاينة", "Open Preview")
                        </a>
                    </div>
                </div>
            </div>

            <!-- Usage Stats -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("إحصائيات الاستخدام", "Usage Statistics")</h5>
                </div>
                <div class="card-body">
                    <div class="text-center py-4">
                        <div class="avatar-text avatar-xl bg-soft-primary text-primary mx-auto mb-3">
                            <h3 class="mb-0">@usageCount</h3>
                        </div>
                        <p class="text-muted mb-0">@Html.T("شهادة تم إنشاؤها باستخدام هذا القالب", "Certificate(s) created using this template")</p>
                    </div>
                </div>
            </div>

            <!-- Variables Help -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("المتغيرات المتاحة", "Available Variables")</h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <code>{{StudentName}}</code>
                            <span class="text-muted fs-11">@Html.T("اسم الطالب", "Student Name")</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <code>{{CourseName}}</code>
                            <span class="text-muted fs-11">@Html.T("اسم الدورة", "Course Name")</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <code>{{InstructorName}}</code>
                            <span class="text-muted fs-11">@Html.T("اسم المدرب", "Instructor Name")</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <code>{{CompletionDate}}</code>
                            <span class="text-muted fs-11">@Html.T("تاريخ الإتمام", "Completion Date")</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <code>{{CertificateNumber}}</code>
                            <span class="text-muted fs-11">@Html.T("رقم الشهادة", "Certificate Number")</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                            <code>{{Grade}}</code>
                            <span class="text-muted fs-11">@Html.T("الدرجة", "Grade")</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="card stretch stretch-full mt-4">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("إجراءات سريعة", "Quick Actions")</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="@Url.Action("Edit", "CertificateTemplates", new { id = Model.Id })" class="btn btn-primary">
                            <i class="feather-edit me-2"></i>
                            @Html.T("تعديل القالب", "Edit Template")
                        </a>
                        <form asp-action="Duplicate" method="post">
                            <input type="hidden" name="id" value="@Model.Id" />
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-light-brand w-100">
                                <i class="feather-copy me-2"></i>
                                @Html.T("نسخ القالب", "Duplicate Template")
                            </button>
                        </form>
                        @if (!Model.IsDefault && usageCount == 0)
                        {
                            <form asp-action="Delete" method="post" onsubmit="return confirm('@(Html.T("هل أنت متأكد من حذف هذا القالب؟", "Are you sure you want to delete this template?"))')">
                                <input type="hidden" name="id" value="@Model.Id" />
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-danger w-100">
                                    <i class="feather-trash-2 me-2"></i>
                                    @Html.T("حذف القالب", "Delete Template")
                                </button>
                            </form>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

