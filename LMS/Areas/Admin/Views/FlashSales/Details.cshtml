@model LMS.Domain.Entities.Marketing.FlashSale

@{
    ViewData["Title"] = Html.T("تفاصيل العرض السريع", "Flash sale details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("التسويق", "Marketing"), null),
        (Html.T("العروض السريعة", "Flash sales"), Url.Action("Index", "FlashSales")),
        (Html.T("التفاصيل", "Details"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        (Html.T("تعديل", "Edit"), "feather-edit", Url.Action("Edit", "FlashSales", new { id = Model.Id }), "btn-primary")
    };
    ViewData["HeaderActions"] = actions;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <div class="col-lg-12 mb-4">
            <div class="card">
                <div class="card-body text-center py-4">
                    <div class="avatar-text avatar-xxl rounded bg-soft-warning text-warning mb-3 mx-auto">
                        <i class="feather-zap" style="font-size: 2.5rem;"></i>
                    </div>
                    <h3 class="mb-2">@Model.Name</h3>
                    <h2 class="text-success mb-3">@Html.T("خصم", "Discount") @Model.DiscountPercentage%</h2>
                    @if (Model.IsActive)
                    {
                        <span class="badge bg-soft-success text-success fs-6 px-3 py-2">@Html.T("مفعل", "Active")</span>
                    }
                    else
                    {
                        <span class="badge bg-soft-danger text-danger fs-6 px-3 py-2">@Html.T("معطل", "Disabled")</span>
                    }
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-primary text-primary">
                            <i class="feather-shopping-cart"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("المبيعات", "Sales")</span>
                            <h3 class="fw-bolder">@Model.CurrentSales</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-success text-success">
                            <i class="feather-percent"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("الخصم", "Discount")</span>
                            <h3 class="fw-bolder">@Model.DiscountPercentage%</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-info text-info">
                            <i class="feather-book-open"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("الدورات", "Courses")</span>
                            <h3 class="fw-bolder">@Model.FlashSaleCourses.Count</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-warning text-warning">
                            <i class="feather-target"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("الحد الأقصى", "Maximum")</span>
                            <h3 class="fw-bolder">@(Model.MaxSales?.ToString() ?? "∞")</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("معلومات العرض", "Offer information")</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("الاسم", "Name")</label>
                        <p class="fw-semibold">@Model.Name</p>
                    </div>
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("الوصف", "Description")</label>
                        <p>@(Model.Description ?? Html.T("لا يوجد وصف", "No description").ToString())</p>
                    </div>
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("نسبة الخصم", "Discount percentage")</label>
                        <p class="text-success fw-bold fs-4">@Model.DiscountPercentage%</p>
                    </div>
                    <div class="mb-0">
                        <label class="text-muted">@Html.T("تاريخ الإنشاء", "Created date")</label>
                        <p>@Model.CreatedAt.ToString("dd/MM/yyyy hh:mm tt")</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("فترة العرض", "Offer period")</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("تاريخ البداية", "Start date")</label>
                        <p class="fw-semibold">@Model.StartDate.ToString("dd/MM/yyyy hh:mm tt")</p>
                    </div>
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("تاريخ النهاية", "End date")</label>
                        <p class="fw-semibold">@Model.EndDate.ToString("dd/MM/yyyy hh:mm tt")</p>
                    </div>
                    <div class="mb-0">
                        <label class="text-muted">@Html.T("المدة", "Duration")</label>
                        <p>@((Model.EndDate - Model.StartDate).Days) @Html.T("يوم", "days")</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("الدورات المشمولة", "Included courses") (@Model.FlashSaleCourses.Count)</h5>
                </div>
                <div class="card-body">
                    @if (Model.FlashSaleCourses.Any())
                    {
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>@Html.T("الدورة", "Course")</th>
                                        <th>@Html.T("السعر الأصلي", "Original price")</th>
                                        <th>@Html.T("السعر بعد الخصم", "Price after discount")</th>
                                        <th>@Html.T("التوفير", "Savings")</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.FlashSaleCourses)
                                    {
                                        var discountAmount = item.Course.Price * Model.DiscountPercentage / 100;
                                        var finalPrice = item.Course.Price - discountAmount;
                                        <tr>
                                            <td>@item.Course.Title</td>
                                            <td class="text-muted"><s>@item.Course.Price.ToEGP()</s></td>
                                            <td class="text-success fw-bold">@finalPrice.ToEGP()</td>
                                            <td><span class="badge bg-soft-success text-success">@Html.T("وفر", "Save") @discountAmount.ToEGP()</span></td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <p class="text-muted text-center py-4">@Html.T("لا توجد دورات مضافة لهذا العرض", "No courses added to this offer")</p>
                    }
                </div>
            </div>
        </div>

        <!-- Quick Actions Card -->
        <div class="col-lg-12">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-zap me-2"></i>@Html.T("إجراءات سريعة", "Quick actions")
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-flex gap-2 flex-wrap">
                        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary">
                            <i class="feather-edit me-2"></i>@Html.T("تعديل العرض", "Edit offer")
                        </a>
                        <form asp-action="ToggleActive" asp-route-id="@Model.Id" method="post" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-light-brand">
                                @if (Model.IsActive)
                                {
                                    <i class="feather-eye-off me-2"></i>
                                    <span>@Html.T("تعطيل العرض", "Disable offer")</span>
                                }
                                else
                                {
                                    <i class="feather-eye me-2"></i>
                                    <span>@Html.T("تفعيل العرض", "Enable offer")</span>
                                }
                            </button>
                        </form>
                        @if (Model.CurrentSales == 0)
                        {
                            <form asp-action="Delete" asp-route-id="@Model.Id" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-danger" onclick="return confirm('@Html.Raw(Html.T("هل أنت متأكد من حذف هذا العرض؟ لا يمكن التراجع عن هذا الإجراء.", "Are you sure you want to delete this offer? This action cannot be undone.").ToString().Replace("'", "\\'"))')">
                                    <i class="feather-trash-2 me-2"></i>@Html.T("حذف العرض", "Delete Offer")
                                </button>
                            </form>
                        }
                        else
                        {
                            <button type="button" class="btn btn-secondary" disabled title="@Html.T("لا يمكن حذف عرض تم استخدامه", "Cannot delete an offer that has been used")">
                                <i class="feather-trash-2 me-2"></i>@Html.T("حذف العرض", "Delete Offer")
                            </button>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

