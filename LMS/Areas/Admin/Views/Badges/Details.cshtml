@model LMS.Domain.Entities.Gamification.Badge

@{
    ViewData["Title"] = Html.T("تفاصيل الشارة", "Badge details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("التحفيز", "Gamification"), null),
        (Html.T("الشارات", "Badges"), Url.Action("Index", "Badges")),
        (Html.T("تفاصيل الشارة", "Badge details"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        (Html.T("تعديل", "Edit"), "feather-edit", Url.Action("Edit", "Badges", new { id = Model.Id }), "btn-primary"),
        (Html.T("حذف", "Delete"), "feather-trash-2", "javascript:void(0)", "btn-danger delete-btn")
    };
    ViewData["HeaderActions"] = actions;
}

@section Styles {
    <style>
        .badge-showcase {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6rem;
            margin: 0 auto;
            animation: float 3s ease-in-out infinite;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        @@keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        .badge-showcase::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        @@keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }
        .info-card {
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            background: #f9fafb;
            transition: all 0.3s;
        }
        .info-card:hover {
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .stat-box {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background: var(--gradient-hero, linear-gradient(135deg, #004aad 0%, #0055c4 50%, #1a5cb9 100%));
            color: white;
        }
        .rarity-display {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1.1rem;
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <!-- Badge Showcase -->
    <div class="text-center mb-4">
        <div class="badge-showcase @(Model.Rarity switch
        {
            BadgeRarity.Common => "bg-gradient-secondary",
            BadgeRarity.Uncommon => "bg-gradient-success",
            BadgeRarity.Rare => "bg-gradient-primary",
            BadgeRarity.Epic => "bg-gradient-warning",
            BadgeRarity.Legendary => "bg-gradient-danger",
            _ => "bg-gradient-primary"
        }) text-white">
            @if (!string.IsNullOrEmpty(Model.IconUrl))
            {
                @if (Model.IconUrl.StartsWith("feather-"))
                {
                    <i class="@Model.IconUrl"></i>
                }
                else
                {
                    <img src="@Model.IconUrl" style="width: 120px; height: 120px; object-fit: cover; border-radius: 50%;" alt="@Model.Name">
                }
            }
            else
            {
                <i class="feather-shield"></i>
            }
        </div>
        <h2 class="fw-bold mt-4 mb-2">@Model.Name</h2>
        <span class="rarity-display @(Model.Rarity switch
        {
            BadgeRarity.Common => "bg-soft-secondary text-secondary",
            BadgeRarity.Uncommon => "bg-soft-success text-success",
            BadgeRarity.Rare => "bg-soft-primary text-primary",
            BadgeRarity.Epic => "bg-soft-warning text-warning",
            BadgeRarity.Legendary => "bg-soft-danger text-danger",
            _ => "bg-soft-primary text-primary"
        })">
            <i class="feather-star"></i>
            @(Model.Rarity switch
            {
                BadgeRarity.Common => "شائعة",
                BadgeRarity.Uncommon => "غير شائعة",
                BadgeRarity.Rare => "نادرة",
                BadgeRarity.Epic => "ملحمية",
                BadgeRarity.Legendary => "أسطورية",
                _ => "غير محدد"
            })
        </span>
        @if (Model.IsActive)
        {
            <span class="badge bg-soft-success text-success ms-2">
                <i class="feather-check-circle"></i>
                نشطة
            </span>
        }
        else
        {
            <span class="badge bg-soft-secondary text-secondary ms-2">
                <i class="feather-x-circle"></i>
                غير نشطة
            </span>
        }
    </div>

    <!-- Stats Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="stat-box">
                <h3 class="mb-1">@Model.TotalAwarded</h3>
                <small>إجمالي الحاصلين</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-box" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <h3 class="mb-1">@Model.PointsAwarded</h3>
                <small>نقاط الجائزة</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-box" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <h3 class="mb-1">@Model.ExperienceAwarded</h3>
                <small>خبرة ممنوحة</small>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-box" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                <h3 class="mb-1">@Model.DisplayOrder</h3>
                <small>ترتيب العرض</small>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Main Details -->
        <div class="col-lg-8">
            <!-- Description Card -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-file-text me-2"></i>
                        الوصف
                    </h5>
                </div>
                <div class="card-body">
                    <p class="lead">@Model.Description</p>
                </div>
            </div>

            <!-- Criteria Card -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-target me-2"></i>
                        معايير الحصول على الشارة
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="info-card">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="avatar-text bg-soft-primary text-primary avatar-lg">
                                        <i class="feather-award"></i>
                                    </div>
                                    <div>
                                        <small class="text-muted d-block">النقاط المطلوبة</small>
                                        <h4 class="mb-0">@Model.CriteriaValue</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-card">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="avatar-text bg-soft-success text-success avatar-lg">
                                        <i class="feather-layers"></i>
                                    </div>
                                    <div>
                                        <small class="text-muted d-block">نوع المعيار</small>
                                        <h6 class="mb-0">@Model.CriteriaType</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                        @if (!string.IsNullOrEmpty(Model.Category))
                        {
                            <div class="col-md-6">
                                <div class="info-card">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="avatar-text bg-soft-warning text-warning avatar-lg">
                                            <i class="feather-folder"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted d-block">الفئة</small>
                                            <h6 class="mb-0">@Model.Category</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(Model.Color))
                        {
                            <div class="col-md-6">
                                <div class="info-card">
                                    <div class="d-flex align-items-center gap-3">
                                        <div class="avatar-text avatar-lg" style="background: @Model.Color;">
                                            <i class="feather-droplet text-white"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted d-block">اللون</small>
                                            <h6 class="mb-0">@Model.Color</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Rewards Card -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-gift me-2"></i>
                        المكافآت
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center gap-3 p-3 border rounded">
                                <div class="avatar-text bg-soft-success text-success avatar-lg">
                                    <i class="feather-award"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block">النقاط الممنوحة</small>
                                    <h4 class="mb-0 text-success">+@Model.PointsAwarded</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex align-items-center gap-3 p-3 border rounded">
                                <div class="avatar-text bg-soft-info text-info avatar-lg">
                                    <i class="feather-zap"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block">الخبرة الممنوحة</small>
                                    <h4 class="mb-0 text-info">+@Model.ExperienceAwarded XP</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-info mt-3 mb-0">
                        <i class="feather-info me-2"></i>
                        يحصل الطالب على هذه المكافآت تلقائياً عند حصوله على الشارة
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Status Card -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-info me-2"></i>
                        معلومات الحالة
                    </h5>
                </div>
                <div class="card-body">
                    <div class="vstack gap-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted">الحالة:</span>
                            @if (Model.IsActive)
                            {
                                <span class="badge bg-soft-success text-success">نشطة</span>
                            }
                            else
                            {
                                <span class="badge bg-soft-secondary text-secondary">غير نشطة</span>
                            }
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted">سرية:</span>
                            @if (Model.IsSecret)
                            {
                                <span class="badge bg-soft-warning text-warning">
                                    <i class="feather-eye-off"></i>
                                    سرية
                                </span>
                            }
                            else
                            {
                                <span class="badge bg-soft-info text-info">
                                    <i class="feather-eye"></i>
                                    مرئية
                                </span>
                            }
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted">تاريخ الإنشاء:</span>
                            <span class="fw-semibold">@Model.CreatedAt.ToString("dd/MM/yyyy")</span>
                        </div>
                        @if (Model.UpdatedAt.HasValue)
                        {
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-muted">آخر تحديث:</span>
                                <span class="fw-semibold">@Model.UpdatedAt.Value.ToString("dd/MM/yyyy")</span>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-zap me-2"></i>
                        @Html.T("إجراءات سريعة", "Quick actions")
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-light-brand">
                            <i class="feather-edit me-2"></i>
                            تعديل الشارة
                        </a>
                        <form asp-action="ToggleStatus" asp-route-id="@Model.Id" method="post" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-light-brand w-100">
                                @if (Model.IsActive)
                                {
                                    <i class="feather-eye-off me-2"></i>
                                    <span>إلغاء التنشيط</span>
                                }
                                else
                                {
                                    <i class="feather-eye me-2"></i>
                                    <span>تنشيط</span>
                                }
                            </button>
                        </form>
                        <button type="button" class="btn btn-light-brand" onclick="window.print()">
                            <i class="feather-printer me-2"></i>
                            طباعة
                        </button>
                        <hr>
                        <button type="button" class="btn btn-danger delete-btn">
                            <i class="feather-trash-2 me-2"></i>
                            حذف الشارة
                        </button>
                    </div>
                </div>
            </div>

            <!-- Statistics Card -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-bar-chart me-2"></i>
                        إحصائيات الأداء
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">معدل الحصول</span>
                            <span class="fw-semibold">@Model.TotalAwarded طالب</span>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-primary" style="width: @(Model.TotalAwarded > 0 ? Math.Min(100, Model.TotalAwarded) : 5)%"></div>
                        </div>
                    </div>
                    
                    <div class="alert alert-light mb-0">
                        <i class="feather-trending-up me-2"></i>
                        <small>هذه الشارة حصل عليها @Model.TotalAwarded من الطلاب حتى الآن</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<form asp-action="Delete" asp-route-id="@Model.Id" method="post" id="deleteForm">
    @Html.AntiForgeryToken()
</form>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('.delete-btn').click(function() {
                if (confirm('@(Html.Raw(Html.T("هل أنت متأكد من حذف هذه الشارة؟\n\nتحذير: سيتم حذف سجل جميع الطلاب الحاصلين على هذه الشارة!", "Are you sure you want to delete this badge?\n\nWarning: All student records for this badge will be deleted!").Replace("'", "\\'").Replace("\r", "").Replace("\n", "\\n")))'.replace(/\\n/g, '\n')) {
                    $('#deleteForm').submit();
                }
            });
        });
    </script>
}

