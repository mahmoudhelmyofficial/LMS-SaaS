@model IEnumerable<LMS.Domain.Entities.Gamification.Badge>

@{
    ViewData["Title"] = Html.T("إدارة الشارات", "Badges Management");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("التحفيز", "Gamification"), null),
        (Html.T("الشارات", "Badges"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    ViewData["ShowStats"] = true;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        (Html.T("إضافة شارة", "Add Badge"), "feather-plus", Url.Action("Create", "Badges"), "btn-primary")
    };
    ViewData["HeaderActions"] = actions;
}

@section Styles {
    <style>
        .badge-card {
            transition: all 0.3s ease;
        }
        .badge-card:hover {
            transform: translateY(-5px) rotate(5deg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .badge-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            position: relative;
        }
        .badge-icon::before {
            content: '';
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

@section StatsCards {
    <div class="col-xxl-3 col-md-6">
        <div class="card stretch stretch-full">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-primary text-primary">
                            <i class="feather-shield"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("إجمالي الشارات", "Total badges")</span>
                            <h3 class="fw-bolder d-block">@Model.Count().ToString("N0")</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xxl-3 col-md-6">
        <div class="card stretch stretch-full">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-success text-success">
                            <i class="feather-check-circle"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("تم منحها", "Awarded")</span>
                            <h3 class="fw-bolder d-block">0</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xxl-3 col-md-6">
        <div class="card stretch stretch-full">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-warning text-warning">
                            <i class="feather-star"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("شارات ذهبية", "Gold badges")</span>
                            <h3 class="fw-bolder d-block">@Model.Count(b => b.Level == "Gold").ToString("N0")</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xxl-3 col-md-6">
        <div class="card stretch stretch-full">
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-info text-info">
                            <i class="feather-trending-up"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("الأكثر منحاً", "Most awarded")</span>
                            <h3 class="fw-bolder d-block">0</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<!-- Main Content -->
<div class="main-content">
    <div class="row">
        @if (Model != null && Model.Any())
        {
            @foreach (var badge in Model)
            {
                <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-4">
                    <div class="card badge-card text-center">
                        <div class="card-body">
                            <div class="badge-icon @(badge.Level == "Gold" ? "bg-gradient-warning" : badge.Level == "Silver" ? "bg-gradient-secondary" : "bg-gradient-primary") text-white">
                                @if (!string.IsNullOrEmpty(badge.IconUrl))
                                {
                                    <img src="@badge.IconUrl" alt="@badge.Title" style="width: 60px; height: 60px;" />
                                }
                                else
                                {
                                    <i class="feather-shield"></i>
                                }
                            </div>
                            
                            <h6 class="mb-1">@badge.Title</h6>
                            <small class="text-muted d-block mb-2">@badge.Description</small>
                            
                            <div class="mb-2">
                                @switch (badge.Level)
                                {
                                    case "Bronze":
                                        <span class="badge" style="background: linear-gradient(135deg, #cd7f32 0%, #a0522d 100%); color: white;">@Html.T("برونزي", "Bronze")</span>
                                        break;
                                    case "Silver":
                                        <span class="badge" style="background: linear-gradient(135deg, #c0c0c0 0%, #808080 100%); color: white;">@Html.T("فضي", "Silver")</span>
                                        break;
                                    case "Gold":
                                        <span class="badge" style="background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%); color: white;">@Html.T("ذهبي", "Gold")</span>
                                        break;
                                    case "Platinum":
                                        <span class="badge" style="background: linear-gradient(135deg, #e5e4e2 0%, #4a4a4a 100%); color: white;">@Html.T("بلاتيني", "Platinum")</span>
                                        break;
                                }
                            </div>

                            <small class="text-muted d-block mb-2">
                                <i class="feather-users"></i>
                                @badge.TotalAwarded @Html.T("حاصل", "holder(s)")
                            </small>

                            <div class="btn-group btn-group-sm" role="group">
                                <a href="@Url.Action("Edit", "Badges", new { id = badge.Id })" class="btn btn-light">
                                    <i class="feather-edit"></i>
                                </a>
                                <button class="btn btn-light" onclick="confirmDelete('@badge.Id')">
                                    <i class="feather-trash-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body text-center py-5">
                        <i class="feather-shield fs-1 text-muted mb-3"></i>
                        <h5>@Html.T("لا توجد شارات بعد", "No badges yet")</h5>
                        <p class="text-muted mb-4">@Html.T("ابدأ بإنشاء شارات لتحفيز الطلاب على الإنجاز", "Start by creating badges to motivate students")</p>
                        <a href="@Url.Action("Create", "Badges")" class="btn btn-primary">
                            <i class="feather-plus me-2"></i>
                            @Html.T("إضافة شارة جديدة", "Add new badge")
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

<!-- Delete Form for proper POST submission -->
<form id="deleteForm" method="post" style="display: none;">
    @Html.AntiForgeryToken()
</form>

@section Scripts {
    <script>
        function confirmDelete(badgeId) {
            if (confirm('@(Html.T("هل أنت متأكد من حذف هذه الشارة؟", "Are you sure you want to delete this badge?"))')) {
                var form = document.getElementById('deleteForm');
                form.action = '@Url.Action("Delete", "Badges")/' + badgeId;
                form.submit();
            }
        }
    </script>
}

