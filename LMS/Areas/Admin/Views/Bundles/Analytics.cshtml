@model LMS.Domain.Entities.Marketing.CourseBundle

@{
    ViewData["Title"] = Html.T("إحصائيات الباقة", "Bundle analytics");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الدورات", "Bundles"), null),
        (Html.T("الحزم", "Bundles"), Url.Action("Index", "Bundles")),
        (Html.T("إحصائيات", "Statistics"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        (Html.T("العودة للتفاصيل", "Back to details"), "feather-arrow-right", Url.Action("Details", "Bundles", new { id = Model.Id }), "btn-light")
    };
    ViewData["HeaderActions"] = actions;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <!-- Statistics Cards -->
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-primary text-primary">
                            <i class="feather-shopping-cart"></i>
                        </div>
                        <div>
                            <span class="text-muted">إجمالي المبيعات</span>
                            <h3 class="fw-bolder mb-0">@Model.SalesCount.ToString("N0")</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-success text-success">
                            <i class="feather-dollar-sign"></i>
                        </div>
                        <div>
                            <span class="text-muted">إجمالي الإيرادات</span>
                            <h3 class="fw-bolder mb-0">@((Model.SalesCount * Model.Price).ToEGP())</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-warning text-warning">
                            <i class="feather-percent"></i>
                        </div>
                        <div>
                            <span class="text-muted">نسبة التوفير</span>
                            <h3 class="fw-bolder mb-0">@Model.SavingsPercentage.ToString("F0")%</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-info text-info">
                            <i class="feather-book"></i>
                        </div>
                        <div>
                            <span class="text-muted">عدد الدورات</span>
                            <h3 class="fw-bolder mb-0">@Model.CoursesCount</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bundle Details -->
        <div class="col-lg-8 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("معلومات الباقة", "Bundle information")</h5>
                </div>
                <div class="card-body">
                    <h4 class="mb-3">@Model.Name</h4>
                    <p class="text-muted">@Model.Description</p>
                    
                    <div class="d-flex gap-3 mb-3">
                        <div>
                            <span class="text-muted d-block">السعر الأصلي</span>
                            <span class="text-decoration-line-through">@Model.OriginalPrice.ToEGP()</span>
                        </div>
                        <div>
                            <span class="text-muted d-block">سعر الباقة</span>
                            <span class="text-success fw-bold">@Model.Price.ToEGP()</span>
                        </div>
                    </div>

                    @if (Model.BundleCourses != null && Model.BundleCourses.Any())
                    {
                        <h6 class="mt-4 mb-3">الدورات المضمنة:</h6>
                        <div class="list-group">
                            @foreach (var bundleCourse in Model.BundleCourses)
                            {
                                <div class="list-group-item d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center gap-3">
                                        <i class="feather-book text-primary"></i>
                                        <span>@(bundleCourse.Course?.Title ?? "دورة")</span>
                                    </div>
                                    <span class="text-muted">@(bundleCourse.Course?.Price.ToEGP() ?? "-")</span>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="col-lg-4 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("حالة الباقة", "Bundle status")</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("الحالة", "Status")</label>
                        <div>
                            @if (Model.IsActive)
                            {
                                <span class="badge bg-success">@Html.T("نشطة", "Active")</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">@Html.T("غير نشطة", "Inactive")</span>
                            }
                            @if (Model.IsFeatured)
                            {
                                <span class="badge bg-warning">@Html.T("مميزة", "Featured")</span>
                            }
                        </div>
                    </div>

                    @if (Model.ValidFrom.HasValue || Model.ValidTo.HasValue)
                    {
                        <div class="mb-3">
                            <label class="text-muted">@Html.T("فترة الصلاحية", "Validity period")</label>
                            <div>
                                @if (Model.ValidFrom.HasValue)
                                {
                                    <small>@Html.T("من:", "From:") @Model.ValidFrom.Value.ToString("dd/MM/yyyy")</small>
                                }
                                @if (Model.ValidTo.HasValue)
                                {
                                    <small class="d-block">إلى: @Model.ValidTo.Value.ToString("dd/MM/yyyy")</small>
                                }
                            </div>
                        </div>
                    }

                    @if (Model.MaxSales.HasValue)
                    {
                        <div class="mb-3">
                            <label class="text-muted">@Html.T("الحد الأقصى للمبيعات", "Max sales")</label>
                            <div>
                                <span>@Model.SalesCount / @Model.MaxSales</span>
                                <div class="progress mt-2" style="height: 8px;">
                                    <div class="progress-bar" style="width: @(((double)Model.SalesCount / Model.MaxSales.Value) * 100)%"></div>
                                </div>
                            </div>
                        </div>
                    }

                    <div class="mt-4">
                        <a href="@Url.Action("Edit", "Bundles", new { id = Model.Id })" class="btn btn-primary w-100">
                            <i class="feather-edit me-2"></i>
                            تعديل الباقة
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
