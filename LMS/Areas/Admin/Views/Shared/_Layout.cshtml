@using LMS.Services.Interfaces
@inject IPlatformSettingsService PlatformSettings

@{
    var platformName = await PlatformSettings.GetPlatformNameAsync();
    var platformDescription = await PlatformSettings.GetSettingAsync("PlatformDescription", Html.T("منصة تعليمية متكاملة", "Integrated learning platform"));
    var platformFavicon = await PlatformSettings.GetSettingAsync("PlatformFavicon", "~/assets/images/favicon.ico");
}

<!DOCTYPE html>
<html lang="@Html.Lang()" dir="@Html.Dir()">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="@platformName - @platformDescription" />
    <meta name="author" content="@platformName" />
    <partial name="_PwaMeta" />
    <title>@ViewData["Title"] - @Html.T("لوحة تحكم المدير", "Admin Dashboard") - @platformName</title>
    
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="@Url.Content(string.IsNullOrEmpty(platformFavicon) ? "~/assets/images/favicon.ico" : "~" + platformFavicon)" />
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="~/assets/css/bootstrap.min.css" />
    
    <!-- Vendors CSS -->
    <link rel="stylesheet" type="text/css" href="~/assets/vendors/css/vendors.min.css" />
    <link rel="stylesheet" type="text/css" href="~/assets/vendors/css/feather.min.css" />
    <link rel="stylesheet" type="text/css" href="~/assets/vendors/css/daterangepicker.min.css" />
    
    <!-- Custom Theme CSS -->
    <link rel="stylesheet" type="text/css" href="~/assets/css/theme.min.css" />
    
    <!-- Mobile Responsive CSS -->
    <link rel="stylesheet" type="text/css" href="~/css/responsive-mobile.css" />
    
    <!-- Brand Identity CSS -->
    <link rel="stylesheet" type="text/css" href="~/css/brand-identity.css" />
    
    <!-- Site CSS - Global styles including modal fix -->
    <link rel="stylesheet" type="text/css" href="~/css/site.css" asp-append-version="true" />
    
    <!-- PerfectScrollbar CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/perfect-scrollbar/1.5.5/css/perfect-scrollbar.min.css" />
    
    <!-- Google Fonts - Cairo for Arabic -->
    @if (Html.IsRtl())
    {
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    }
    
    <!-- Conditional RTL/LTR Styles -->
    @if (Html.IsRtl())
    {
    <style>
        body {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: rtl;
            text-align: right;
        }
        
        /* Sidebar positioning for RTL */
        .nxl-navigation {
            left: auto !important;
            right: 0 !important;
        }
        
        .nxl-container {
            margin-left: 0 !important;
            margin-right: 280px !important;
            min-height: auto !important;
            display: flex;
            flex-direction: column;
            padding : 0 !important;
        }
        
        .nxl-head-mobile-toggler {
            margin-left: auto;
            margin-right: 0;
        }
        
        .breadcrumb-item + .breadcrumb-item::before {
            float: right;
            padding-left: 0.5rem;
            padding-right: 0;
            content: "/";
        }
        
        .ms-auto {
            margin-left: 0 !important;
            margin-right: auto !important;
        }
        
        .me-auto {
            margin-right: 0 !important;
            margin-left: auto !important;
        }
        
        .text-end {
            text-align: left !important;
        }
        
        .text-start {
            text-align: right !important;
        }
        
        /* Minimenu adjustments for RTL */
        html.minimenu .nxl-container {
            margin-left: 0 !important;
            margin-right: 140px !important;
            min-height: auto !important;
            padding: 0 !important;
        }
        
        html.minimenu .nxl-navigation {
            width: 120px !important;
        }
        
        /* Dropdown arrow rotation for RTL */
        .nxl-arrow i {
            transform: rotate(180deg);
        }
        
        .nxl-hasmenu.nxl-trigger .nxl-arrow i {
            transform: rotate(90deg);
        }
        
        /* Submenu positioning */
        .nxl-submenu {
            padding-right: 1rem;
            padding-left: 0;
        }
        
        /* Mobile responsive adjustments */
        @@media (max-width: 1199px) {
            .nxl-container {
                margin-right: 0 !important;
                margin-left: 0 !important;
                min-height: auto !important;
            }
            
            .nxl-navigation {
                left: auto !important;
                right: -280px !important;
            }
            
            body.nxl-navigation-show .nxl-navigation {
                left: auto !important;
                right: 0 !important;
            }
            
            /* Footer responsive - full width on mobile/tablet */
            .footer {
                right: 0 !important;
            }
        }
        
        /* Header dropdown styles */
        .nxl-header .dropdown,
        .nxl-header .nxl-h-item {
            position: relative;
        }
        
        .nxl-header .dropdown-menu {
            position: absolute;
            top: 100%;
            z-index: 1050;
            display: none;
            min-width: 200px;
            padding: 0.5rem 0;
            margin-top: 0.5rem;
            background-color: #fff;
            border: 1px solid rgba(0,0,0,.1);
            border-radius: 0.5rem;
            box-shadow: 0 0.5rem 1.5rem rgba(0,0,0,.15);
        }
        
        .nxl-header .dropdown-menu.show {
            display: block !important;
        }
        
        /* RTL: Dropdowns open towards center (left edge anchored) */
        .nxl-header .dropdown-menu-end,
        .nxl-header .dropdown-menu {
            left: 0 !important;
            right: auto !important;
        }
        
        /* Dropdown toggle active state */
        .header-dropdown-toggle.active {
            background-color: var(--primary-soft, #e8f0fb) !important;
            color: var(--primary, #004aad) !important;
        }
        
        /* Breadcrumb spacing for RTL */
        .breadcrumb {
            display: flex;
            flex-wrap: wrap;
            padding: 0;
            margin: 0 1.5rem;
            list-style: none;
            gap: 0.25rem;
            align-items: center;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .breadcrumb-item a {
            color: #6c757d;
            text-decoration: none;
        }
        
        .breadcrumb-item a:hover {
            color: var(--primary, #004aad);
        }
        
        .breadcrumb-item.active,
        .breadcrumb-item:last-child {
            color: #333;
            font-weight: 600;
        }
        
        .breadcrumb-item + .breadcrumb-item {
            padding-right: 0;
        }
        
        .breadcrumb-item + .breadcrumb-item::before {
            content: ">";
            padding: 0 0.75rem;
            color: #adb5bd;
            font-size: 0.75rem;
        }
        
        /* Page header title styling */
        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            background: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,.05);
            flex-wrap: nowrap;
            gap: 0.5rem;
            min-height: 56px;
        }
        
        .page-header-left {
            display: flex;
            align-items: center;
            flex-wrap: nowrap;
            flex: 1;
            min-width: 0;
        }
        
        .page-header-title {
            margin-left: 1rem;
            padding-left: 1rem;
            border-left: 3px solid #004aad;
            flex-shrink: 0;
        }
        
        .page-header-title h5 {
            margin: 0;
            font-weight: 700;
            color: #333;
            font-size: 1.1rem;
            white-space: nowrap;
        }
        
        /* Page Header Right - inline with title */
        .page-header-right {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
        }
        
        /* Mobile toggle button */
        .page-header-right-open-toggle {
            display: none;
        }
        
        /* Page header right items - desktop visible, mobile hidden */
        .page-header-right-items {
            display: flex;
            align-items: center;
        }
        
        .page-header-right-items-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Mobile: Show toggle, hide items initially */
        @@media (max-width: 767.98px) {
            .page-header {
                padding: 0.5rem 0.75rem;
                min-height: 48px;
            }
            
            .page-header-title h5 {
                font-size: 1rem;
            }
            
            .breadcrumb {
                display: none;
            }
            
            .page-header-right-open-toggle {
                display: flex !important;
            }
            
            .page-header-right-items {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,.5);
                z-index: 1050;
                padding: 1rem;
                flex-direction: column;
                align-items: stretch;
            }
            
            .page-header-right-items.page-header-right-open {
                display: flex !important;
            }
            
            .page-header-right-items .page-header-right-items-wrapper {
                background: #fff;
                border-radius: 0.75rem;
                padding: 1rem;
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
                max-height: 80vh;
                overflow-y: auto;
            }
            
            .page-header-right-items .page-header-right-items-wrapper .btn,
            .page-header-right-items .page-header-right-items-wrapper .dropdown {
                width: 100%;
            }
            
            .page-header-right-items .page-header-right-items-wrapper .btn {
                justify-content: center;
            }
            
            .page-header-right-items .page-header-right-items-wrapper .dropdown .btn {
                width: 100%;
            }
        }
        
        /* Tablet adjustments */
        @@media (min-width: 768px) and (max-width: 991.98px) {
            .breadcrumb {
                display: none;
            }
        }
        
        /* Sidebar submenu styles */
        .nxl-submenu {
            display: none;
            list-style: none;
            margin: 0;
            padding: 0.5rem 0 0.5rem 1rem;
            background-color: rgba(0,0,0,.02);
        }
        
        .nxl-hasmenu.nxl-trigger > .nxl-submenu {
            display: block;
        }
        
        .nxl-submenu .nxl-link {
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            text-decoration: none;
            color: #666;
            font-size: 0.9rem;
        }
        
        .nxl-submenu .nxl-link:hover {
            color: var(--primary, #004aad);
            background-color: rgba(0, 74, 173, 0.05);
        }
        
        .nxl-submenu .nxl-link.active {
            color: var(--primary, #004aad);
            font-weight: 600;
        }
        
        /* Navbar content scrollbar */
        .navbar-content {
            position: relative;
            height: calc(100vh - 100px);
            overflow: hidden;
        }
        
        /* Navbar item styles */
        .nxl-navbar {
            list-style: none;
            margin: 0;
            padding: 1rem 0;
        }
        
        .nxl-item {
            margin-bottom: 0.25rem;
        }
        
        .nxl-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            text-decoration: none;
            color: #333;
            border-radius: 0.375rem;
            margin: 0 0.5rem;
            transition: all 0.2s;
        }
        
        .nxl-link:hover {
            background-color: rgba(0, 74, 173, 0.1);
            color: var(--primary, #004aad);
        }
        
        .nxl-link.active {
            background-color: rgba(0, 74, 173, 0.15);
            color: var(--primary, #004aad);
            font-weight: 600;
        }
        
        .nxl-micon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 0.75rem;
        }
        
        .nxl-mtext {
            flex: 1;
        }
        
        .nxl-arrow {
            margin-right: 0.5rem;
            transition: transform 0.3s;
        }
        
        .nxl-caption {
            padding: 1rem 1.5rem 0.5rem;
        }
        
        .nxl-caption label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #999;
            letter-spacing: 0.5px;
        }
        
        /* Navigation wrapper */
        .nxl-navigation {
            position: fixed;
            top: 0;
            width: 280px;
            height: 100vh;
            background-color: #fff;
            box-shadow: 0 0 15px rgba(0,0,0,.05);
            z-index: 1030;
            transition: all 0.3s ease;
        }
        
        .navbar-wrapper {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .m-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #eee;
            min-height: 100px;
            display: flex;
            align-items: center;
        }
        
        .b-brand {
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        
        .b-brand img {
            max-width: 100%;
            height: auto;
            object-fit: contain;
        }
        
        .logo-sm {
            display: none;
        }
        
        html.minimenu .logo-lg {
            display: none;
        }
        
        html.minimenu .logo-sm {
            display: block;
        }
        
        /* Header link styles */
        .nxl-header .nxl-head-link,
        .nxl-header .nxl-h-item > a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .nxl-header .nxl-head-link:hover,
        .nxl-header .nxl-h-item > a:hover {
            background-color: rgba(0,0,0,.05);
        }
        
        /* Notification badge */
        .nxl-h-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 10px;
            padding: 2px 5px;
            border-radius: 50%;
        }
        
        .nxl-h-item {
            position: relative;
        }
        
        /* Search dropdown */
        .nxl-search-dropdown {
            min-width: 300px !important;
            padding: 1rem !important;
        }
        
        /* Notifications dropdown */
        .nxl-notifications-menu {
            min-width: 320px !important;
        }
        
        /* User dropdown */
        .nxl-user-dropdown {
            min-width: 220px !important;
        }
        
        /* Dropdown item styling */
        .dropdown-item {
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: #333;
            transition: background-color 0.2s;
        }
        
        .dropdown-item:hover {
            background-color: #f8f9fa;
        }
        
        .dropdown-item i {
            width: 18px;
        }
        
        /* Notifications styling */
        .notifications-head {
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .notifications-item {
            display: flex;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f5f5f5;
        }
        
        .notifications-item:hover {
            background-color: #f8f9fa;
        }
        
        .notifications-desc {
            flex: 1;
            margin-right: 0.75rem;
        }
        
        .notifications-footer {
            padding: 0.75rem;
            border-top: 1px solid #eee;
        }
        
        /* Avatar styles */
        .avatar-text {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: 600;
        }
        
        .avatar-md {
            width: 40px;
            height: 40px;
            font-size: 14px;
        }
        
        .avatar-sm {
            width: 32px;
            height: 32px;
            font-size: 12px;
        }
        
        /* Hamburger menu styling */
        .hamburger {
            cursor: pointer;
            padding: 10px;
        }
        
        .hamburger-box {
            width: 20px;
            height: 16px;
            position: relative;
        }
        
        .hamburger-inner,
        .hamburger-inner::before,
        .hamburger-inner::after {
            width: 20px;
            height: 2px;
            background-color: #333;
            position: absolute;
            transition: transform 0.15s ease;
        }
        
        .hamburger-inner {
            top: 50%;
            transform: translateY(-50%);
        }
        
        .hamburger-inner::before {
            content: '';
            top: -6px;
        }
        
        .hamburger-inner::after {
            content: '';
            bottom: -6px;
        }
        
        /* ============================================
           HEADER STYLES - Full Width with Mobile Support
           ============================================ */
        .nxl-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 280px; /* Same as sidebar width */
            height: 70px;
            background-color: #fff;
            border-bottom: 1px solid #eee;
            z-index: 1020;
            display: flex;
            align-items: center;
        }
        
        .header-wrapper {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            height: 100%;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
                
        /* RTL Header positioning */
        html[dir="rtl"] .nxl-header,
        .nxl-header {
            left: 0;
            right: 280px;
        }
        
        html.minimenu .nxl-header {
            right: 120px;
        }
        
        /* Minimenu footer adjustment */
        html.minimenu .footer {
            right: 120px !important;
        }
        
        /* Mobile/Tablet: Full width header */
        @@media (max-width: 1199px) {
            .nxl-header {
                left: 0 !important;
                right: 0 !important;
                width: 100% !important;
            }
            
        }
        
        @@media (max-width: 767px) {
            .nxl-header {
                height: 56px !important;
            }
            
            .header-wrapper {
                padding: 0 0.75rem !important;
                height: 56px !important;
            }
            
        }
        
        /* Header icon buttons */
        .nxl-h-item {
            position: relative;
            margin: 0 0.25rem;
        }
        
        .nxl-h-item > a,
        .nxl-head-link {
            display: flex !important;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background-color: #f5f5f5;
            color: #333;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .nxl-h-item > a:hover,
        .nxl-head-link:hover {
            background-color: var(--primary-soft, #e8f0fb);
            color: var(--primary, #004aad);
        }
        
        .nxl-h-item > a i,
        .nxl-head-link i {
            font-size: 18px;
        }
        
        /* Notification badge */
        .nxl-h-badge {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 10px;
            min-width: 18px;
            height: 18px;
            padding: 0 4px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Navigation toggle buttons */
        .nxl-navigation-toggle a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .nxl-navigation-toggle a:hover {
            background-color: var(--primary-soft, #e8f0fb);
            color: var(--primary, #004aad);
        }
        
        .nxl-navigation-toggle a i {
            font-size: 20px;
        }
        
        /* Header dropdown toggle */
        .header-dropdown-toggle {
            display: flex !important;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background-color: #f5f5f5;
            color: #333;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .header-dropdown-toggle:hover,
        .header-dropdown-toggle.active {
            background-color: var(--primary-soft, #e8f0fb);
            color: var(--primary, #004aad);
        }
        
        .header-dropdown-toggle i {
            font-size: 18px;
            pointer-events: none;
        }
        
        /* Profile avatar in header */
        .header-dropdown-toggle .avatar-text {
            pointer-events: none;
        }
    </style>
    }
    else
    {
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: ltr;
            text-align: left;
        }
        
        /* Sidebar positioning for LTR */
        .nxl-navigation {
            position: fixed;
            top: 0;
            left: 0;
            right: auto !important;
            width: 280px;
            height: 100vh;
            background-color: #fff;
            box-shadow: 0 0 15px rgba(0,0,0,.05);
            z-index: 1030;
            transition: all 0.3s ease;
        }
        
        .nxl-container {
            margin-left: 280px !important;
            margin-right: 0 !important;
            min-height: auto !important;
            display: flex;
            flex-direction: column;
            padding: 0 !important;
        }
        
        .nxl-head-mobile-toggler {
            margin-right: auto;
            margin-left: 0;
        }
        
        .breadcrumb-item + .breadcrumb-item::before {
            float: left;
            padding-right: 0.5rem;
            padding-left: 0;
            content: "/";
        }
        
        /* Minimenu adjustments for LTR */
        html.minimenu .nxl-container {
            margin-right: 0 !important;
            margin-left: 140px !important;
            min-height: auto !important;
            padding: 0 !important;
        }
        
        html.minimenu .nxl-navigation {
            width: 120px !important;
        }
        
        /* Dropdown arrow */
        .nxl-arrow i {
            transition: transform 0.25s ease;
        }
        
        .nxl-hasmenu.nxl-trigger .nxl-arrow i {
            transform: rotate(90deg);
        }
        
        /* Submenu positioning */
        .nxl-submenu {
            padding-left: 1rem;
            padding-right: 0;
        }
        
        /* Mobile responsive adjustments */
        @@media (max-width: 1199px) {
            .nxl-container {
                margin-left: 0 !important;
                margin-right: 0 !important;
                min-height: auto !important;
            }
            
            .nxl-navigation {
                right: auto !important;
                left: -280px !important;
            }
            
            body.nxl-navigation-show .nxl-navigation {
                right: auto !important;
                left: 0 !important;
            }
            
            .footer {
                left: 0 !important;
            }
        }
        
        /* Header dropdown styles */
        .nxl-header .dropdown,
        .nxl-header .nxl-h-item {
            position: relative;
        }
        
        .nxl-header .dropdown-menu {
            position: absolute;
            top: 100%;
            z-index: 1050;
            display: none;
            min-width: 200px;
            padding: 0.5rem 0;
            margin-top: 0.5rem;
            background-color: #fff;
            border: 1px solid rgba(0,0,0,.1);
            border-radius: 0.5rem;
            box-shadow: 0 0.5rem 1.5rem rgba(0,0,0,.15);
        }
        
        .nxl-header .dropdown-menu.show {
            display: block !important;
        }
        
        /* LTR: Dropdowns open towards right */
        .nxl-header .dropdown-menu-end,
        .nxl-header .dropdown-menu {
            right: 0 !important;
            left: auto !important;
        }
        
        .header-dropdown-toggle.active {
            background-color: var(--primary-soft, #e8f0fb) !important;
            color: var(--primary, #004aad) !important;
        }
        
        /* Breadcrumb */
        .breadcrumb { display: flex; flex-wrap: wrap; padding: 0; margin: 0 1.5rem; list-style: none; gap: 0.25rem; align-items: center; }
        .breadcrumb-item { display: flex; align-items: center; font-size: 0.875rem; }
        .breadcrumb-item a { color: #6c757d; text-decoration: none; }
        .breadcrumb-item a:hover { color: var(--primary, #004aad); }
        .breadcrumb-item.active, .breadcrumb-item:last-child { color: #333; font-weight: 600; }
        .breadcrumb-item + .breadcrumb-item::before { content: ">"; padding: 0 0.75rem; color: #adb5bd; font-size: 0.75rem; }
        
        /* Page header */
        .page-header { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 1rem; margin-bottom: 1rem; background: #fff; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,.05); flex-wrap: nowrap; gap: 0.5rem; min-height: 56px; }
        .page-header-left { display: flex; align-items: center; flex-wrap: nowrap; flex: 1; min-width: 0; }
        .page-header-title { margin-right: 1rem; padding-right: 1rem; border-right: 3px solid #004aad; flex-shrink: 0; }
        .page-header-title h5 { margin: 0; font-weight: 700; color: #333; font-size: 1.1rem; white-space: nowrap; }
        .page-header-right { display: flex; align-items: center; gap: 0.5rem; flex-shrink: 0; }
        .page-header-right-open-toggle { display: none; }
        .page-header-right-items { display: flex; align-items: center; }
        .page-header-right-items-wrapper { display: flex; align-items: center; gap: 0.5rem; }
        
        @@media (max-width: 767.98px) {
            .page-header { padding: 0.5rem 0.75rem; min-height: 48px; }
            .page-header-title h5 { font-size: 1rem; }
            .breadcrumb { display: none; }
            .page-header-right-open-toggle { display: flex !important; }
            .page-header-right-items { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,.5); z-index: 1050; padding: 1rem; flex-direction: column; align-items: stretch; }
            .page-header-right-items.page-header-right-open { display: flex !important; }
            .page-header-right-items .page-header-right-items-wrapper { background: #fff; border-radius: 0.75rem; padding: 1rem; flex-direction: column; align-items: stretch; gap: 0.75rem; max-height: 80vh; overflow-y: auto; }
            .page-header-right-items .page-header-right-items-wrapper .btn, .page-header-right-items .page-header-right-items-wrapper .dropdown { width: 100%; }
            .page-header-right-items .page-header-right-items-wrapper .btn { justify-content: center; }
            .page-header-right-items .page-header-right-items-wrapper .dropdown .btn { width: 100%; }
        }
        
        @@media (min-width: 768px) and (max-width: 991.98px) {
            .breadcrumb { display: none; }
        }
        
        /* Sidebar submenu styles */
        .nxl-submenu { display: none; list-style: none; margin: 0; padding: 0.5rem 0 0.5rem 1rem; background-color: rgba(0,0,0,.02); }
        .nxl-hasmenu.nxl-trigger > .nxl-submenu { display: block; }
        .nxl-submenu .nxl-link { padding: 0.5rem 1rem; display: flex; align-items: center; text-decoration: none; color: #666; font-size: 0.9rem; }
        .nxl-submenu .nxl-link:hover { color: var(--primary, #004aad); background-color: rgba(0, 74, 173, 0.05); }
        .nxl-submenu .nxl-link.active { color: var(--primary, #004aad); font-weight: 600; }
        
        .navbar-content { position: relative; height: calc(100vh - 100px); overflow: hidden; }
        .nxl-navbar { list-style: none; margin: 0; padding: 1rem 0; }
        .nxl-item { margin-bottom: 0.25rem; }
        .nxl-link { display: flex; align-items: center; padding: 0.75rem 1rem; text-decoration: none; color: #333; border-radius: 0.375rem; margin: 0 0.5rem; transition: all 0.2s; }
        .nxl-link:hover { background-color: rgba(0, 74, 173, 0.1); color: var(--primary, #004aad); }
        .nxl-link.active { background-color: rgba(0, 74, 173, 0.15); color: var(--primary, #004aad); font-weight: 600; }
        .nxl-micon { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; }
        .nxl-mtext { flex: 1; }
        .nxl-arrow { margin-left: 0.5rem; transition: transform 0.3s; }
        .nxl-caption { padding: 1rem 1.5rem 0.5rem; }
        .nxl-caption label { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: #999; letter-spacing: 0.5px; }
        
        .navbar-wrapper { height: 100%; display: flex; flex-direction: column; }
        .m-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid #eee; min-height: 100px; display: flex; align-items: center; }
        .b-brand { text-decoration: none; display: flex; align-items: center; justify-content: center; width: 100%; }
        .b-brand img { max-width: 100%; height: auto; object-fit: contain; }
        .logo-sm { display: none; }
        html.minimenu .logo-lg { display: none; }
        html.minimenu .logo-sm { display: block; }
        
        /* Header styles */
        .nxl-header { position: fixed; top: 0; left: 280px; right: 0; height: 70px; background-color: #fff; border-bottom: 1px solid #eee; z-index: 1020; display: flex; align-items: center; }
        .header-wrapper { width: 100%; display: flex; align-items: center; justify-content: space-between; padding: 0 1.5rem; height: 100%; }
        .header-left { display: flex; align-items: center; gap: 1rem; }
        .header-right { display: flex; align-items: center; gap: 0.5rem; }
        
        html.minimenu .nxl-header { left: 120px; }
        html.minimenu .footer { left: 120px !important; }
        
        @@media (max-width: 1199px) {
            .nxl-header { left: 0 !important; right: 0 !important; width: 100% !important; }
        }
        
        @@media (max-width: 767px) {
            .nxl-header { height: 56px !important; }
            .header-wrapper { padding: 0 0.75rem !important; height: 56px !important; }
        }
        
        .nxl-h-item { position: relative; margin: 0 0.25rem; }
        .nxl-h-item > a, .nxl-head-link { display: flex !important; align-items: center; justify-content: center; width: 42px; height: 42px; border-radius: 50%; background-color: #f5f5f5; color: #333; text-decoration: none; cursor: pointer; transition: all 0.2s ease; position: relative; }
        .nxl-h-item > a:hover, .nxl-head-link:hover { background-color: var(--primary-soft, #e8f0fb); color: var(--primary, #004aad); }
        .nxl-h-item > a i, .nxl-head-link i { font-size: 18px; }
        .nxl-h-badge { position: absolute; top: 0; right: 0; font-size: 10px; min-width: 18px; height: 18px; padding: 0 4px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .nxl-navigation-toggle a { display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 50%; color: #333; cursor: pointer; transition: all 0.2s ease; }
        .nxl-navigation-toggle a:hover { background-color: var(--primary-soft, #e8f0fb); color: var(--primary, #004aad); }
        .nxl-navigation-toggle a i { font-size: 20px; }
        .header-dropdown-toggle { display: flex !important; align-items: center; justify-content: center; width: 42px; height: 42px; border-radius: 50%; background-color: #f5f5f5; color: #333; text-decoration: none; cursor: pointer; transition: all 0.2s ease; position: relative; }
        .header-dropdown-toggle:hover, .header-dropdown-toggle.active { background-color: var(--primary-soft, #e8f0fb); color: var(--primary, #004aad); }
        .header-dropdown-toggle i { font-size: 18px; pointer-events: none; }
        .header-dropdown-toggle .avatar-text { pointer-events: none; }
        
        .nxl-search-dropdown { min-width: 300px !important; padding: 1rem !important; }
        .nxl-notifications-menu { min-width: 320px !important; }
        .nxl-user-dropdown { min-width: 220px !important; }
        .dropdown-item { padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; text-decoration: none; color: #333; transition: background-color 0.2s; }
        .dropdown-item:hover { background-color: #f8f9fa; }
        .dropdown-item i { width: 18px; }
        .notifications-head { padding: 1rem; border-bottom: 1px solid #eee; }
        .notifications-item { display: flex; padding: 0.75rem 1rem; border-bottom: 1px solid #f5f5f5; }
        .notifications-item:hover { background-color: #f8f9fa; }
        .notifications-desc { flex: 1; margin-left: 0.75rem; }
        .notifications-footer { padding: 0.75rem; border-top: 1px solid #eee; }
        .avatar-text { display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: 600; }
        .avatar-md { width: 40px; height: 40px; font-size: 14px; }
        .avatar-sm { width: 32px; height: 32px; font-size: 12px; }
        .hamburger { cursor: pointer; padding: 10px; }
        .hamburger-box { width: 20px; height: 16px; position: relative; }
        .hamburger-inner, .hamburger-inner::before, .hamburger-inner::after { width: 20px; height: 2px; background-color: #333; position: absolute; transition: transform 0.15s ease; }
        .hamburger-inner { top: 50%; transform: translateY(-50%); }
        .hamburger-inner::before { content: ''; top: -6px; }
        .hamburger-inner::after { content: ''; bottom: -6px; }
    </style>
    }
    
    @RenderSection("Styles", required: false)
</head>

<body>
    <!--! ================================================================ !-->
    <!--! [Start] Navigation Menu !-->
    <!--! ================================================================ !-->
    @await Html.PartialAsync("_Sidebar")
    <!--! ================================================================ !-->
    <!--! [End] Navigation Menu !-->
    <!--! ================================================================ !-->
    
    <!--! ================================================================ !-->
    <!--! [Start] Header !-->
    <!--! ================================================================ !-->
    @await Html.PartialAsync("_Header")
    <!--! ================================================================ !-->
    <!--! [End] Header !-->
    <!--! ================================================================ !-->
    
    <!--! ================================================================ !-->
    <!--! [Start] Main Content !-->
    <!--! ================================================================ !-->
    <main class="nxl-container">
        <div class="nxl-content" style="flex: 1 0 auto;">
            @await Html.PartialAsync("_Messages")
            
            @{
                var title = ViewData["Title"]?.ToString() ?? Html.T("الصفحة", "Page");
                var breadcrumbs = ViewData["Breadcrumbs"] as List<(string Name, string? Url)> ?? new List<(string, string?)>();
                var showStats = ViewData["ShowStats"] as bool? ?? false;
                var actions = ViewData["HeaderActions"] as List<(string Text, string Icon, string Url, string? CssClass)> ?? new List<(string, string, string, string?)>();
            }

            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-left d-flex align-items-center">
                    <div class="page-header-title">
                        <h5 class="m-b-10">@title</h5>
                    </div>
                    @if (breadcrumbs.Any())
                    {
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="Dashboard" asp-action="Index">@Html.T("الرئيسية", "Home")</a></li>
                            @foreach (var crumb in breadcrumbs)
                            {
                                if (string.IsNullOrEmpty(crumb.Url))
                                {
                                    <li class="breadcrumb-item">@crumb.Name</li>
                                }
                                else
                                {
                                    <li class="breadcrumb-item"><a href="@crumb.Url">@crumb.Name</a></li>
                                }
                            }
                        </ul>
                    }
                </div>
                <div class="page-header-right d-flex align-items-center gap-2">
                    <!-- Mobile Toggle Button - Same Row -->
                    <a href="javascript:void(0)" class="page-header-right-open-toggle d-md-none btn btn-icon btn-light-brand">
                        <i class="feather-more-vertical fs-18"></i>
                    </a>
                    
                    <!-- Action Items Container -->
                    <div class="page-header-right-items">
                        <div class="d-flex d-md-none mb-3 pb-2 border-bottom">
                            <a href="javascript:void(0)" class="page-header-right-close-toggle d-flex align-items-center text-muted">
                                <i class="feather-x me-2"></i>
                                <span>@Html.T("إغلاق", "Close")</span>
                            </a>
                        </div>
                        <div class="d-flex align-items-center gap-2 page-header-right-items-wrapper">
                            @if (showStats)
                            {
                                <a href="javascript:void(0);" class="btn btn-icon btn-light-brand" data-bs-toggle="collapse" data-bs-target="#statsCollapse">
                                    <i class="feather-bar-chart"></i>
                                </a>
                            }
                            @if (IsSectionDefined("FilterDropdown"))
                            {
                                <div class="dropdown">
                                    <a class="btn btn-icon btn-light-brand" data-bs-toggle="dropdown" data-bs-offset="0, 10" data-bs-auto-close="outside">
                                        <i class="feather-filter"></i>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-end">
                                        @RenderSection("FilterDropdown", required: false)
                                    </div>
                                </div>
                            }
                            <div class="dropdown">
                                <a class="btn btn-icon btn-light-brand" data-bs-toggle="dropdown" data-bs-offset="0, 10" data-bs-auto-close="outside">
                                    <i class="feather-paperclip"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-end">
                                    <a href="javascript:void(0);" class="dropdown-item export-pdf">
                                        <i class="bi bi-filetype-pdf me-3"></i>
                                        <span>@Html.T("تصدير PDF", "Export PDF")</span>
                                    </a>
                                    <a href="javascript:void(0);" class="dropdown-item export-csv">
                                        <i class="bi bi-filetype-csv me-3"></i>
                                        <span>@Html.T("تصدير CSV", "Export CSV")</span>
                                    </a>
                                    <a href="javascript:void(0);" class="dropdown-item export-excel">
                                        <i class="bi bi-filetype-xlsx me-3"></i>
                                        <span>@Html.T("تصدير Excel", "Export Excel")</span>
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a href="javascript:void(0);" class="dropdown-item" onclick="window.print()">
                                        <i class="bi bi-printer me-3"></i>
                                        <span>@Html.T("طباعة", "Print")</span>
                                    </a>
                                </div>
                            </div>
                            @foreach (var action in actions)
                            {
                                <a href="@action.Url" class="btn @(action.CssClass ?? "btn-primary")">
                                    <i class="@action.Icon me-2"></i>
                                    <span>@action.Text</span>
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>

            @if (showStats && IsSectionDefined("StatsCards"))
            {
                <div id="statsCollapse" class="accordion-collapse collapse page-header-collapse">
                    <div class="accordion-body pb-2">
                        <div class="row">
                            @RenderSection("StatsCards", required: false)
                        </div>
                    </div>
                </div>
            }
            else if (IsSectionDefined("StatsCards"))
            {
                // Ignore the section if ShowStats is false to prevent render errors
                IgnoreSection("StatsCards");
            }

            @RenderBody()
        </div>
        
        <!-- Footer Spacer -->
        <div style="height: 80px;"></div>
        
        <!-- Fixed Footer -->
        <footer class="footer" style="position: fixed; bottom: 0; @(Html.IsRtl() ? "left: 0; right: 280px;" : "right: 0; left: 280px;") height: 40px; background-color: #f8f9fa; border-top: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: center; z-index: 1000;">
            <p class="fs-11 text-muted fw-medium text-uppercase mb-0 copyright">
                <span>&copy; @DateTime.Now.Year @Html.T("منصة", "Platform") @platformName.</span>
                <span class="d-none d-sm-inline-block">@Html.T(await PlatformSettings.GetSettingAsync("PlatformCopyright", "جميع الحقوق محفوظة"), "All rights reserved")</span>
            </p>
        </footer>
    </main>
    <!--! ================================================================ !-->
    <!--! [End] Main Content !-->
    <!--! ================================================================ !-->
    
    <!-- jQuery -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    
    <!-- Bootstrap Bundle (includes Popper) -->
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- PerfectScrollbar -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/perfect-scrollbar/1.5.5/perfect-scrollbar.min.js"></script>
    
    <!-- Chart.js for Dashboard Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Site.js - Global scripts including modal fix -->
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/pwa-register.js" asp-append-version="true"></script>
    
    <!-- Admin translated strings for JS (same approach as Html.T) -->
    <script>
        window.__adminT = {
            exportData: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Html.T("تصدير البيانات", "Export Data"))),
            noDataToExport: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Html.T("لا توجد بيانات للتصدير", "No data to export"))),
            exportSuccess: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Html.T("تم تصدير البيانات بنجاح", "Data exported successfully")))
        };
    </script>
    
    <!-- Admin Dashboard Navigation and Interactions JS -->
    <script>
        (function() {
            'use strict';
            
            // Wait for DOM to be ready
            document.addEventListener('DOMContentLoaded', function() {
                initSidebar();
                initHeaderDropdowns();
                initMobileToggle();
                initScrollbar();
                initActiveMenuHighlight();
                initAlertAutoDismiss();
                initPageHeaderToggle();
            });
            
            // Sidebar dropdown functionality is handled in _SidebarScripts.cshtml
            // This function is kept empty to avoid duplicate initialization
            function initSidebar() {
                // Sidebar dropdown logic moved to _SidebarScripts.cshtml for cleaner separation
            }
            
            // Header dropdowns (search, notifications, profile)
            function initHeaderDropdowns() {
                var isProcessingTouch = false;
                
                // Core toggle function
                function toggleDropdown(toggle) {
                    var parent = toggle.closest('.dropdown, .nxl-h-item');
                    if (!parent) return false;
                    
                    var menu = parent.querySelector('.dropdown-menu');
                    if (!menu) return false;
                    
                    var isOpen = menu.classList.contains('show');
                    
                    // Close all other dropdowns first
                    closeAllHeaderDropdowns();
                    
                    // Toggle current dropdown
                    if (!isOpen) {
                        menu.classList.add('show');
                        toggle.classList.add('active');
                        // Prevent immediate close from document click
                        menu.setAttribute('data-just-opened', 'true');
                        setTimeout(function() {
                            menu.removeAttribute('data-just-opened');
                        }, 200);
                    }
                    return true;
                }
                
                // Handle click events on dropdown toggles
                document.addEventListener('click', function(e) {
                    // Skip if we just processed a touch event
                    if (isProcessingTouch) {
                        isProcessingTouch = false;
                        return;
                    }
                    
                    var toggle = e.target.closest('.header-dropdown-toggle');
                    
                    if (toggle) {
                        e.preventDefault();
                        e.stopPropagation();
                        toggleDropdown(toggle);
                        return;
                    }
                    
                    // Handle close button in search
                    var searchClose = e.target.closest('.search-form .btn-close');
                    if (searchClose) {
                        e.preventDefault();
                        e.stopPropagation();
                        closeAllHeaderDropdowns();
                        return;
                    }
                    
                    // Check if clicked inside a dropdown menu (don't close)
                    var insideDropdownMenu = e.target.closest('.nxl-h-item .dropdown-menu');
                    if (insideDropdownMenu && !insideDropdownMenu.hasAttribute('data-just-opened')) {
                        return; // Don't close when clicking inside the menu
                    }
                    
                    // Close dropdowns when clicking outside
                    var insideHeaderItem = e.target.closest('.nxl-h-item');
                    if (!insideHeaderItem) {
                        closeAllHeaderDropdowns();
                    }
                }, true); // Use capture phase
                
                // Handle touch events for mobile - using touchstart for better responsiveness
                document.addEventListener('touchstart', function(e) {
                    var toggle = e.target.closest('.header-dropdown-toggle');
                    if (toggle) {
                        e.preventDefault();
                        isProcessingTouch = true;
                        toggleDropdown(toggle);
                    }
                }, { passive: false });
                
                // Handle Escape key to close dropdowns
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        closeAllHeaderDropdowns();
                    }
                });
            }
            
            // Helper function to close all header dropdowns
            function closeAllHeaderDropdowns() {
                document.querySelectorAll('.nxl-h-item .dropdown-menu.show').forEach(function(menu) {
                    menu.classList.remove('show');
                    menu.removeAttribute('data-just-opened');
                });
                document.querySelectorAll('.header-dropdown-toggle.active').forEach(function(toggle) {
                    toggle.classList.remove('active');
                });
            }
            
            // Mobile sidebar toggle
            function initMobileToggle() {
                var mobileToggle = document.getElementById('mobile-collapse');
                var sidebarCloseBtn = document.getElementById('sidebar-close-btn');
                
                if (mobileToggle) {
                    mobileToggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.body.classList.toggle('nxl-navigation-show');
                    });
                }
                
                // Sidebar close button handler
                if (sidebarCloseBtn) {
                    sidebarCloseBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.body.classList.remove('nxl-navigation-show');
                    });
                }
                
                // Close sidebar when clicking on overlay (the ::before pseudo-element)
                document.addEventListener('click', function(e) {
                    if (document.body.classList.contains('nxl-navigation-show')) {
                        var navigation = document.querySelector('.nxl-navigation');
                        var header = document.querySelector('.nxl-header');
                        var isClickInsideNav = navigation && navigation.contains(e.target);
                        var isClickOnToggle = mobileToggle && mobileToggle.contains(e.target);
                        var isClickInsideHeader = header && header.contains(e.target);
                        
                        // Don't close sidebar when clicking inside header or navigation
                        if (!isClickInsideNav && !isClickOnToggle && !isClickInsideHeader) {
                            document.body.classList.remove('nxl-navigation-show');
                        }
                    }
                });
                
                // Menu mini/expand buttons
                var miniBtn = document.getElementById('menu-mini-button');
                var expandBtn = document.getElementById('menu-expend-button');
                
                if (miniBtn) {
                    miniBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.documentElement.classList.add('minimenu');
                        this.style.display = 'none';
                        if (expandBtn) expandBtn.style.display = 'block';
                    });
                }
                
                if (expandBtn) {
                    expandBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.documentElement.classList.remove('minimenu');
                        this.style.display = 'none';
                        if (miniBtn) miniBtn.style.display = 'block';
                    });
                }
            }
            
            // Initialize PerfectScrollbar for sidebar
            function initScrollbar() {
                var navContent = document.querySelector('.navbar-content');
                if (navContent && typeof PerfectScrollbar !== 'undefined') {
                    new PerfectScrollbar(navContent, {
                        wheelSpeed: 0.5,
                        swipeEasing: true,
                        suppressScrollX: true,
                        wheelPropagation: false
                    });
                }
            }
            
            // Active menu highlighting is handled server-side via Razor in _Sidebar.cshtml
            // and initialized in _SidebarScripts.cshtml, so this function is no longer needed
            function initActiveMenuHighlight() {
                // Active state is set server-side, no client-side manipulation needed
            }
            
            // Auto-dismiss alerts
            function initAlertAutoDismiss() {
                setTimeout(function() {
                    var alerts = document.querySelectorAll('.alert');
                    alerts.forEach(function(alert) {
                        fadeOut(alert, 500, function() {
                            if (alert.parentNode) {
                                alert.parentNode.removeChild(alert);
                            }
                        });
                    });
                }, 5000);
            }
            
            // Page header right toggle (mobile)
            function initPageHeaderToggle() {
                var openToggle = document.querySelector('.page-header-right-open-toggle');
                var closeToggle = document.querySelector('.page-header-right-close-toggle');
                var rightItems = document.querySelector('.page-header-right-items');
                
                if (openToggle && rightItems) {
                    openToggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        rightItems.classList.add('page-header-right-open');
                        rightItems.classList.remove('page-header-right-close');
                    });
                }
                
                if (closeToggle && rightItems) {
                    closeToggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        rightItems.classList.remove('page-header-right-open');
                        rightItems.classList.add('page-header-right-close');
                    });
                }
                
                // Close when clicking outside (on overlay)
                if (rightItems) {
                    rightItems.addEventListener('click', function(e) {
                        if (e.target === rightItems) {
                            rightItems.classList.remove('page-header-right-open');
                            rightItems.classList.add('page-header-right-close');
                        }
                    });
                }
            }
            
            // Utility: Slide down animation
            function slideDown(element, duration) {
                if (!element) return;
                
                // If already visible and has height, skip animation
                var computedDisplay = window.getComputedStyle(element).display;
                if (computedDisplay === 'block' && element.offsetHeight > 0) {
                    return;
                }
                
                element.style.display = 'block';
                element.style.overflow = 'hidden';
                element.style.height = '0';
                element.style.transition = 'height ' + duration + 'ms ease';
                
                var height = element.scrollHeight;
                requestAnimationFrame(function() {
                    element.style.height = height + 'px';
                });
                
                setTimeout(function() {
                    element.style.height = '';
                    element.style.overflow = '';
                    element.style.transition = '';
                }, duration);
            }
            
            // Utility: Slide up animation
            function slideUp(element, duration) {
                if (!element) return;
                
                // If already hidden, skip animation
                var computedDisplay = window.getComputedStyle(element).display;
                if (computedDisplay === 'none' || element.offsetHeight === 0) {
                    element.style.display = 'none';
                    return;
                }
                
                element.style.overflow = 'hidden';
                var currentHeight = element.offsetHeight || element.scrollHeight;
                element.style.height = currentHeight + 'px';
                element.style.transition = 'height ' + duration + 'ms ease';
                
                // Force reflow
                element.offsetHeight;
                
                requestAnimationFrame(function() {
                    element.style.height = '0';
                });
                
                setTimeout(function() {
                    element.style.display = 'none';
                    element.style.height = '';
                    element.style.overflow = '';
                    element.style.transition = '';
                }, duration);
            }
            
            // Utility: Fade out animation
            function fadeOut(element, duration, callback) {
                element.style.opacity = '1';
                element.style.transition = 'opacity ' + duration + 'ms ease';
                
                requestAnimationFrame(function() {
                    element.style.opacity = '0';
                });
                
                setTimeout(function() {
                    element.style.display = 'none';
                    if (callback) callback();
                }, duration);
            }
            
            // ============================================
            // EXPORT FUNCTIONALITY - Global Handler
            // ============================================
            initExportButtons();
            
            function initExportButtons() {
                // Export PDF
                document.querySelectorAll('.export-pdf').forEach(function(btn) {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        handleExport('pdf');
                    });
                });
                
                // Export CSV
                document.querySelectorAll('.export-csv').forEach(function(btn) {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        handleExport('csv');
                    });
                });
                
                // Export Excel
                document.querySelectorAll('.export-excel').forEach(function(btn) {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        handleExport('excel');
                    });
                });
            }
            
            function handleExport(format) {
                // Get current page context
                var pageTitle = document.querySelector('.page-header-title h5')?.textContent || (window.__adminT && window.__adminT.exportData ? window.__adminT.exportData : 'Export Data');
                var tableElement = document.querySelector('.table, .data-table, [data-export-table]');
                
                // Try to export table data if available on current page
                if (tableElement && (format === 'csv' || format === 'excel')) {
                    exportTableData(tableElement, format, pageTitle);
                } else if (format === 'pdf') {
                    // For PDF, use print functionality with print-friendly styles
                    exportAsPdf(pageTitle);
                } else {
                    // Fallback: Navigate to custom export page
                    navigateToCustomExport(format);
                }
            }
            
            function exportTableData(table, format, filename) {
                var rows = table.querySelectorAll('tr');
                if (rows.length === 0) {
                    showExportMessage((window.__adminT && window.__adminT.noDataToExport) || 'No data to export', 'warning');
                    return;
                }
                
                var csvContent = '';
                var rowDelimiter = '\n';
                var cellDelimiter = format === 'csv' ? ',' : '\t';
                
                rows.forEach(function(row, rowIndex) {
                    var cells = row.querySelectorAll('th, td');
                    var rowData = [];
                    
                    cells.forEach(function(cell) {
                        // Skip action columns (buttons, links, etc.)
                        if (cell.querySelector('button, .btn, .dropdown')) {
                            return;
                        }
                        
                        var text = cell.textContent.trim().replace(/"/g, '""');
                        // Remove extra whitespace and newlines
                        text = text.replace(/\s+/g, ' ');
                        rowData.push('"' + text + '"');
                    });
                    
                    if (rowData.length > 0) {
                        csvContent += rowData.join(cellDelimiter) + rowDelimiter;
                    }
                });
                
                if (!csvContent.trim()) {
                    showExportMessage((window.__adminT && window.__adminT.noDataToExport) || 'No data to export', 'warning');
                    return;
                }
                
                // Add BOM for UTF-8 encoding (important for Arabic)
                var BOM = '\uFEFF';
                var blob = new Blob([BOM + csvContent], { 
                    type: format === 'csv' ? 'text/csv;charset=utf-8;' : 'application/vnd.ms-excel;charset=utf-8;'
                });
                
                var link = document.createElement('a');
                var url = URL.createObjectURL(blob);
                var timestamp = new Date().toISOString().slice(0, 10);
                var extension = format === 'csv' ? '.csv' : '.xls';
                
                link.setAttribute('href', url);
                link.setAttribute('download', filename.replace(/\s+/g, '_') + '_' + timestamp + extension);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showExportMessage((window.__adminT && window.__adminT.exportSuccess) || 'Data exported successfully', 'success');
            }
            
            function exportAsPdf(title) {
                // Add print-specific styles temporarily
                var printStyles = document.createElement('style');
                printStyles.id = 'export-print-styles';
                printStyles.textContent = '@@media print { ' +
                    '.nxl-navigation, .nxl-header, .page-header-right, .btn, .dropdown, footer, .nxl-h-item { display: none !important; } ' +
                    '.nxl-container { margin: 0 !important; padding: 20px !important; } ' +
                    '.card { break-inside: avoid; box-shadow: none !important; border: 1px solid #ddd !important; } ' +
                    'body { font-size: 12pt !important; } ' +
                    '.table { font-size: 10pt !important; } ' +
                    '@@page { margin: 1cm; } ' +
                '}';
                document.head.appendChild(printStyles);
                
                // Trigger print
                window.print();
                
                // Remove print styles after printing
                setTimeout(function() {
                    var styles = document.getElementById('export-print-styles');
                    if (styles) styles.remove();
                }, 1000);
            }
            
            function navigateToCustomExport(format) {
                // Get current controller from URL path
                var pathParts = window.location.pathname.split('/').filter(Boolean);
                var controller = pathParts.length >= 2 ? pathParts[1] : 'Dashboard';
                
                // Map controller to export type
                var exportTypeMap = {
                    'Dashboard': 'Analytics',
                    'Users': 'Users',
                    'Students': 'Users',
                    'Instructors': 'Users',
                    'Courses': 'Courses',
                    'Enrollments': 'Enrollments',
                    'Payments': 'Payments',
                    'Reviews': 'Reviews',
                    'Certificates': 'Certificates'
                };
                
                var exportType = exportTypeMap[controller] || '';
                var baseUrl = '/Admin/ReportExports/CustomExport';
                
                if (exportType) {
                    window.location.href = baseUrl + '?reportType=' + encodeURIComponent(exportType) + '&format=' + encodeURIComponent(format);
                } else {
                    window.location.href = baseUrl;
                }
            }
            
            function showExportMessage(message, type) {
                // Create toast notification
                var toast = document.createElement('div');
                toast.className = 'alert alert-' + (type === 'success' ? 'success' : 'warning') + ' position-fixed';
                toast.style.cssText = 'top: 80px; left: 50%; transform: translateX(-50%); z-index: 9999; min-width: 300px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
                toast.innerHTML = '<i class="feather-' + (type === 'success' ? 'check-circle' : 'alert-triangle') + ' me-2"></i>' + message;
                
                document.body.appendChild(toast);
                
                setTimeout(function() {
                    toast.style.opacity = '0';
                    toast.style.transition = 'opacity 0.3s';
                    setTimeout(function() {
                        toast.remove();
                    }, 300);
                }, 3000);
            }
        })();
    </script>
    
    @RenderSection("Scripts", required: false)
</body>
</html>
