@{
    ViewData["Title"] = Html.T("تصدير مخصص", "Custom export");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("لوحة التحكم", "Dashboard"), Url.Action("Index", "Dashboard")),
        (Html.T("التقارير", "Reports"), null),
        (Html.T("تصدير مخصص", "Custom export"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <div class="col-lg-8 offset-lg-2">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-download me-2"></i>@Html.T("إنشاء تصدير مخصص", "Create custom export")
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post" asp-action="CustomExport">
                        @Html.AntiForgeryToken()
                        
                        <div class="mb-4">
                            <label class="form-label">@Html.T("نوع التقرير", "Report type") <span class="text-danger">*</span></label>
                            <select name="reportType" class="form-select" required>
                                <option value="">@Html.T("اختر نوع التقرير", "Select report type")</option>
                                <option value="Users">@Html.T("المستخدمين", "Users")</option>
                                <option value="Courses">@Html.T("الدورات", "Courses")</option>
                                <option value="Enrollments">@Html.T("التسجيلات", "Enrollments")</option>
                                <option value="Payments">@Html.T("المدفوعات", "Payments")</option>
                                <option value="Reviews">@Html.T("التقييمات", "Reviews")</option>
                                <option value="Certificates">@Html.T("الشهادات", "Certificates")</option>
                                <option value="Analytics">@Html.T("التحليلات", "Analytics")</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">@Html.T("صيغة التصدير", "Export format") <span class="text-danger">*</span></label>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="format" id="formatCsv" value="csv" checked>
                                        <label class="form-check-label" for="formatCsv">
                                            <i class="feather-file-text me-2"></i>CSV
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="format" id="formatExcel" value="excel">
                                        <label class="form-check-label" for="formatExcel">
                                            <i class="feather-file me-2"></i>Excel
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="format" id="formatPdf" value="pdf">
                                        <label class="form-check-label" for="formatPdf">
                                            <i class="feather-file-text me-2"></i>PDF
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label">@Html.T("من تاريخ", "From date")</label>
                                <input type="date" name="fromDate" class="form-control" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">@Html.T("إلى تاريخ", "To date")</label>
                                <input type="date" name="toDate" class="form-control" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">@Html.T("الحقول المطلوبة", "Required fields")</label>
                            <div class="alert alert-info">
                                <small>@Html.T("سيتم تضمين جميع الحقول المتاحة للنوع المحدد", "All available fields for the selected type will be included")</small>
                            </div>
                        </div>

                        <div class="d-flex gap-2 justify-content-end">
                            <a href="@Url.Action("Index")" class="btn btn-light">
                                <i class="feather-x me-2"></i>@Html.T("إلغاء", "Cancel")
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-download me-2"></i>@Html.T("تصدير الآن", "Export now")
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="feather-info me-2"></i>@Html.T("معلومات مهمة", "Important information")
                    </h6>
                </div>
                <div class="card-body">
                    <ul class="small mb-0">
                        <li>@Html.T("سيتم معالجة التصدير في الخلفية", "Export will be processed in the background")</li>
                        <li>@Html.T("ستتلقى إشعاراً عند اكتمال التصدير", "You will be notified when the export is complete")</li>
                        <li>@Html.T("الملفات الكبيرة قد تستغرق بعض الوقت", "Large files may take some time")</li>
                        <li>@Html.T("يمكنك تحميل الملف من قائمة التصديرات", "You can download the file from the exports list")</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Set default from date to 30 days ago
        const fromDateInput = document.querySelector('input[name="fromDate"]');
        if (fromDateInput && !fromDateInput.value) {
            const date = new Date();
            date.setDate(date.getDate() - 30);
            fromDateInput.value = date.toISOString().split('T')[0];
        }
    </script>
}

