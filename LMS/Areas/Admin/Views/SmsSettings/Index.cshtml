@model LMS.Areas.Admin.ViewModels.SmsSettingViewModel
@{
    ViewData["Title"] = Html.T("إعدادات الرسائل النصية", "SMS settings");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الإعدادات", "Settings"), Url.Action("Index", "Settings")),
        (Html.T("الرسائل النصية", "SMS"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <form asp-action="Index" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="Id" />
        <div class="row">
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("مزود خدمة SMS", "SMS service provider")</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">@Html.T("المزود", "Provider")</label>
                            <select class="form-select" asp-for="Provider" id="smsProvider">
                                <option value="Twilio">Twilio</option>
                                <option value="Nexmo">Vonage (Nexmo)</option>
                                <option value="AWS">Amazon SNS</option>
                                <option value="Custom">@Html.T("مخصص", "Custom")</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">@Html.T("معرف الحساب / مفتاح API", "Account SID / API Key")</label>
                            <input type="text" class="form-control" asp-for="ApiKey" placeholder="ACxxxxxxxxxxxxxxx" />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">@Html.T("رمز المصادقة / سر API", "Auth Token / API Secret")</label>
                            <input type="password" class="form-control" asp-for="ApiSecret" />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">@Html.T("رقم المرسل", "Sender number")</label>
                            <input type="text" class="form-control" asp-for="SenderId" placeholder="+966xxxxxxxxx" />
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("إعدادات الإرسال", "Send settings")</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" asp-for="IsEnabled" id="enableSMS">
                            <label class="form-check-label" for="enableSMS">
                                تفعيل الرسائل النصية
                            </label>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" asp-for="TestMode" id="testMode">
                            <label class="form-check-label" for="testMode">
                                وضع الاختبار
                            </label>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" asp-for="EnableDeliveryReports" id="deliveryReports">
                            <label class="form-check-label" for="deliveryReports">
                                تقارير التسليم
                            </label>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">@Html.T("رقم الاختبار", "Test number")</label>
                            <input type="text" class="form-control" asp-for="TestPhoneNumber" placeholder="+966xxxxxxxxx" />
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">@Html.T("محاولات إعادة الإرسال", "Retry attempts")</label>
                                <input type="number" class="form-control" asp-for="MaxRetryAttempts" min="0" max="5" />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">@Html.T("تأخير إعادة المحاولة (ثانية)", "Retry delay (seconds)")</label>
                                <input type="number" class="form-control" asp-for="RetryDelaySeconds" min="0" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("إجراءات", "Actions")</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-save me-2"></i>
                                @Html.T("حفظ الإعدادات", "Save settings")
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("استهلاك هذا الشهر", "This month's usage")</h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <h2 class="text-primary">@(ViewBag.SmsConsumption ?? 0)</h2>
                            <p class="text-muted mb-0">@Html.T("رسالة مرسلة", "Message sent")</p>
                        </div>
                        <div class="progress mb-2">
                            <div class="progress-bar bg-success" style="width: @(ViewBag.SmsPercentage ?? 0)%"></div>
                        </div>
                        <small class="text-muted">@Html.T("من", "of") @(ViewBag.SmsLimit ?? 1000) @Html.T("رسالة", "message(s)")</small>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("اختبار الإرسال", "Test send")</h5>
                    </div>
                    <div class="card-body">
                        <form asp-action="SendTest" method="post" id="testSmsForm">
                            @Html.AntiForgeryToken()
                            <div class="mb-3">
                                <label class="form-label">@Html.T("رقم الهاتف", "Phone number")</label>
                                <input type="tel" name="phoneNumber" class="form-control" placeholder="+966xxxxxxxxx" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">@Html.T("الرسالة", "Message")</label>
                                <textarea name="message" class="form-control" rows="2" placeholder="@Html.T("رسالة الاختبار", "Test message")" required>@Html.T("هذه رسالة اختبار من منصة LMS", "This is a test message from LMS platform")</textarea>
                            </div>
                            <button type="submit" class="btn btn-outline-primary w-100">
                                <i class="feather-send me-2"></i>
                                @Html.T("إرسال رسالة اختبار", "Send test message")
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
