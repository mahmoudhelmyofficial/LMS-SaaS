@model LMS.Areas.Admin.ViewModels.SeoSettingViewModel

@{
    ViewData["Title"] = Html.T("إعدادات SEO", "SEO Settings");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("لوحة التحكم", "Dashboard"), Url.Action("Index", "Dashboard")),
        (Html.T("إعدادات المنصة", "Platform settings"), Url.Action("Index", "PlatformSettings")),
        (Html.T("إعدادات SEO", "SEO settings"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@section Styles {
    <style>
        .seo-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 1.5rem;
        }
        .google-preview {
            font-family: Arial, sans-serif;
        }
        .google-title {
            color: #1a0dab;
            font-size: 20px;
            font-weight: 400;
            line-height: 1.3;
            text-decoration: none;
        }
        .google-url {
            color: #006621;
            font-size: 14px;
            line-height: 1.3;
        }
        .google-description {
            color: #545454;
            font-size: 14px;
            line-height: 1.54;
        }
        .analytics-card {
            transition: all 0.3s ease;
        }
        .analytics-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <form asp-action="SaveSeoSetting" method="post" id="seoSettingsForm">
        <input type="hidden" asp-for="Id" />
        
        <div class="row">
            <!-- Main Settings -->
            <div class="col-lg-8">
                <!-- Basic SEO Settings -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-search me-2"></i>إعدادات SEO الأساسية
                        </h5>
                    </div>
                    <div class="card-body">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <div class="mb-4">
                            <label asp-for="SiteTitle" class="form-label">@Html.T("عنوان الموقع", "Site title")</label>
                            <input asp-for="SiteTitle" class="form-control form-control-lg" placeholder="@Html.T("منصة LMS - أفضل منصة تعليمية", "LMS Platform - Best learning platform")" id="siteTitleInput" maxlength="60" />
                            <span asp-validation-for="SiteTitle" class="text-danger"></span>
                            <small class="text-muted"><span id="titleCount">0</span>/60 @Html.T("حرف (مثالي: 50-60)", "characters (ideal: 50-60)")</small>
                        </div>

                        <div class="mb-4">
                            <label asp-for="SiteDescription" class="form-label">@Html.T("وصف الموقع", "Site description")</label>
                            <textarea asp-for="SiteDescription" class="form-control" rows="3" placeholder="@Html.T("منصة تعليمية شاملة توفر دورات احترافية في مختلف المجالات...", "A comprehensive learning platform offering professional courses...")" id="siteDescInput" maxlength="160"></textarea>
                            <span asp-validation-for="SiteDescription" class="text-danger"></span>
                            <small class="text-muted"><span id="descCount">0</span>/160 @Html.T("حرف (مثالي: 150-160)", "characters (ideal: 150-160)")</small>
                        </div>

                        <div class="mb-4">
                            <label asp-for="SiteKeywords" class="form-label">@Html.T("الكلمات المفتاحية", "Keywords")</label>
                            <input asp-for="SiteKeywords" class="form-control" placeholder="@Html.T("دورات، تعليم، أونلاين، برمجة، تطوير", "courses, education, online, programming, development")" />
                            <span asp-validation-for="SiteKeywords" class="text-danger"></span>
                            <small class="text-muted">@Html.T("افصل الكلمات بفاصلة (،)", "Separate keywords with a comma")</small>
                        </div>
                    </div>
                </div>

                <!-- Meta Tags -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-tag me-2"></i>@Html.T("Meta Tags الافتراضية", "Default Meta Tags")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <label asp-for="DefaultMetaTitle" class="form-label">@Html.T("عنوان Meta الافتراضي", "Default Meta title")</label>
                            <input asp-for="DefaultMetaTitle" class="form-control" placeholder="@Html.T("منصة LMS", "LMS Platform")" />
                            <span asp-validation-for="DefaultMetaTitle" class="text-danger"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="DefaultMetaDescription" class="form-label">@Html.T("وصف Meta الافتراضي", "Default Meta description")</label>
                            <textarea asp-for="DefaultMetaDescription" class="form-control" rows="2"></textarea>
                            <span asp-validation-for="DefaultMetaDescription" class="text-danger"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="DefaultMetaKeywords" class="form-label">@Html.T("كلمات Meta المفتاحية", "Default Meta keywords")</label>
                            <input asp-for="DefaultMetaKeywords" class="form-control" />
                            <span asp-validation-for="DefaultMetaKeywords" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <!-- Open Graph & Social Media -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-share-2 me-2"></i>Open Graph & وسائل التواصل
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <label asp-for="OgImage" class="form-label">@Html.T("صورة Open Graph", "Open Graph image")</label>
                            <input asp-for="OgImage" type="url" class="form-control" placeholder="https://example.com/og-image.jpg" />
                            <span asp-validation-for="OgImage" class="text-danger"></span>
                            <small class="text-muted">@Html.T("الحجم الموصى به: 1200x630 بكسل", "Recommended size: 1200x630 px")</small>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label asp-for="TwitterCardType" class="form-label">@Html.T("نوع بطاقة Twitter", "Twitter card type")</label>
                                <select asp-for="TwitterCardType" class="form-select">
                                    <option value="">@Html.T("-- اختر --", "-- Select --")</option>
                                    <option value="summary">@Html.T("ملخص", "Summary")</option>
                                    <option value="summary_large_image">@Html.T("ملخص بصورة كبيرة", "Summary with large image")</option>
                                    <option value="app">@Html.T("تطبيق", "App")</option>
                                    <option value="player">@Html.T("مشغل", "Player")</option>
                                </select>
                            </div>

                            <div class="col-md-6 mb-4">
                                <label asp-for="TwitterSite" class="form-label">@Html.T("حساب Twitter", "Twitter account")</label>
                                <input asp-for="TwitterSite" class="form-control" placeholder="@@LMSPlatform" />
                                <span asp-validation-for="TwitterSite" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics & Tracking -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-bar-chart-2 me-2"></i>@Html.T("التحليلات والتتبع", "Analytics & tracking")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label asp-for="GoogleAnalyticsId" class="form-label">@Html.T("معرف Google Analytics", "Google Analytics ID")</label>
                                <input asp-for="GoogleAnalyticsId" class="form-control" placeholder="@Html.T("G-XXXXXXXXXX أو UA-XXXXXXXXX", "G-XXXXXXXXXX or UA-XXXXXXXXX")" />
                                <span asp-validation-for="GoogleAnalyticsId" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-4">
                                <label asp-for="GoogleTagManagerId" class="form-label">@Html.T("معرف Google Tag Manager", "Google Tag Manager ID")</label>
                                <input asp-for="GoogleTagManagerId" class="form-control" placeholder="GTM-XXXXXX" />
                                <span asp-validation-for="GoogleTagManagerId" class="text-danger"></span>
                            </div>

                            <div class="col-md-6 mb-4">
                                <label asp-for="FacebookPixelId" class="form-label">@Html.T("معرف Facebook Pixel", "Facebook Pixel ID")</label>
                                <input asp-for="FacebookPixelId" class="form-control" placeholder="123456789012345" />
                                <span asp-validation-for="FacebookPixelId" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced SEO -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-sliders me-2"></i>إعدادات متقدمة
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <label asp-for="CanonicalBaseUrl" class="form-label">@Html.T("الرابط الأساسي (Canonical URL)", "Canonical base URL")</label>
                            <input asp-for="CanonicalBaseUrl" type="url" class="form-control" placeholder="https://www.example.com" />
                            <span asp-validation-for="CanonicalBaseUrl" class="text-danger"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="RobotsDirective" class="form-label">@Html.T("توجيهات Robots", "Robots directive")</label>
                            <input asp-for="RobotsDirective" class="form-control" placeholder="@Html.T("index, follow", "index, follow")" />
                            <span asp-validation-for="RobotsDirective" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check form-switch mb-3">
                                    <input asp-for="EnableSitemap" class="form-check-input" type="checkbox" />
                                    <label class="form-check-label">
                                        <strong>@Html.T("تفعيل Sitemap", "Enable Sitemap")</strong>
                                        <br><small class="text-muted">@Html.T("خريطة الموقع التلقائية", "Automatic sitemap")</small>
                                    </label>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-check form-switch mb-3">
                                    <input asp-for="EnableRobotsTxt" class="form-check-input" type="checkbox" />
                                    <label class="form-check-label">
                                        <strong>@Html.T("تفعيل robots.txt", "Enable robots.txt")</strong>
                                        <br><small class="text-muted">@Html.T("ملف توجيه محركات البحث", "Search engine directives file")</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Custom Scripts -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-code me-2"></i>@Html.T("سكريبتات مخصصة", "Custom scripts")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <label asp-for="CustomHeadScripts" class="form-label">@Html.T("سكريبتات Head", "Head scripts")</label>
                            <textarea asp-for="CustomHeadScripts" class="form-control" rows="4" placeholder="@Html.T("<!-- أضف سكريبتات هنا -->", "<!-- Add scripts here -->")"></textarea>
                            <span asp-validation-for="CustomHeadScripts" class="text-danger"></span>
                            <small class="text-muted">@Html.T("سيتم إضافتها في &lt;head&gt;", "Will be added in &lt;head&gt;")</small>
                        </div>

                        <div class="mb-4">
                            <label asp-for="CustomBodyScripts" class="form-label">@Html.T("سكريبتات Body", "Body scripts")</label>
                            <textarea asp-for="CustomBodyScripts" class="form-control" rows="4" placeholder="@Html.T("<!-- أضف سكريبتات هنا -->", "<!-- Add scripts here -->")"></textarea>
                            <span asp-validation-for="CustomBodyScripts" class="text-danger"></span>
                            <small class="text-muted">@Html.T("سيتم إضافتها قبل إغلاق &lt;/body&gt;", "Will be added before closing &lt;/body&gt;")</small>
                        </div>

                        <div class="alert alert-warning">
                            <i class="feather-alert-triangle me-2"></i>
                            <strong>@Html.T("تحذير:", "Warning:")</strong> @Html.T("تأكد من صحة الأكواد المضافة. الأكواد الخاطئة قد تؤثر على عمل الموقع.", "Ensure the added code is correct. Invalid code may affect the site.")
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex gap-2 justify-content-end mb-4">
                    <a asp-action="Index" class="btn btn-light">
                        <i class="feather-arrow-right me-2"></i>@Html.T("العودة", "Back")
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="feather-save me-2"></i>@Html.T("حفظ الإعدادات", "Save settings")
                    </button>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Google Preview -->
                <div class="card stretch stretch-full mb-4" style="position: sticky; top: 20px;">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-eye me-2"></i>@Html.T("معاينة Google", "Google preview")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="seo-preview google-preview">
                            <div class="google-title mb-1" id="previewTitle">@Html.T("منصة LMS - التعليم عبر الإنترنت", "LMS Platform - Online learning")</div>
                            <div class="google-url mb-2">https://www.example.com</div>
                            <div class="google-description" id="previewDesc">@Html.T("منصة تعليمية شاملة توفر دورات احترافية في مختلف المجالات التقنية والإدارية...", "A comprehensive learning platform offering professional courses...")</div>
                        </div>
                    </div>
                </div>

                <!-- SEO Score -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-award me-2"></i>@Html.T("تقييم SEO", "SEO score")
                        </h5>
                    </div>
                    <div class="card-body text-center">
                        <div class="mb-3">
                            <div class="display-4 fw-bold text-success" id="seoScore">75</div>
                            <p class="text-muted mb-0">@Html.T("من 100", "out of 100")</p>
                        </div>
                        <div class="progress mb-3" style="height: 10px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 75%" id="seoProgressBar"></div>
                        </div>
                        <div class="text-start">
                            <small class="text-success d-block mb-1">
                                <i class="feather-check-circle me-1"></i>@Html.T("عنوان الموقع مناسب", "Site title is suitable")
                            </small>
                            <small class="text-success d-block mb-1">
                                <i class="feather-check-circle me-1"></i>@Html.T("وصف الموقع مناسب", "Site description is suitable")
                            </small>
                            <small class="text-warning d-block mb-1">
                                <i class="feather-alert-circle me-1"></i>@Html.T("أضف صورة Open Graph", "Add Open Graph image")
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Tools -->
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-tool me-2"></i>@Html.T("أدوات مفيدة", "Useful tools")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="https://search.google.com/search-console" target="_blank" class="btn btn-sm btn-light">
                                <i class="feather-external-link me-2"></i>Google Search Console
                            </a>
                            <a href="https://analytics.google.com" target="_blank" class="btn btn-sm btn-light">
                                <i class="feather-external-link me-2"></i>Google Analytics
                            </a>
                            <a href="https://pagespeed.web.dev" target="_blank" class="btn btn-sm btn-light">
                                <i class="feather-external-link me-2"></i>PageSpeed Insights
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Character counter
            function updateCounter(input, counter) {
                const length = $(input).val().length;
                $(counter).text(length);
            }

            $('#siteTitleInput').on('input', function() {
                updateCounter(this, '#titleCount');
                $('#previewTitle').text($(this).val() || 'منصة LMS - التعليم عبر الإنترنت');
                updateSEOScore();
            });

            $('#siteDescInput').on('input', function() {
                updateCounter(this, '#descCount');
                $('#previewDesc').text($(this).val() || 'منصة تعليمية شاملة...');
                updateSEOScore();
            });

            // SEO Score calculation
            function updateSEOScore() {
                let score = 0;
                const titleLength = $('#siteTitleInput').val().length;
                const descLength = $('#siteDescInput').val().length;

                if (titleLength >= 50 && titleLength <= 60) score += 30;
                else if (titleLength > 0) score += 15;

                if (descLength >= 150 && descLength <= 160) score += 30;
                else if (descLength > 0) score += 15;

                if ($('input[name="GoogleAnalyticsId"]').val()) score += 10;
                if ($('input[name="OgImage"]').val()) score += 15;
                if ($('input[name="SiteKeywords"]').val()) score += 15;

                $('#seoScore').text(score);
                $('#seoProgressBar').css('width', score + '%');

                if (score >= 80) {
                    $('#seoProgressBar').removeClass('bg-warning bg-danger').addClass('bg-success');
                } else if (score >= 50) {
                    $('#seoProgressBar').removeClass('bg-success bg-danger').addClass('bg-warning');
                } else {
                    $('#seoProgressBar').removeClass('bg-success bg-warning').addClass('bg-danger');
                }
            }

            // Initialize
            updateCounter('#siteTitleInput', '#titleCount');
            updateCounter('#siteDescInput', '#descCount');
            updateSEOScore();
        });
    </script>
}

