@model LMS.Areas.Admin.ViewModels.SmsSettingViewModel

@{
    ViewData["Title"] = Html.T("تعديل إعدادات SMS", "Edit SMS settings");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("لوحة التحكم", "Dashboard"), Url.Action("Index", "Dashboard")),
        (Html.T("إعدادات المنصة", "Platform settings"), Url.Action("Index", "PlatformSettings")),
        (Html.T("إعدادات SMS", "SMS settings"), Url.Action("Index", "SmsSettings")),
        (Html.T("تعديل", "Edit"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <form asp-action="EditSmsSetting" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="Id" />
        
        <div class="row">
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("معلومات المزود", "Provider information")</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label asp-for="Provider" class="form-label">المزود <span class="text-danger">*</span></label>
                            <select asp-for="Provider" class="form-select" disabled>
                                <option value="">اختر المزود</option>
                                <option value="Twilio">Twilio</option>
                                <option value="Nexmo">Nexmo (Vonage)</option>
                                <option value="Unifonic">Unifonic</option>
                            </select>
                            <small class="text-muted">لا يمكن تغيير المزود بعد الإنشاء</small>
                            <input type="hidden" asp-for="Provider" />
                        </div>

                        <div class="mb-3">
                            <label asp-for="ApiKey" class="form-label">مفتاح API <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <input asp-for="ApiKey" type="password" class="form-control" id="apiKeyInput" />
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('apiKeyInput', this)">
                                    <i class="feather-eye"></i>
                                </button>
                            </div>
                            <span asp-validation-for="ApiKey" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="ApiSecret" class="form-label">المفتاح السري</label>
                            <div class="input-group">
                                <input asp-for="ApiSecret" type="password" class="form-control" id="apiSecretInput" />
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('apiSecretInput', this)">
                                    <i class="feather-eye"></i>
                                </button>
                            </div>
                            <span asp-validation-for="ApiSecret" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="SenderId" class="form-label">معرف المرسل</label>
                            <input asp-for="SenderId" class="form-control" maxlength="11" />
                            <span asp-validation-for="SenderId" class="text-danger"></span>
                            <small class="text-muted">الاسم الذي يظهر للمستلم (11 حرف كحد أقصى)</small>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("الإعدادات المتقدمة", "Advanced settings")</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="MaxRetryAttempts" class="form-label">محاولات إعادة الإرسال</label>
                                <input asp-for="MaxRetryAttempts" type="number" class="form-control" min="0" max="10" />
                                <small class="text-muted">في حالة فشل الإرسال (0-10)</small>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label asp-for="RetryDelaySeconds" class="form-label">التأخير بين المحاولات (ثواني)</label>
                                <input asp-for="RetryDelaySeconds" type="number" class="form-control" min="0" max="3600" />
                                <small class="text-muted">المدة بين كل محاولة</small>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-check form-switch mb-3">
                                    <input asp-for="IsEnabled" class="form-check-input" type="checkbox" />
                                    <label class="form-check-label" asp-for="IsEnabled">
                                        <strong>تفعيل الخدمة</strong>
                                    </label>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-check form-switch mb-3">
                                    <input asp-for="TestMode" class="form-check-input" type="checkbox" />
                                    <label class="form-check-label" asp-for="TestMode">
                                        <strong>وضع الاختبار</strong>
                                    </label>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-check form-switch mb-3">
                                    <input asp-for="EnableDeliveryReports" class="form-check-input" type="checkbox" />
                                    <label class="form-check-label" asp-for="EnableDeliveryReports">
                                        <strong>تقارير التسليم</strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="feather-save me-2"></i>حفظ التعديلات
                    </button>
                    <a asp-action="SmsSettings" class="btn btn-light">
                        <i class="feather-x me-2"></i>إلغاء
                    </a>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-info me-2"></i>معلومات
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="small text-muted">قم بتحديث إعدادات خدمة SMS الخاصة بك.</p>
                        
                        <div class="alert alert-warning">
                            <strong>تنبيه:</strong> تأكد من صحة البيانات قبل الحفظ لتجنب مشاكل في إرسال الرسائل.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        function togglePassword(inputId, button) {
            const input = document.getElementById(inputId);
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('feather-eye');
                icon.classList.add('feather-eye-off');
            } else {
                input.type = 'password';
                icon.classList.remove('feather-eye-off');
                icon.classList.add('feather-eye');
            }
        }
    </script>
}

