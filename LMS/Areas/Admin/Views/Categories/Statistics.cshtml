@model dynamic

@{
    ViewData["Title"] = Html.T("إحصائيات التصنيفات", "Category statistics");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("إدارة المحتوى", "Content management"), null),
        (Html.T("التصنيفات", "Categories"), Url.Action("Index", "Categories")),
        (Html.T("الإحصائيات", "Statistics"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@section Styles {
    <style>
        .stat-card {
            transition: all 0.3s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <div class="avatar-text bg-soft-primary text-primary avatar-xl mb-3 mx-auto">
                        <i class="feather-folder"></i>
                    </div>
                    <h3 class="fw-bold">@Model.TotalCategories</h3>
                    <small class="text-muted">@Html.T("إجمالي التصنيفات", "Total categories")</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <div class="avatar-text bg-soft-success text-success avatar-xl mb-3 mx-auto">
                        <i class="feather-check-circle"></i>
                    </div>
                    <h3 class="fw-bold">@Model.ActiveCategories</h3>
                    <small class="text-muted">@Html.T("تصنيفات نشطة", "Active categories")</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <div class="avatar-text bg-soft-warning text-warning avatar-xl mb-3 mx-auto">
                        <i class="feather-star"></i>
                    </div>
                    <h3 class="fw-bold">@Model.FeaturedCategories</h3>
                    <small class="text-muted">@Html.T("تصنيفات مميزة", "Featured categories")</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card stat-card">
                <div class="card-body text-center">
                    <div class="avatar-text bg-soft-danger text-danger avatar-xl mb-3 mx-auto">
                        <i class="feather-alert-circle"></i>
                    </div>
                    <h3 class="fw-bold">@Model.EmptyCategories</h3>
                    <small class="text-muted">@Html.T("تصنيفات فارغة", "Empty categories")</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-6">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-bar-chart me-2"></i>
                        أهم التصنيفات
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>@Html.T("التصنيف", "Category")</th>
                                    <th>@Html.T("الدورات", "Courses")</th>
                                    <th>@Html.T("نشط", "Active")</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var cat in Model.TopCategories)
                                {
                                    <tr>
                                        <td>
                                            <a asp-action="Details" asp-route-id="@cat.Category.Id">
                                                @cat.Category.Name
                                            </a>
                                        </td>
                                        <td>
                                            <span class="badge bg-soft-primary text-primary">
                                                @cat.CourseCount دورة
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge bg-soft-success text-success">
                                                @cat.ActiveCourseCount نشط
                                            </span>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-pie-chart me-2"></i>
                        التوزيع
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-4">
                        <div class="d-flex justify-content-between mb-2">
                            <span>تصنيفات رئيسية</span>
                            <span class="fw-bold">@Model.ParentCategories</span>
                        </div>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-primary" style="width: @(((double)Model.ParentCategories / Model.TotalCategories) * 100)%">
                                @(((double)Model.ParentCategories / Model.TotalCategories) * 100).ToString("N0")%
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="d-flex justify-content-between mb-2">
                            <span>تصنيفات فرعية</span>
                            <span class="fw-bold">@Model.SubCategories</span>
                        </div>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-success" style="width: @(((double)Model.SubCategories / Model.TotalCategories) * 100)%">
                                @(((double)Model.SubCategories / Model.TotalCategories) * 100).ToString("N0")%
                            </div>
                        </div>
                    </div>

                    <div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>تصنيفات بدورات</span>
                            <span class="fw-bold">@Model.CategoriesWithCourses</span>
                        </div>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-warning" style="width: @(((double)Model.CategoriesWithCourses / Model.TotalCategories) * 100)%">
                                @(((double)Model.CategoriesWithCourses / Model.TotalCategories) * 100).ToString("N0")%
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Move Courses Tool -->
    <div class="row mt-4">
        <div class="col-lg-12">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-move me-2"></i>
                        نقل الدورات بين التصنيفات
                    </h5>
                </div>
                <div class="card-body">
                    <form asp-action="MoveCourses" method="post" onsubmit="return confirm('@Html.Raw(Html.T("هل أنت متأكد من نقل جميع الدورات؟ سيتم نقل جميع الدورات من التصنيف المصدر إلى التصنيف الهدف.", "Are you sure you want to move all courses? All courses will be moved from source to target category.").Replace("'", "\\'"))');">
                        @Html.AntiForgeryToken()
                        <div class="row g-3">
                            <div class="col-md-5">
                                <label class="form-label">@Html.T("من التصنيف (المصدر)", "From category (source)")</label>
                                <select name="fromCategoryId" class="form-select" required>
                                    <option value="">-- @Html.T("اختر التصنيف المصدر", "Select source category") --</option>
                                    @foreach (var cat in Model.TopCategories)
                                    {
                                        <option value="@cat.Category.Id">@cat.Category.Name (@cat.CourseCount دورة)</option>
                                    }
                                </select>
                                <small class="text-muted">@Html.T("التصنيف الذي سيتم نقل الدورات منه", "Category to move courses from")</small>
                            </div>
                            <div class="col-md-2 d-flex align-items-center justify-content-center">
                                <div class="avatar-text bg-soft-primary text-primary avatar-lg">
                                    <i class="feather-arrow-right"></i>
                                </div>
                            </div>
                            <div class="col-md-5">
                                <label class="form-label">@Html.T("إلى التصنيف (الهدف)", "To category (target)")</label>
                                <select name="toCategoryId" class="form-select" required>
                                    <option value="">-- @Html.T("اختر التصنيف الهدف", "Select target category") --</option>
                                    @foreach (var cat in Model.TopCategories)
                                    {
                                        <option value="@cat.Category.Id">@cat.Category.Name</option>
                                    }
                                </select>
                                <small class="text-muted">@Html.T("التصنيف الذي سيتم نقل الدورات إليه", "Category to move courses to")</small>
                            </div>
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary">
                                    <i class="feather-move me-2"></i>
                                    نقل الدورات
                                </button>
                                <button type="reset" class="btn btn-light">
                                    <i class="feather-x me-2"></i>
                                    إلغاء
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

