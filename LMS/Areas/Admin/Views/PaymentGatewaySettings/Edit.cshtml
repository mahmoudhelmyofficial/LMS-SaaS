@model LMS.Areas.Admin.ViewModels.PaymentGatewaySettingEditViewModel

@{
    ViewData["Title"] = Html.T("تعديل بوابة الدفع", "Edit payment gateway");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الإعدادات", "Settings"), null),
        (Html.T("بوابات الدفع", "Payment Gateways"), Url.Action("Index", "PaymentGatewaySettings")),
        (Html.T("تعديل", "Edit"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@await Html.PartialAsync("_PageHeader")

<!-- Main Content -->
<div class="main-content">
    <div class="row">
        <div class="col-lg-12">
            <form asp-action="Edit" method="post" class="needs-validation" novalidate>
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="Id" />
                
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("المعلومات الأساسية", "Basic Information")</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label asp-for="GatewayName" class="form-label required">@Html.T("اسم البوابة (بالإنجليزية)", "Gateway Name (in English)")</label>
                                <input asp-for="GatewayName" class="form-control" required />
                                <span asp-validation-for="GatewayName" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="GatewayType" class="form-label required">@Html.T("نوع البوابة", "Gateway Type")</label>
                                <select asp-for="GatewayType" class="form-select" required>
                                    <option value="">@Html.T("-- اختر النوع --", "-- Select Type --")</option>
                                    <option value="Stripe">Stripe</option>
                                    <option value="PayPal">PayPal</option>
                                    <option value="Razorpay">Razorpay</option>
                                    <option value="Paystack">Paystack</option>
                                    <option value="Flutterwave">Flutterwave</option>
                                    <option value="Paymob">Paymob</option>
                                    <option value="HyperPay">HyperPay</option>
                                    <option value="Moyasar">Moyasar</option>
                                    <option value="Checkout">Checkout.com</option>
                                    <option value="Other">@Html.T("أخرى", "Other")</option>
                                </select>
                                <span asp-validation-for="GatewayType" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="DisplayName" class="form-label required">@Html.T("الاسم المعروض", "Display Name")</label>
                                <input asp-for="DisplayName" class="form-control" required />
                                <span asp-validation-for="DisplayName" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="DisplayOrder" class="form-label">@Html.T("ترتيب العرض", "Display Order")</label>
                                <input asp-for="DisplayOrder" type="number" class="form-control" />
                                <span asp-validation-for="DisplayOrder" class="text-danger"></span>
                            </div>

                            <div class="col-12">
                                <label asp-for="Description" class="form-label">@Html.T("الوصف", "Description")</label>
                                <textarea asp-for="Description" class="form-control" rows="2"></textarea>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card stretch stretch-full mb-4">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <h5 class="card-title mb-0">@Html.T("مفاتيح الإنتاج (Production)", "Production Keys")</h5>
                        <span class="badge bg-soft-success text-success">@Html.T("مباشر", "Live")</span>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label asp-for="ApiKey" class="form-label required">@Html.T("مفتاح API", "API Key")</label>
                                <input asp-for="ApiKey" class="form-control font-monospace" required />
                                <span asp-validation-for="ApiKey" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="SecretKey" class="form-label required">@Html.T("المفتاح السري", "Secret Key")</label>
                                <input asp-for="SecretKey" type="password" class="form-control font-monospace" required />
                                <span asp-validation-for="SecretKey" class="text-danger"></span>
                                <small class="text-muted">@Html.T("اترك فارغاً إذا كنت لا تريد تغييره", "Leave blank if you don't want to change it")</small>
                            </div>

                            <div class="col-12">
                                <label asp-for="WebhookSecret" class="form-label">@Html.T("Webhook Secret", "Webhook Secret")</label>
                                <input asp-for="WebhookSecret" type="password" class="form-control font-monospace" />
                                <span asp-validation-for="WebhookSecret" class="text-danger"></span>
                                <small class="text-muted">@Html.T("اترك فارغاً إذا كنت لا تريد تغييره", "Leave blank if you don't want to change it")</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card stretch stretch-full mb-4">
                    <div class="card-header d-flex align-items-center justify-content-between">
                        <h5 class="card-title mb-0">@Html.T("مفاتيح الاختبار (Test Mode)", "Test Keys (Test Mode)")</h5>
                        <span class="badge bg-soft-warning text-warning">@Html.T("تجريبي", "Test")</span>
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch mb-3">
                            <input asp-for="IsTestMode" class="form-check-input" type="checkbox" id="testModeSwitch" />
                            <label class="form-check-label" for="testModeSwitch">
                                @Html.T("تفعيل وضع الاختبار (Test Mode)", "Enable Test Mode")
                            </label>
                        </div>

                        <div class="row g-3" id="testKeysSection">
                            <div class="col-md-6">
                                <label asp-for="TestApiKey" class="form-label">@Html.T("مفتاح API الاختبار", "Test API Key")</label>
                                <input asp-for="TestApiKey" class="form-control font-monospace" />
                                <span asp-validation-for="TestApiKey" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="TestSecretKey" class="form-label">@Html.T("المفتاح السري للاختبار", "Test Secret Key")</label>
                                <input asp-for="TestSecretKey" type="password" class="form-control font-monospace" />
                                <span asp-validation-for="TestSecretKey" class="text-danger"></span>
                                <small class="text-muted">@Html.T("اترك فارغاً إذا كنت لا تريد تغييره", "Leave blank if you don't want to change it")</small>
                            </div>

                            <div class="col-12">
                                <div class="alert alert-warning">
                                    <i class="feather-alert-triangle me-2"></i>
                                    <strong>@Html.T("تحذير:", "Warning:")</strong> @Html.T("لا تنسى تعطيل وضع الاختبار عند الانتقال للإنتاج!", "Don't forget to disable test mode when going to production!")
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("الحدود والرسوم", "Limits & Fees")</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label asp-for="MinimumAmount" class="form-label">@Html.T("الحد الأدنى", "Minimum Amount")</label>
                                <div class="input-group">
                                    <input asp-for="MinimumAmount" type="number" step="0.01" class="form-control" />
                                    <span class="input-group-text">@Html.T("ر.س", "SAR")</span>
                                </div>
                                <span asp-validation-for="MinimumAmount" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="MaximumAmount" class="form-label">@Html.T("الحد الأقصى", "Maximum Amount")</label>
                                <div class="input-group">
                                    <input asp-for="MaximumAmount" type="number" step="0.01" class="form-control" />
                                    <span class="input-group-text">@Html.T("ر.س", "SAR")</span>
                                </div>
                                <span asp-validation-for="MaximumAmount" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="TransactionFeePercentage" class="form-label">@Html.T("رسوم النسبة المئوية", "Percentage Fee")</label>
                                <div class="input-group">
                                    <input asp-for="TransactionFeePercentage" type="number" step="0.01" class="form-control" />
                                    <span class="input-group-text">%</span>
                                </div>
                                <span asp-validation-for="TransactionFeePercentage" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label asp-for="TransactionFeeFixed" class="form-label">@Html.T("رسوم ثابتة", "Fixed Fee")</label>
                                <div class="input-group">
                                    <input asp-for="TransactionFeeFixed" type="number" step="0.01" class="form-control" />
                                    <span class="input-group-text">@Html.T("ر.س", "SAR")</span>
                                </div>
                                <span asp-validation-for="TransactionFeeFixed" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("الإعدادات المتقدمة", "Advanced Settings")</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-12">
                                <label asp-for="SupportedCurrencies" class="form-label">@Html.T("العملات المدعومة", "Supported Currencies")</label>
                                <input asp-for="SupportedCurrencies" class="form-control" />
                                <span asp-validation-for="SupportedCurrencies" class="text-danger"></span>
                                <small class="text-muted">@Html.T("أدخل رموز العملات مفصولة بفاصلة", "Enter currency codes separated by comma")</small>
                            </div>

                            <div class="col-12">
                                <label asp-for="ConfigurationJson" class="form-label">@Html.T("إعدادات إضافية (JSON)", "Additional Settings (JSON)")</label>
                                <textarea asp-for="ConfigurationJson" class="form-control font-monospace" rows="4"></textarea>
                                <span asp-validation-for="ConfigurationJson" class="text-danger"></span>
                            </div>

                            <div class="col-12">
                                <div class="form-check form-switch">
                                    <input asp-for="IsEnabled" class="form-check-input" type="checkbox" id="isEnabledSwitch" />
                                    <label class="form-check-label" for="isEnabledSwitch">
                                        @Html.T("تفعيل بوابة الدفع", "Enable payment gateway")
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card stretch stretch-full">
                    <div class="card-body">
                        <div class="d-flex gap-2 justify-content-end">
                            <a href="@Url.Action("Index", "PaymentGatewaySettings")" class="btn btn-light">
                                <i class="feather-x me-2"></i>
                                @Html.T("إلغاء", "Cancel")
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-save me-2"></i>
                                @Html.T("حفظ التغييرات", "Save Changes")
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        // Toggle test keys section visibility
        $('#testModeSwitch').on('change', function() {
            if ($(this).is(':checked')) {
                $('#testKeysSection').slideDown();
            } else {
                $('#testKeysSection').slideUp();
            }
        }).trigger('change');

        // Form validation
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        if (!form.checkValidity()) {
                            event.preventDefault()
                            event.stopPropagation()
                        }
                        form.classList.add('was-validated')
                    }, false)
                })
        })()
    </script>
}

