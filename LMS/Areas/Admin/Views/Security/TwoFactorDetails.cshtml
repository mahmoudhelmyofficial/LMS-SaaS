@model LMS.Domain.Entities.Security.TwoFactorSetting

@{
    ViewData["Title"] = Html.T("تفاصيل المصادقة الثنائية", "Two-factor details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("لوحة التحكم", "Dashboard"), Url.Action("Index", "Dashboard")),
        (Html.T("الأمان", "Security"), Url.Action("Dashboard", "Security")),
        (Html.T("المصادقة الثنائية", "Two-factor authentication"), Url.Action("TwoFactorSettings", "Security")),
        (Html.T("التفاصيل", "Details"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <div class="col-lg-8">
            <!-- Status Overview -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-body text-center py-5">
                    @if (Model.IsEnabled)
                    {
                        <div class="avatar-text avatar-xl bg-soft-success text-success mx-auto mb-3">
                            <i class="feather-shield" style="font-size: 3rem;"></i>
                        </div>
                        <h3 class="fw-bold text-success mb-2">المصادقة الثنائية مفعلة</h3>
                        <p class="text-muted">تم تفعيل المصادقة الثنائية لهذا الحساب</p>
                    }
                    else
                    {
                        <div class="avatar-text avatar-xl bg-soft-warning text-warning mx-auto mb-3">
                            <i class="feather-shield-off" style="font-size: 3rem;"></i>
                        </div>
                        <h3 class="fw-bold text-warning mb-2">@Html.T("المصادقة الثنائية معطلة", "Two-factor authentication is disabled")</h3>
                        <p class="text-muted">@Html.T("تم تعطيل المصادقة الثنائية", "Two-factor authentication has been disabled")</p>
                    }
                </div>
            </div>

            <!-- Details -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-info me-2"></i>@Html.T("معلومات المصادقة", "Authentication info")
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-borderless">
                            <tbody>
                                <tr>
                                    <td class="text-muted" style="width: 200px;">
                                        <i class="feather-smartphone me-2"></i>@Html.T("طريقة المصادقة", "Authentication method")
                                    </td>
                                    <td class="fw-semibold">
                                        <span class="badge bg-primary">@Model.Method</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="text-muted">
                                        <i class="feather-calendar me-2"></i>@Html.T("تاريخ التفعيل", "Activation date")
                                    </td>
                                    <td class="fw-semibold">@Model.CreatedAt.ToString("yyyy/MM/dd hh:mm tt")</td>
                                </tr>
                                <tr>
                                    <td class="text-muted">
                                        <i class="feather-clock me-2"></i>@Html.T("آخر استخدام", "Last used")
                                    </td>
                                    <td class="fw-semibold">
                                        @if (Model.LastUsedAt.HasValue)
                                        {
                                            @Model.LastUsedAt.Value.ToString("yyyy/MM/dd hh:mm tt")
                                        }
                                        else
                                        {
                                            <span class="text-muted">@Html.T("لم يستخدم بعد", "Not used yet")</span>
                                        }
                                    </td>
                                </tr>
                                @if (!Model.IsEnabled && Model.DisabledAt.HasValue)
                                {
                                    <tr>
                                        <td class="text-muted">
                                            <i class="feather-x-circle me-2"></i>@Html.T("تاريخ التعطيل", "Disabled date")
                                        </td>
                                        <td class="fw-semibold">@Model.DisabledAt.Value.ToString("yyyy/MM/dd hh:mm tt")</td>
                                    </tr>
                                }
                                <tr>
                                    <td class="text-muted">
                                        <i class="feather-activity me-2"></i>@Html.T("الحالة", "Status")
                                    </td>
                                    <td>
                                        @if (Model.IsEnabled)
                                        {
                                            <span class="badge bg-success">@Html.T("مفعلة", "Enabled")</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">@Html.T("معطلة", "Disabled")</span>
                                        }
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Backup Codes -->
            @if (!string.IsNullOrEmpty(Model.BackupCodes))
            {
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-key me-2"></i>@Html.T("رموز النسخ الاحتياطي", "Backup codes")
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-warning">
                            <i class="feather-alert-triangle me-2"></i>
                            @Html.T("هذه الرموز حساسة ويجب الحفاظ على سريتها", "These codes are sensitive and must be kept confidential")
                        </div>
                        <pre class="bg-light p-3 rounded">@Model.BackupCodes</pre>
                    </div>
                </div>
            }
        </div>

        <div class="col-lg-4">
            <!-- Actions -->
            <div class="card stretch stretch-full mb-4" style="position: sticky; top: 20px;">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-settings me-2"></i>@Html.T("إجراءات", "Actions")
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a asp-action="TwoFactorSettings" class="btn btn-light">
                            <i class="feather-arrow-right me-2"></i>@Html.T("العودة للقائمة", "Back to list")
                        </a>
                        @if (Model.User != null)
                        {
                            <a asp-controller="Users" asp-action="Details" asp-route-id="@Model.UserId" class="btn btn-outline-primary">
                                <i class="feather-user me-2"></i>@Html.T("عرض المستخدم", "View user")
                            </a>
                        }
                        @if (Model.IsEnabled)
                        {
                            <form asp-action="DisableTwoFactor" asp-route-id="@Model.Id" method="post" onsubmit="return confirm('@(Html.Raw(Html.T("هل أنت متأكد من تعطيل المصادقة الثنائية؟", "Are you sure you want to disable two-factor authentication?").ToString().Replace("'", "\\'")))')">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-danger">
                                    <i class="feather-x-circle me-2"></i>@Html.T("تعطيل المصادقة", "Disable authentication")
                                </button>
                            </form>
                        }
                    </div>
                </div>
            </div>

            <!-- User Info -->
            @if (Model.User != null)
            {
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-user me-2"></i>المستخدم
                        </h5>
                    </div>
                    <div class="card-body text-center">
                        <div class="avatar-text avatar-xl bg-soft-primary text-primary mx-auto mb-3">
                            <span class="fs-4">@(Model.User.FirstName?.Length > 0 ? Model.User.FirstName.Substring(0, 1).ToUpper() : "")@(Model.User.LastName?.Length > 0 ? Model.User.LastName.Substring(0, 1).ToUpper() : "")</span>
                        </div>
                        <h6 class="fw-bold mb-1">@(Model.User.FirstName ?? "") @(Model.User.LastName ?? "")</h6>
                        <p class="text-muted small mb-3">@Model.User.Email</p>
                        <a asp-controller="Users" asp-action="Details" asp-route-id="@Model.UserId" class="btn btn-sm btn-primary">
                            عرض الملف الشخصي
                        </a>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

