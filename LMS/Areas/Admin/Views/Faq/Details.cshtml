@model LMS.Domain.Entities.Courses.Faq

@{
    ViewData["Title"] = Html.T("تفاصيل السؤال", "Question details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الدعم", "Support"), null),
        (Html.T("الأسئلة الشائعة", "FAQ"), Url.Action("Index", "Faq")),
        (Html.T("تفاصيل السؤال", "Question details"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        (Html.T("تعديل", "Edit"), "feather-edit", Url.Action("Edit", "Faq", new { id = Model.Id }), "btn-primary"),
        (Html.T("حذف", "Delete"), "feather-trash-2", "javascript:void(0)", "btn-danger delete-btn")
    };
    ViewData["HeaderActions"] = actions;
}

@section Styles {
    <style>
        .faq-question {
            background: var(--gradient-hero, linear-gradient(135deg, #004aad 0%, #0055c4 50%, #1a5cb9 100%));
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .faq-answer {
            background: #f9fafb;
            padding: 25px;
            border-radius: 12px;
            border-right: 4px solid #3b82f6;
            font-size: 1.05rem;
            line-height: 1.8;
        }
        .info-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .tag-item {
            display: inline-block;
            padding: 6px 14px;
            background: #e5e7eb;
            border-radius: 20px;
            margin: 4px;
            font-size: 0.875rem;
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <!-- Question Card -->
    <div class="faq-question">
        <div class="d-flex align-items-start justify-content-between mb-3">
            <h2 class="fw-bold text-white mb-0">
                <i class="feather-help-circle me-2"></i>
                السؤال
            </h2>
            @if (Model.IsPublished)
            {
                <span class="badge bg-white text-primary">
                    <i class="feather-eye me-1"></i>
                    منشور
                </span>
            }
            else
            {
                <span class="badge bg-white text-secondary">
                    <i class="feather-eye-off me-1"></i>
                    غير منشور
                </span>
            }
        </div>
        <h3 class="text-white mb-0">@Model.Question</h3>
    </div>

    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Answer Card -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-message-square me-2"></i>
                        الإجابة
                    </h5>
                </div>
                <div class="card-body">
                    <div class="faq-answer">
                        @Html.Raw(Model.Answer)
                    </div>
                </div>
            </div>

            <!-- Category & Tags -->
            @if (!string.IsNullOrEmpty(Model.Category) || !string.IsNullOrEmpty(Model.Tags))
            {
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-tag me-2"></i>
                            التصنيف والوسوم
                        </h5>
                    </div>
                    <div class="card-body">
                        @if (!string.IsNullOrEmpty(Model.Category))
                        {
                            <div class="mb-3">
                                <label class="form-label text-muted fw-semibold">@Html.T("الفئة:", "Category:")</label>
                                <div>
                                    <span class="info-badge bg-soft-primary text-primary">
                                        <i class="feather-folder me-1"></i>
                                        @Model.Category
                                    </span>
                                </div>
                            </div>
                        }
                        
                        @if (!string.IsNullOrEmpty(Model.Tags))
                        {
                            <div>
                                <label class="form-label text-muted fw-semibold">@Html.T("الوسوم:", "Tags:")</label>
                                <div>
                                    @foreach (var tag in Model.Tags.Split(',', StringSplitOptions.RemoveEmptyEntries))
                                    {
                                        <span class="tag-item">
                                            <i class="feather-hash"></i>
                                            @tag.Trim()
                                        </span>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            <!-- Related Course & Lesson -->
            @if (Model.Course != null || Model.Lesson != null)
            {
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-link me-2"></i>
                            المرتبط بـ
                        </h5>
                    </div>
                    <div class="card-body">
                        @if (Model.Course != null)
                        {
                            <div class="d-flex align-items-center gap-3 p-3 border rounded mb-3">
                                <div class="avatar-text bg-soft-primary text-primary avatar-lg">
                                    <i class="feather-book"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <small class="text-muted d-block">الدورة</small>
                                    <h6 class="fw-bold mb-0">@Model.Course.Title</h6>
                                </div>
                                <a asp-area="Admin" asp-controller="Courses" asp-action="Details" asp-route-id="@Model.Course.Id" class="btn btn-sm btn-light">
                                    <i class="feather-external-link"></i>
                                </a>
                            </div>
                        }
                        
                        @if (Model.Lesson != null)
                        {
                            <div class="d-flex align-items-center gap-3 p-3 border rounded">
                                <div class="avatar-text bg-soft-info text-info avatar-lg">
                                    <i class="feather-file-text"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <small class="text-muted d-block">الدرس</small>
                                    <h6 class="fw-bold mb-0">@Model.Lesson.Title</h6>
                                </div>
                                <a asp-area="Admin" asp-controller="Lessons" asp-action="Details" asp-route-id="@Model.Lesson.Id" class="btn btn-sm btn-light">
                                    <i class="feather-external-link"></i>
                                </a>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Status Card -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-info me-2"></i>
                        معلومات السؤال
                    </h5>
                </div>
                <div class="card-body">
                    <div class="vstack gap-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted">الحالة:</span>
                            @if (Model.IsPublished)
                            {
                                <span class="badge bg-soft-success text-success">منشور</span>
                            }
                            else
                            {
                                <span class="badge bg-soft-secondary text-secondary">غير منشور</span>
                            }
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted">ترتيب العرض:</span>
                            <span class="fw-semibold">#@Model.DisplayOrder</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted">تاريخ الإنشاء:</span>
                            <span class="fw-semibold">@Model.CreatedAt.ToString("dd/MM/yyyy")</span>
                        </div>
                        @if (Model.UpdatedAt.HasValue)
                        {
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="text-muted">آخر تحديث:</span>
                                <span class="fw-semibold">@Model.UpdatedAt.Value.ToString("dd/MM/yyyy")</span>
                            </div>
                        }
                        @if (Model.Author != null)
                        {
                            <hr class="my-2">
                            <div class="d-flex align-items-center gap-2">
                                <div class="avatar-text bg-soft-primary text-primary avatar-md">
                                    <i class="feather-user"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block">الكاتب</small>
                                    <span class="fw-semibold">@Model.Author.FirstName @Model.Author.LastName</span>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-zap me-2"></i>
                        @Html.T("إجراءات سريعة", "Quick actions")
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-light-brand">
                            <i class="feather-edit me-2"></i>
                            تعديل السؤال
                        </a>
                        <form asp-action="TogglePublish" asp-route-id="@Model.Id" method="post" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-light-brand w-100">
                                @if (Model.IsPublished)
                                {
                                    <i class="feather-eye-off me-2"></i>
                                    <span>إخفاء</span>
                                }
                                else
                                {
                                    <i class="feather-eye me-2"></i>
                                    <span>نشر</span>
                                }
                            </button>
                        </form>
                        <button type="button" class="btn btn-light-brand" onclick="duplicateFaq()">
                            <i class="feather-copy me-2"></i>
                            نسخ السؤال
                        </button>
                        <button type="button" class="btn btn-light-brand" onclick="window.print()">
                            <i class="feather-printer me-2"></i>
                            طباعة
                        </button>
                        <hr>
                        <button type="button" class="btn btn-danger delete-btn">
                            <i class="feather-trash-2 me-2"></i>
                            حذف السؤال
                        </button>
                    </div>
                </div>
            </div>

            <!-- Statistics Card -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-trending-up me-2"></i>
                        إحصائيات
                    </h5>
                </div>
                <div class="card-body">
                    <div class="vstack gap-3">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">المشاهدات:</span>
                            <span class="fw-bold text-primary">0</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">مفيدة:</span>
                            <span class="fw-bold text-success">0</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">غير مفيدة:</span>
                            <span class="fw-bold text-danger">0</span>
                        </div>
                    </div>
                    <div class="alert alert-light mt-3 mb-0">
                        <i class="feather-info me-2"></i>
                        <small>الإحصائيات قيد التطوير</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<form asp-action="Delete" asp-route-id="@Model.Id" method="post" id="deleteForm">
    @Html.AntiForgeryToken()
</form>

@section Scripts {
    <script>
        window.__FaqT = {
            confirmDelete: '@Html.Raw(Html.T("هل أنت متأكد من حذف هذا السؤال؟", "Are you sure you want to delete this question?").Replace("'", "\\'"))',
            copyInDevelopment: '@Html.Raw(Html.T("ميزة النسخ قيد التطوير", "Copy feature is under development").Replace("'", "\\'"))'
        };
        $(document).ready(function() {
            $('.delete-btn').click(function() {
                if (confirm(window.__FaqT.confirmDelete)) {
                    $('#deleteForm').submit();
                }
            });
        });

        function duplicateFaq() {
            alert(window.__FaqT.copyInDevelopment);
        }
    </script>
}

