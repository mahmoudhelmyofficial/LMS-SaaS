@model LMS.Domain.Entities.Notifications.EmailQueue

@{
    ViewData["Title"] = Html.T("تفاصيل رسالة البريد", "Email message details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الاتصالات", "Communications"), null),
        (Html.T("قائمة البريد", "Email queue"), Url.Action("Index", "EmailQueue")),
        (Html.T("التفاصيل", "Details"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <div class="col-lg-12 mb-4">
            <div class="card">
                <div class="card-body text-center py-4">
                    <div class="avatar-text avatar-xxl rounded bg-soft-primary text-primary mb-3 mx-auto">
                        <i class="feather-mail" style="font-size: 2.5rem;"></i>
                    </div>
                    <h4 class="mb-2">@Model.Subject</h4>
                    @switch (Model.Status)
                    {
                        case "Sent":
                            <span class="badge bg-soft-success text-success fs-6 px-3 py-2">تم الإرسال</span>
                            break;
                        case "Failed":
                            <span class="badge bg-soft-danger text-danger fs-6 px-3 py-2">فاشل</span>
                            break;
                        case "Pending":
                            <span class="badge bg-soft-warning text-warning fs-6 px-3 py-2">معلق</span>
                            break;
                    }
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header"><h5 class="card-title">@Html.T("معلومات الرسالة", "Message information")</h5></div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("المستلم", "Recipient")</label>
                        <p class="fw-semibold">@Model.ToName &lt;@Model.ToEmail&gt;</p>
                    </div>
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("المرسل", "Sender")</label>
                        <p>@Model.FromName &lt;@Model.FromEmail&gt;</p>
                    </div>
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("الموضوع", "Subject")</label>
                        <p class="fw-semibold">@Model.Subject</p>
                    </div>
                    <div class="mb-0">
                        <label class="text-muted">@Html.T("الأولوية", "Priority")</label>
                        <p><span class="badge @(Model.Priority > 5 ? "bg-danger" : Model.Priority > 3 ? "bg-warning" : "bg-secondary")">@Model.Priority</span></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header"><h5 class="card-title">@Html.T("حالة الإرسال", "Send status")</h5></div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("الحالة", "Status")</label>
                        <p><span class="badge bg-soft-primary text-primary">@Model.Status</span></p>
                    </div>
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("عدد المحاولات", "Attempts")</label>
                        <p>@Model.Attempts / @Model.MaxAttempts</p>
                    </div>
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("تاريخ الإنشاء", "Created")</label>
                        <p>@Model.CreatedAt.ToString("dd/MM/yyyy hh:mm tt")</p>
                    </div>
                    @if (Model.SentAt.HasValue)
                    {
                        <div class="mb-0">
                            <label class="text-muted">@Html.T("تاريخ الإرسال", "Sent at")</label>
                            <p>@Model.SentAt.Value.ToString("dd/MM/yyyy hh:mm tt")</p>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                    {
                        <div class="mb-0">
                            <label class="text-muted">@Html.T("رسالة الخطأ", "Error message")</label>
                            <div class="alert alert-danger">@Model.ErrorMessage</div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-lg-12 mb-4">
            <div class="card">
                <div class="card-header"><h5 class="card-title">@Html.T("محتوى الرسالة", "Message content")</h5></div>
                <div class="card-body">
                    <iframe srcdoc="@Html.Raw(Model.Body)" style="width: 100%; min-height: 400px; border: 1px solid #e5e7eb; border-radius: 8px;"></iframe>
                </div>
            </div>
        </div>

        @if (Model.Status == "Failed")
        {
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <form method="post" asp-action="Retry" asp-route-id="@Model.Id">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-refresh-cw me-2"></i>إعادة المحاولة
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

