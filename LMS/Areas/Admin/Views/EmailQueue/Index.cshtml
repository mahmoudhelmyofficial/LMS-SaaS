@model LMS.Areas.Admin.ViewModels.EmailQueueStatsViewModel

@{
    ViewData["Title"] = Html.T("قائمة انتظار البريد الإلكتروني", "Email queue");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الاتصالات", "Communications"), null),
        (Html.T("قائمة البريد", "Email Queue"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    ViewData["ShowStats"] = true;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        (Html.T("عرض القائمة", "View List"), "feather-list", Url.Action("List", "EmailQueue"), "btn-primary")
    };
    ViewData["HeaderActions"] = actions;
}

@await Html.PartialAsync("_PageHeader")

@section StatsCards {
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <div class="d-flex align-items-center gap-3">
                    <div class="avatar-text avatar-xl rounded bg-soft-primary text-primary">
                        <i class="feather-mail"></i>
                    </div>
                    <div>
                        <span class="text-truncate-1-line">إجمالي الرسائل</span>
                        <h3 class="fw-bolder">@Model.TotalEmails.ToString("N0")</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <div class="d-flex align-items-center gap-3">
                    <div class="avatar-text avatar-xl rounded bg-soft-warning text-warning">
                        <i class="feather-clock"></i>
                    </div>
                    <div>
                        <span class="text-truncate-1-line">في الانتظار</span>
                        <h3 class="fw-bolder">@Model.PendingEmails.ToString("N0")</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <div class="d-flex align-items-center gap-3">
                    <div class="avatar-text avatar-xl rounded bg-soft-success text-success">
                        <i class="feather-check-circle"></i>
                    </div>
                    <div>
                        <span class="text-truncate-1-line">تم الإرسال</span>
                        <h3 class="fw-bolder">@Model.SentEmails.ToString("N0")</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <div class="d-flex align-items-center gap-3">
                    <div class="avatar-text avatar-xl rounded bg-soft-danger text-danger">
                        <i class="feather-x-circle"></i>
                    </div>
                    <div>
                        <span class="text-truncate-1-line">فاشلة</span>
                        <h3 class="fw-bolder">@Model.FailedEmails.ToString("N0")</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<div class="main-content">
    <div class="row">
        <div class="col-lg-8 mb-4">
            <div class="card">
                <div class="card-header"><h5 class="card-title">@Html.T("نظرة عامة", "Overview")</h5></div>
                <div class="card-body">
                    <canvas id="emailChart" style="height: 300px;"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4 mb-4">
            <div class="card">
                <div class="card-header"><h5 class="card-title">@Html.T("الإجراءات السريعة", "Quick Actions")</h5></div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="@Url.Action("List", "EmailQueue", new { status = "Pending" })" class="btn btn-outline-warning">
                            <i class="feather-clock me-2"></i>@Html.T("عرض المعلقة", "View Pending")
                        </a>
                        <a href="@Url.Action("List", "EmailQueue", new { status = "Failed" })" class="btn btn-outline-danger">
                            <i class="feather-alert-circle me-2"></i>@Html.T("عرض الفاشلة", "View Failed")
                        </a>
                        <form method="post" asp-action="ProcessQueue" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-outline-success w-100">
                                <i class="feather-send me-2"></i>معالجة القائمة
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('emailChart');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['في الانتظار', 'تم الإرسال', 'فاشلة'],
                datasets: [{
                    data: [@Model.PendingEmails, @Model.SentEmails, @Model.FailedEmails],
                    backgroundColor: ['#ffa726', '#66bb6a', '#ef5350']
                }]
            }
        });
    </script>
}

