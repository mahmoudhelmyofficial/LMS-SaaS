@model List<LMS.Areas.Admin.ViewModels.EmailQueueListViewModel>

@{
    ViewData["Title"] = Html.T("رسائل البريد المعلقة", "Pending email messages");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الاتصالات", "Communications"), null),
        (Html.T("قائمة البريد", "Email queue"), Url.Action("Index", "EmailQueue")),
        (Html.T("الرسائل المعلقة", "Pending messages"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        ("الرجوع للقائمة", "feather-arrow-right", Url.Action("Index", "EmailQueue"), "btn-light")
    };
    ViewData["HeaderActions"] = actions;
    var page = (int?)ViewBag.Page ?? 1;
    var totalCount = (int?)ViewBag.TotalCount ?? 0;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0">الرسائل المعلقة (@totalCount.ToString("N0"))</h5>
        </div>
        <div class="card-body">
            @if (!Model.Any())
            {
                <div class="text-center py-5">
                    <i class="feather-inbox text-muted" style="font-size: 3rem;"></i>
                    <p class="mt-3">@Html.T("لا توجد رسائل معلقة", "No pending messages")</p>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>@Html.T("الأولوية", "Priority")</th>
                                <th>@Html.T("البريد الإلكتروني", "Email")</th>
                                <th>@Html.T("الموضوع", "Subject")</th>
                                <th>@Html.T("موعد الإرسال", "Scheduled at")</th>
                                <th>@Html.T("تاريخ الإنشاء", "Created")</th>
                                <th>@Html.T("الإجراءات", "Actions")</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var email in Model)
                            {
                                <tr>
                                    <td>
                                        @if (email.Priority == 1)
                                        {
                                            <span class="badge bg-danger">عاجل</span>
                                        }
                                        else if (email.Priority == 2)
                                        {
                                            <span class="badge bg-warning">عالي</span>
                                        }
                                        else if (email.Priority == 3)
                                        {
                                            <span class="badge bg-info">متوسط</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">منخفض</span>
                                        }
                                    </td>
                                    <td>
                                        <div>
                                            <strong>@email.ToEmail</strong>
                                            @if (!string.IsNullOrEmpty(email.ToName))
                                            {
                                                <br/><small class="text-muted">@email.ToName</small>
                                            }
                                        </div>
                                    </td>
                                    <td>@email.Subject</td>
                                    <td>
                                        @if (email.ScheduledFor.HasValue)
                                        {
                                            @email.ScheduledFor.Value.ToString("dd/MM/yyyy HH:mm")
                                        }
                                        else
                                        {
                                            <span class="text-muted">الآن</span>
                                        }
                                    </td>
                                    <td>@email.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                                    <td>
                                        <a href="@Url.Action("Details", new { id = email.Id })" class="btn btn-sm btn-info" title="@Html.T("التفاصيل", "Details")">
                                            <i class="feather-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                @if (totalCount > 50)
                {
                    <nav class="mt-3">
                        <ul class="pagination justify-content-center">
                            @if (page > 1)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("Pending", new { page = page - 1 })">السابق</a>
                                </li>
                            }
                            <li class="page-item active">
                                <span class="page-link">@(page)</span>
                            </li>
                            @if (page * 50 < totalCount)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("Pending", new { page = page + 1 })">التالي</a>
                                </li>
                            }
                        </ul>
                    </nav>
                }
            }
        </div>
    </div>
</div>

