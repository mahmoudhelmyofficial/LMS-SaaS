@model LMS.Areas.Admin.ViewModels.AchievementCreateViewModel

@{
    ViewData["Title"] = Html.T("Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ù†Ø¬Ø§Ø²", "Create achievement");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª", "Achievements"), Url.Action("Index", "Achievements")),
        (Html.T("Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ù†Ø¬Ø§Ø²", "Create achievement"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@section Styles {
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
    <style>
        .note-editor.note-frame { direction: rtl; text-align: right; }
        .icon-picker { display: flex; flex-wrap: wrap; gap: 10px; max-height: 300px; overflow-y: auto; }
        .icon-item {
            width: 60px;
            height: 60px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 24px;
        }
        .icon-item:hover, .icon-item.selected { border-color: #667eea; background: #f0f2ff; }
        .achievement-preview {
            border: 2px dashed #dee2e6;
            border-radius: 12px;
            padding: 30px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            text-align: center;
        }
        .preview-badge {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            font-size: 48px;
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <div class="col-lg-8">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-award me-2"></i>
                        Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²
                    </h5>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post" id="achievementForm" enctype="multipart/form-data">
                        @Html.AntiForgeryToken()
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <div class="form-group mb-4">
                            <label asp-for="Title" class="form-label">
                                Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Title" class="form-control form-control-lg" placeholder="@Html.T("Ù…Ø«Ø§Ù„: Ø£ÙˆÙ„ Ø¯ÙˆØ±Ø© Ù…ÙƒØªÙ…Ù„Ø©", "e.g. First course completed")" />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>

                        <div class="form-group mb-4">
                            <label asp-for="Description" class="form-label">
                                Ø§Ù„ÙˆØµÙ <span class="text-danger">*</span>
                            </label>
                            <textarea asp-for="Description" id="descriptionEditor" class="form-control" rows="5"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Type" class="form-label">
                                        Ù†ÙˆØ¹ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² <span class="text-danger">*</span>
                                    </label>
                                    <select asp-for="Type" class="form-select">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                                        <option value="CourseCompletion">Ø¥ØªÙ…Ø§Ù… Ø¯ÙˆØ±Ø©</option>
                                        <option value="PathCompletion">Ø¥ØªÙ…Ø§Ù… Ù…Ø³Ø§Ø±</option>
                                        <option value="QuizScore">Ù†ØªÙŠØ¬Ø© Ø§Ø®ØªØ¨Ø§Ø±</option>
                                        <option value="Engagement">Ù…Ø´Ø§Ø±ÙƒØ©</option>
                                        <option value="TimeSpent">ÙˆÙ‚Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</option>
                                        <option value="Milestone">Ø¥Ù†Ø¬Ø§Ø² Ø±Ø¦ÙŠØ³ÙŠ</option>
                                        <option value="Special">Ø®Ø§Øµ</option>
                                    </select>
                                    <span asp-validation-for="Type" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Rarity" class="form-label">
                                        Ø§Ù„Ù†Ø¯Ø±Ø© <span class="text-danger">*</span>
                                    </label>
                                    <select asp-for="Rarity" class="form-select" id="raritySelect">
                                        <option value="Common">Ø´Ø§Ø¦Ø¹</option>
                                        <option value="Uncommon">ØºÙŠØ± Ø´Ø§Ø¦Ø¹</option>
                                        <option value="Rare">Ù†Ø§Ø¯Ø±</option>
                                        <option value="Epic">Ù…Ù„Ø­Ù…ÙŠ</option>
                                        <option value="Legendary">Ø£Ø³Ø·ÙˆØ±ÙŠ</option>
                                    </select>
                                    <span asp-validation-for="Rarity" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="Points" class="form-label">
                                        Ø§Ù„Ù†Ù‚Ø§Ø· <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="Points" type="number" class="form-control" min="1" />
                                    <span asp-validation-for="Points" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label asp-for="RequiredValue" class="form-label">
                                        Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                                    </label>
                                    <input asp-for="RequiredValue" type="number" class="form-control" min="0" />
                                    <span asp-validation-for="RequiredValue" class="text-danger"></span>
                                    <small class="form-text text-muted">Ù…Ø«Ø§Ù„: 5 Ø¯ÙˆØ±Ø§ØªØŒ 100 Ø³Ø§Ø¹Ø©</small>
                                </div>
                            </div>
                        </div>

                        <div class="form-group mb-4">
                            <label class="form-label">
                                Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² <span class="text-danger">*</span>
                            </label>
                            <input type="hidden" asp-for="Icon" id="iconInput" />
                            <div class="icon-picker border rounded p-3">
                                <div class="icon-item" data-icon="ğŸ†">ğŸ†</div>
                                <div class="icon-item" data-icon="ğŸ–ï¸">ğŸ–ï¸</div>
                                <div class="icon-item" data-icon="ğŸ¥‡">ğŸ¥‡</div>
                                <div class="icon-item" data-icon="â­">â­</div>
                                <div class="icon-item" data-icon="ğŸ’">ğŸ’</div>
                                <div class="icon-item" data-icon="ğŸ‘‘">ğŸ‘‘</div>
                                <div class="icon-item" data-icon="ğŸ¯">ğŸ¯</div>
                                <div class="icon-item" data-icon="ğŸš€">ğŸš€</div>
                                <div class="icon-item" data-icon="ğŸ“š">ğŸ“š</div>
                                <div class="icon-item" data-icon="ğŸ“">ğŸ“</div>
                                <div class="icon-item" data-icon="âœ¨">âœ¨</div>
                                <div class="icon-item" data-icon="ğŸŒŸ">ğŸŒŸ</div>
                            </div>
                            <span asp-validation-for="Icon" class="text-danger"></span>
                        </div>

                        <div class="form-group mb-4">
                            <label asp-for="BadgeImageFile" class="form-label">
                                ØµÙˆØ±Ø© Ø§Ù„Ø´Ø§Ø±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                            </label>
                            <input asp-for="BadgeImageFile" type="file" class="form-control" accept="image/*" id="imageInput" />
                            <span asp-validation-for="BadgeImageFile" class="text-danger"></span>
                            <small class="form-text text-muted">Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡: 200 Ã— 200 Ø¨ÙƒØ³Ù„</small>
                        </div>

                        <div class="card border mb-4">
                            <div class="card-body">
                                <h6 class="card-title mb-3">
                                    <i class="feather-settings me-2"></i>
                                    Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
                                </h6>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-check form-switch">
                                            <input asp-for="IsActive" class="form-check-input" type="checkbox" id="isActiveSwitch" checked />
                                            <label class="form-check-label" for="isActiveSwitch">
                                                <i class="feather-check-circle me-2"></i>
                                                Ø¥Ù†Ø¬Ø§Ø² Ù†Ø´Ø·
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check form-switch">
                                            <input asp-for="IsSecret" class="form-check-input" type="checkbox" id="isSecretSwitch" />
                                            <label class="form-check-label" for="isSecretSwitch">
                                                <i class="feather-eye-off me-2"></i>
                                                Ø¥Ù†Ø¬Ø§Ø² Ø³Ø±ÙŠ
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check form-switch">
                                            <input asp-for="IsRepeatable" class="form-check-input" type="checkbox" id="isRepeatableSwitch" />
                                            <label class="form-check-label" for="isRepeatableSwitch">
                                                <i class="feather-repeat me-2"></i>
                                                Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙƒØ±Ø§Ø±
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check form-switch">
                                            <input asp-for="ShowNotification" class="form-check-input" type="checkbox" id="showNotificationSwitch" checked />
                                            <label class="form-check-label" for="showNotificationSwitch">
                                                <i class="feather-bell me-2"></i>
                                                Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex gap-2 justify-content-end">
                            <a asp-action="Index" class="btn btn-light">
                                <i class="feather-x me-2"></i>
                                Ø¥Ù„ØºØ§Ø¡
                            </a>
                            <button type="button" class="btn btn-secondary" id="previewBtn">
                                <i class="feather-eye me-2"></i>
                                Ù…Ø¹Ø§ÙŠÙ†Ø©
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-save me-2"></i>
                                Ø­ÙØ¸ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-eye me-2"></i>
                        Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²
                    </h5>
                </div>
                <div class="card-body">
                    <div class="achievement-preview">
                        <div class="preview-badge" id="previewBadge">
                            ğŸ†
                        </div>
                        <h5 class="fw-bold mb-2" id="previewTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</h5>
                        <p class="text-muted small mb-3" id="previewDescription">ÙˆØµÙ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§...</p>
                        <div class="d-flex justify-content-center gap-2 mb-3">
                            <span class="badge bg-soft-primary text-primary" id="previewType">Ø§Ù„Ù†ÙˆØ¹</span>
                            <span class="badge bg-soft-warning text-warning" id="previewRarity">Ø§Ù„Ù†Ø¯Ø±Ø©</span>
                        </div>
                        <div class="d-flex justify-content-center align-items-center gap-2">
                            <i class="feather-award text-warning"></i>
                            <span class="fw-bold" id="previewPoints">0 Ù†Ù‚Ø·Ø©</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-info me-2"></i>
                        Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù†Ø¯Ø±Ø©
                    </h5>
                </div>
                <div class="card-body">
                    <div class="vstack gap-2">
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-soft-secondary text-secondary">Ø´Ø§Ø¦Ø¹</span>
                            <small class="text-muted">5-10 Ù†Ù‚Ø§Ø·</small>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-soft-success text-success">ØºÙŠØ± Ø´Ø§Ø¦Ø¹</span>
                            <small class="text-muted">15-25 Ù†Ù‚Ø·Ø©</small>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-soft-primary text-primary">Ù†Ø§Ø¯Ø±</span>
                            <small class="text-muted">30-50 Ù†Ù‚Ø·Ø©</small>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-soft-purple text-purple">Ù…Ù„Ø­Ù…ÙŠ</span>
                            <small class="text-muted">60-100 Ù†Ù‚Ø·Ø©</small>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <span class="badge bg-soft-warning text-warning">Ø£Ø³Ø·ÙˆØ±ÙŠ</span>
                            <small class="text-muted">150+ Ù†Ù‚Ø·Ø©</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    
    <script>
        $(document).ready(function() {
            $('#descriptionEditor').summernote({
                height: 150,
                direction: 'rtl',
                placeholder: 'Ø§ÙƒØªØ¨ ÙˆØµÙ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ù‡Ù†Ø§...',
                toolbar: [
                    ['style', ['bold', 'italic', 'underline']],
                    ['para', ['ul', 'ol']]
                ]
            });

            // Icon picker
            $('.icon-item').click(function() {
                $('.icon-item').removeClass('selected');
                $(this).addClass('selected');
                const icon = $(this).data('icon');
                $('#iconInput').val(icon);
                $('#previewBadge').text(icon);
            });

            // Live preview
            function updatePreview() {
                const title = $('#Title').val() || 'Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²';
                const description = $('#descriptionEditor').summernote('code').replace(/<[^>]*>/g, '').substring(0, 80) + '...';
                const type = $('#Type option:selected').text() || 'Ø§Ù„Ù†ÙˆØ¹';
                const rarity = $('#Rarity option:selected').text() || 'Ø§Ù„Ù†Ø¯Ø±Ø©';
                const points = $('#Points').val() || '0';

                $('#previewTitle').text(title);
                $('#previewDescription').text(description || 'ÙˆØµÙ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§...');
                $('#previewType').text(type);
                $('#previewRarity').text(rarity);
                $('#previewPoints').text(points + ' Ù†Ù‚Ø·Ø©');

                // Update rarity badge color
                const rarityValue = $('#Rarity').val();
                const rarityColors = {
                    'Common': 'bg-soft-secondary text-secondary',
                    'Uncommon': 'bg-soft-success text-success',
                    'Rare': 'bg-soft-primary text-primary',
                    'Epic': 'bg-soft-purple text-purple',
                    'Legendary': 'bg-soft-warning text-warning'
                };
                $('#previewRarity').attr('class', 'badge ' + (rarityColors[rarityValue] || 'bg-soft-secondary text-secondary'));
            }

            $('#Title, #Type, #Rarity, #Points').on('change keyup', updatePreview);
            $('#descriptionEditor').on('summernote.change', updatePreview);

            // Select first icon by default
            $('.icon-item').first().click();

            updatePreview();
        });
    </script>
}

