@model LMS.Domain.Entities.Financial.CommissionSetting

@{
    ViewData["Title"] = Html.T("تفاصيل إعداد العمولة", "Commission setting details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الإدارة المالية", "Financial"), null),
        (Html.T("إعدادات العمولات", "Commission settings"), Url.Action("Index", "CommissionSettings")),
        (Html.T("التفاصيل", "Details"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        (Html.T("تعديل", "Edit"), "feather-edit", Url.Action("Edit", "CommissionSettings", new { id = Model.Id }), "btn-primary")
    };
    ViewData["HeaderActions"] = actions;
}

@await Html.PartialAsync("_PageHeader")

<!-- Main Content -->
<div class="main-content">
    <div class="row">
        <!-- Status Card -->
        <div class="col-lg-12 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body text-center py-4">
                    <div class="avatar-text avatar-xxl rounded bg-soft-primary text-primary mb-3 mx-auto">
                        <i class="feather-percent" style="font-size: 2.5rem;"></i>
                    </div>
                    <h3 class="mb-2">@Model.Name</h3>
                    <p class="text-muted mb-3">@Model.Type</p>
                    @if (Model.IsActive)
                    {
                        <span class="badge bg-soft-success text-success fs-6 px-3 py-2">
                            <i class="feather-check-circle me-1"></i>
                            نشطة
                        </span>
                    }
                    else
                    {
                        <span class="badge bg-soft-danger text-danger fs-6 px-3 py-2">
                            <i class="feather-x-circle me-1"></i>
                            معطلة
                        </span>
                    }
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="col-md-3 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-danger text-danger">
                            <i class="feather-trending-down"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("نسبة المنصة", "Platform rate")</span>
                            <h3 class="fw-bolder d-block">@Model.PlatformRate%</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-success text-success">
                            <i class="feather-trending-up"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("نسبة المدرب", "Instructor rate")</span>
                            <h3 class="fw-bolder d-block">@Model.InstructorRate%</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-warning text-warning">
                            <i class="feather-clock"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("فترة الحجز", "Booking period")</span>
                            <h3 class="fw-bolder d-block">@Model.HoldPeriodDays</h3>
                            <span class="fs-11 text-muted">@Html.T("يوم", "day")</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-info text-info">
                            <i class="feather-award"></i>
                        </div>
                        <div>
                            <span class="text-truncate-1-line">@Html.T("الأولوية", "Priority")</span>
                            <h3 class="fw-bolder d-block">#@Model.Priority</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Basic Info -->
        <div class="col-lg-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("المعلومات الأساسية", "Basic information")</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("الاسم", "Name")</label>
                        <p class="fw-semibold">@Model.Name</p>
                    </div>
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("النوع", "Type")</label>
                        <p><span class="badge bg-soft-primary text-primary">@Model.Type</span></p>
                    </div>
                    @if (Model.Category != null)
                    {
                        <div class="mb-3">
                            <label class="text-muted">@Html.T("الفئة", "Category")</label>
                            <p class="fw-semibold">@Model.Category.Name</p>
                        </div>
                    }
                    @if (Model.Course != null)
                    {
                        <div class="mb-3">
                            <label class="text-muted">@Html.T("الدورة", "Course")</label>
                            <p class="fw-semibold">@Model.Course.Title</p>
                        </div>
                    }
                    @if (Model.Instructor != null)
                    {
                        <div class="mb-3">
                            <label class="text-muted">@Html.T("المدرب", "Instructor")</label>
                            <p class="fw-semibold">@Model.Instructor.FirstName @Model.Instructor.LastName</p>
                        </div>
                    }
                    <div class="mb-0">
                        <label class="text-muted">@Html.T("الوصف", "Description")</label>
                        <p>@(Model.Description ?? "لا يوجد وصف")</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Commission Breakdown -->
        <div class="col-lg-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("تفاصيل العمولة", "Commission details")</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("نسبة المنصة", "Platform rate")</label>
                        <div class="progress" style="height: 30px;">
                            <div class="progress-bar bg-danger" style="width: @Model.PlatformRate%">
                                <strong>@Model.PlatformRate%</strong>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("نسبة المدرب", "Instructor rate")</label>
                        <div class="progress" style="height: 30px;">
                            <div class="progress-bar bg-success" style="width: @Model.InstructorRate%">
                                <strong>@Model.InstructorRate%</strong>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("الحد الأدنى للبيع", "Minimum sale")</label>
                        <p class="fw-bold">@(Model.MinimumSaleAmount.HasValue ? Model.MinimumSaleAmount.Value.ToEGP() : "لا يوجد")</p>
                    </div>
                    <div class="mb-0">
                        <label class="text-muted">@Html.T("مثال على دورة بسعر 1000 ر.س", "Example for a 1000 course")</label>
                        <div class="alert alert-info mb-0">
                            <div><strong>@Html.T("المنصة", "Platform"):</strong> @((1000 * Model.PlatformRate / 100).ToEGP())</div>
                            <div><strong>@Html.T("المدرب", "Instructor"):</strong> @((1000 * Model.InstructorRate / 100).ToEGP())</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Validity Period -->
        <div class="col-lg-12 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("فترة الصلاحية", "Validity period")</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <label class="text-muted">@Html.T("تاريخ البداية", "Start date")</label>
                            <p class="fw-semibold">@(Model.StartDate.HasValue ? Model.StartDate.Value.ToString("dd/MM/yyyy") : "فوري")</p>
                        </div>
                        <div class="col-md-4">
                            <label class="text-muted">@Html.T("تاريخ النهاية", "End date")</label>
                            <p class="fw-semibold">@(Model.EndDate.HasValue ? Model.EndDate.Value.ToString("dd/MM/yyyy") : "دائم")</p>
                        </div>
                        <div class="col-md-4">
                            <label class="text-muted">@Html.T("تاريخ الإنشاء", "Created date")</label>
                            <p class="fw-semibold">@Model.CreatedAt.ToString("dd/MM/yyyy hh:mm tt")</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="col-lg-12">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex gap-2 justify-content-between">
                        <form method="post" asp-action="ToggleActive" asp-route-id="@Model.Id">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-@(Model.IsActive ? "warning" : "success")">
                                <i class="feather-toggle-@(Model.IsActive ? "left" : "right") me-2"></i>
                                @(Model.IsActive ? Html.T("تعطيل", "Disable") : Html.T("تفعيل", "Enable")) @Html.T("الإعداد", "setting")
                            </button>
                        </form>
                        <div class="d-flex gap-2">
                            <a href="@Url.Action("Index", "CommissionSettings")" class="btn btn-light">
                                <i class="feather-list me-2"></i>
                                العودة للقائمة
                            </a>
                            <a href="@Url.Action("Edit", "CommissionSettings", new { id = Model.Id })" class="btn btn-primary">
                                <i class="feather-edit me-2"></i>
                                تعديل
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

