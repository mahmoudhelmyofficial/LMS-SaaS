@model LMS.Areas.Admin.ViewModels.CommissionPreviewViewModel

@{
    ViewData["Title"] = Html.T("معاينة حساب العمولة", "Commission calculator preview");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الإدارة المالية", "Financial"), null),
        (Html.T("إعدادات العمولات", "Commission settings"), Url.Action("Index", "CommissionSettings")),
        (Html.T("معاينة العمولة", "Commission preview"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@await Html.PartialAsync("_PageHeader")

@await Html.PartialAsync("_Messages")

<div class="main-content">
    <div class="row">
        <div class="col-lg-8">
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-calculator me-2"></i>
                        معاينة حساب العمولة
                    </h5>
                </div>
                <div class="card-body">
                    <form asp-action="Preview" method="post" class="needs-validation" novalidate>
                        @Html.AntiForgeryToken()
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label asp-for="SaleAmount" class="form-label required">مبلغ البيع</label>
                                <div class="input-group">
                                    <input asp-for="SaleAmount" type="number" step="0.01" min="0.01" class="form-control" placeholder="1000" />
                                    <span class="input-group-text">ج.م</span>
                                </div>
                                <span asp-validation-for="SaleAmount" class="text-danger"></span>
                            </div>
                            @{
                                var categories = ViewBag.Categories as IEnumerable<SelectListItem> ?? new List<SelectListItem>();
                                var courses = ViewBag.Courses as IEnumerable<SelectListItem> ?? new List<SelectListItem>();
                                var instructors = ViewBag.Instructors as IEnumerable<SelectListItem> ?? new List<SelectListItem>();
                            }
                            <div class="col-md-6">
                                <label asp-for="CourseId" class="form-label">الدورة (اختياري)</label>
                                <select asp-for="CourseId" asp-items="courses" class="form-select">
                                    <option value="">-- اختيار دورة لتطبيق إعداد محدد --</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="InstructorId" class="form-label">المدرب (اختياري)</label>
                                <select asp-for="InstructorId" asp-items="instructors" class="form-select">
                                    <option value="">-- اختيار مدرب لتطبيق إعداد محدد --</option>
                                </select>
                            </div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-calculator me-2"></i>
                                احسب العمولة
                            </button>
                            <a href="@Url.Action("Index", "CommissionSettings")" class="btn btn-light">
                                <i class="feather-arrow-right me-2"></i>
                                العودة للقائمة
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        @if (Model.SaleAmount > 0)
        {
            <div class="col-lg-4">
                <div class="card stretch stretch-full mb-4 border-primary">
                    <div class="card-header bg-soft-primary">
                        <h5 class="card-title text-primary mb-0">
                            <i class="feather-info me-2"></i>
                            الإعداد المطبق
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="mb-2"><strong>@Model.AppliedSettingName</strong></p>
                        <p class="text-muted small mb-0">@Model.AppliedSettingType</p>
                    </div>
                </div>
            </div>
        }
    </div>

    @if (Model.SaleAmount > 0 && (Model.PlatformCommission > 0 || Model.InstructorEarning > 0))
    {
        <div class="row g-4 mt-2">
            <div class="col-md-3">
                <div class="card stretch stretch-full">
                    <div class="card-body">
                        <div class="d-flex align-items-center gap-3">
                            <div class="avatar-text avatar-xl rounded bg-soft-danger text-danger">
                                <i class="feather-trending-down"></i>
                            </div>
                            <div>
                                <span class="text-muted small">نسبة المنصة</span>
                                <h4 class="fw-bolder mb-0">@Model.PlatformRate%</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stretch stretch-full">
                    <div class="card-body">
                        <div class="d-flex align-items-center gap-3">
                            <div class="avatar-text avatar-xl rounded bg-soft-success text-success">
                                <i class="feather-trending-up"></i>
                            </div>
                            <div>
                                <span class="text-muted small">نسبة المدرب</span>
                                <h4 class="fw-bolder mb-0">@Model.InstructorRate%</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stretch stretch-full">
                    <div class="card-body">
                        <div class="d-flex align-items-center gap-3">
                            <div class="avatar-text avatar-xl rounded bg-soft-warning text-warning">
                                <i class="feather-dollar-sign"></i>
                            </div>
                            <div>
                                <span class="text-muted small">عمولة المنصة</span>
                                <h4 class="fw-bolder mb-0">@Model.PlatformCommission.ToEGP(2)</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stretch stretch-full">
                    <div class="card-body">
                        <div class="d-flex align-items-center gap-3">
                            <div class="avatar-text avatar-xl rounded bg-soft-info text-info">
                                <i class="feather-award"></i>
                            </div>
                            <div>
                                <span class="text-muted small">أرباح المدرب</span>
                                <h4 class="fw-bolder mb-0">@Model.InstructorEarning.ToEGP(2)</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12">
                <div class="card stretch stretch-full">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <span class="text-muted">فترة حجز الأموال:</span>
                                <strong>@Model.HoldPeriodDays يوم</strong>
                            </div>
                            <div class="col-md-6">
                                <span class="text-muted">متاح للمدرب في:</span>
                                <strong>@Model.AvailableDate.ToString("dd/MM/yyyy")</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
}
