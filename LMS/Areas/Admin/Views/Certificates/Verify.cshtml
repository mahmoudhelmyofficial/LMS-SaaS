@{
    ViewData["Title"] = Html.T("التحقق من الشهادة", "Verify certificate");
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    
    var certificate = ViewBag.Certificate as LMS.Domain.Entities.Certifications.Certificate;
    var message = ViewBag.Message as string;
}

<!DOCTYPE html>
<html lang="@Html.Lang()" dir="@Html.Dir()">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - @Html.T("منصة LMS", "LMS Platform")</title>
    <link rel="stylesheet" href="~/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/assets/vendors/css/vendors.min.css" />
    <link rel="stylesheet" href="~/assets/css/theme.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background: var(--gradient-hero, linear-gradient(135deg, #004aad 0%, #0055c4 50%, #1a5cb9 100%));
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <!-- Header -->
                <div class="text-center mb-5">
                    <div class="avatar-text avatar-xxl bg-white text-primary mx-auto mb-4 shadow-lg">
                        <i class="feather-shield fs-1"></i>
                    </div>
                    <h1 class="text-white fw-bold mb-2">@Html.T("التحقق من الشهادة", "Verify Certificate")</h1>
                    <p class="text-white-50">@Html.T("منصة LMS - نظام إدارة التعلم", "LMS Platform - Learning Management System")</p>
                </div>

                <!-- Verification Form -->
                @if (certificate == null)
                {
                    <div class="card shadow-lg border-0">
                        <div class="card-body p-5">
                            <div class="text-center mb-4">
                                <div class="avatar-text avatar-xl bg-soft-primary text-primary mx-auto mb-3">
                                    <i class="feather-search"></i>
                                </div>
                                <h4 class="fw-bold mb-2">@Html.T("أدخل رمز التحقق", "Enter Verification Code")</h4>
                                <p class="text-muted">
                                    @Html.T("يرجى إدخال رمز التحقق المكون من 12 حرفاً الموجود على الشهادة", "Please enter the 12-character verification code found on the certificate")
                                </p>
                            </div>

                            <form asp-action="Verify" asp-controller="Certificates" method="get">
                                <div class="mb-4">
                                    <label class="form-label fw-semibold">@Html.T("رمز التحقق", "Verification Code")</label>
                                    <input type="text" name="code" class="form-control form-control-lg text-center" 
                                           placeholder="@Html.T("مثال: ABC123XYZ789", "e.g. ABC123XYZ789")" 
                                           maxlength="12" 
                                           style="letter-spacing: 3px; font-size: 1.5rem;"
                                           required />
                                    <div class="form-text text-center mt-2">
                                        <i class="feather-info me-1"></i>
                                        @Html.T("يمكنك العثور على رمز التحقق أسفل الشهادة", "You can find the verification code at the bottom of the certificate")
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">
                                    <i class="feather-shield me-2"></i>
                                    @Html.T("التحقق من الشهادة", "Verify Certificate")
                                </button>

                                <div class="text-center">
                                    <a href="@Url.Action("Index", "Home")" class="text-muted">
                                        <i class="feather-arrow-right me-2"></i>
                                        @Html.T("العودة للصفحة الرئيسية", "Back to Home")
                                    </a>
                                </div>
                            </form>

                            @if (!string.IsNullOrEmpty(message) && certificate == null)
                            {
                                <div class="alert alert-warning mt-4">
                                    <i class="feather-alert-triangle me-2"></i>
                                    @message
                                </div>
                            }
                        </div>
                    </div>

                    <!-- Information Card -->
                    <div class="card shadow-lg border-0 mt-4">
                        <div class="card-body p-4">
                            <h6 class="fw-bold mb-3">
                                <i class="feather-info text-primary me-2"></i>
                                @Html.T("معلومات عن التحقق", "Verification Information")
                            </h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="d-flex align-items-start">
                                        <i class="feather-check-circle text-success me-2 mt-1"></i>
                                        <div>
                                            <p class="mb-0 small"><strong>@Html.T("آمن ومضمون", "Secure & Reliable")</strong></p>
                                            <p class="mb-0 text-muted small">@Html.T("نظام تحقق محمي بالكامل", "Fully protected verification system")</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-start">
                                        <i class="feather-zap text-warning me-2 mt-1"></i>
                                        <div>
                                            <p class="mb-0 small"><strong>@Html.T("فوري", "Instant")</strong></p>
                                            <p class="mb-0 text-muted small">@Html.T("نتيجة التحقق خلال ثوانٍ", "Verification result in seconds")</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-start">
                                        <i class="feather-globe text-info me-2 mt-1"></i>
                                        <div>
                                            <p class="mb-0 small"><strong>@Html.T("متاح دائماً", "Always Available")</strong></p>
                                            <p class="mb-0 text-muted small">@Html.T("التحقق متاح 24/7", "Verification available 24/7")</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-flex align-items-start">
                                        <i class="feather-shield text-primary me-2 mt-1"></i>
                                        <div>
                                            <p class="mb-0 small"><strong>@Html.T("موثوق", "Trusted")</strong></p>
                                            <p class="mb-0 text-muted small">@Html.T("قاعدة بيانات محدثة", "Up-to-date database")</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <!-- Verification Result -->
                    @if (certificate.IsRevoked)
                    {
                        <!-- Revoked Certificate -->
                        <div class="card shadow-lg border-0 border-start border-danger border-5">
                            <div class="card-body p-5">
                                <div class="text-center mb-4">
                                    <div class="avatar-text avatar-xxl bg-soft-danger text-danger mx-auto mb-3">
                                        <i class="feather-x-circle fs-1"></i>
                                    </div>
                                    <h3 class="fw-bold text-danger mb-2">@Html.T("الشهادة ملغاة", "Certificate Revoked")</h3>
                                    <p class="text-muted">@Html.T("هذه الشهادة تم إلغاؤها ولم تعد صالحة", "This certificate has been revoked and is no longer valid")</p>
                                </div>

                                <div class="border rounded p-4 bg-soft-danger mb-4">
                                    <h6 class="fw-bold mb-3">@Html.T("معلومات الشهادة", "Certificate Information")</h6>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <p class="text-muted mb-1 small">@Html.T("رقم الشهادة", "Certificate Number")</p>
                                            <p class="fw-bold mb-0">@certificate.CertificateNumber</p>
                                        </div>
                                        <div class="col-md-6">
                                            <p class="text-muted mb-1 small">@Html.T("اسم الطالب", "Student Name")</p>
                                            <p class="fw-bold mb-0">@certificate.StudentName</p>
                                        </div>
                                        <div class="col-12">
                                            <p class="text-muted mb-1 small">@Html.T("الدورة", "Course")</p>
                                            <p class="fw-bold mb-0">@certificate.CourseName</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="alert alert-danger">
                                    <h6 class="fw-bold mb-2">@Html.T("سبب الإلغاء", "Revocation Reason")</h6>
                                    <p class="mb-0">@certificate.RevocationReason</p>
                                </div>

                                <div class="row g-3 text-center">
                                    <div class="col-md-6">
                                        <p class="text-muted mb-1 small">@Html.T("تاريخ الإصدار", "Issue Date")</p>
                                        <p class="fw-bold mb-0">@certificate.IssuedAt.ToString("dd/MM/yyyy")</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="text-muted mb-1 small">@Html.T("تاريخ الإلغاء", "Revocation Date")</p>
                                        <p class="fw-bold mb-0">@certificate.RevokedAt?.ToString("dd/MM/yyyy")</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        <!-- Valid Certificate -->
                        <div class="card shadow-lg border-0 border-start border-success border-5">
                            <div class="card-body p-5">
                                <div class="text-center mb-4">
                                    <div class="avatar-text avatar-xxl bg-soft-success text-success mx-auto mb-3 animate__animated animate__bounceIn">
                                        <i class="feather-check-circle fs-1"></i>
                                    </div>
                                    <h3 class="fw-bold text-success mb-2">@Html.T("شهادة صالحة", "Valid Certificate")</h3>
                                    <p class="text-muted">@Html.T("هذه الشهادة صادرة من منصة LMS وموثقة", "This certificate is issued by the LMS platform and is authenticated")</p>
                                </div>

                                <div class="border rounded p-4 bg-soft-success mb-4">
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-start">
                                                <div class="avatar-text avatar-sm bg-success text-white me-2">
                                                    <i class="feather-hash"></i>
                                                </div>
                                                <div>
                                                    <p class="text-muted mb-1 small">@Html.T("رقم الشهادة", "Certificate Number")</p>
                                                    <p class="fw-bold mb-0">@certificate.CertificateNumber</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="d-flex align-items-start">
                                                <div class="avatar-text avatar-sm bg-primary text-white me-2">
                                                    <i class="feather-user"></i>
                                                </div>
                                                <div>
                                                    <p class="text-muted mb-1 small">@Html.T("اسم الطالب", "Student Name")</p>
                                                    <p class="fw-bold mb-0">@certificate.StudentName</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <div class="d-flex align-items-start">
                                                <div class="avatar-text avatar-sm bg-info text-white me-2">
                                                    <i class="feather-book"></i>
                                                </div>
                                                <div>
                                                    <p class="text-muted mb-1 small">@Html.T("الدورة", "Course")</p>
                                                    <p class="fw-bold mb-0">@certificate.CourseName</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="d-flex align-items-start">
                                                <div class="avatar-text avatar-sm bg-warning text-white me-2">
                                                    <i class="feather-user-check"></i>
                                                </div>
                                                <div>
                                                    <p class="text-muted mb-1 small">@Html.T("المدرس", "Instructor")</p>
                                                    <p class="fw-bold mb-0">@certificate.InstructorName</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="d-flex align-items-start">
                                                <div class="avatar-text avatar-sm bg-success text-white me-2">
                                                    <i class="feather-award"></i>
                                                </div>
                                                <div>
                                                    <p class="text-muted mb-1 small">@Html.T("التقدير", "Grade")</p>
                                                    <p class="fw-bold mb-0">
                                                        @if (certificate.Grade.HasValue)
                                                        {
                                                            @certificate.Grade.Value.ToString("F1")
                                                            @:% 
                                                        }
                                                        else
                                                        {
                                                            @Html.T("اجتياز", "Pass")
                                                        }
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="d-flex align-items-start">
                                                <div class="avatar-text avatar-sm bg-secondary text-white me-2">
                                                    <i class="feather-calendar"></i>
                                                </div>
                                                <div>
                                                    <p class="text-muted mb-1 small">@Html.T("تاريخ الإصدار", "Issue Date")</p>
                                                    <p class="fw-bold mb-0">@certificate.IssuedAt.ToString("dd/MM/yyyy")</p>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="d-flex align-items-start">
                                                <div class="avatar-text avatar-sm bg-secondary text-white me-2">
                                                    <i class="feather-check-square"></i>
                                                </div>
                                                <div>
                                                    <p class="text-muted mb-1 small">@Html.T("تاريخ الإكمال", "Completion Date")</p>
                                                    <p class="fw-bold mb-0">@certificate.CompletionDate.ToString("dd/MM/yyyy")</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="alert alert-success mb-4">
                                    <div class="d-flex align-items-center">
                                        <i class="feather-shield fs-4 me-3"></i>
                                        <div>
                                            <h6 class="mb-1">@Html.T("تم التحقق بنجاح", "Verified Successfully")</h6>
                                            <p class="mb-0 small">
                                                @Html.T("هذه الشهادة صادرة رسمياً من منصة LMS.", "This certificate is officially issued by the LMS platform.")
                                                @Html.T("تم التحقق في", "Verified at") @DateTime.UtcNow.ToString("dd/MM/yyyy hh:mm tt")
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-center">
                                    <button onclick="window.print()" class="btn btn-primary me-2">
                                        <i class="feather-printer me-2"></i>
                                        @Html.T("طباعة", "Print")
                                    </button>
                                    <a href="@Url.Action("Verify", "Certificates")" class="btn btn-light">
                                        <i class="feather-search me-2"></i>
                                        @Html.T("التحقق من شهادة أخرى", "Verify Another Certificate")
                                    </a>
                                </div>
                            </div>
                        </div>
                    }

                    <!-- Verification Info -->
                    <div class="card shadow-lg border-0 mt-4">
                        <div class="card-body p-4">
                            <div class="d-flex align-items-center justify-content-between">
                                <div>
                                    <p class="text-muted mb-1 small">@Html.T("رمز التحقق", "Verification Code")</p>
                                    <p class="fw-bold mb-0" style="letter-spacing: 2px;">@certificate.VerificationCode</p>
                                </div>
                                <div class="text-end">
                                    <p class="text-muted mb-1 small">@Html.T("عدد مرات التحقق", "Verification Count")</p>
                                    <p class="fw-bold mb-0">@certificate.VerificationCount @Html.T("مرة", "time(s)")</p>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

    <script src="~/assets/vendors/js/vendors.min.js"></script>
    
    <style>
        @@media print {
            body {
                background: white;
            }
            .btn, .alert, a {
                display: none !important;
            }
        }
    </style>
</body>
</html>

