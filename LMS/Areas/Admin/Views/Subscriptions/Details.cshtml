@model LMS.Domain.Entities.Payments.Subscription

@{
    ViewData["Title"] = Html.T("تفاصيل الاشتراك", "Subscription details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الاشتراكات", "Subscriptions"), Url.Action("Index", "Subscriptions")),
        (Html.T("تفاصيل اشتراك", "Subscription details"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <div class="col-lg-8">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("معلومات الاشتراك", "Subscription info")</h5>
                    <div class="card-header-action">
                        <span class="badge @(Model.Status == "Active" ? "bg-soft-success text-success" : "bg-soft-secondary text-secondary")">
                            @Model.Status
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-4 text-muted">رقم الاشتراك:</div>
                        <div class="col-md-8 fw-bold">#@Model.Id</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4 text-muted">المشترك:</div>
                        <div class="col-md-8">
                            <a asp-controller="Users" asp-action="Details" asp-route-id="@Model.StudentId">
                                @Model.Student.FirstName @Model.Student.LastName
                            </a>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4 text-muted">الخطة:</div>
                        <div class="col-md-8 fw-bold">@Model.Plan.Name</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4 text-muted">السعر:</div>
                        <div class="col-md-8 fw-bold text-primary">@(Model.Price?.ToEGP() ?? "0")</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4 text-muted">تاريخ البدء:</div>
                        <div class="col-md-8">@Model.StartDate.ToString("dd/MM/yyyy")</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4 text-muted">تاريخ الانتهاء:</div>
                        <div class="col-md-8">@(Model.EndDate?.ToString("dd/MM/yyyy") ?? "-")</div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-4 text-muted">التجديد التلقائي:</div>
                        <div class="col-md-8">
                            @if (Model.IsAutoRenew)
                            {
                                <span class="badge bg-soft-success text-success">مفعل</span>
                            }
                            else
                            {
                                <span class="badge bg-soft-secondary text-secondary">معطل</span>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("الإجراءات", "Actions")</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        @if (Model.Status == "Active")
                        {
                            <form asp-action="Cancel" method="post" onsubmit="return confirm(window.__SubscriptionsDetailsT.cancelConfirm);">
                                <input type="hidden" name="id" value="@Model.Id" />
                                <input type="hidden" name="reason" value="Admin cancelled" />
                                <button type="submit" class="btn btn-danger w-100">
                                    <i class="feather-x me-2"></i>@Html.T("إلغاء الاشتراك", "Cancel subscription")
                                </button>
                            </form>
                        }
                        <a asp-action="Index" class="btn btn-light">
                            <i class="feather-arrow-right me-2"></i>@Html.T("رجوع للقائمة", "Back to list")
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
window.__SubscriptionsDetailsT = { cancelConfirm: '@Html.Raw(Html.T("هل أنت متأكد من إلغاء هذا الاشتراك؟", "Are you sure you want to cancel this subscription?").Replace("'", "\\'"))' };
</script>
}

