@model LMS.Areas.Admin.ViewModels.SubscriptionPlanEditViewModel

@{
    ViewData["Title"] = Html.T("تعديل خطة الاشتراك", "Edit subscription plan");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الاشتراكات", "Subscriptions"), Url.Action("Index", "Subscriptions")),
        (Html.T("الخطط", "Plans"), Url.Action("Plans", "Subscriptions")),
        (Html.T("تعديل خطة", "Edit plan"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@section Styles {
    <link rel="stylesheet" href="~/Areas/Admin/Views/Subscriptions/CreatePlan.cshtml" />
}

@await Html.PartialAsync("_PageHeader")

<!-- Main Content -->
<div class="main-content">
    <form asp-action="EditPlan" method="post">
        <input type="hidden" asp-for="Id" />
        <div class="row">
            <div class="col-lg-8">
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("المعلومات الأساسية", "Basic information")</h5>
                        <div class="card-header-action">
                            <span class="badge bg-soft-info text-info">
                                @Model.ActiveSubscribersCount مشترك نشط
                            </span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <label class="form-label" for="name">@Html.T("اسم الخطة", "Plan name") <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" asp-for="Name" required>
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label class="form-label" for="price">@Html.T("السعر (جنيه)", "Price (currency)") <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="price" asp-for="Price" step="0.01" min="0" required>
                                <span asp-validation-for="Price" class="text-danger"></span>
                            </div>
                            <div class="col-12 mb-4">
                                <label class="form-label" for="description">@Html.T("الوصف", "Description")</label>
                                <textarea class="form-control" id="description" asp-for="Description" rows="3"></textarea>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label class="form-label" for="durationDays">@Html.T("مدة الاشتراك (بالأيام)", "Duration (days)")</label>
                                <input type="number" class="form-control" id="durationDays" asp-for="DurationDays" min="1" required>
                            </div>
                            <div class="col-md-6 mb-4">
                                <label class="form-label" for="coursesLimit">@Html.T("حد الدورات", "Courses limit")</label>
                                <input type="number" class="form-control" id="coursesLimit" asp-for="CoursesLimit">
                                <small class="text-muted">@Html.T("-1 للدورات غير المحدودة", "-1 for unlimited")</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("الميزات والصلاحيات", "Features and permissions")</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="accessToPremiumContent" asp-for="AccessToPremiumContent">
                                    <label class="form-check-label" for="accessToPremiumContent">
                                        <i class="feather-star text-warning me-2"></i>
                                        <strong>@Html.T("الوصول للمحتوى المميز", "Access to premium content")</strong>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="accessToLiveClasses" asp-for="AccessToLiveClasses">
                                    <label class="form-check-label" for="accessToLiveClasses">
                                        <i class="feather-video text-info me-2"></i>
                                        <strong>@Html.T("حضور الفصول المباشرة", "Attend live classes")</strong>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="prioritySupport" asp-for="PrioritySupport">
                                    <label class="form-check-label" for="prioritySupport">
                                        <i class="feather-headphones text-primary me-2"></i>
                                        <strong>@Html.T("دعم فني ذو أولوية", "Priority support")</strong>
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="certificatesIncluded" asp-for="CertificatesIncluded">
                                    <label class="form-check-label" for="certificatesIncluded">
                                        <i class="feather-award text-success me-2"></i>
                                        <strong>@Html.T("شهادات إتمام", "Completion certificates")</strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("إعدادات إضافية", "Additional settings")</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label" for="trialPeriodDays">@Html.T("فترة التجربة (أيام)", "Trial period (days)")</label>
                                <input type="number" class="form-control" id="trialPeriodDays" asp-for="TrialPeriodDays" min="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label" for="displayOrder">@Html.T("ترتيب العرض", "Display order")</label>
                                <input type="number" class="form-control" id="displayOrder" asp-for="DisplayOrder" min="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">@Html.T("الحالة", "Status")</label>
                                <div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="isActive" asp-for="IsActive">
                                        <label class="form-check-label" for="isActive">@Html.T("نشط", "Active")</label>
                                    </div>
                                    <div class="form-check form-switch mt-2">
                                        <input class="form-check-input" type="checkbox" id="isFeatured" asp-for="IsFeatured">
                                        <label class="form-check-label" for="isFeatured">@Html.T("مميز", "Featured")</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer text-end">
                        <a asp-action="Plans" class="btn btn-light me-2">
                            <i class="feather-arrow-right me-2"></i>رجوع
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="feather-save me-2"></i>حفظ التعديلات
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card stretch stretch-full sticky-top" style="top: 100px;">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("معاينة الخطة", "Plan preview")</h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <h4 id="previewName" class="fw-bold">@Model.Name</h4>
                            <p id="previewDescription" class="text-muted small">@Model.Description</p>
                            <div class="my-4">
                                <span id="previewPrice" class="display-4 fw-bold text-primary">@Model.Price.ToString("N0")</span>
                                <span class="text-muted">جنيه</span>
                            </div>
                            <small id="previewDuration" class="text-muted">لمدة @Model.DurationDays يوم</small>
                        </div>
                        <hr>
                        <h6 class="fw-bold mb-3">إحصائيات:</h6>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="feather-users text-primary me-2"></i>
                                <span>@Model.ActiveSubscribersCount مشترك نشط</span>
                            </li>
                            <li class="mb-2">
                                <i class="feather-calendar text-success me-2"></i>
                                <span>تم الإنشاء: @DateTime.Now.ToString("dd/MM/yyyy")</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            function updatePreview() {
                $('#previewName').text($('#name').val() || 'اسم الخطة');
                $('#previewDescription').text($('#description').val() || 'وصف الخطة');
                $('#previewPrice').text(parseFloat($('#price').val() || 0).toLocaleString('ar-EG'));
                $('#previewDuration').text(`لمدة ${$('#durationDays').val() || 0} يوم`);
            }
            $('#name, #description, #price, #durationDays').on('input', updatePreview);
        });
    </script>
}

