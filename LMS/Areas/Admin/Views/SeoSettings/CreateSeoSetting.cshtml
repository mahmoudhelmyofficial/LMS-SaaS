@model LMS.Areas.Admin.ViewModels.SeoSettingViewModel

@{
    ViewData["Title"] = Html.T("إعداد SEO للمنصة", "Platform SEO setup");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الإعدادات", "Settings"), Url.Action("Index", "Settings")),
        (Html.T("إعدادات SEO", "SEO settings"), Url.Action("Index", "SeoSettings")),
        (Html.T("إعداد جديد", "New setting"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@section Styles {
    <style>
        .seo-preview {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .google-preview {
            font-family: Arial, sans-serif;
        }
        .google-title {
            color: #1a0dab;
            font-size: 20px;
            font-weight: 400;
            margin-bottom: 5px;
            cursor: pointer;
        }
        .google-title:hover {
            text-decoration: underline;
        }
        .google-url {
            color: #006621;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .google-description {
            color: #545454;
            font-size: 14px;
            line-height: 1.58;
        }
        .social-preview {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            background: white;
        }
        .social-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }
        .social-content {
            padding: 15px;
        }
        .social-title {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 16px;
        }
        .social-description {
            color: #65676b;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .social-domain {
            color: #65676b;
            font-size: 12px;
            text-transform: uppercase;
        }
        .analytics-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 25px;
            color: white;
            margin-bottom: 20px;
        }
        .tracking-code {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
        }
        .feature-toggle {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        .feature-toggle:hover {
            border-color: #3454d1;
            background: #f0f4ff;
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <div class="col-lg-8">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-search me-2"></i>معلومات SEO الأساسية
                    </h5>
                </div>
                <div class="card-body">
                    <form asp-action="SaveSeoSetting" method="post">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <div class="form-group mb-4">
                            <label asp-for="SiteTitle" class="form-label">
                                عنوان الموقع <span class="text-danger">*</span>
                            </label>
                            <input asp-for="SiteTitle" class="form-control form-control-lg" placeholder="منصة التعليم الإلكتروني" id="siteTitle" maxlength="60" />
                            <span asp-validation-for="SiteTitle" class="text-danger"></span>
                            <div class="d-flex justify-content-between mt-1">
                                <small class="text-muted">يظهر في نتائج البحث وعنوان المتصفح</small>
                                <small class="text-muted"><span id="titleCount">0</span>/60</small>
                            </div>
                        </div>

                        <div class="form-group mb-4">
                            <label asp-for="SiteDescription" class="form-label">
                                وصف الموقع <span class="text-danger">*</span>
                            </label>
                            <textarea asp-for="SiteDescription" class="form-control" rows="3" placeholder="منصة تعليمية متكاملة تقدم دورات احترافية في مختلف المجالات..." id="siteDescription" maxlength="160"></textarea>
                            <span asp-validation-for="SiteDescription" class="text-danger"></span>
                            <div class="d-flex justify-content-between mt-1">
                                <small class="text-muted">وصف مختصر يظهر في نتائج البحث</small>
                                <small class="text-muted"><span id="descCount">0</span>/160</small>
                            </div>
                        </div>

                        <div class="form-group mb-4">
                            <label asp-for="Keywords" class="form-label">
                                الكلمات المفتاحية
                            </label>
                            <input asp-for="Keywords" class="form-control" placeholder="تعليم إلكتروني، دورات أونلاين، تدريب، تطوير مهارات" />
                            <span asp-validation-for="Keywords" class="text-danger"></span>
                            <small class="text-muted">افصل الكلمات بفاصلة (،)</small>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label asp-for="AuthorName" class="form-label">اسم المؤلف</label>
                                <input asp-for="AuthorName" class="form-control" placeholder="اسم المنصة أو الشركة" />
                            </div>
                            <div class="col-md-6">
                                <label asp-for="CanonicalUrl" class="form-label">الرابط الأساسي</label>
                                <input asp-for="CanonicalUrl" class="form-control" placeholder="https://example.com" />
                                <small class="text-muted">الرابط الرئيسي للموقع</small>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label asp-for="LogoUrl" class="form-label">رابط الشعار</label>
                                <input asp-for="LogoUrl" class="form-control" placeholder="https://example.com/logo.png" />
                                <small class="text-muted">للظهور في نتائج البحث</small>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="FeaturedImageUrl" class="form-label">الصورة المميزة</label>
                                <input asp-for="FeaturedImageUrl" class="form-control" placeholder="https://example.com/og-image.jpg" />
                                <small class="text-muted">للمشاركة على وسائل التواصل</small>
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- Analytics & Tracking -->
                        <h6 class="mb-3">
                            <i class="feather-bar-chart-2 me-2"></i>التتبع والتحليلات
                        </h6>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label asp-for="GoogleAnalyticsId" class="form-label">
                                    <i class="feather-trending-up me-2"></i>Google Analytics ID
                                </label>
                                <input asp-for="GoogleAnalyticsId" class="form-control" placeholder="G-XXXXXXXXXX أو UA-XXXXXXXXX-X" id="gaId" />
                                <small class="text-muted">معرف Google Analytics 4</small>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="GoogleTagManagerId" class="form-label">
                                    <i class="feather-tag me-2"></i>Google Tag Manager ID
                                </label>
                                <input asp-for="GoogleTagManagerId" class="form-control" placeholder="GTM-XXXXXXX" />
                                <small class="text-muted">معرف Google Tag Manager</small>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label asp-for="FacebookPixelId" class="form-label">
                                    <i class="feather-facebook me-2"></i>Facebook Pixel ID
                                </label>
                                <input asp-for="FacebookPixelId" class="form-control" placeholder="123456789012345" />
                                <small class="text-muted">لتتبع إعلانات فيسبوك</small>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="GoogleSearchConsoleCode" class="form-label">
                                    <i class="feather-search me-2"></i>Google Search Console
                                </label>
                                <input asp-for="GoogleSearchConsoleCode" class="form-control" placeholder="google-site-verification=..." />
                                <small class="text-muted">كود التحقق من الموقع</small>
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- Social Media -->
                        <h6 class="mb-3">
                            <i class="feather-share-2 me-2"></i>وسائل التواصل الاجتماعي
                        </h6>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="feature-toggle">
                                    <div class="form-check form-switch">
                                        <input asp-for="EnableOpenGraph" class="form-check-input" type="checkbox" checked />
                                        <label class="form-check-label" asp-for="EnableOpenGraph">
                                            <strong>Open Graph (Facebook)</strong><br>
                                            <small class="text-muted">تحسين المشاركة على فيسبوك</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="feature-toggle">
                                    <div class="form-check form-switch">
                                        <input asp-for="EnableTwitterCards" class="form-check-input" type="checkbox" checked />
                                        <label class="form-check-label" asp-for="EnableTwitterCards">
                                            <strong>@Html.T("بطاقات تويتر", "Twitter Cards")</strong><br>
                                            <small class="text-muted">تحسين المشاركة على تويتر</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group mb-4">
                            <label asp-for="TwitterHandle" class="form-label">
                                <i class="feather-twitter me-2"></i>حساب تويتر
                            </label>
                            <div class="input-group">
                                <span class="input-group-text">@@</span>
                                <input asp-for="TwitterHandle" class="form-control" placeholder="username" />
                            </div>
                            <small class="text-muted">اسم المستخدم بدون @@</small>
                        </div>

                        <hr class="my-4">

                        <!-- Advanced Features -->
                        <h6 class="mb-3">
                            <i class="feather-settings me-2"></i>إعدادات متقدمة
                        </h6>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="feature-toggle">
                                    <div class="form-check form-switch">
                                        <input asp-for="EnableSchemaMarkup" class="form-check-input" type="checkbox" checked />
                                        <label class="form-check-label" asp-for="EnableSchemaMarkup">
                                            <strong>@Html.T("بيانات Schema المنظمة", "Schema Markup")</strong><br>
                                            <small class="text-muted">بيانات منظمة لمحركات البحث</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="feature-toggle">
                                    <div class="form-check form-switch">
                                        <input asp-for="EnableSitemap" class="form-check-input" type="checkbox" checked />
                                        <label class="form-check-label" asp-for="EnableSitemap">
                                            <strong>خريطة الموقع (Sitemap)</strong><br>
                                            <small class="text-muted">توليد sitemap.xml تلقائياً</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="feature-toggle">
                                    <div class="form-check form-switch">
                                        <input asp-for="EnableRobotsTxt" class="form-check-input" type="checkbox" checked id="robotsToggle" />
                                        <label class="form-check-label" asp-for="EnableRobotsTxt">
                                            <strong>ملف Robots.txt</strong><br>
                                            <small class="text-muted">التحكم في الزحف للموقع</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="feature-toggle">
                                    <div class="form-check form-switch">
                                        <input asp-for="EnableRssFeed" class="form-check-input" type="checkbox" checked />
                                        <label class="form-check-label" asp-for="EnableRssFeed">
                                            <strong>@Html.T("تغذية RSS", "RSS Feed")</strong><br>
                                            <small class="text-muted">تغذية RSS للمحتوى</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group mb-4" id="robotsContent" style="display: none;">
                            <label asp-for="RobotsTxtContent" class="form-label">محتوى Robots.txt</label>
                            <textarea asp-for="RobotsTxtContent" class="form-control" rows="6" style="font-family: monospace;">User-agent: *
Allow: /
Disallow: /admin/
Disallow: /api/
Sitemap: https://example.com/sitemap.xml</textarea>
                            <small class="text-muted">قواعد الزحف لمحركات البحث</small>
                        </div>

                        <div class="alert alert-info">
                            <i class="feather-info me-2"></i>
                            <strong>نصيحة:</strong> تأكد من إضافة موقعك إلى Google Search Console و Bing Webmaster Tools للحصول على أفضل النتائج.
                        </div>

                        <div class="d-flex gap-2 justify-content-end">
                            <a asp-action="SeoSettings" class="btn btn-light">
                                <i class="feather-x me-2"></i>إلغاء
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-save me-2"></i>حفظ إعدادات SEO
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Google Preview -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="feather-search me-2"></i>معاينة Google
                    </h6>
                </div>
                <div class="card-body">
                    <div class="seo-preview google-preview">
                        <div class="google-title" id="googleTitle">منصة التعليم الإلكتروني</div>
                        <div class="google-url">https://example.com</div>
                        <div class="google-description" id="googleDescription">
                            منصة تعليمية متكاملة تقدم دورات احترافية في مختلف المجالات...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Social Media Preview -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="card-title mb-0">
                        <i class="feather-share-2 me-2"></i>معاينة وسائل التواصل
                    </h6>
                </div>
                <div class="card-body">
                    <div class="social-preview">
                        <div class="social-image">
                            <i class="feather-image"></i>
                        </div>
                        <div class="social-content">
                            <div class="social-domain">EXAMPLE.COM</div>
                            <div class="social-title" id="socialTitle">منصة التعليم الإلكتروني</div>
                            <div class="social-description" id="socialDescription">
                                منصة تعليمية متكاملة تقدم دورات احترافية...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Info -->
            <div class="analytics-card">
                <h6 class="text-white mb-3">
                    <i class="feather-activity me-2"></i>أكواد التتبع
                </h6>
                <div class="tracking-code mb-3" id="gaCode" style="display: none;">
                    <!-- Google Analytics -->
                    <div class="text-white-50 mb-1">Google Analytics:</div>
                    <div id="gaCodeDisplay">لم يتم الإضافة</div>
                </div>
                <small class="text-white-50">
                    <i class="feather-check-circle me-1"></i>
                    سيتم إضافة الأكواد تلقائياً لجميع صفحات الموقع
                </small>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Character counters
            $('#siteTitle').on('input', function() {
                const length = $(this).val().length;
                $('#titleCount').text(length);
                $('#googleTitle, #socialTitle').text($(this).val() || 'منصة التعليم الإلكتروني');
            });

            $('#siteDescription').on('input', function() {
                const length = $(this).val().length;
                $('#descCount').text(length);
                const text = $(this).val() || 'منصة تعليمية متكاملة تقدم دورات احترافية...';
                $('#googleDescription').text(text);
                $('#socialDescription').text(text.substring(0, 100) + (text.length > 100 ? '...' : ''));
            });

            // Google Analytics preview
            $('#gaId').on('input', function() {
                const gaId = $(this).val();
                if (gaId) {
                    $('#gaCode').show();
                    $('#gaCodeDisplay').text(gaId);
                } else {
                    $('#gaCode').hide();
                }
            });

            // Robots.txt toggle
            $('#robotsToggle').on('change', function() {
                $('#robotsContent').toggle($(this).is(':checked'));
            });

            // Initialize counters
            $('#titleCount').text($('#siteTitle').val().length);
            $('#descCount').text($('#siteDescription').val().length);
        });
    </script>
}

