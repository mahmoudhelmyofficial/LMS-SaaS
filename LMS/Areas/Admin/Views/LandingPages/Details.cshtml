@model LMS.Domain.Entities.Marketing.LandingPage

@{
    ViewData["Title"] = Html.T("تفاصيل الصفحة المقصودة", "Landing page details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الصفحات المقصودة", "Landing pages"), Url.Action("Index", "LandingPages")),
        (Model.Title, null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        (Html.T("تعديل", "Edit"), "feather-edit", Url.Action("Edit", "LandingPages", new { id = Model.Id }), "btn-primary"),
        (Html.T("معاينة", "Preview"), "feather-eye", $"/landing/{Model.Slug}", "btn-info")
    };
    ViewData["HeaderActions"] = actions;
}

@section Styles {
    <style>
        .status-badge {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
        }
        .preview-container {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            background-color: #f9fafb;
            min-height: 400px;
        }
        .template-preview {
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .metric-card {
            background: var(--gradient-hero, linear-gradient(135deg, #004aad 0%, #0055c4 50%, #1a5cb9 100%));
            border-radius: 12px;
            padding: 20px;
            color: white;
            height: 100%;
        }
        .metric-value {
            font-size: 32px;
            font-weight: 700;
            line-height: 1;
        }
        .seo-info-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        .section-divider {
            border-top: 2px dashed #e5e7eb;
            margin: 30px 0;
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Page Overview -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("معلومات الصفحة", "Page information")</h5>
                    <div class="card-header-action">
                        @if (Model.IsActive)
                        {
                            <span class="badge bg-success status-badge">@Html.T("نشطة", "Active")</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary status-badge">@Html.T("غير نشطة", "Inactive")</span>
                        }
                        @if (Model.Status != null)
                        {
                            <span class="badge bg-info status-badge ms-2">@Model.Status</span>
                        }
                    </div>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <!-- Title -->
                        <div class="col-12">
                            <h3 class="mb-2">@Model.Title</h3>
                            <p class="text-muted mb-0">
                                <i class="feather-link me-2"></i>
                                <a href="/landing/@Model.Slug" target="_blank" class="text-primary">
                                    /landing/@Model.Slug
                                </a>
                            </p>
                        </div>

                        <!-- Description -->
                        @if (!string.IsNullOrEmpty(Model.Description))
                        {
                            <div class="col-12">
                                <label class="text-muted fs-12 mb-2">@Html.T("الوصف", "Description")</label>
                                <div class="p-3 bg-light rounded">
                                    <p class="mb-0">@Model.Description</p>
                                </div>
                            </div>
                        }

                        <div class="section-divider"></div>

                        <!-- Template Info -->
                        @if (Model.Template != null)
                        {
                            <div class="col-12">
                                <label class="text-muted fs-12 mb-2">@Html.T("القالب المستخدم", "Template used")</label>
                                <div class="d-flex align-items-center gap-3 p-3 bg-light rounded">
                                    <div class="avatar-text avatar-lg bg-soft-primary text-primary">
                                        <i class="feather-layout"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">@Model.Template.Name</h6>
                                        @if (!string.IsNullOrEmpty(Model.Template.Description))
                                        {
                                            <p class="text-muted fs-12 mb-0">@Model.Template.Description</p>
                                        }
                                    </div>
                                </div>
                            </div>
                        }

                        <!-- SEO Information -->
                        @if (!string.IsNullOrEmpty(Model.MetaTitle) || !string.IsNullOrEmpty(Model.MetaDescription) || !string.IsNullOrEmpty(Model.MetaKeywords))
                        {
                            <div class="col-12">
                                <div class="section-divider"></div>
                                <h5 class="mb-3">
                                    <i class="feather-search me-2"></i>
                                    @Html.T("معلومات SEO", "SEO information")
                                </h5>
                                <div class="seo-info-card">
                                    @if (!string.IsNullOrEmpty(Model.MetaTitle))
                                    {
                                        <div class="mb-3">
                                            <label class="text-muted fs-12 mb-1">@Html.T("عنوان ميتا", "Meta Title")</label>
                                            <p class="fw-semibold mb-0">@Model.MetaTitle</p>
                                        </div>
                                    }
                                    @if (!string.IsNullOrEmpty(Model.MetaDescription))
                                    {
                                        <div class="mb-3">
                                            <label class="text-muted fs-12 mb-1">@Html.T("وصف ميتا", "Meta Description")</label>
                                            <p class="mb-0">@Model.MetaDescription</p>
                                        </div>
                                    }
                                    @if (!string.IsNullOrEmpty(Model.MetaKeywords))
                                    {
                                        <div>
                                            <label class="text-muted fs-12 mb-1">@Html.T("الكلمات المفتاحية", "Keywords")</label>
                                            <p class="mb-0">@Model.MetaKeywords</p>
                                        </div>
                                    }
                                </div>
                            </div>
                        }

                        <!-- Custom CSS/JS -->
                        @if (!string.IsNullOrEmpty(Model.CustomCss) || !string.IsNullOrEmpty(Model.CustomJs))
                        {
                            <div class="col-12">
                                <div class="section-divider"></div>
                                <h5 class="mb-3">
                                    <i class="feather-code me-2"></i>
                                    @Html.T("تخصيصات متقدمة", "Advanced customizations")
                                </h5>
                                @if (!string.IsNullOrEmpty(Model.CustomCss))
                                {
                                    <div class="mb-3">
                                        <label class="text-muted fs-12 mb-2">@Html.T("CSS مخصص", "Custom CSS")</label>
                                        <pre class="bg-dark text-light p-3 rounded"><code>@Model.CustomCss</code></pre>
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(Model.CustomJs))
                                {
                                    <div>
                                        <label class="text-muted fs-12 mb-2">@Html.T("جافاسكربت مخصص", "Custom JavaScript")</label>
                                        <pre class="bg-dark text-light p-3 rounded"><code>@Model.CustomJs</code></pre>
                                    </div>
                                }
                            </div>
                        }

                        <!-- Dates -->
                        <div class="col-md-6">
                            <label class="text-muted fs-12 mb-1">@Html.T("تاريخ الإنشاء", "Created date")</label>
                            <p class="mb-0">@Model.CreatedAt.ToString("dd/MM/yyyy hh:mm tt")</p>
                        </div>

                        @if (Model.PublishedAt.HasValue)
                        {
                            <div class="col-md-6">
                                <label class="text-muted fs-12 mb-1">@Html.T("تاريخ النشر", "Published date")</label>
                                <p class="mb-0">@Model.PublishedAt.Value.ToString("dd/MM/yyyy hh:mm tt")</p>
                            </div>
                        }

                        @if (Model.UpdatedAt.HasValue)
                        {
                            <div class="col-md-6">
                                <label class="text-muted fs-12 mb-1">@Html.T("آخر تحديث", "Last updated")</label>
                                <p class="mb-0">@Model.UpdatedAt.Value.ToString("dd/MM/yyyy hh:mm tt")</p>
                            </div>
                        }

                        <!-- Created By -->
                        @if (Model.CreatedBy != null)
                        {
                            <div class="col-md-6">
                                <label class="text-muted fs-12 mb-1">@Html.T("أنشئت بواسطة", "Created by")</label>
                                <p class="mb-0">@Model.CreatedBy</p>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Preview Section -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("معاينة الصفحة", "Page preview")</h5>
                    <div class="card-header-action">
                        <a href="/landing/@Model.Slug" target="_blank" class="btn btn-sm btn-primary">
                            <i class="feather-external-link me-2"></i>
                            @Html.T("فتح في نافذة جديدة", "Open in new window")
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="preview-container">
                        <iframe src="/landing/@Model.Slug" 
                                style="width: 100%; min-height: 600px; border: none; border-radius: 8px;"
                                title="@Html.T("معاينة", "Preview")"></iframe>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Performance Metrics -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("الأداء", "Performance")</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-12">
                            <div class="metric-card" style="background: var(--gradient-hero, linear-gradient(135deg, #004aad 0%, #0055c4 50%, #1a5cb9 100%));">
                                <p class="mb-2 opacity-75">@Html.T("إجمالي الزيارات", "Total visits")</p>
                                <h2 class="metric-value mb-0">@Model.ViewCount</h2>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="metric-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <p class="mb-2 opacity-75">@Html.T("التحويلات", "Conversions")</p>
                                <h2 class="metric-value mb-0">@Model.ConversionCount</h2>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="metric-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <p class="mb-2 opacity-75">@Html.T("معدل التحويل", "Conversion rate")</p>
                                <h2 class="metric-value mb-0">
                                    @if (Model.ViewCount > 0 && Model.ConversionCount > 0)
                                    {
                                        @(((decimal)Model.ConversionCount / Model.ViewCount * 100).ToString("F1"))
                                    }
                                    else
                                    {
                                        @:0
                                    }%
                                </h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page Status -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("حالة الصفحة", "Page status")</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between mb-3 pb-3 border-bottom">
                        <span class="text-muted">@Html.T("الحالة", "Status")</span>
                        <span class="fw-semibold">
                            @if (Model.IsActive)
                            {
                                <span class="badge bg-success">@Html.T("نشطة", "Active")</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">@Html.T("غير نشطة", "Inactive")</span>
                            }
                        </span>
                    </div>
                    <div class="d-flex align-items-center justify-content-between mb-3 pb-3 border-bottom">
                        <span class="text-muted">@Html.T("حالة النشر", "Publish status")</span>
                        <span class="fw-semibold">
                            @if (Model.Status != null)
                            {
                                <span class="badge bg-info">@Model.Status</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">@Html.T("غير محدد", "Unspecified")</span>
                            }
                        </span>
                    </div>
                    <div class="d-flex align-items-center justify-content-between mb-3 pb-3 border-bottom">
                        <span class="text-muted">@Html.T("رقم الصفحة", "Page ID")</span>
                        <span class="fw-semibold">#@Model.Id.ToString().PadLeft(5, '0')</span>
                    </div>
                    <div class="d-flex align-items-center justify-content-between">
                        <span class="text-muted">@Html.T("القالب", "Template")</span>
                        <span class="fw-semibold">@(Model.Template?.Name ?? Html.T("لا يوجد", "None").ToString())</span>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("الإجراءات", "Actions")</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="@Url.Action("Edit", "LandingPages", new { id = Model.Id })" class="btn btn-primary">
                            <i class="feather-edit me-2"></i>
                            @Html.T("تعديل الصفحة", "Edit page")
                        </a>
                        <a href="/landing/@Model.Slug" target="_blank" class="btn btn-info">
                            <i class="feather-eye me-2"></i>
                            @Html.T("معاينة مباشرة", "Live preview")
                        </a>
                        @if (Model.IsActive)
                        {
                            <form asp-action="ToggleStatus" asp-route-id="@Model.Id" method="post">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-warning w-100">
                                    <i class="feather-pause me-2"></i>
                                    @Html.T("إلغاء التفعيل", "Deactivate")
                                </button>
                            </form>
                        }
                        else
                        {
                            <form asp-action="ToggleStatus" asp-route-id="@Model.Id" method="post">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-success w-100">
                                    <i class="feather-play me-2"></i>
                                    @Html.T("تفعيل الصفحة", "Activate page")
                                </button>
                            </form>
                        }
                        <button type="button" class="btn btn-secondary" onclick="duplicatePage()">
                            <i class="feather-copy me-2"></i>
                            نسخ الصفحة
                        </button>
                        <form asp-action="Delete" asp-route-id="@Model.Id" method="post">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-danger w-100" onclick="return confirm('@Html.Raw(Html.T("هل أنت متأكد من حذف هذه الصفحة؟", "Are you sure you want to delete this page?").Replace("'", "\\'"))')">
                                <i class="feather-trash-2 me-2"></i>
                                حذف الصفحة
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Quick Links -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("روابط سريعة", "Quick links")</h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <a href="@Url.Action("Index", "LandingPages")" class="list-group-item list-group-item-action border-0">
                            <i class="feather-list me-2"></i>
                            @Html.T("جميع الصفحات المقصودة", "All landing pages")
                        </a>
                        <a href="@Url.Action("Index", "Analytics", new { page = "landing-" + Model.Slug })" class="list-group-item list-group-item-action border-0">
                            <i class="feather-bar-chart-2 me-2"></i>
                            @Html.T("تحليلات الصفحة", "Page analytics")
                        </a>
                        <a href="@Url.Action("Index", "SeoSettings")" class="list-group-item list-group-item-action border-0">
                            <i class="feather-search me-2"></i>
                            @Html.T("إعدادات SEO", "SEO settings")
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function duplicatePage() {
            if (confirm('@Html.Raw(Html.T("هل تريد إنشاء نسخة من هذه الصفحة؟", "Do you want to create a copy of this page?").Replace("'", "\\'"))')) {
                // Implement duplication logic
                window.location.href = '@Url.Action("Duplicate", "LandingPages", new { id = Model.Id })';
            }
        }

        // Auto-refresh metrics every 30 seconds
        setInterval(function() {
            // Implement metrics refresh logic
            console.log('Refreshing metrics...');
        }, 30000);
    </script>
}

