@model LMS.Areas.Admin.ViewModels.LandingPageCreateViewModel

@{
    ViewData["Title"] = Html.T("إنشاء صفحة ترويجية", "Create landing page");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("الصفحات الترويجية", "Landing pages"), Url.Action("Index", "LandingPages")),
        (Html.T("إنشاء صفحة", "Create page"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@section Styles {
    <link rel="stylesheet" href="~/assets/vendors/css/editors/quill/quill.snow.css" />
}

@await Html.PartialAsync("_PageHeader")

<!-- Main Content -->
<div class="main-content">
    <form asp-action="Create" method="post">
        @Html.AntiForgeryToken()
        
        <div class="row">
            <div class="col-lg-8">
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("معلومات الصفحة", "Page information")</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <div class="col-12">
                                <label class="form-label" asp-for="Title">@Html.T("عنوان الصفحة", "Page title") <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" asp-for="Title" placeholder="@Html.T("مثال: عرض خاص - دورة تطوير الويب", "e.g. Special offer - Web development course")" required />
                                <span asp-validation-for="Title" class="text-danger"></span>
                            </div>

                            <div class="col-12">
                                <label class="form-label" asp-for="Description">@Html.T("الوصف", "Description")</label>
                                <textarea class="form-control" asp-for="Description" rows="4" placeholder="@Html.T("وصف مختصر عن محتوى الصفحة...", "Brief description of the page content...")"></textarea>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>

                            <div class="col-12">
                                <label class="form-label" asp-for="Slug">@Html.T("الرابط (Slug)", "Slug") <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text">/landing/</span>
                                    <input type="text" class="form-control" asp-for="Slug" placeholder="web-development-offer" required />
                                </div>
                                <span asp-validation-for="Slug" class="text-danger"></span>
                                <small class="text-muted">
                                    @Html.T("استخدم الأحرف الإنجليزية والأرقام والشرطات فقط. سيتم إنشاؤه تلقائياً من العنوان إذا تركته فارغاً.", "Use letters, numbers and hyphens only. Auto-generated from title if left empty.")
                                </small>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label" asp-for="TemplateId">@Html.T("القالب", "Template")</label>
                                <select class="form-select" asp-for="TemplateId">
                                    <option value="">@Html.T("بدون قالب", "No template")</option>
                                    @foreach (var template in ViewBag.Templates ?? new List<dynamic>())
                                    {
                                        <option value="@template.Id">@template.Name</option>
                                    }
                                </select>
                                <span asp-validation-for="TemplateId" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label" asp-for="Status">@Html.T("الحالة", "Status")</label>
                                <select class="form-select" asp-for="Status">
                                    <option value="Draft">@Html.T("مسودة", "Draft")</option>
                                    <option value="Published">@Html.T("منشورة", "Published")</option>
                                    <option value="Scheduled">@Html.T("مجدولة", "Scheduled")</option>
                                </select>
                                <span asp-validation-for="Status" class="text-danger"></span>
                            </div>

                            <div class="col-12">
                                <label class="form-label">@Html.T("محتوى الصفحة", "Page content")</label>
                                <div id="pageContentEditor" style="min-height: 300px;"></div>
                                <textarea asp-for="Content" class="d-none" id="pageContentInput"></textarea>
                                <span asp-validation-for="Content" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label" asp-for="MetaTitle">@Html.T("عنوان SEO", "SEO title")</label>
                                <input type="text" class="form-control" asp-for="MetaTitle" placeholder="@Html.T("عنوان لمحركات البحث", "Title for search engines")" />
                                <span asp-validation-for="MetaTitle" class="text-danger"></span>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label" asp-for="MetaKeywords">@Html.T("كلمات مفتاحية", "Keywords")</label>
                                <input type="text" class="form-control" asp-for="MetaKeywords" placeholder="@Html.T("كلمة1, كلمة2, كلمة3", "keyword1, keyword2, keyword3")" />
                                <span asp-validation-for="MetaKeywords" class="text-danger"></span>
                            </div>

                            <div class="col-12">
                                <label class="form-label" asp-for="MetaDescription">@Html.T("وصف SEO", "SEO description")</label>
                                <textarea class="form-control" asp-for="MetaDescription" rows="3" placeholder="@Html.T("وصف الصفحة لمحركات البحث...", "Page description for search engines...")"></textarea>
                                <span asp-validation-for="MetaDescription" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <!-- Settings -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("الإعدادات", "Settings")</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" asp-for="IsActive" id="isActive" checked />
                                <label class="form-check-label" for="isActive">@Html.T("صفحة نشطة", "Active page")</label>
                            </div>
                            <small class="text-muted">@Html.T("الصفحات النشطة يمكن الوصول إليها من قبل الزوار", "Active pages are accessible to visitors")</small>
                        </div>
                    </div>
                </div>

                <!-- Publishing -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("النشر", "Publishing")</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">@Html.T("تاريخ النشر", "Publish date")</label>
                            <input type="datetime-local" class="form-control" asp-for="PublishDate" />
                            <small class="text-muted">@Html.T("اترك فارغاً للنشر الفوري", "Leave empty for immediate publish")</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">@Html.T("تاريخ الانتهاء", "Expiry date")</label>
                            <input type="datetime-local" class="form-control" asp-for="ExpiryDate" />
                            <small class="text-muted">@Html.T("اترك فارغاً إذا لم يكن هناك تاريخ انتهاء", "Leave empty if no expiry")</small>
                        </div>
                    </div>
                </div>

                <!-- Featured Image -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("الصورة المميزة", "Featured image")</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label" asp-for="FeaturedImageUrl">@Html.T("رابط الصورة", "Image URL")</label>
                            <input type="url" class="form-control" asp-for="FeaturedImageUrl" placeholder="https://example.com/image.jpg" />
                            <span asp-validation-for="FeaturedImageUrl" class="text-danger"></span>
                        </div>
                        <div id="imagePreview" class="border rounded p-3 text-center d-none">
                            <img id="previewImg" src="" alt="Preview" class="img-fluid rounded" style="max-height: 200px;" />
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="card stretch stretch-full">
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-save me-2"></i>
                                حفظ الصفحة
                            </button>
                            <button type="button" class="btn btn-light-brand" id="previewBtn">
                                <i class="feather-eye me-2"></i>
                                معاينة
                            </button>
                            <a href="@Url.Action("Index", "LandingPages")" class="btn btn-light">
                                <i class="feather-x me-2"></i>
                                إلغاء
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="~/assets/vendors/js/editors/quill/quill.min.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize Quill editor
            var quill = new Quill('#pageContentEditor', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        [{ 'color': [] }, { 'background': [] }],
                        [{ 'align': [] }],
                        ['link', 'image', 'video'],
                        ['clean']
                    ]
                },
                placeholder: 'اكتب محتوى الصفحة هنا...'
            });

            // Sync editor content with hidden textarea
            quill.on('text-change', function() {
                $('#pageContentInput').val(quill.root.innerHTML);
            });

            // Auto-generate slug from title
            $('#Title').on('blur', function() {
                var slugInput = $('#Slug');
                if (!slugInput.val()) {
                    var slug = $(this).val()
                        .toLowerCase()
                        .replace(/\s+/g, '-')
                        .replace(/[^\w\-]+/g, '')
                        .replace(/\-\-+/g, '-')
                        .replace(/^-+/, '')
                        .replace(/-+$/, '');
                    slugInput.val(slug);
                }
            });

            // Image preview
            $('#FeaturedImageUrl').on('blur', function() {
                var url = $(this).val();
                if (url) {
                    $('#previewImg').attr('src', url);
                    $('#imagePreview').removeClass('d-none');
                } else {
                    $('#imagePreview').addClass('d-none');
                }
            });

            // Preview button
            $('#previewBtn').on('click', function() {
                alert('@Html.Raw(Html.T("المعاينة قيد التطوير", "Preview is under development").Replace("'", "\\'"))');
            });
        });
    </script>
}

