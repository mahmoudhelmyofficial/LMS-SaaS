@model LMS.Domain.Entities.Learning.LearningPath

@{
    ViewData["Title"] = Html.T("إحصائيات المسار التعليمي", "Learning path statistics");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("المسارات التعليمية", "Learning paths"), Url.Action("Index", "LearningPaths")),
        (Html.T("إحصائيات", "Statistics"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        (Html.T("العودة للتفاصيل", "Back to details"), "feather-arrow-right", Url.Action("Details", "LearningPaths", new { id = Model.Id }), "btn-light")
    };
    ViewData["HeaderActions"] = actions;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <!-- Statistics Cards -->
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-primary text-primary">
                            <i class="feather-users"></i>
                        </div>
                        <div>
                            <span class="text-muted">@Html.T("إجمالي التسجيلات", "Total enrollments")</span>
                            <h3 class="fw-bolder mb-0">@Model.EnrollmentCount.ToString("N0")</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-success text-success">
                            <i class="feather-dollar-sign"></i>
                        </div>
                        <div>
                            <span class="text-muted">@Html.T("إجمالي الإيرادات", "Total revenue")</span>
                            <h3 class="fw-bolder mb-0">@((Model.EnrollmentCount * (Model.Price ?? 0)).ToEGP())</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-warning text-warning">
                            <i class="feather-clock"></i>
                        </div>
                        <div>
                            <span class="text-muted">@Html.T("المدة التقديرية", "Estimated duration")</span>
                            <h3 class="fw-bolder mb-0">@Model.EstimatedHours ساعة</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div class="avatar-text avatar-xl rounded bg-soft-info text-info">
                            <i class="feather-book"></i>
                        </div>
                        <div>
                            <span class="text-muted">@Html.T("عدد الدورات", "Number of courses")</span>
                            <h3 class="fw-bolder mb-0">@Model.CoursesCount</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Path Details -->
        <div class="col-lg-8 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("معلومات المسار", "Path information")</h5>
                </div>
                <div class="card-body">
                    <h4 class="mb-3">@Model.Name</h4>
                    <p class="text-muted">@Model.Description</p>
                    
                    <div class="d-flex gap-3 mb-3">
                        <div>
                            <span class="text-muted d-block">@Html.T("المستوى", "Level")</span>
                            <span class="badge bg-soft-primary text-primary">@Model.Level</span>
                        </div>
                        <div>
                            <span class="text-muted d-block">@Html.T("السعر", "Price")</span>
                            @if (Model.Price.HasValue && Model.Price.Value > 0)
                            {
                                <span class="text-success fw-bold">@Model.Price.Value.ToEGP()</span>
                            }
                            else
                            {
                                <span class="badge bg-success">@Html.T("مجاني", "Free")</span>
                            }
                        </div>
                    </div>

                    @if (Model.Courses != null && Model.Courses.Any())
                    {
                        <h6 class="mt-4 mb-3">@Html.T("الدورات المضمنة:", "Included courses:")</h6>
                        <div class="list-group">
                            @foreach (var pathCourse in Model.Courses.OrderBy(c => c.DisplayOrder))
                            {
                                <div class="list-group-item d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center gap-3">
                                        <span class="badge bg-light text-muted">@pathCourse.DisplayOrder</span>
                                        <i class="feather-book text-primary"></i>
                                        <span>@(pathCourse.Course?.Title ?? "دورة")</span>
                                    </div>
                                    <span class="badge bg-soft-info text-info">@(pathCourse.Course?.Level.ToString() ?? "-")</span>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="col-lg-4 mb-4">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("حالة المسار", "Path status")</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="text-muted">@Html.T("الحالة", "Status")</label>
                        <div>
                            @if (Model.IsPublished)
                            {
                                <span class="badge bg-success">@Html.T("منشور", "Published")</span>
                            }
                            else
                            {
                                <span class="badge bg-secondary">@Html.T("مسودة", "Draft")</span>
                            }
                            @if (Model.IsFeatured)
                            {
                                <span class="badge bg-warning">@Html.T("مميز", "Featured")</span>
                            }
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="text-muted">@Html.T("تاريخ الإنشاء", "Created at")</label>
                        <div>@Model.CreatedAt.ToString("dd/MM/yyyy")</div>
                    </div>

                    @if (Model.UpdatedAt.HasValue)
                    {
                        <div class="mb-3">
                            <label class="text-muted">@Html.T("آخر تحديث", "Last updated")</label>
                            <div>@Model.UpdatedAt.Value.ToString("dd/MM/yyyy")</div>
                        </div>
                    }

                    <div class="mt-4">
                        <a href="@Url.Action("Edit", "LearningPaths", new { id = Model.Id })" class="btn btn-primary w-100">
                            <i class="feather-edit me-2"></i>
                            تعديل المسار
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
