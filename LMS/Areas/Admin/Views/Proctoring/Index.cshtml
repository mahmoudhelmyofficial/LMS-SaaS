@model List<LMS.Domain.Entities.Settings.PlatformSetting>
@{
    ViewData["Title"] = Html.T("مراقبة الاختبارات", "Proctoring");
    ViewData["Breadcrumbs"] = new List<(string Name, string Url)>
    {
        (Html.T("الإعدادات", "Settings"), Url.Action("Index", "Settings")),
        (Html.T("مراقبة الاختبارات", "Proctoring"), "")
    };
}

<div class="main-content">
    <!-- Stats Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="avatar avatar-lg bg-soft-primary rounded">
                                <i class="feather-help-circle fs-4 text-primary"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3 class="mb-0">@ViewBag.TotalQuizzes</h3>
                            <span class="text-muted fs-12">@Html.T("إجمالي الاختبارات", "Total quizzes")</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="avatar avatar-lg bg-soft-success rounded">
                                <i class="feather-eye fs-4 text-success"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3 class="mb-0">@ViewBag.ProctoredQuizzes</h3>
                            <span class="text-muted fs-12">@Html.T("اختبارات مراقبة", "Proctored quizzes")</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="avatar avatar-lg bg-soft-warning rounded">
                                <i class="feather-radio fs-4 text-warning"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3 class="mb-0">@ViewBag.ActiveExams</h3>
                            <span class="text-muted fs-12">@Html.T("اختبارات نشطة", "Active exams")</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0">
                            <div class="avatar avatar-lg bg-soft-info rounded">
                                <i class="feather-check-circle fs-4 text-info"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h3 class="mb-0">@ViewBag.CompletedExams</h3>
                            <span class="text-muted fs-12">@Html.T("اختبارات مكتملة", "Completed exams")</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <form asp-action="Save" method="post">
        @Html.AntiForgeryToken()
        
        <div class="row g-4">
            <!-- General Settings -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0"><i class="feather-settings me-2"></i>الإعدادات العامة</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-12">
                                <label class="form-label">مزود المراقبة</label>
                                @{
                                    var proctoringProvider = Model?.FirstOrDefault(s => s.Key == "ProctoringProvider")?.Value;
                                }
                                <select name="Provider" class="form-select">
                                    <option value="Internal" selected="@(proctoringProvider == "Internal" || proctoringProvider == null)">مراقبة داخلية</option>
                                    <option value="Proctorio" selected="@(proctoringProvider == "Proctorio")">Proctorio</option>
                                    <option value="ExamSoft" selected="@(proctoringProvider == "ExamSoft")">ExamSoft</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="IsEnabled" value="false" />
                                    <input type="checkbox" name="IsEnabled" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringEnabled")?.Value == "true" ? "checked" : "")>
                                    <label class="form-check-label">تفعيل المراقبة</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Browser Lockdown -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0"><i class="feather-monitor me-2"></i>قفل المتصفح</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="LockBrowser" value="false" />
                                    <input type="checkbox" name="LockBrowser" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringLockBrowser")?.Value != "false" ? "checked" : "")>
                                    <label class="form-check-label">قفل المتصفح</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="FullScreenRequired" value="false" />
                                    <input type="checkbox" name="FullScreenRequired" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringFullScreenRequired")?.Value != "false" ? "checked" : "")>
                                    <label class="form-check-label">ملء الشاشة</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="PreventCopyPaste" value="false" />
                                    <input type="checkbox" name="PreventCopyPaste" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringPreventCopyPaste")?.Value != "false" ? "checked" : "")>
                                    <label class="form-check-label">منع النسخ واللصق</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="PreventRightClick" value="false" />
                                    <input type="checkbox" name="PreventRightClick" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringPreventRightClick")?.Value != "false" ? "checked" : "")>
                                    <label class="form-check-label">منع النقر الأيمن</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="PreventScreenshot" value="false" />
                                    <input type="checkbox" name="PreventScreenshot" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringPreventScreenshot")?.Value != "false" ? "checked" : "")>
                                    <label class="form-check-label">منع لقطات الشاشة</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Webcam Monitoring -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0"><i class="feather-camera me-2"></i>مراقبة الكاميرا</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-12">
                                <label class="form-label">فاصل التقاط الصور (ثانية)</label>
                                <input type="number" name="PhotoIntervalSeconds" class="form-control" min="10" max="120"
                                       value="@(Model?.FirstOrDefault(s => s.Key == "ProctoringPhotoInterval")?.Value ?? "30")">
                            </div>
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="WebcamRequired" value="false" />
                                    <input type="checkbox" name="WebcamRequired" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringWebcamRequired")?.Value == "true" ? "checked" : "")>
                                    <label class="form-check-label">الكاميرا مطلوبة</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="RecordVideo" value="false" />
                                    <input type="checkbox" name="RecordVideo" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringRecordVideo")?.Value == "true" ? "checked" : "")>
                                    <label class="form-check-label">تسجيل الفيديو</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="FaceDetectionEnabled" value="false" />
                                    <input type="checkbox" name="FaceDetectionEnabled" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringFaceDetection")?.Value == "true" ? "checked" : "")>
                                    <label class="form-check-label">اكتشاف الوجه</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="MultipleFaceAlert" value="false" />
                                    <input type="checkbox" name="MultipleFaceAlert" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringMultipleFaceAlert")?.Value != "false" ? "checked" : "")>
                                    <label class="form-check-label">تنبيه وجوه متعددة</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Screen & Tab Monitoring -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0"><i class="feather-layout me-2"></i>مراقبة الشاشة</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-12">
                                <label class="form-label">الحد الأقصى لتبديل التبويبات</label>
                                <input type="number" name="MaxTabSwitches" class="form-control" min="0" max="10"
                                       value="@(Model?.FirstOrDefault(s => s.Key == "ProctoringMaxTabSwitches")?.Value ?? "3")">
                            </div>
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="ScreenShareRequired" value="false" />
                                    <input type="checkbox" name="ScreenShareRequired" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringScreenShare")?.Value == "true" ? "checked" : "")>
                                    <label class="form-check-label">مشاركة الشاشة</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="RecordScreen" value="false" />
                                    <input type="checkbox" name="RecordScreen" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringRecordScreen")?.Value == "true" ? "checked" : "")>
                                    <label class="form-check-label">تسجيل الشاشة</label>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="TabSwitchAlert" value="false" />
                                    <input type="checkbox" name="TabSwitchAlert" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringTabSwitchAlert")?.Value != "false" ? "checked" : "")>
                                    <label class="form-check-label">تنبيه عند تبديل التبويبات</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Violation Handling -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0"><i class="feather-alert-triangle me-2"></i>معالجة المخالفات</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-12">
                                <label class="form-label">حد المخالفات للإنهاء</label>
                                <input type="number" name="ViolationThreshold" class="form-control" min="1" max="20"
                                       value="@(Model?.FirstOrDefault(s => s.Key == "ProctoringViolationThreshold")?.Value ?? "5")">
                            </div>
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="AutoTerminateOnViolation" value="false" />
                                    <input type="checkbox" name="AutoTerminateOnViolation" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringAutoTerminate")?.Value == "true" ? "checked" : "")>
                                    <label class="form-check-label">إنهاء تلقائي</label>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="NotifyInstructorOnViolation" value="false" />
                                    <input type="checkbox" name="NotifyInstructorOnViolation" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringNotifyInstructor")?.Value != "false" ? "checked" : "")>
                                    <label class="form-check-label">إخطار المدرس</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Detection -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0"><i class="feather-cpu me-2"></i>الكشف بالذكاء الاصطناعي</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-12">
                                <label class="form-label">مستوى الحساسية</label>
                                @{
                                    var aiSensitivity = Model?.FirstOrDefault(s => s.Key == "ProctoringAiSensitivity")?.Value;
                                }
                                <select name="AiSensitivity" class="form-select">
                                    <option value="Low" selected="@(aiSensitivity == "Low")">منخفض</option>
                                    <option value="Medium" selected="@(aiSensitivity == "Medium" || aiSensitivity == null)">متوسط</option>
                                    <option value="High" selected="@(aiSensitivity == "High")">عالي</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <div class="form-check form-switch">
                                    <input type="hidden" name="AiDetectionEnabled" value="false" />
                                    <input type="checkbox" name="AiDetectionEnabled" value="true" class="form-check-input" 
                                           @(Model?.FirstOrDefault(s => s.Key == "ProctoringAiEnabled")?.Value == "true" ? "checked" : "")>
                                    <label class="form-check-label">تفعيل الكشف بالذكاء الاصطناعي</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4 d-flex gap-2">
            <button type="submit" class="btn btn-primary">
                <i class="feather-save me-2"></i>@Html.T("حفظ الإعدادات", "Save settings")
            </button>
            <a asp-action="ActiveExams" class="btn btn-outline-warning">
                <i class="feather-radio me-2"></i>الاختبارات النشطة
            </a>
            <a asp-action="Violations" class="btn btn-outline-danger">
                <i class="feather-alert-circle me-2"></i>سجل المخالفات
            </a>
            <a asp-action="Reports" class="btn btn-outline-info">
                <i class="feather-bar-chart-2 me-2"></i>التقارير
            </a>
        </div>
    </form>
</div>

