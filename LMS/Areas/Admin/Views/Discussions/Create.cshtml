@model LMS.Areas.Admin.ViewModels.DiscussionCreateViewModel

@{
    ViewData["Title"] = Html.T("إنشاء مناقشة جديدة", "Create new discussion");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("التواصل الاجتماعي", "Social"), null),
        (Html.T("المناقشات", "Discussions"), Url.Action("Index", "Discussions")),
        (Html.T("إنشاء مناقشة", "Create discussion"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@section Styles {
    <link rel="stylesheet" href="~/assets/vendors/css/select2.min.css" />
    <link rel="stylesheet" href="~/assets/vendors/css/select2-bootstrap-5-theme.min.css" />
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <form asp-action="Create" method="post">
        @Html.AntiForgeryToken()
        <div class="row">
            <div class="col-lg-8">
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("تفاصيل المناقشة", "Discussion details")</h5>
                    </div>
                    <div class="card-body">
                        <!-- Title -->
                        <div class="mb-4">
                            <label class="form-label" asp-for="Title">@Html.T("عنوان المناقشة", "Discussion title") <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" asp-for="Title" placeholder="@Html.T("أدخل عنوان المناقشة", "Enter discussion title")" required />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>

                        <!-- Content -->
                        <div class="mb-4">
                            <label class="form-label" asp-for="Content">@Html.T("المحتوى", "Content") <span class="text-danger">*</span></label>
                            <textarea class="form-control" asp-for="Content" rows="8" placeholder="@Html.T("اكتب محتوى المناقشة هنا...", "Write the discussion content here...")" required></textarea>
                            <span asp-validation-for="Content" class="text-danger"></span>
                        </div>

                        <!-- Course -->
                        <div class="mb-4">
                            <label class="form-label" asp-for="CourseId">@Html.T("الدورة", "Course") <span class="text-danger">*</span></label>
                            <select class="form-select" asp-for="CourseId" asp-items="@ViewBag.Courses" required>
                                <option value="">-- @Html.T("اختر الدورة", "Select course") --</option>
                            </select>
                            <span asp-validation-for="CourseId" class="text-danger"></span>
                        </div>

                        <!-- Lesson -->
                        <div class="mb-4">
                            <label class="form-label" asp-for="LessonId">@Html.T("الدرس (اختياري)", "Lesson (optional)")</label>
                            <select class="form-select" asp-for="LessonId" asp-items="@ViewBag.Lessons">
                                <option value="">-- @Html.T("اختر الدرس", "Select lesson") --</option>
                            </select>
                            <span asp-validation-for="LessonId" class="text-danger"></span>
                            <small class="text-muted">@Html.T("اترك فارغاً للمناقشة العامة للدورة", "Leave empty for general course discussion")</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="card-title">@Html.T("خيارات المناقشة", "Discussion options")</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input type="checkbox" class="form-check-input" asp-for="IsPinned" />
                                <label class="form-check-label" asp-for="IsPinned">
                                    <i class="feather-star text-warning me-1"></i>
                                    تثبيت المناقشة
                                </label>
                            </div>
                            <small class="text-muted">@Html.T("المناقشات المثبتة تظهر في أعلى القائمة", "Pinned discussions appear at the top of the list")</small>
                        </div>
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input type="checkbox" class="form-check-input" asp-for="IsLocked" />
                                <label class="form-check-label" asp-for="IsLocked">
                                    <i class="feather-lock text-danger me-1"></i>
                                    قفل المناقشة
                                </label>
                            </div>
                            <small class="text-muted">@Html.T("منع إضافة ردود جديدة", "Prevent adding new replies")</small>
                        </div>
                    </div>
                </div>

                <div class="card stretch stretch-full">
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-plus me-2"></i>
                                إنشاء المناقشة
                            </button>
                            <a asp-action="Index" class="btn btn-light">
                                <i class="feather-x me-2"></i>
                                إلغاء
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script src="~/assets/vendors/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            // When course changes, load lessons
            $('#CourseId').on('change', function() {
                var courseId = $(this).val();
                var lessonSelect = $('#LessonId');
                
                lessonSelect.empty();
                lessonSelect.append('<option value="">-- @Html.T("اختر الدرس", "Select lesson") --</option>');
                
                if (courseId) {
                    $.ajax({
                        url: '/Admin/Courses/GetLessons',
                        data: { courseId: courseId },
                        success: function(data) {
                            $.each(data, function(i, lesson) {
                                lessonSelect.append($('<option></option>').val(lesson.id).text(lesson.title));
                            });
                        }
                    });
                }
            });
        });
    </script>
}

