@{
    ViewData["Title"] = "نتائج البحث";
    var query = ViewBag.SearchQuery as string ?? "";
}

@await Html.PartialAsync("_HelpStyles")

<!-- Page Header -->
<div class="page-header">
    <div class="page-header-left d-flex align-items-center">
        <div class="page-header-title">
            <h5 class="m-0">نتائج البحث</h5>
        </div>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="Dashboard" asp-action="Index">الرئيسية</a></li>
            <li class="breadcrumb-item"><a asp-action="Index">مركز المساعدة</a></li>
            <li class="breadcrumb-item active">نتائج البحث</li>
        </ol>
    </div>
</div>

<div class="row">
    <div class="col-lg-3 mb-4">
        @await Html.PartialAsync("_HelpSidebar", "Search")
    </div>
    
    <div class="col-lg-9">
        <!-- Search Box -->
        <div class="help-section">
            <div class="help-search" style="max-width: 100%;">
                <form asp-action="Search" method="get" style="position: relative;">
                    <input type="text" name="query" value="@query" 
                           placeholder="ابحث عن موضوع..." 
                           class="form-control form-control-lg" 
                           style="padding-right: 3rem; border-radius: 12px;" />
                    <button type="submit" class="btn btn-link" 
                            style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%);">
                        <i class="feather-search text-muted"></i>
                    </button>
                </form>
            </div>
        </div>
        
        @if (!string.IsNullOrEmpty(query))
        {
            <div class="help-section">
                <h4 class="mb-4">نتائج البحث عن: "@query"</h4>
                
                @{
                    var queryLower = query.ToLower();
                    var results = new List<(string Title, string Description, string Action, string Icon, string Color)>();
                    
                    // Search in all topics
                    if (queryLower.Contains("مستخدم") || queryLower.Contains("طالب") || queryLower.Contains("مدرس") || queryLower.Contains("user"))
                    {
                        results.Add(("إدارة المستخدمين", "إضافة وتعديل المستخدمين والطلاب والمدرسين", "UserManagement", "users", "green"));
                    }
                    if (queryLower.Contains("دورة") || queryLower.Contains("تصنيف") || queryLower.Contains("محتوى") || queryLower.Contains("course"))
                    {
                        results.Add(("إدارة الدورات", "مراجعة الدورات والتصنيفات", "CourseManagement", "book", "purple"));
                    }
                    if (queryLower.Contains("دفع") || queryLower.Contains("سحب") || queryLower.Contains("مال") || queryLower.Contains("عمولة") || queryLower.Contains("payment"))
                    {
                        results.Add(("الإدارة المالية", "المدفوعات والسحوبات والعمولات", "FinancialManagement", "dollar-sign", "orange"));
                    }
                    if (queryLower.Contains("كوبون") || queryLower.Contains("عرض") || queryLower.Contains("تسويق") || queryLower.Contains("إعلان"))
                    {
                        results.Add(("أدوات التسويق", "الكوبونات والعروض والإعلانات", "MarketingTools", "trending-up", "red"));
                    }
                    if (queryLower.Contains("تقرير") || queryLower.Contains("إحصائ") || queryLower.Contains("تحليل") || queryLower.Contains("report"))
                    {
                        results.Add(("التقارير والتحليلات", "جميع التقارير والإحصائيات", "ReportsAnalytics", "bar-chart-2", "teal"));
                    }
                    if (queryLower.Contains("بريد") || queryLower.Contains("رسالة") || queryLower.Contains("إشعار") || queryLower.Contains("email"))
                    {
                        results.Add(("الاتصالات", "البريد والرسائل والإشعارات", "Communications", "mail", "indigo"));
                    }
                    if (queryLower.Contains("إعداد") || queryLower.Contains("setting") || queryLower.Contains("شعار") || queryLower.Contains("seo"))
                    {
                        results.Add(("إعدادات المنصة", "جميع إعدادات المنصة", "PlatformSettings", "settings", "slate"));
                    }
                    if (queryLower.Contains("أمان") || queryLower.Contains("سجل") || queryLower.Contains("دخول") || queryLower.Contains("خطأ") || queryLower.Contains("security"))
                    {
                        results.Add(("الأمان والمراقبة", "الأمان والسجلات والمراقبة", "SecurityMonitoring", "shield", "amber"));
                    }
                    if (queryLower.Contains("بداية") || queryLower.Contains("start") || queryLower.Contains("جولة"))
                    {
                        results.Add(("دليل البدء السريع", "تعرف على لوحة التحكم", "GettingStarted", "play-circle", "blue"));
                    }
                    
                    // If no specific results, show general topics
                    if (!results.Any())
                    {
                        results.Add(("دليل البدء السريع", "تعرف على لوحة التحكم", "GettingStarted", "play-circle", "blue"));
                        results.Add(("إدارة المستخدمين", "إضافة وتعديل المستخدمين", "UserManagement", "users", "green"));
                        results.Add(("الأسئلة الشائعة", "إجابات على الأسئلة المتكررة", "FAQ", "help-circle", "pink"));
                    }
                }
                
                <div class="row g-3">
                    @foreach (var result in results)
                    {
                        <div class="col-md-6">
                            <a asp-action="@result.Action" class="d-block p-4 bg-light rounded-3 text-decoration-none text-dark hover-shadow" 
                               style="transition: all 0.2s ease;">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="flex-shrink-0">
                                        <div class="feature-icon @result.Color" style="width: 48px; height: 48px; font-size: 18px;">
                                            <i class="feather-@result.Icon"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">@result.Title</h6>
                                        <p class="mb-0 text-muted small">@result.Description</p>
                                    </div>
                                </div>
                            </a>
                        </div>
                    }
                </div>
            </div>
        }
        else
        {
            <div class="help-section text-center py-5">
                <i class="feather-search text-muted" style="font-size: 4rem;"></i>
                <h4 class="mt-3">ابحث عن موضوع</h4>
                <p class="text-muted">اكتب كلمة البحث في المربع أعلاه</p>
            </div>
        }
        
        <!-- Popular Topics -->
        <div class="help-section">
            <h5 class="mb-3"><i class="feather-trending-up text-primary me-2"></i> المواضيع الأكثر بحثاً</h5>
            <div class="d-flex flex-wrap gap-2">
                <a asp-action="Search" asp-route-query="إضافة مستخدم" class="btn btn-outline-secondary btn-sm">إضافة مستخدم</a>
                <a asp-action="Search" asp-route-query="طلبات السحب" class="btn btn-outline-secondary btn-sm">طلبات السحب</a>
                <a asp-action="Search" asp-route-query="موافقة دورة" class="btn btn-outline-secondary btn-sm">موافقة دورة</a>
                <a asp-action="Search" asp-route-query="إعدادات البريد" class="btn btn-outline-secondary btn-sm">إعدادات البريد</a>
                <a asp-action="Search" asp-route-query="كوبون خصم" class="btn btn-outline-secondary btn-sm">كوبون خصم</a>
                <a asp-action="Search" asp-route-query="تقرير مبيعات" class="btn btn-outline-secondary btn-sm">تقرير مبيعات</a>
            </div>
        </div>
    </div>
</div>

<style>
    .hover-shadow:hover {
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }
</style>

