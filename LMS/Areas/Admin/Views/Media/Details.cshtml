@model LMS.Domain.Entities.Content.Media

@{
    ViewData["Title"] = Html.T("ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù„Ù", "File details");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("Ù…ÙƒØªØ¨Ø© Ø§Ù„ÙˆØ³Ø§Ø¦Ø·", "Media library"), Url.Action("Index", "Media")),
        (Html.T("ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù„Ù", "File details"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
    var actions = new List<(string Text, string Icon, string Url, string? CssClass)>
    {
        ("ØªØ­Ù…ÙŠÙ„", "feather-download", Model.Url, "btn-primary"),
        ("Ø­Ø°Ù", "feather-trash-2", "javascript:void(0)", "btn-danger delete-btn")
    };
    ViewData["HeaderActions"] = actions;
}

@section Styles {
    <style>
        .media-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .media-preview {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .media-preview img {
            max-width: 100%;
            max-height: 500px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .media-preview video {
            max-width: 100%;
            max-height: 500px;
            border-radius: 8px;
        }
        .media-preview audio {
            width: 100%;
        }
        .file-icon {
            font-size: 120px;
            opacity: 0.5;
        }
        .stats-box {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .stats-box:hover {
            transform: translateY(-5px);
        }
        .info-badge {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }
        .usage-item {
            padding: 12px;
            border-radius: 6px;
            background: #f8f9fa;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        .usage-item:hover {
            background: #e9ecef;
        }
    </style>
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <!-- Media Header -->
    <div class="media-header">
        <div class="d-flex align-items-start justify-content-between mb-3">
            <div class="flex-grow-1">
                <div class="d-flex align-items-center gap-2 mb-3">
                    <span class="badge bg-white text-primary">@Model.FileType</span>
                    <span class="badge bg-white text-dark">@Model.MimeType</span>
                    @if (Model.IsPublic)
                    {
                        <span class="badge bg-success">
                            <i class="feather-globe"></i>
                            Ø¹Ø§Ù…
                        </span>
                    }
                    else
                    {
                        <span class="badge bg-warning">
                            <i class="feather-lock"></i>
                            Ø®Ø§Øµ
                        </span>
                    }
                </div>
                <h2 class="text-white mb-2">@Model.FileName</h2>
                @if (!string.IsNullOrEmpty(Model.Title))
                {
                    <p class="text-white-50 mb-0">@Model.Title</p>
                }
            </div>
        </div>
        <div class="row g-3 text-white">
            <div class="col-md-3">
                <small class="text-white-50 d-block">Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù</small>
                <div class="d-flex align-items-center gap-2">
                    <i class="feather-hard-drive"></i>
                    <span class="fw-semibold">@((Model.FileSize / 1024.0 / 1024.0).ToString("F2")) MB</span>
                </div>
            </div>
            <div class="col-md-3">
                <small class="text-white-50 d-block">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</small>
                <div class="d-flex align-items-center gap-2">
                    <i class="feather-eye"></i>
                    <span class="fw-semibold">@Model.ViewCount</span>
                </div>
            </div>
            <div class="col-md-3">
                <small class="text-white-50 d-block">Ø¹Ø¯Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª</small>
                <div class="d-flex align-items-center gap-2">
                    <i class="feather-download"></i>
                    <span class="fw-semibold">@Model.DownloadCount</span>
                </div>
            </div>
            <div class="col-md-3">
                <small class="text-white-50 d-block">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±ÙØ¹</small>
                <div class="d-flex align-items-center gap-2">
                    <i class="feather-calendar"></i>
                    <span class="fw-semibold">@Model.CreatedAt.ToString("dd/MM/yyyy")</span>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Media Preview -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-image me-2"></i>
                        Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù
                    </h5>
                    <div class="card-header-action">
                        <a href="@Model.Url" class="btn btn-sm btn-primary" download>
                            <i class="feather-download me-2"></i>
                            ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="media-preview">
                        @if (Model.FileType == "Image")
                        {
                            <img src="@Model.Url" alt="@Model.FileName" />
                        }
                        else if (Model.FileType == "Video")
                        {
                            <video controls>
                                <source src="@Model.Url" type="@Model.MimeType">
                                Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                            </video>
                        }
                        else if (Model.FileType == "Audio")
                        {
                            <audio controls>
                                <source src="@Model.Url" type="@Model.MimeType">
                                Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
                            </audio>
                        }
                        else if (Model.FileType == "PDF")
                        {
                            <iframe src="@Model.Url" style="width: 100%; height: 600px; border: none;"></iframe>
                        }
                        else
                        {
                            <div class="text-center">
                                <div class="file-icon">ğŸ“„</div>
                                <h5 class="mt-3">@Model.FileName</h5>
                                <p class="text-muted">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù…Ø¹Ø§ÙŠÙ†Ø© Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª</p>
                                <a href="@Model.Url" class="btn btn-primary" download>
                                    <i class="feather-download me-2"></i>
                                    ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                                </a>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- File Information -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-info me-2"></i>
                        Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <small class="text-muted d-block mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù</small>
                            <code class="info-badge">@Model.FileName</code>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted d-block mb-1">Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯</small>
                            <code class="info-badge">@Model.Extension</code>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted d-block mb-1">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù</small>
                            <span class="badge bg-soft-primary text-primary">@Model.FileType</span>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted d-block mb-1">@Html.T("Ù†ÙˆØ¹ MIME", "MIME Type")</small>
                            <code class="info-badge">@Model.MimeType</code>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted d-block mb-1">Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù</small>
                            <span class="fw-semibold">@((Model.FileSize / 1024.0 / 1024.0).ToString("F2")) MB</span>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted d-block mb-1">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù</small>
                            <a href="@Model.Url" target="_blank" class="text-break">
                                <i class="feather-external-link me-1"></i>
                                ÙØªØ­ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
                            </a>
                        </div>
                        @if (Model.FileType == "Image" && Model.Width.HasValue && Model.Height.HasValue)
                        {
                            <div class="col-md-6">
                                <small class="text-muted d-block mb-1">Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯</small>
                                <span class="fw-semibold">@Model.Width Ã— @Model.Height Ø¨ÙƒØ³Ù„</span>
                            </div>
                        }
                        @if (Model.FileType == "Video" && Model.Duration != TimeSpan.Zero)
                        {
                            <div class="col-md-6">
                                <small class="text-muted d-block mb-1">Ø§Ù„Ù…Ø¯Ø©</small>
                                <span class="fw-semibold">@Model.Duration?.ToString(@"hh\:mm\:ss")</span>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(Model.AltText))
                        {
                            <div class="col-12">
                                <small class="text-muted d-block mb-1">Ø§Ù„Ù†Øµ Ø§Ù„Ø¨Ø¯ÙŠÙ„</small>
                                <p class="mb-0">@Model.AltText</p>
                            </div>
                        }
                        @if (!string.IsNullOrEmpty(Model.Description))
                        {
                            <div class="col-12">
                                <small class="text-muted d-block mb-1">Ø§Ù„ÙˆØµÙ</small>
                                <p class="mb-0">@Model.Description</p>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Usage in System -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-link me-2"></i>
                        Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
                    </h5>
                </div>
                <div class="card-body">
                    <div id="usageContainer">
                        <div class="text-center text-muted py-4">
                            <i class="feather-loader fs-3 mb-2"></i>
                            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timeline -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-clock me-2"></i>
                        Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø²Ù…Ù†ÙŠ
                    </h5>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-marker bg-success"></div>
                            <div class="timeline-content">
                                <h6 class="mb-1">ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù</h6>
                                <p class="text-muted mb-1">@Model.CreatedAt.ToString("dd/MM/yyyy hh:mm tt")</p>
                                @if (Model.CreatedBy != null)
                                {
                                    <small class="text-muted">
                                        Ø¨ÙˆØ§Ø³Ø·Ø©: @Model.CreatedBy
                                    </small>
                                }
                            </div>
                        </div>
                        @if (Model.UpdatedAt.HasValue)
                        {
                            <div class="timeline-item">
                                <div class="timeline-marker bg-primary"></div>
                                <div class="timeline-content">
                                    <h6 class="mb-1">ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù</h6>
                                    <p class="text-muted mb-0">@Model.UpdatedAt.Value.ToString("dd/MM/yyyy hh:mm tt")</p>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Statistics -->
            <div class="row g-3 mb-4">
                <div class="col-6">
                    <div class="stats-box">
                        <div class="avatar-text bg-soft-primary text-primary mb-2">
                            <i class="feather-eye"></i>
                        </div>
                        <h3 class="mb-1">@Model.ViewCount</h3>
                        <small class="text-muted">Ù…Ø´Ø§Ù‡Ø¯Ø©</small>
                    </div>
                </div>
                <div class="col-6">
                    <div class="stats-box">
                        <div class="avatar-text bg-soft-success text-success mb-2">
                            <i class="feather-download"></i>
                        </div>
                        <h3 class="mb-1">@Model.DownloadCount</h3>
                        <small class="text-muted">ØªØ­Ù…ÙŠÙ„</small>
                    </div>
                </div>
            </div>

            <!-- Quick Info -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-info me-2"></i>
                        Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©
                    </h5>
                </div>
                <div class="card-body">
                    <div class="vstack gap-3">
                        <div>
                            <small class="text-muted d-block mb-1">Ø§Ù„Ø­Ø§Ù„Ø©</small>
                            @if (Model.IsPublic)
                            {
                                <span class="badge bg-soft-success text-success">Ø¹Ø§Ù…</span>
                            }
                            else
                            {
                                <span class="badge bg-soft-warning text-warning">Ø®Ø§Øµ</span>
                            }
                        </div>
                        <div>
                            <small class="text-muted d-block mb-1">Ø§Ù„Ù…Ø¬Ù„Ø¯</small>
                            <span class="fw-semibold">@(string.IsNullOrEmpty(Model.Folder) ? "Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ" : Model.Folder)</span>
                        </div>
                        @if (!string.IsNullOrEmpty(Model.StorageProvider))
                        {
                            <div>
                                <small class="text-muted d-block mb-1">Ù…Ø²ÙˆØ¯ Ø§Ù„ØªØ®Ø²ÙŠÙ†</small>
                                <span class="fw-semibold">@Model.StorageProvider</span>
                            </div>
                        }
                        <div>
                            <small class="text-muted d-block mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±ÙØ¹</small>
                            <span class="fw-semibold">@Model.CreatedAt.ToString("dd/MM/yyyy")</span>
                        </div>
                        @if (Model.UpdatedAt.HasValue)
                        {
                            <div>
                                <small class="text-muted d-block mb-1">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</small>
                                <span class="fw-semibold">@Model.UpdatedAt.Value.ToString("dd/MM/yyyy")</span>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-zap me-2"></i>
                        @Html.T("Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©", "Quick actions")
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="@Model.Url" class="btn btn-light-brand" download>
                            <i class="feather-download me-2"></i>
                            ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                        </a>
                        <button type="button" class="btn btn-light-brand" id="copyUrlBtn">
                            <i class="feather-copy me-2"></i>
                            Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù
                        </button>
                        <button type="button" class="btn btn-light-brand" id="shareBtn">
                            <i class="feather-share-2 me-2"></i>
                            Ù…Ø´Ø§Ø±ÙƒØ©
                        </button>
                        @if (Model.FileType == "Image")
                        {
                            <button type="button" class="btn btn-light-brand" id="editImageBtn">
                                <i class="feather-edit me-2"></i>
                                ØªØ­Ø±ÙŠØ± Ø§Ù„ØµÙˆØ±Ø©
                            </button>
                        }
                        <hr>
                        <button type="button" class="btn btn-danger delete-btn">
                            <i class="feather-trash-2 me-2"></i>
                            Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tags -->
            @if (Model.Tags != null && Model.Tags.Any())
            {
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="feather-tag me-2"></i>
                            Ø§Ù„ÙˆØ³ÙˆÙ…
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-wrap gap-2">
                            @foreach (var tag in Model.Tags)
                            {
                                <span class="badge bg-soft-primary text-primary">@tag</span>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<!-- Delete Confirmation Form -->
<form asp-action="Delete" asp-route-id="@Model.Id" method="post" id="deleteForm">
    @Html.AntiForgeryToken()
</form>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Copy URL functionality
            $('#copyUrlBtn').click(function() {
                const url = '@Model.Url';
                navigator.clipboard.writeText(url).then(function() {
                    const btn = $('#copyUrlBtn');
                    const originalText = btn.html();
                    btn.html('<i class="feather-check me-2"></i>ØªÙ… Ø§Ù„Ù†Ø³Ø®!');
                    btn.addClass('btn-success').removeClass('btn-light-brand');
                    setTimeout(function() {
                        btn.html(originalText);
                        btn.removeClass('btn-success').addClass('btn-light-brand');
                    }, 2000);
                });
            });

            // Delete confirmation
            $('.delete-btn').click(function() {
                if (confirm('@Html.Raw(Html.T("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.", "Are you sure you want to delete this file? This action cannot be undone.").Replace("'", "\\'"))')) {
                    $('#deleteForm').submit();
                }
            });

            // Load usage data
            $.ajax({
                url: '@Url.Action("GetMediaUsage", "Media", new { id = Model.Id })',
                type: 'GET',
                success: function(data) {
                    const container = $('#usageContainer');
                    if (data && data.length > 0) {
                        container.empty();
                        data.forEach(function(usage) {
                            container.append(`
                                <div class="usage-item">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div>
                                            <h6 class="mb-1">${usage.title}</h6>
                                            <small class="text-muted">${usage.type}</small>
                                        </div>
                                        <a href="${usage.url}" class="btn btn-sm btn-light-brand">
                                            <i class="feather-external-link"></i>
                                        </a>
                                    </div>
                                </div>
                            `);
                        });
                    } else {
                        container.html(`
                            <div class="text-center text-muted py-4">
                                <i class="feather-inbox fs-3 mb-2"></i>
                                <p>Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                            </div>
                        `);
                    }
                },
                error: function() {
                    $('#usageContainer').html(`
                        <div class="alert alert-warning mb-0">
                            <i class="feather-alert-triangle me-2"></i>
                            ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
                        </div>
                    `);
                }
            });
        });
    </script>

    <style>
        .timeline {
            position: relative;
            padding-right: 30px;
        }
        .timeline-item {
            position: relative;
            padding-bottom: 25px;
        }
        .timeline-marker {
            position: absolute;
            right: -36px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .timeline-item:before {
            content: '';
            position: absolute;
            right: -31px;
            top: 17px;
            width: 2px;
            height: calc(100% - 5px);
            background: #e5e7eb;
        }
        .timeline-item:last-child:before {
            display: none;
        }
    </style>
}

