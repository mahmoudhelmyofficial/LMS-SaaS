@model LMS.Domain.Entities.LiveSessions.LiveClass

@{
    ViewData["Title"] = Html.T("تعديل الحصة المباشرة", "Edit live class");
    var breadcrumbs = new List<(string Name, string? Url)>
    {
        (Html.T("البث المباشر", "Live classes"), Url.Action("Index", "LiveClasses")),
        (Html.T("تعديل الحصة", "Edit class"), null)
    };
    ViewData["Breadcrumbs"] = breadcrumbs;
}

@await Html.PartialAsync("_PageHeader")

<div class="main-content">
    <div class="row">
        <div class="col-lg-8">
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="feather-edit text-primary me-2"></i>
                        @Html.T("تعديل الحصة المباشرة", "Edit live class")
                    </h5>
                </div>
                <div class="card-body">
                    <form asp-action="Edit" asp-controller="LiveClasses" method="post">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="id" value="@Model.Id" />
                        
                        <div class="mb-3">
                            <label class="form-label">@Html.T("الدورة", "Course")</label>
                            <input type="text" class="form-control" value="@Model.Course?.Title" disabled />
                            <small class="text-muted">@Html.T("لا يمكن تغيير الدورة المرتبطة", "The linked course cannot be changed")</small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">@Html.T("عنوان الحصة", "Session title") <span class="text-danger">*</span></label>
                            <input type="text" name="title" class="form-control" value="@Model.Title" required 
                                   placeholder="@Html.T("أدخل عنوان الحصة", "Enter session title")" />
                        </div>

                        <div class="mb-3">
                            <label class="form-label">@Html.T("الوصف", "Description")</label>
                            <textarea name="description" class="form-control" rows="3" 
                                      placeholder="@Html.T("وصف مختصر للحصة", "Brief description of the session")">@Model.Description</textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">@Html.T("وقت البدء", "Start time") <span class="text-danger">*</span></label>
                                    <input type="datetime-local" name="scheduledStartTime" class="form-control" 
                                           value="@Model.ScheduledStartTime.ToString("yyyy-MM-ddTHH:mm")" required />
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">@Html.T("وقت الانتهاء", "End time") <span class="text-danger">*</span></label>
                                    <input type="datetime-local" name="scheduledEndTime" class="form-control" 
                                           value="@Model.ScheduledEndTime.ToString("yyyy-MM-ddTHH:mm")" required />
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">@Html.T("رابط الاجتماع", "Meeting link")</label>
                            <input type="url" name="meetingUrl" class="form-control" value="@Model.MeetingUrl" 
                                   placeholder="@Html.T("مثال: https://zoom.us/j/...", "e.g. https://zoom.us/j/...")" />
                            <small class="text-muted">@Html.T("اتركه فارغاً للاحتفاظ بالرابط الحالي", "Leave empty to keep current link")</small>
                        </div>

                        <div class="d-flex gap-2 mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-save me-2"></i>
                                @Html.T("حفظ التغييرات", "Save changes")
                            </button>
                            <a href="@Url.Action("Details", "LiveClasses", new { id = Model.Id })" class="btn btn-light">
                                @Html.T("إلغاء", "Cancel")
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Current Status -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("معلومات الحصة", "Session information")</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">@Html.T("الحالة", "Status")</label>
                        <div>
                            @switch (Model.Status)
                            {
                                case LMS.Domain.Enums.LiveClassStatus.Scheduled:
                                    <span class="badge bg-soft-warning text-warning">@Html.T("مجدولة", "Scheduled")</span>
                                    break;
                                case LMS.Domain.Enums.LiveClassStatus.Live:
                                    <span class="badge bg-soft-danger text-danger">@Html.T("مباشر الآن", "Live now")</span>
                                    break;
                                case LMS.Domain.Enums.LiveClassStatus.Completed:
                                    <span class="badge bg-soft-success text-success">@Html.T("مكتملة", "Completed")</span>
                                    break;
                                case LMS.Domain.Enums.LiveClassStatus.Cancelled:
                                    <span class="badge bg-soft-secondary text-secondary">@Html.T("ملغية", "Cancelled")</span>
                                    break;
                            }
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">@Html.T("المنصة", "Platform")</label>
                        <div>@Model.Platform</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">@Html.T("المدة", "Duration")</label>
                        <div>@Model.DurationMinutes @Html.T("دقيقة", "min")</div>
                    </div>

                    @if (Model.RegisteredCount > 0)
                    {
                        <div class="mb-3">
                            <label class="form-label">@Html.T("المسجلين", "Registered")</label>
                            <div>@Model.RegisteredCount @Html.T("مشارك", "participant(s)")</div>
                        </div>
                    }

                    <div class="mb-3">
                        <label class="form-label">@Html.T("تاريخ الإنشاء", "Created at")</label>
                        <div>@Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card stretch stretch-full">
                <div class="card-header">
                    <h5 class="card-title">@Html.T("إجراءات سريعة", "Quick actions")</h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <a href="@Url.Action("Details", "LiveClasses", new { id = Model.Id })" class="list-group-item list-group-item-action">
                            <i class="feather-eye me-3"></i>
                            @Html.T("عرض التفاصيل", "View details")
                        </a>
                        @if (Model.Status == LMS.Domain.Enums.LiveClassStatus.Scheduled)
                        {
                            <form asp-action="StartNow" asp-controller="LiveClasses" asp-route-id="@Model.Id" method="post" class="d-inline w-100">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="list-group-item list-group-item-action text-success border-0 bg-transparent text-start w-100">
                                    <i class="feather-play me-3"></i>
                                    @Html.T("بدء الحصة الآن", "Start session now")
                                </button>
                            </form>
                        }
                        <a href="@Url.Action("Index", "LiveClasses")" class="list-group-item list-group-item-action">
                            <i class="feather-list me-3"></i>
                            @Html.T("العودة للقائمة", "Back to list")
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
