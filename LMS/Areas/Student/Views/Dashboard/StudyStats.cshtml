@model StudyStatsViewModel
@{
    ViewData["Title"] = Html.T("Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø©", "Study Statistics");
}

@section Styles {
<style>
    .stats-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        height: 100%;
    }
    .streak-card {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
        border-radius: 12px;
        padding: 30px;
        text-align: center;
    }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<!-- Header -->
<div class="card stretch stretch-full mb-4">
    <div class="card-body">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h3 class="fw-bold mb-2">
                    <i class="feather-bar-chart text-primary me-2"></i>
                    @Html.T("Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø©", "Study Statistics")
                </h3>
                <p class="text-muted mb-0">@Html.T("ØªØ­Ù„ÙŠÙ„ Ù†Ø´Ø§Ø·Ùƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù„Ø¢Ø®Ø±", "Analysis of your study activity for the last") @Model.Days @Html.T("ÙŠÙˆÙ…", "days")</p>
            </div>
            <div class="btn-group">
                <a asp-action="StudyStats" asp-route-days="7" class="btn @(Model.Days == 7 ? "btn-primary" : "btn-outline-primary")">
                    @Html.T("7 Ø£ÙŠØ§Ù…", "7 Days")
                </a>
                <a asp-action="StudyStats" asp-route-days="30" class="btn @(Model.Days == 30 ? "btn-primary" : "btn-outline-primary")">
                    @Html.T("30 ÙŠÙˆÙ…", "30 Days")
                </a>
                <a asp-action="StudyStats" asp-route-days="90" class="btn @(Model.Days == 90 ? "btn-primary" : "btn-outline-primary")">
                    @Html.T("90 ÙŠÙˆÙ…", "90 Days")
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Summary Cards -->
<div class="row g-4 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="stats-card">
            <div class="text-center">
                <div style="font-size: 48px; margin-bottom: 12px;">â±ï¸</div>
                <h3 class="fw-bold mb-1">@Model.TotalMinutes</h3>
                <p class="text-muted mb-0">@Html.T("Ø¯Ù‚ÙŠÙ‚Ø© Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©", "Total Minutes")</p>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stats-card">
            <div class="text-center">
                <div style="font-size: 48px; margin-bottom: 12px;">ğŸ“Š</div>
                <h3 class="fw-bold mb-1">@(Model.AverageMinutesPerDay.ToString("F1"))</h3>
                <p class="text-muted mb-0">@Html.T("Ù…ØªÙˆØ³Ø· Ø¯Ù‚ÙŠÙ‚Ø©/ÙŠÙˆÙ…", "Average Min/Day")</p>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="streak-card">
            <div style="font-size: 48px; margin-bottom: 12px;">ğŸ”¥</div>
            <h3 class="text-white mb-1">@Model.CurrentStreak</h3>
            <p class="mb-0 opacity-75">@Html.T("Ø£ÙŠØ§Ù… Ù…ØªÙˆØ§ØµÙ„Ø©", "Consecutive Days")</p>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stats-card">
            <div class="text-center">
                <div style="font-size: 48px; margin-bottom: 12px;">â­</div>
                <h3 class="fw-bold mb-1">@Model.LongestStreak</h3>
                <p class="text-muted mb-0">@Html.T("Ø£Ø·ÙˆÙ„ Ø³Ù„Ø³Ù„Ø©", "Longest Streak")</p>
            </div>
        </div>
    </div>
</div>

<!-- Charts -->
<div class="row g-4 mb-4">
    <div class="col-lg-8">
        <div class="card stretch stretch-full">
            <div class="card-body">
                <h5 class="fw-bold mb-4">
                    <i class="feather-activity text-primary me-2"></i>
                    @Html.T("Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙŠÙˆÙ…ÙŠ", "Daily Activity")
                </h5>
                <canvas id="dailyActivityChart" height="80"></canvas>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card stretch stretch-full">
            <div class="card-body">
                <h5 class="fw-bold mb-4">
                    <i class="feather-pie-chart text-success me-2"></i>
                    @Html.T("Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø©", "Distribution by Course")
                </h5>
                <canvas id="byCourseChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- By Course Table -->
<div class="card stretch stretch-full">
    <div class="card-body">
        <h5 class="fw-bold mb-4">
            <i class="feather-book-open text-info me-2"></i>
                    @Html.T("Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±Ø©", "Details by Course")
        </h5>
        
        @if (Model.ByCourse.Any())
        {
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>@Html.T("Ø§Ù„Ø¯ÙˆØ±Ø©", "Course")</th>
                            <th class="text-center">@Html.T("Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©", "Completed Lessons")</th>
                            <th class="text-center">@Html.T("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆÙ‚Øª", "Total Time")</th>
                            <th class="text-center">@Html.T("Ø§Ù„ØªÙ‚Ø¯Ù…", "Progress")</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var course in Model.ByCourse)
                        {
                            <tr>
                                <td>
                                    <strong>@course.CourseName</strong>
                                </td>
                                <td class="text-center">
                                    @course.LessonsCompleted / @course.TotalLessons
                                </td>
                                <td class="text-center">
                                    <span class="badge bg-soft-primary text-primary">
                                        @(course.TotalMinutes) @Html.T("Ø¯Ù‚ÙŠÙ‚Ø©", "min")
                                    </span>
                                </td>
                                <td class="text-center">
                                    @{
                                        var progress = course.TotalLessons > 0 ? (decimal)course.LessonsCompleted / course.TotalLessons * 100 : 0;
                                    }
                                    <div class="progress" style="width: 100px; height: 8px; margin: 0 auto;">
                                        <div class="progress-bar bg-primary" style="width: @(progress)%"></div>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            ViewData["Icon"] = "book-open";
            ViewData["Title"] = Html.T("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø±Ø§Ø³ÙŠØ©", "No study data available");
            ViewData["Message"] = Html.T("Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª", "Start studying to see statistics");
            @await Html.PartialAsync("_EmptyState")
        }
    </div>
</div>

@section Scripts {
<script>
    // Daily Activity Chart
    const dailyCtx = document.getElementById('dailyActivityChart').getContext('2d');
    new Chart(dailyCtx, {
        type: 'bar',
        data: {
            labels: @Html.Raw(Json.Serialize(Model.DailyStats.Select(ds => ds.Date.ToString("MM/dd")))),
            datasets: [{
                label: '@Html.Raw(Html.T("Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©", "Study Minutes"))',
                data: @Html.Raw(Json.Serialize(Model.DailyStats.Select(ds => ds.MinutesStudied))),
                backgroundColor: 'rgba(102, 126, 234, 0.8)',
                borderRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return value + ' @Html.Raw(Html.T("Ø¯Ù‚ÙŠÙ‚Ø©", "min"))';
                        }
                    }
                }
            }
        }
    });

    // By Course Chart
    const byCourseCtx = document.getElementById('byCourseChart').getContext('2d');
    new Chart(byCourseCtx, {
        type: 'doughnut',
        data: {
            labels: @Html.Raw(Json.Serialize(Model.ByCourse.Select(c => c.CourseName))),
            datasets: [{
                data: @Html.Raw(Json.Serialize(Model.ByCourse.Select(c => c.TotalMinutes))),
                backgroundColor: ['#667eea', '#22c55e', '#fbbf24', '#ef4444', '#3b82f6', '#a855f7']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom'
                }
            }
        }
    });
</script>
}
