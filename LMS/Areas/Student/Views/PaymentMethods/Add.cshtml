@model AddPaymentMethodViewModel
@{
    ViewData["Title"] = Html.T("Ø¥Ø¶Ø§ÙØ© Ø·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹", "Add Payment Method");
}

@section Styles {
<style>
    .payment-form {
        max-width: 600px;
        margin: 0 auto;
    }
    
    .card-preview {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        padding: 30px;
        color: white;
        min-height: 220px;
        position: relative;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }
    
    .card-chip {
        width: 50px;
        height: 40px;
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        border-radius: 8px;
        margin-bottom: 30px;
    }
    
    .card-number {
        font-size: 1.5rem;
        letter-spacing: 3px;
        font-weight: 600;
        margin-bottom: 20px;
    }
    
    .card-holder, .card-expiry {
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .card-logo {
        position: absolute;
        top: 30px;
        left: 30px;
        font-size: 2rem;
        opacity: 0.8;
    }
    
    .form-control-card {
        font-size: 1.1rem;
        padding: 15px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    
    .form-control-card:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .secure-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: #f0fdf4;
        color: #16a34a;
        padding: 8px 16px;
        border-radius: 8px;
        font-weight: 600;
    }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<!-- Back Button -->
<div class="mb-3">
    <a asp-action="Index" class="btn btn-sm btn-light">
        <i class="feather-arrow-right me-2"></i>
        @Html.T("Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹", "Back to payment methods")
    </a>
</div>

<div class="payment-form">
    <!-- Header -->
    <div class="text-center mb-4">
        <h2 class="fw-bold mb-2">
            <i class="feather-credit-card text-primary me-2"></i>
            @Html.T("Ø¥Ø¶Ø§ÙØ© Ø·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹ Ø¬Ø¯ÙŠØ¯Ø©", "Add new payment method")
        </h2>
        <p class="text-muted">@Html.T("Ø£Ø¶Ù Ø¨Ø·Ø§Ù‚ØªÙƒ Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ù„ØªØ³Ù‡ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¯ÙØ¹", "Add your card to simplify payments")</p>
    </div>
    
    <!-- Security Badge -->
    <div class="text-center mb-4">
        <div class="secure-badge">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                <path d="M5.338 1.59a61.44 61.44 0 0 0-2.837.856.481.481 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.725 10.725 0 0 0 2.287 2.233c.346.244.652.42.893.533.12.057.218.095.293.118a.55.55 0 0 0 .101.025.615.615 0 0 0 .1-.025c.076-.023.174-.061.294-.118.24-.113.547-.29.893-.533a10.726 10.726 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.775 11.775 0 0 1-2.517 2.453 7.159 7.159 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7.158 7.158 0 0 1-1.048-.625 11.777 11.777 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 62.456 62.456 0 0 1 5.072.56z"/>
            </svg>
            @Html.T("Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ù…Ø­Ù…ÙŠØ© Ø¨ØªØ´ÙÙŠØ± SSL", "Your data is protected with SSL encryption")
        </div>
    </div>
    
    <!-- Card Preview -->
    <div class="card-preview mb-4">
        <div class="card-logo">ğŸ’³</div>
        <div class="card-chip"></div>
        <div class="card-number" id="card-preview-number">**** **** **** ****</div>
        <div class="d-flex justify-content-between">
            <div>
                <div class="small opacity-75 mb-1">@Html.T("Ø§Ø³Ù… Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©", "Cardholder Name")</div>
                <div class="card-holder" id="card-preview-holder">@Html.T("Ø§Ø³Ù…Ùƒ", "YOUR NAME")</div>
            </div>
            <div class="text-end">
                <div class="small opacity-75 mb-1">@Html.T("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡", "Expiry date")</div>
                <div class="card-expiry" id="card-preview-expiry">@Html.T("Ø´Ù‡Ø±/Ø³Ù†Ø©", "MM/YY")</div>
            </div>
        </div>
    </div>
    
    <!-- Payment Form -->
    <div class="card stretch stretch-full">
        <div class="card-body p-4">
            <form asp-action="Add" method="post" id="paymentForm">
                <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
                
                <!-- Card Type -->
                <div class="mb-4">
                    <label class="form-label fw-bold">@Html.T("Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©", "Card type")</label>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-outline-primary flex-grow-1 card-type-btn active" data-type="Credit">
                            @Html.T("Ø¨Ø·Ø§Ù‚Ø© Ø§Ø¦ØªÙ…Ø§Ù†", "Credit card")
                        </button>
                        <button type="button" class="btn btn-outline-primary flex-grow-1 card-type-btn" data-type="Debit">
                            @Html.T("Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¯ÙŠÙ†", "Debit card")
                        </button>
                    </div>
                    <input type="hidden" asp-for="PaymentMethodType" value="Credit" />
                </div>
                
                <!-- Card Number -->
                <div class="mb-4">
                    <label asp-for="CardNumber" class="form-label fw-bold">
                        @Html.T("Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©", "Card Number")
                        <span class="text-danger">*</span>
                    </label>
                    <input asp-for="CardNumber" class="form-control form-control-card" 
                           placeholder="@Html.T("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©", "Enter card number")" 
                           maxlength="19"
                           id="cardNumber" />
                    <span asp-validation-for="CardNumber" class="text-danger"></span>
                </div>
                
                <!-- Card Holder Name -->
                <div class="mb-4">
                    <label asp-for="CardHolderName" class="form-label fw-bold">
                        @Html.T("Ø§Ø³Ù… Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©", "Cardholder Name")
                        <span class="text-danger">*</span>
                    </label>
                    <input asp-for="CardHolderName" class="form-control form-control-card" 
                           placeholder="@Html.T("ÙƒÙ…Ø§ Ù‡Ùˆ Ù…ÙƒØªÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©", "As written on the card")"
                           id="cardHolder" />
                    <span asp-validation-for="CardHolderName" class="text-danger"></span>
                </div>
                
                <div class="row">
                    <!-- Expiry Month -->
                    <div class="col-md-4 mb-4">
                        <label asp-for="ExpiryMonth" class="form-label fw-bold">
                            @Html.T("Ø§Ù„Ø´Ù‡Ø±", "Month")
                            <span class="text-danger">*</span>
                        </label>
                        <select asp-for="ExpiryMonth" class="form-select form-control-card" id="expiryMonth">
                            <option value="">@Html.T("Ø§Ø®ØªØ±", "Select")</option>
                            @for (int i = 1; i <= 12; i++)
                            {
                                <option value="@i">@i.ToString("00")</option>
                            }
                        </select>
                        <span asp-validation-for="ExpiryMonth" class="text-danger"></span>
                    </div>
                    
                    <!-- Expiry Year -->
                    <div class="col-md-4 mb-4">
                        <label asp-for="ExpiryYear" class="form-label fw-bold">
                            @Html.T("Ø§Ù„Ø³Ù†Ø©", "Year")
                            <span class="text-danger">*</span>
                        </label>
                        <select asp-for="ExpiryYear" class="form-select form-control-card" id="expiryYear">
                            <option value="">@Html.T("Ø§Ø®ØªØ±", "Select")</option>
                            @for (int i = DateTime.Now.Year; i <= DateTime.Now.Year + 20; i++)
                            {
                                <option value="@i">@i</option>
                            }
                        </select>
                        <span asp-validation-for="ExpiryYear" class="text-danger"></span>
                    </div>
                    
                    <!-- CVV -->
                    <div class="col-md-4 mb-4">
                        <label class="form-label fw-bold">
                            @Html.T("Ø±Ù…Ø² Ø§Ù„Ø£Ù…Ø§Ù† (CVV)", "CVV")
                            <span class="text-danger">*</span>
                            <i class="feather-help-circle" data-bs-toggle="tooltip" title="@Html.T("Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 3 Ø£Ø±Ù‚Ø§Ù… Ø®Ù„Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©", "The 3-digit number on the back of the card")"></i>
                        </label>
                        <input type="password" class="form-control form-control-card" 
                               placeholder="@Html.T("***", "***")" 
                               maxlength="4" 
                               pattern="[0-9]{3,4}" />
                    </div>
                </div>
                
                <!-- Nickname -->
                <div class="mb-4">
                    <label asp-for="NickName" class="form-label fw-bold">
                        @Html.T("Ø§Ø³Ù… Ù…Ø³ØªØ¹Ø§Ø± Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)", "Card nickname (optional)")
                    </label>
                    <input asp-for="NickName" class="form-control" 
                           placeholder="@Html.T("Ù…Ø«Ø§Ù„: Ø¨Ø·Ø§Ù‚ØªÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", "e.g. My primary card")" />
                    <small class="text-muted">@Html.T("Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©", "To easily identify the card")</small>
                </div>
                
                <!-- Set as Default -->
                <div class="mb-4">
                    <div class="form-check">
                        <input asp-for="IsDefault" class="form-check-input" type="checkbox" />
                        <label asp-for="IsDefault" class="form-check-label">
                            @Html.T("ØªØ¹ÙŠÙŠÙ† ÙƒØ·Ø±ÙŠÙ‚Ø© Ø¯ÙØ¹ Ø§ÙØªØ±Ø§Ø¶ÙŠØ©", "Set as default payment method")
                        </label>
                    </div>
                </div>
                
                <!-- Terms -->
                <div class="mb-4">
                    <div class="alert alert-info">
                        <div class="d-flex gap-2">
                            <i class="feather-shield text-primary"></i>
                            <div class="small">
                                @Html.T("Ø¨Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©ØŒ Ø£Ù†Øª ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰", "By adding this card, you agree to") <a href="#">@Html.T("Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…", "Terms of Use")</a> 
                                @Html.T("Ùˆ", "and") <a href="#">@Html.T("Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©", "Privacy Policy")</a>. @Html.T("Ø³ÙŠØªÙ… ØªØ´ÙÙŠØ± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ø·Ø§Ù‚ØªÙƒ Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†.", "Your card information will be encrypted securely.")
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Submit Buttons -->
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary flex-grow-1">
                        <i class="feather-check me-2"></i>
                        @Html.T("Ø­ÙØ¸ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©", "Save card")
                    </button>
                    <a asp-action="Index" class="btn btn-light">
                        @Html.T("Ø¥Ù„ØºØ§Ø¡", "Cancel")
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
@{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
<script>
    // Card number formatting
    document.getElementById('cardNumber').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\s/g, '');
        let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
        e.target.value = formattedValue;
        
        // Update preview
        document.getElementById('card-preview-number').textContent = 
            formattedValue || '**** **** **** ****';
    });
    
    // Card holder name update
    document.getElementById('cardHolder').addEventListener('input', function(e) {
        document.getElementById('card-preview-holder').textContent = 
            e.target.value.toUpperCase() || 'YOUR NAME';
    });
    
    // Expiry date update
    function updateExpiry() {
        const month = document.getElementById('expiryMonth').value;
        const year = document.getElementById('expiryYear').value;
        const shortYear = year ? year.toString().slice(-2) : 'YY';
        const display = month && year ? 
            `${month.padStart(2, '0')}/${shortYear}` : 'MM/YY';
        document.getElementById('card-preview-expiry').textContent = display;
    }
    
    document.getElementById('expiryMonth').addEventListener('change', updateExpiry);
    document.getElementById('expiryYear').addEventListener('change', updateExpiry);
    
    // Card type selection
    document.querySelectorAll('.card-type-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.card-type-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            document.querySelector('input[name="PaymentMethodType"]').value = this.dataset.type;
        });
    });
    
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
</script>
}

