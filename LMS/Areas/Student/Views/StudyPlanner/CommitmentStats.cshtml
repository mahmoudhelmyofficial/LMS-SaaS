@model CommitmentStatsViewModel
@{
    ViewData["Title"] = Html.T("Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…", "Commitment Statistics");
}

@section Styles {
<style>
    .stats-header {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border-radius: 16px;
        padding: 40px;
        text-align: center;
        margin-bottom: 24px;
    }
    .commitment-score {
        font-size: 72px;
        font-weight: bold;
        margin-bottom: 16px;
    }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<!-- Header with Score -->
<div class="stats-header">
    <div class="commitment-score">@Model.CommitmentScore%</div>
    <h3 class="text-white mb-2">@Html.T("Ø¯Ø±Ø¬Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…", "Commitment Score")</h3>
    <p class="mb-0 opacity-75">
        @if (Model.CommitmentScore >= 90)
        {
            @Html.Raw(Html.T("Ù…Ù…ØªØ§Ø²! Ø§Ù„ØªØ²Ø§Ù… Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ ğŸ†", "Excellent! Exceptional commitment ğŸ†"))
        }
        else if (Model.CommitmentScore >= 70)
        {
            @Html.Raw(Html.T("Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ğŸ‘", "Very good! Keep up this level ğŸ‘"))
        }
        else if (Model.CommitmentScore >= 50)
        {
            @Html.Raw(Html.T("Ø¬ÙŠØ¯! ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ²Ø§Ù…Ùƒ ğŸ’ª", "Good! You can improve your commitment ğŸ’ª"))
        }
        else
        {
            @Html.Raw(Html.T("ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†! Ø­Ø§ÙˆÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø®Ø·ØªÙƒ ğŸ“š", "Needs improvement! Try to stick to your plan ğŸ“š"))
        }
    </p>
</div>

<!-- Key Metrics -->
<div class="row g-4 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="card">
            <div class="card-body text-center">
                <div style="font-size: 48px; margin-bottom: 12px;">ğŸ“…</div>
                <h3 class="fw-bold mb-1">@Model.TotalPlannedSessions</h3>
                <p class="text-muted mb-0">@Html.T("Ø¬Ù„Ø³Ø§Øª Ù…Ø¬Ø¯ÙˆÙ„Ø©", "Scheduled Sessions")</p>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card">
            <div class="card-body text-center">
                <div style="font-size: 48px; margin-bottom: 12px;">âœ…</div>
                <h3 class="fw-bold text-success mb-1">@Model.CompletedSessions</h3>
                <p class="text-muted mb-0">@Html.T("Ø¬Ù„Ø³Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©", "Completed Sessions")</p>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card">
            <div class="card-body text-center">
                <div style="font-size: 48px; margin-bottom: 12px;">âŒ</div>
                <h3 class="fw-bold text-danger mb-1">@Model.MissedSessions</h3>
                <p class="text-muted mb-0">@Html.T("Ø¬Ù„Ø³Ø§Øª ÙØ§Ø¦ØªØ©", "Missed Sessions")</p>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card">
            <div class="card-body text-center">
                <div style="font-size: 48px; margin-bottom: 12px;">ğŸ”¥</div>
                <h3 class="fw-bold text-warning mb-1">@Model.CurrentStreak</h3>
                <p class="text-muted mb-0">@Html.T("Ø£ÙŠØ§Ù… Ù…ØªÙˆØ§ØµÙ„Ø©", "Day Streak")</p>
            </div>
        </div>
    </div>
</div>

<!-- Charts -->
<div class="row g-4 mb-4">
    <div class="col-lg-8">
        <div class="card stretch stretch-full">
            <div class="card-body">
                <h5 class="fw-bold mb-4">
                    <i class="feather-activity text-primary me-2"></i>
                    @Html.T("Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø®Ù„Ø§Ù„ Ø§Ù„Ù€ 30 ÙŠÙˆÙ… Ø§Ù„Ù…Ø§Ø¶ÙŠØ©", "Commitment Over the Last 30 Days")
                </h5>
                <canvas id="commitmentChart" height="80"></canvas>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card stretch stretch-full">
            <div class="card-body">
                <h5 class="fw-bold mb-4">
                    <i class="feather-pie-chart text-success me-2"></i>
                    @Html.T("Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²", "Completion Rate")
                </h5>
                <canvas id="completionChart"></canvas>
                <div class="mt-4 text-center">
                    <h3 class="fw-bold text-primary mb-1">@Model.CompletionRate%</h3>
                    <p class="text-muted small mb-0">@Html.T("Ù†Ø³Ø¨Ø© Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø¬Ù„Ø³Ø§Øª", "Session completion rate")</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Time Stats -->
<div class="card stretch stretch-full mb-4">
    <div class="card-body">
        <h5 class="fw-bold mb-4">
            <i class="feather-clock text-info me-2"></i>
            @Html.T("Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙˆÙ‚Øª", "Time Statistics")
        </h5>
        
        <div class="row g-4">
            <div class="col-md-3">
                <div class="text-center p-3 rounded" style="background: #f0f9ff;">
                    <h4 class="fw-bold text-primary mb-1">@Model.TotalPlannedHours @Html.T("Ø³Ø§Ø¹Ø©", "hrs")</h4>
                    <small class="text-muted">@Html.T("Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø®Ø·Ø·", "Planned Time")</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="text-center p-3 rounded" style="background: #f0fdf4;">
                    <h4 class="fw-bold text-success mb-1">@Model.TotalActualHours @Html.T("Ø³Ø§Ø¹Ø©", "hrs")</h4>
                    <small class="text-muted">@Html.T("Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙØ¹Ù„ÙŠ", "Actual Time")</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="text-center p-3 rounded" style="background: #fffbeb;">
                    <h4 class="fw-bold text-warning mb-1">@Model.AverageSessionDuration @Html.T("Ø¯Ù‚ÙŠÙ‚Ø©", "min")</h4>
                    <small class="text-muted">@Html.T("Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©", "Avg. session duration")</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="text-center p-3 rounded" style="background: #fef2f2;">
                    <h4 class="fw-bold text-danger mb-1">@Model.MissedHours @Html.T("Ø³Ø§Ø¹Ø©", "hrs")</h4>
                    <small class="text-muted">@Html.T("Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¶Ø§Ø¦Ø¹", "Missed Time")</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Weekly Pattern -->
<div class="card stretch stretch-full mb-4">
    <div class="card-body">
        <h5 class="fw-bold mb-4">
            <i class="feather-bar-chart text-primary me-2"></i>
            @Html.T("Ù†Ù…Ø· Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ", "Weekly Commitment Pattern")
        </h5>
        <canvas id="weeklyPatternChart" height="60"></canvas>
    </div>
</div>

<!-- Insights -->
<div class="card stretch stretch-full">
    <div class="card-body">
        <h5 class="fw-bold mb-4">
            <i class="feather-lightbulb text-warning me-2"></i>
            @Html.T("Ø±Ø¤Ù‰ ÙˆØªÙˆØµÙŠØ§Øª", "Insights & Recommendations")
        </h5>
        
        <div class="row g-3">
            @if (Model.CommitmentScore >= 90)
            {
                <div class="col-12">
                    <div class="alert alert-success">
                        <i class="feather-check-circle me-2"></i>
                        <strong>@Html.T("Ù…Ù…ØªØ§Ø²!", "Excellent!")</strong> @Html.T("Ø§Ù„ØªØ²Ø§Ù…Ùƒ Ø¨Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ. Ø§Ø³ØªÙ…Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¦Ø¹!", "Your commitment to your study plan is exceptional. Keep up this great performance!")
                    </div>
                </div>
            }
            else if (Model.MissedSessions > 5)
            {
                <div class="col-12">
                    <div class="alert alert-warning">
                        <i class="feather-alert-triangle me-2"></i>
                        <strong>@Html.T("ØªÙ†Ø¨ÙŠÙ‡:", "Warning:")</strong> @Html.T("Ù„Ø¯ÙŠÙƒ", "You have") @Model.MissedSessions @Html.T("Ø¬Ù„Ø³Ø§Øª ÙØ§Ø¦ØªØ©. Ø­Ø§ÙˆÙ„ ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ²Ø§Ù…Ùƒ Ø¨Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ.", "missed sessions. Try to improve your commitment to your study schedule.")
                    </div>
                </div>
            }
            
            @if (Model.BestDay != null)
            {
                <div class="col-md-6">
                    <div class="p-3 rounded" style="background: #f0fdf4; border-right: 4px solid #22c55e;">
                        <h6 class="fw-bold mb-1">@Html.T("Ø£ÙØ¶Ù„ ÙŠÙˆÙ…", "Best Day")</h6>
                        <p class="mb-0">@Model.BestDay - @Html.T("Ø£Ø¹Ù„Ù‰ Ø§Ù„ØªØ²Ø§Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…", "Highest commitment on this day")</p>
                    </div>
                </div>
            }
            
            @if (Model.WorstDay != null)
            {
                <div class="col-md-6">
                    <div class="p-3 rounded" style="background: #fef2f2; border-right: 4px solid #ef4444;">
                        <h6 class="fw-bold mb-1">@Html.T("ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†", "Needs Improvement")</h6>
                        <p class="mb-0">@Model.WorstDay - @Html.T("Ø­Ø§ÙˆÙ„ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…", "Try to improve commitment on this day")</p>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
<script>
    var _commitmentLabels = {
        commitmentRate: @Html.Raw(Json.Serialize(Html.T("Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…", "Commitment Rate"))),
        completed: @Html.Raw(Json.Serialize(Html.T("Ù…ÙƒØªÙ…Ù„Ø©", "Completed"))),
        missed: @Html.Raw(Json.Serialize(Html.T("ÙØ§Ø¦ØªØ©", "Missed"))),
        upcoming: @Html.Raw(Json.Serialize(Html.T("Ù‚Ø§Ø¯Ù…Ø©", "Upcoming"))),
        weekDays: @Html.Raw(Json.Serialize(new[] { Html.T("Ø§Ù„Ø£Ø­Ø¯", "Sun"), Html.T("Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Mon"), Html.T("Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Tue"), Html.T("Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Wed"), Html.T("Ø§Ù„Ø®Ù…ÙŠØ³", "Thu"), Html.T("Ø§Ù„Ø¬Ù…Ø¹Ø©", "Fri"), Html.T("Ø§Ù„Ø³Ø¨Øª", "Sat") }))
    };
    // Commitment Over Time Chart
    const commitmentCtx = document.getElementById('commitmentChart').getContext('2d');
    new Chart(commitmentCtx, {
        type: 'line',
        data: {
            labels: @Html.Raw(Json.Serialize(Model.DailyCommitment.Select(d => d.Date.ToString("MM/dd")))),
            datasets: [{
                label: _commitmentLabels.commitmentRate,
                data: @Html.Raw(Json.Serialize(Model.DailyCommitment.Select(d => d.CommitmentRate))),
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });

    // Completion Chart
    const completionCtx = document.getElementById('completionChart').getContext('2d');
    new Chart(completionCtx, {
        type: 'doughnut',
        data: {
            labels: [_commitmentLabels.completed, _commitmentLabels.missed, _commitmentLabels.upcoming],
            datasets: [{
                data: [@Model.CompletedSessions, @Model.MissedSessions, @Model.PendingSessions],
                backgroundColor: ['#22c55e', '#ef4444', '#3b82f6']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true
        }
    });

    // Weekly Pattern Chart
    const weeklyCtx = document.getElementById('weeklyPatternChart').getContext('2d');
    new Chart(weeklyCtx, {
        type: 'bar',
        data: {
            labels: _commitmentLabels.weekDays,
            datasets: [
                {
                    label: _commitmentLabels.completed,
                    data: @Html.Raw(Json.Serialize(Model.WeeklyPattern.Select(w => w.Completed))),
                    backgroundColor: '#22c55e'
                },
                {
                    label: _commitmentLabels.missed,
                    data: @Html.Raw(Json.Serialize(Model.WeeklyPattern.Select(w => w.Missed))),
                    backgroundColor: '#ef4444'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
}
