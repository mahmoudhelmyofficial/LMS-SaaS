@model LMS.Areas.Student.Controllers.PaymentSuccessViewModel
@{
    ViewData["Title"] = Html.T("نجح الدفع", "Payment Successful");
}

@section Styles {
<style>
    .success-animation {
        animation: scaleIn 0.5s ease-out;
    }
    @@keyframes scaleIn {
        0% { transform: scale(0); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
    .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        background: #667eea;
        animation: fall 3s linear forwards;
        z-index: 1000;
        pointer-events: none;
    }
    @@keyframes fall {
        to { transform: translateY(100vh) rotate(360deg); opacity: 0; }
    }
</style>
}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Success Message -->
            <div class="card stretch stretch-full text-center mb-4" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; padding: 60px 40px;">
                <div class="success-animation">
                    <div class="avatar-text avatar-xxl bg-white text-success mx-auto mb-4">
                        <i class="feather-check-circle" style="font-size: 64px;"></i>
                    </div>
                    <h1 class="text-white fw-bold mb-3">@Html.T("تم الدفع بنجاح!", "Payment successful!")</h1>
                    <p class="text-white opacity-75 fs-5 mb-4">
                        @if (Model.CoursesCount > 0 && Model.BooksCount > 0)
                        {
                            <text>@Html.T("تهانينا! لقد تم تسجيلك في", "Congratulations! You have been enrolled in") @Model.CoursesCount @Html.T("دورة وشراء", "course(s) and purchased") @Model.BooksCount @Html.T("كتاب بنجاح", "book(s) successfully")</text>
                        }
                        else if (Model.CoursesCount > 0)
                        {
                            <text>@Html.T("تهانينا! لقد تم تسجيلك في", "Congratulations! You have been enrolled in") @Model.CoursesCount @Html.T("دورة بنجاح", "course(s) successfully")</text>
                        }
                        else
                        {
                            <text>@Html.T("تهانينا! تم شراء", "Congratulations! Purchased") @Model.BooksCount @Html.T("كتاب بنجاح", "book(s) successfully")</text>
                        }
                    </p>
                    <p class="text-white opacity-75 fs-12 mb-1">
                        @Html.T("رقم العملية:", "Transaction ID:") <strong>@Model.TransactionId</strong>
                    </p>
                    <p class="text-white opacity-75 fs-5 mt-2">
                        <strong>@Model.TotalAmount.ToEGP(0)</strong>
                    </p>
                </div>
            </div>

            @if (Model.Courses.Any())
            {
                <!-- Enrolled Courses -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="fw-bold mb-0">
                            <i class="feather-play-circle me-2 text-primary"></i>
                            @Html.T("الدورات المسجلة", "Enrolled courses") (@Model.Courses.Count)
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            @foreach (var course in Model.Courses)
                            {
                                <div class="list-group-item px-0">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-text avatar-lg bg-soft-primary text-primary me-3">
                                                <i class="feather-play-circle"></i>
                                            </div>
                                            <div>
                                                <span class="badge bg-primary fs-10 mb-1">@Html.T("دورة", "Course")</span>
                                                <h6 class="fw-bold mb-0">@course.CourseName</h6>
                                            </div>
                                        </div>
                                        <a asp-controller="Learning" asp-action="Overview" asp-route-courseId="@course.CourseId" class="btn btn-primary">
                                            <i class="feather-play-circle me-2"></i>
                                            @Html.T("ابدأ الآن", "Start now")
                                        </a>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }

            @if (Model.Books.Any())
            {
                <!-- Purchased Books -->
                <div class="card stretch stretch-full mb-4">
                    <div class="card-header">
                        <h5 class="fw-bold mb-0">
                            <i class="feather-book me-2 text-info"></i>
                            @Html.T("الكتب المشتراة", "Purchased books") (@Model.Books.Count)
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            @foreach (var book in Model.Books)
                            {
                                <div class="list-group-item px-0">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div class="d-flex align-items-center">
                                            @if (!string.IsNullOrEmpty(book.CoverImageUrl))
                                            {
                                                <img src="@book.CoverImageUrl" alt="@book.BookTitle" class="rounded me-3" style="width: 60px; height: 80px; object-fit: cover;" />
                                            }
                                            else
                                            {
                                                <div class="avatar-text avatar-lg bg-soft-info text-info me-3" style="height: 80px; width: 60px; border-radius: 8px;">
                                                    <i class="feather-book"></i>
                                                </div>
                                            }
                                            <div>
                                                <span class="badge bg-info fs-10 mb-1">@Html.T("كتاب", "Book")</span>
                                                <h6 class="fw-bold mb-0">@book.BookTitle</h6>
                                            </div>
                                        </div>
                                        <a asp-controller="Books" asp-action="MyLibrary" class="btn btn-info">
                                            <i class="feather-download me-2"></i>
                                            @Html.T("تحميل", "Download")
                                        </a>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }

            <!-- What's Next -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="fw-bold mb-0">
                        <i class="feather-compass me-2"></i>
                        @Html.T("ماذا بعد؟", "What's next?")
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        @if (Model.CoursesCount > 0)
                        {
                            <div class="col-md-4">
                                <div class="text-center p-3 border rounded">
                                    <div class="avatar-text avatar-lg bg-soft-primary text-primary mx-auto mb-3">
                                        <i class="feather-play-circle"></i>
                                    </div>
                                    <h6 class="fw-bold mb-2">@Html.T("ابدأ التعلم", "Start learning")</h6>
                                    <p class="text-muted fs-12 mb-3">@Html.T("ابدأ أول درس الآن", "Start your first lesson now")</p>
                                    <a asp-controller="Courses" asp-action="Index" class="btn btn-sm btn-primary">
                                        @Html.T("دوراتي", "My courses")
                                    </a>
                                </div>
                            </div>
                        }
                        @if (Model.BooksCount > 0)
                        {
                            <div class="col-md-4">
                                <div class="text-center p-3 border rounded">
                                    <div class="avatar-text avatar-lg bg-soft-info text-info mx-auto mb-3">
                                        <i class="feather-book"></i>
                                    </div>
                                    <h6 class="fw-bold mb-2">@Html.T("اقرأ كتبك", "Read your books")</h6>
                                    <p class="text-muted fs-12 mb-3">@Html.T("حمّل وابدأ القراءة", "Download and start reading")</p>
                                    <a asp-controller="Books" asp-action="MyLibrary" class="btn btn-sm btn-info">
                                        @Html.T("مكتبتي", "My library")
                                    </a>
                                </div>
                            </div>
                        }
                        <div class="col-md-4">
                            <div class="text-center p-3 border rounded">
                                <div class="avatar-text avatar-lg bg-soft-success text-success mx-auto mb-3">
                                    <i class="feather-mail"></i>
                                </div>
                                <h6 class="fw-bold mb-2">@Html.T("تحقق من بريدك", "Check your email")</h6>
                                <p class="text-muted fs-12 mb-3">@Html.T("أرسلنا لك تفاصيل الشراء", "We sent you the purchase details")</p>
                                <a asp-controller="Invoices" asp-action="Index" class="btn btn-sm btn-outline-success">
                                    @Html.T("الفواتير", "Invoices")
                                </a>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3 border rounded">
                                <div class="avatar-text avatar-lg bg-soft-warning text-warning mx-auto mb-3">
                                    <i class="feather-users"></i>
                                </div>
                                <h6 class="fw-bold mb-2">@Html.T("انضم للمجتمع", "Join the community")</h6>
                                <p class="text-muted fs-12 mb-3">@Html.T("تواصل مع طلاب آخرين", "Connect with other students")</p>
                                <a asp-controller="Discussions" asp-action="Index" class="btn btn-sm btn-outline-warning">
                                    @Html.T("المناقشات", "Discussions")
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="card stretch stretch-full">
                <div class="card-body">
                    <div class="d-flex gap-3 flex-wrap">
                        @if (Model.CoursesCount > 0)
                        {
                            <a asp-controller="Courses" asp-action="Index" class="btn btn-primary flex-grow-1">
                                <i class="feather-play-circle me-2"></i>
                                @Html.T("دوراتي", "My courses")
                            </a>
                        }
                        @if (Model.BooksCount > 0)
                        {
                            <a asp-controller="Books" asp-action="MyLibrary" class="btn btn-info flex-grow-1">
                                <i class="feather-book me-2"></i>
                                @Html.T("مكتبتي", "My library")
                            </a>
                        }
                        <a asp-controller="Courses" asp-action="Browse" class="btn btn-outline-primary">
                            <i class="feather-search me-2"></i>
                            @Html.T("تصفح المزيد", "Browse more")
                        </a>
                        <a asp-controller="Invoices" asp-action="ViewByTransaction" asp-route-transactionId="@Model.TransactionId" class="btn btn-outline-secondary">
                            <i class="feather-download me-2"></i>
                            @Html.T("تحميل الفاتورة", "Download invoice")
                        </a>
                    </div>
                </div>
            </div>

            <!-- Support -->
            <div class="text-center mt-4">
                <p class="text-muted mb-2">@Html.T("هل تحتاج مساعدة؟", "Need help?")</p>
                <a asp-controller="Support" asp-action="Index" class="text-primary">
                    <i class="feather-message-circle me-1"></i>
                    @Html.T("اتصل بالدعم الفني", "Contact support")
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    // Confetti animation
    function createConfetti() {
        const colors = ['#667eea', '#22c55e', '#f59e0b', '#ef4444', '#3b82f6', '#8b5cf6'];
        for (let i = 0; i < 50; i++) {
            setTimeout(() => {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-10px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 3000);
            }, i * 50);
        }
    }
    
    // Trigger confetti on page load
    window.addEventListener('load', createConfetti);
</script>
}
