@inject LMS.Services.Interfaces.IPlatformSettingsService PlatformSettings
@{
    var _platformName = await PlatformSettings.GetPlatformNameAsync();
    var _platformFavicon = await PlatformSettings.GetPlatformFaviconAsync();
}
<!DOCTYPE html>
<html lang="@Html.Lang()" dir="@Html.Dir()">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="@Html.T("منصة", "Platform") @_platformName - @Html.T("لوحة تحكم الطالب", "Student Dashboard")" />
    <meta name="author" content="@_platformName" />
    <partial name="_PwaMeta" />
    <title>@ViewData["Title"] - @Html.T("لوحة تحكم الطالب", "Student Dashboard") - @_platformName</title>
    
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="@Url.Content(string.IsNullOrEmpty(_platformFavicon) ? "~/assets/images/favicon.ico" : "~" + _platformFavicon)" />
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" type="text/css" href="~/assets/css/bootstrap.min.css" />
    
    <!-- Vendors CSS -->
    <link rel="stylesheet" type="text/css" href="~/assets/vendors/css/vendors.min.css" />
    <link rel="stylesheet" type="text/css" href="~/assets/vendors/css/feather.min.css" />
    <link rel="stylesheet" type="text/css" href="~/assets/vendors/css/daterangepicker.min.css" />
    
    <!-- Custom Theme CSS -->
    <link rel="stylesheet" type="text/css" href="~/assets/css/theme.min.css" />
    
    <!-- Mobile Responsive CSS -->
    <link rel="stylesheet" type="text/css" href="~/css/responsive-mobile.css" />
    
    <!-- Brand Identity CSS -->
    <link rel="stylesheet" type="text/css" href="~/css/brand-identity.css" />
    
    <!-- Content Protection CSS -->
    <link rel="stylesheet" type="text/css" href="~/css/content-protection.css" />
    
    <!-- Secure Video Player CSS -->
    <link rel="stylesheet" type="text/css" href="~/css/secure-video-player.css" />
    
    <!-- Site CSS - Global styles including modal fix -->
    <link rel="stylesheet" type="text/css" href="~/css/site.css" asp-append-version="true" />
    
    <!-- Plyr Video Player CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    
    <!-- PerfectScrollbar CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/perfect-scrollbar/1.5.5/css/perfect-scrollbar.min.css" />
    
    <!-- Google Fonts - Cairo for Arabic -->
    @if (Html.IsRtl())
    {
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    }
    
    <!-- Conditional RTL/LTR Styles -->
    @if (Html.IsRtl())
    {
    <style>
        body { font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; direction: rtl; text-align: right; }
        .nxl-navigation { position: fixed; top: 0; left: auto !important; right: 0 !important; width: 280px; height: 100vh; background-color: #fff; box-shadow: 0 0 15px rgba(0,0,0,.05); z-index: 1030; transition: all 0.3s ease; }
        .nxl-container { margin-left: 0 !important; margin-right: 280px !important; min-height: auto !important; display: flex; flex-direction: column; padding-top: 0px !important; }
        .nxl-header { position: fixed; top: 0; left: 0; right: 280px; height: 70px; background-color: #fff; border-bottom: 1px solid #eee; z-index: 1020; display: flex; align-items: center; }
        .header-wrapper { width: 100%; display: flex; align-items: center; justify-content: space-between; padding: 0 1.5rem; height: 100%; }
        html.minimenu .nxl-container { margin-right: 140px !important; min-height: auto !important; }
        html.minimenu .nxl-navigation { width: 120px !important; }
        html.minimenu .nxl-header { right: 120px; }
        html.minimenu .footer { right: 120px !important; }
        .nxl-arrow i { transform: rotate(180deg); }
        .nxl-hasmenu.nxl-trigger .nxl-arrow i { transform: rotate(90deg); }
        @@media (max-width: 1199px) {
            .nxl-container { margin-right: 0 !important; min-height: auto !important; }
            .nxl-navigation { right: -280px !important; }
            .nxl-header { left: 0 !important; right: 0 !important; width: 100% !important; height: 60px !important; }
            body.nxl-navigation-show .nxl-navigation { right: 0 !important; }
            .footer { right: 0 !important; }
        }
        @@media (max-width: 767px) {
            .nxl-header { height: 56px !important; }
            .header-wrapper { padding: 0 0.75rem !important; height: 56px !important; }
            .nxl-header .dropdown-menu { position: fixed !important; top: 56px !important; left: 10px !important; right: 10px !important; width: calc(100vw - 20px) !important; max-width: none !important; max-height: calc(100vh - 76px) !important; overflow-y: auto !important; }
            .page-header { padding: 0.75rem 0 !important; margin-bottom: 1rem !important; }
            .page-header-left { flex-direction: column; align-items: flex-start !important; }
        }
        .nxl-header .dropdown, .nxl-header .nxl-h-item { position: relative; }
        .nxl-header .dropdown-menu { position: absolute; top: 100%; z-index: 1050; display: none; min-width: 200px; padding: 0.5rem 0; margin-top: 0.5rem; background-color: #fff; border: 1px solid rgba(0,0,0,.1); border-radius: 0.5rem; box-shadow: 0 0.5rem 1.5rem rgba(0,0,0,.15); }
        .nxl-header .dropdown-menu.show { display: block !important; }
        .nxl-header .dropdown-menu-end, .nxl-header .dropdown-menu { left: 0 !important; right: auto !important; }
        .header-dropdown-toggle.active { background-color: var(--primary-soft, #e8f0fb) !important; color: var(--primary, #004aad) !important; }
        .breadcrumb { display: flex; flex-wrap: wrap; padding: 0; margin: 0 1.5rem; list-style: none; gap: 0.25rem; align-items: center; }
        .breadcrumb-item { display: flex; align-items: center; font-size: 0.875rem; }
        .breadcrumb-item a { color: #6c757d; text-decoration: none; }
        .breadcrumb-item a:hover { color: var(--primary, #004aad); }
        .breadcrumb-item.active, .breadcrumb-item:last-child { color: #333; font-weight: 600; }
        .breadcrumb-item + .breadcrumb-item { padding-right: 0; }
        .breadcrumb-item + .breadcrumb-item::before { content: ">"; padding: 0 0.75rem; color: #adb5bd; font-size: 0.75rem; }
        .page-header { display: flex; align-items: center; justify-content: space-between; padding: 1rem 0; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .page-header-left { display: flex; align-items: center; flex-wrap: wrap; }
        .page-header-title { margin-left: 1.5rem; padding-left: 1.5rem; border-left: 3px solid var(--primary, #004aad); }
        .page-header-title h5 { margin: 0; font-weight: 700; color: #333; font-size: 1.25rem; }
        .nxl-submenu .nxl-link { padding: 0.5rem 1rem; font-size: 0.9rem; color: #666; }
        .nxl-submenu .nxl-link:hover { color: var(--primary, #004aad); background-color: rgba(0, 74, 173, 0.05); }
        .nxl-submenu .nxl-link.active { color: var(--primary, #004aad); font-weight: 600; }
        .nxl-submenu { display: none; list-style: none; margin: 0; padding: 0.5rem 0 0.5rem 1rem; background-color: rgba(0,0,0,.02); overflow: hidden; }
        .nxl-hasmenu.nxl-trigger > .nxl-submenu, .nxl-hasmenu.open > .nxl-submenu { display: block; }
        .nxl-hasmenu.nxl-trigger .nxl-arrow i, .nxl-hasmenu.open .nxl-arrow i { transform: rotate(90deg); }
        .navbar-content { position: relative; height: calc(100vh - 80px); overflow: hidden; }
        .navbar-wrapper { height: 100%; display: flex; flex-direction: column; }
        .m-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid #eee; min-height: 100px; display: flex; align-items: center; }
        .b-brand { text-decoration: none; display: flex; align-items: center; justify-content: center; width: 100%; }
        .b-brand img { max-width: 100%; height: auto; object-fit: contain; }
        .nxl-navbar { list-style: none; margin: 0; padding: 1rem 0; }
        .nxl-link { display: flex; align-items: center; padding: 0.75rem 1rem; text-decoration: none; color: #333; border-radius: 0.375rem; margin: 0 0.5rem; transition: all 0.2s; }
        .nxl-link:hover { background-color: rgba(0, 74, 173, 0.1); color: var(--primary, #004aad); }
        .nxl-micon { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; margin-left: 0.75rem; }
        .nxl-mtext { flex: 1; }
        .nxl-caption { padding: 1rem 1.5rem 0.5rem; }
        .nxl-caption label { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: #999; }
        .logo-sm { display: none; } html.minimenu .logo-lg { display: none; } html.minimenu .logo-sm { display: block; }
        .header-dropdown-toggle { display: flex !important; align-items: center; justify-content: center; width: 42px; height: 42px; border-radius: 50%; background-color: #f5f5f5; color: #333; text-decoration: none; cursor: pointer; transition: all 0.2s ease; position: relative; }
        .header-dropdown-toggle:hover, .header-dropdown-toggle.active { background-color: var(--primary-soft, #e8f0fb); color: var(--primary, #004aad); }
        .header-dropdown-toggle i, .header-dropdown-toggle .avatar-text { pointer-events: none; }
        .nxl-h-item { position: relative; margin: 0 0.25rem; }
        .nxl-h-badge { position: absolute; top: 0; right: 0; font-size: 10px; min-width: 18px; height: 18px; padding: 0 4px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .avatar-text { display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: 600; }
        .avatar-md { width: 40px; height: 40px; font-size: 14px; }
        .avatar-sm { width: 32px; height: 32px; font-size: 12px; }
        .dropdown-item { padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; text-decoration: none; color: #333; transition: background-color 0.2s; }
        .dropdown-item:hover { background-color: #f8f9fa; }
        .dropdown-item i { width: 18px; }
        .notifications-head { padding: 1rem; border-bottom: 1px solid #eee; }
        .notifications-item { display: flex; padding: 0.75rem 1rem; border-bottom: 1px solid #f5f5f5; }
        .notifications-item:hover { background-color: #f8f9fa; }
        .notifications-desc { flex: 1; margin-right: 0.75rem; }
        .notifications-footer { padding: 0.75rem; border-top: 1px solid #eee; }
        .nxl-notifications-menu { min-width: 320px !important; }
        .nxl-user-dropdown { min-width: 220px !important; }
        .dropdown-header { padding: 1rem; border-bottom: 1px solid #eee; }
        .nxl-search-dropdown { min-width: 300px !important; padding: 1rem !important; }
        .nxl-navigation-toggle a { display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 50%; color: #333; cursor: pointer; transition: all 0.2s ease; }
        .nxl-navigation-toggle a:hover { background-color: var(--primary-soft, #e8f0fb); color: var(--primary, #004aad); }
        .nxl-navigation-toggle a i { font-size: 20px; }
        .hamburger { cursor: pointer; padding: 10px; }
        .hamburger-box { width: 20px; height: 16px; position: relative; }
        .hamburger-inner, .hamburger-inner::before, .hamburger-inner::after { width: 20px; height: 2px; background-color: #333; position: absolute; transition: transform 0.15s ease; }
        .hamburger-inner { top: 50%; transform: translateY(-50%); }
        .hamburger-inner::before { content: ''; top: -6px; }
        .hamburger-inner::after { content: ''; bottom: -6px; }
    </style>
    }
    else
    {
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; direction: ltr; text-align: left; }
        .nxl-navigation { position: fixed; top: 0; left: 0; right: auto !important; width: 280px; height: 100vh; background-color: #fff; box-shadow: 0 0 15px rgba(0,0,0,.05); z-index: 1030; transition: all 0.3s ease; }
        .nxl-container { margin-left: 280px !important; margin-right: 0 !important; min-height: auto !important; display: flex; flex-direction: column; padding-top: 0px !important; }
        .nxl-header { position: fixed; top: 0; left: 280px; right: 0; height: 70px; background-color: #fff; border-bottom: 1px solid #eee; z-index: 1020; display: flex; align-items: center; }
        .header-wrapper { width: 100%; display: flex; align-items: center; justify-content: space-between; padding: 0 1.5rem; height: 100%; }
        html.minimenu .nxl-container { margin-left: 140px !important; min-height: auto !important; }
        html.minimenu .nxl-navigation { width: 120px !important; }
        html.minimenu .nxl-header { left: 120px; }
        html.minimenu .footer { left: 120px !important; }
        .nxl-arrow i { transition: transform 0.25s ease; }
        .nxl-hasmenu.nxl-trigger .nxl-arrow i, .nxl-hasmenu.open .nxl-arrow i { transform: rotate(90deg); }
        @@media (max-width: 1199px) {
            .nxl-container { margin-left: 0 !important; min-height: auto !important; }
            .nxl-navigation { left: -280px !important; }
            .nxl-header { left: 0 !important; right: 0 !important; width: 100% !important; height: 60px !important; }
            body.nxl-navigation-show .nxl-navigation { left: 0 !important; }
            .footer { left: 0 !important; }
        }
        @@media (max-width: 767px) {
            .nxl-header { height: 56px !important; }
            .header-wrapper { padding: 0 0.75rem !important; height: 56px !important; }
            .nxl-header .dropdown-menu { position: fixed !important; top: 56px !important; left: 10px !important; right: 10px !important; width: calc(100vw - 20px) !important; max-width: none !important; max-height: calc(100vh - 76px) !important; overflow-y: auto !important; }
            .page-header { padding: 0.75rem 0 !important; margin-bottom: 1rem !important; }
            .page-header-left { flex-direction: column; align-items: flex-start !important; }
        }
        .nxl-header .dropdown, .nxl-header .nxl-h-item { position: relative; }
        .nxl-header .dropdown-menu { position: absolute; top: 100%; z-index: 1050; display: none; min-width: 200px; padding: 0.5rem 0; margin-top: 0.5rem; background-color: #fff; border: 1px solid rgba(0,0,0,.1); border-radius: 0.5rem; box-shadow: 0 0.5rem 1.5rem rgba(0,0,0,.15); }
        .nxl-header .dropdown-menu.show { display: block !important; }
        .nxl-header .dropdown-menu-end, .nxl-header .dropdown-menu { right: 0 !important; left: auto !important; }
        .header-dropdown-toggle.active { background-color: var(--primary-soft, #e8f0fb) !important; color: var(--primary, #004aad) !important; }
        .breadcrumb { display: flex; flex-wrap: wrap; padding: 0; margin: 0 1.5rem; list-style: none; gap: 0.25rem; align-items: center; }
        .breadcrumb-item { display: flex; align-items: center; font-size: 0.875rem; }
        .breadcrumb-item a { color: #6c757d; text-decoration: none; }
        .breadcrumb-item a:hover { color: var(--primary, #004aad); }
        .breadcrumb-item.active, .breadcrumb-item:last-child { color: #333; font-weight: 600; }
        .breadcrumb-item + .breadcrumb-item::before { content: ">"; padding: 0 0.75rem; color: #adb5bd; font-size: 0.75rem; }
        .page-header { display: flex; align-items: center; justify-content: space-between; padding: 1rem 0; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .page-header-left { display: flex; align-items: center; flex-wrap: wrap; }
        .page-header-title { margin-right: 1.5rem; padding-right: 1.5rem; border-right: 3px solid var(--primary, #004aad); }
        .page-header-title h5 { margin: 0; font-weight: 700; color: #333; font-size: 1.25rem; }
        .nxl-submenu .nxl-link { padding: 0.5rem 1rem; font-size: 0.9rem; color: #666; }
        .nxl-submenu .nxl-link:hover { color: var(--primary, #004aad); background-color: rgba(0, 74, 173, 0.05); }
        .nxl-submenu .nxl-link.active { color: var(--primary, #004aad); font-weight: 600; }
        .nxl-submenu { display: none; list-style: none; margin: 0; padding: 0.5rem 0 0.5rem 1rem; background-color: rgba(0,0,0,.02); overflow: hidden; }
        .nxl-hasmenu.nxl-trigger > .nxl-submenu, .nxl-hasmenu.open > .nxl-submenu { display: block; }
        .navbar-content { position: relative; height: calc(100vh - 80px); overflow: hidden; }
        .navbar-wrapper { height: 100%; display: flex; flex-direction: column; }
        .m-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid #eee; min-height: 100px; display: flex; align-items: center; }
        .b-brand { text-decoration: none; display: flex; align-items: center; justify-content: center; width: 100%; }
        .b-brand img { max-width: 100%; height: auto; object-fit: contain; }
        .nxl-navbar { list-style: none; margin: 0; padding: 1rem 0; }
        .nxl-link { display: flex; align-items: center; padding: 0.75rem 1rem; text-decoration: none; color: #333; border-radius: 0.375rem; margin: 0 0.5rem; transition: all 0.2s; }
        .nxl-link:hover { background-color: rgba(0, 74, 173, 0.1); color: var(--primary, #004aad); }
        .nxl-micon { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; }
        .nxl-mtext { flex: 1; }
        .nxl-caption { padding: 1rem 1.5rem 0.5rem; }
        .nxl-caption label { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: #999; }
        .logo-sm { display: none; } html.minimenu .logo-lg { display: none; } html.minimenu .logo-sm { display: block; }
        .header-dropdown-toggle { display: flex !important; align-items: center; justify-content: center; width: 42px; height: 42px; border-radius: 50%; background-color: #f5f5f5; color: #333; text-decoration: none; cursor: pointer; transition: all 0.2s ease; position: relative; }
        .header-dropdown-toggle:hover, .header-dropdown-toggle.active { background-color: var(--primary-soft, #e8f0fb); color: var(--primary, #004aad); }
        .header-dropdown-toggle i, .header-dropdown-toggle .avatar-text { pointer-events: none; }
        .nxl-h-item { position: relative; margin: 0 0.25rem; }
        .nxl-h-badge { position: absolute; top: 0; right: 0; font-size: 10px; min-width: 18px; height: 18px; padding: 0 4px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .avatar-text { display: flex; align-items: center; justify-content: center; border-radius: 50%; font-weight: 600; }
        .avatar-md { width: 40px; height: 40px; font-size: 14px; }
        .avatar-sm { width: 32px; height: 32px; font-size: 12px; }
        .dropdown-item { padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; text-decoration: none; color: #333; transition: background-color 0.2s; }
        .dropdown-item:hover { background-color: #f8f9fa; }
        .dropdown-item i { width: 18px; }
        .notifications-head { padding: 1rem; border-bottom: 1px solid #eee; }
        .notifications-item { display: flex; padding: 0.75rem 1rem; border-bottom: 1px solid #f5f5f5; }
        .notifications-item:hover { background-color: #f8f9fa; }
        .notifications-desc { flex: 1; margin-left: 0.75rem; }
        .notifications-footer { padding: 0.75rem; border-top: 1px solid #eee; }
        .nxl-notifications-menu { min-width: 320px !important; }
        .nxl-user-dropdown { min-width: 220px !important; }
        .dropdown-header { padding: 1rem; border-bottom: 1px solid #eee; }
        .nxl-search-dropdown { min-width: 300px !important; padding: 1rem !important; }
        .nxl-navigation-toggle a { display: flex; align-items: center; justify-content: center; width: 36px; height: 36px; border-radius: 50%; color: #333; cursor: pointer; transition: all 0.2s ease; }
        .nxl-navigation-toggle a:hover { background-color: var(--primary-soft, #e8f0fb); color: var(--primary, #004aad); }
        .nxl-navigation-toggle a i { font-size: 20px; }
        .hamburger { cursor: pointer; padding: 10px; }
        .hamburger-box { width: 20px; height: 16px; position: relative; }
        .hamburger-inner, .hamburger-inner::before, .hamburger-inner::after { width: 20px; height: 2px; background-color: #333; position: absolute; transition: transform 0.15s ease; }
        .hamburger-inner { top: 50%; transform: translateY(-50%); }
        .hamburger-inner::before { content: ''; top: -6px; }
        .hamburger-inner::after { content: ''; bottom: -6px; }
    </style>
    }
    
    @RenderSection("Styles", required: false)
</head>

<body>
    <!-- Locale strings for JS (AR/EN) - extended by views via window.__T -->
    <script>
        window.__T = window.__T || {};
        (function() {
            var t = {
                Error: '@Html.Raw(Html.T("حدث خطأ", "An error occurred").Replace("\\", "\\\\").Replace("'", "\\'"))',
                Processing: '@Html.Raw(Html.T("جاري المعالجة...", "Processing...").Replace("\\", "\\\\").Replace("'", "\\'"))',
                Success: '@Html.Raw(Html.T("تمت العملية بنجاح", "Success").Replace("\\", "\\\\").Replace("'", "\\'"))',
                Close: '@Html.Raw(Html.T("إغلاق", "Close").Replace("\\", "\\\\").Replace("'", "\\'"))',
                ConfirmDelete: '@Html.Raw(Html.T("هل أنت متأكد من الحذف؟", "Are you sure you want to delete?").Replace("\\", "\\\\").Replace("'", "\\'"))',
                ConfirmDeleteReminder: '@Html.Raw(Html.T("هل تريد حذف هذا التذكير؟", "Are you sure you want to delete this reminder?").Replace("\\", "\\\\").Replace("'", "\\'"))',
                AgreeTerms: '@Html.Raw(Html.T("يجب الموافقة على الشروط والأحكام", "You must agree to the terms and conditions").Replace("\\", "\\\\").Replace("'", "\\'"))',
                PleaseEnterCoupon: '@Html.Raw(Html.T("يرجى إدخال رمز الكوبون", "Please enter coupon code").Replace("\\", "\\\\").Replace("'", "\\'"))',
                InvalidCoupon: '@Html.Raw(Html.T("الكوبون غير صالح", "Invalid coupon").Replace("\\", "\\\\").Replace("'", "\\'"))',
                ErrorApplyingCoupon: '@Html.Raw(Html.T("حدث خطأ أثناء تطبيق الكوبون", "Error applying coupon").Replace("\\", "\\\\").Replace("'", "\\'"))',
                PleaseEnterGiftCard: '@Html.Raw(Html.T("يرجى إدخال رمز بطاقة الهدية", "Please enter gift card code").Replace("\\", "\\\\").Replace("'", "\\'"))',
                InvalidGiftCard: '@Html.Raw(Html.T("بطاقة الهدية غير صالحة", "Invalid gift card").Replace("\\", "\\\\").Replace("'", "\\'"))',
                ErrorApplyingGiftCard: '@Html.Raw(Html.T("حدث خطأ أثناء تطبيق بطاقة الهدية", "Error applying gift card").Replace("\\", "\\\\").Replace("'", "\\'"))',
                SecurePayment: '@Html.Raw(Html.T("إتمام الدفع الآمن", "Complete Secure Payment").Replace("\\", "\\\\").Replace("'", "\\'"))',
                CopySuccess: '@Html.Raw(Html.T("تم النسخ", "Copied").Replace("\\", "\\\\").Replace("'", "\\'"))',
                CopyCode: '@Html.Raw(Html.T("نسخ الرمز", "Copy code").Replace("\\", "\\\\").Replace("'", "\\'"))',
                CopyRefSuccess: '@Html.Raw(Html.T("تم نسخ الرقم المرجعي", "Reference number copied").Replace("\\", "\\\\").Replace("'", "\\'"))',
                PaymentError: '@Html.Raw(Html.T("حدث خطأ أثناء معالجة الدفع", "An error occurred while processing payment").Replace("\\", "\\\\").Replace("'", "\\'"))',
                PaymentStarted: '@Html.Raw(Html.T("تم بدء عملية الدفع بنجاح", "Payment process started successfully").Replace("\\", "\\\\").Replace("'", "\\'"))',
                PaymentNotConfigured: '@Html.Raw(Html.T("الدفع غير مُعد. يرجى التواصل مع الدعم.", "Payment is not configured. Please contact support.").Replace("\\", "\\\\").Replace("'", "\\'"))',
                UnexpectedError: '@Html.Raw(Html.T("حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.", "An unexpected error occurred. Please try again.").Replace("\\", "\\\\").Replace("'", "\\'"))',
                Verifying: '@Html.Raw(Html.T("جاري التحقق...", "Verifying...").Replace("\\", "\\\\").Replace("'", "\\'"))',
                AnswerMinLength: '@Html.Raw(Html.T("يجب أن تكون الإجابة 10 أحرف على الأقل", "Answer must be at least 10 characters").Replace("\\", "\\\\").Replace("'", "\\'"))'
        };
            Object.assign(window.__T, t);
        })();
    </script>
    <!--! [Start] Navigation Menu !-->
    @await Html.PartialAsync("~/Areas/Student/Views/Shared/_Sidebar.cshtml")
    <!--! [End] Navigation Menu !-->
    
    <!--! [Start] Header !-->
    @await Html.PartialAsync("~/Areas/Student/Views/Shared/_Header.cshtml")
    <!--! [End] Header !-->
    
    <main class="nxl-container">
        <div class="nxl-content" style="flex: 1 0 auto;">
            <div class="page-header">
                <div class="page-header-left d-flex align-items-center">
                    <div class="page-header-title">
                        <h5 class="m-b-10">@ViewData["Title"]</h5>
                    </div>
                    @if (ViewData["Breadcrumbs"] != null)
                    {
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a asp-area="Student" asp-controller="Dashboard" asp-action="Index">@Html.T("الرئيسية", "Home")</a></li>
                            @Html.Raw(ViewData["Breadcrumbs"])
                        </ul>
                    }
                </div>
            </div>
            
            <div class="main-content" style="height: auto; display: block;">
                @RenderBody()
            </div>
        </div>
        
        <!-- Footer Spacer -->
        <div style="height: 80px;"></div>
        
        <!-- Fixed Footer -->
        <footer class="footer" style="position: fixed; bottom: 0; @(Html.IsRtl() ? "left: 0; right: 280px;" : "right: 0; left: 280px;") height: 40px; background-color: #f8f9fa; border-top: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: center; z-index: 1000;">
            <p class="fs-11 text-muted fw-medium text-uppercase mb-0 copyright">
                <span>&copy; @DateTime.Now.Year @Html.T("منصة WEBUILDER.", "WEBUILDER Platform.")</span>
                <span class="d-none d-sm-inline-block">@Html.T("جميع الحقوق محفوظة.", "All rights reserved.")</span>
            </p>
        </footer>
    </main>
    
    <!-- jQuery -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    
    <!-- Bootstrap Bundle -->
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- PerfectScrollbar -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/perfect-scrollbar/1.5.5/perfect-scrollbar.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Site.js - Global scripts including modal fix -->
    <script src="~/js/site.js" asp-append-version="true"></script>
    
    <script>
        (function() {
            'use strict';
            
            document.addEventListener('DOMContentLoaded', function() {
                initSidebar();
                initHeaderDropdowns();
                initMobileToggle();
                initScrollbar();
                initActiveMenuHighlight();
            });
            
            function initSidebar() {
                var sidebar = document.querySelector('#main-sidebar');
                if (!sidebar) return;
                
                sidebar.addEventListener('click', function(e) {
                    var menuLink = e.target.closest('.nxl-hasmenu > a.nxl-link');
                    if (!menuLink) return;
                    
                    var parent = menuLink.closest('.nxl-hasmenu');
                    if (!parent) return;
                    
                    var submenu = parent.querySelector('.nxl-submenu');
                    if (!submenu) return;
                    
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    
                    var isOpen = parent.classList.contains('nxl-trigger');
                    
                    document.querySelectorAll('.nxl-hasmenu.nxl-trigger').forEach(function(openMenu) {
                        if (openMenu !== parent) {
                            openMenu.classList.remove('nxl-trigger', 'open');
                            var openSubmenu = openMenu.querySelector('.nxl-submenu');
                            if (openSubmenu) {
                                slideUp(openSubmenu, 300);
                            }
                        }
                    });
                    
                    if (isOpen) {
                        parent.classList.remove('nxl-trigger', 'open');
                        slideUp(submenu, 300);
                    } else {
                        parent.classList.add('nxl-trigger', 'open');
                        slideDown(submenu, 300);
                    }
                }, true);
            }
            
            function initHeaderDropdowns() {
                var isProcessingTouch = false;
                
                // Core toggle function
                function toggleDropdown(toggle) {
                    var parent = toggle.closest('.dropdown, .nxl-h-item');
                    if (!parent) return false;
                    
                    var menu = parent.querySelector('.dropdown-menu');
                    if (!menu) return false;
                    
                    var isOpen = menu.classList.contains('show');
                    
                    // Close all other dropdowns first
                    closeAllDropdowns();
                    
                    // Toggle current dropdown
                    if (!isOpen) {
                        menu.classList.add('show');
                        toggle.classList.add('active');
                        menu.setAttribute('data-just-opened', 'true');
                        setTimeout(function() {
                            menu.removeAttribute('data-just-opened');
                        }, 200);
                    }
                    return true;
                }
                
                // Handle click events on dropdown toggles
                document.addEventListener('click', function(e) {
                    // Skip if we just processed a touch event
                    if (isProcessingTouch) {
                        isProcessingTouch = false;
                        return;
                    }
                    
                    var toggle = e.target.closest('.header-dropdown-toggle');
                    
                    if (toggle) {
                        e.preventDefault();
                        e.stopPropagation();
                        toggleDropdown(toggle);
                        return;
                    }
                    
                    // Check if clicked inside a dropdown menu (don't close)
                    var insideDropdownMenu = e.target.closest('.nxl-h-item .dropdown-menu');
                    if (insideDropdownMenu && !insideDropdownMenu.hasAttribute('data-just-opened')) {
                        return;
                    }
                    
                    // Close dropdowns when clicking outside
                    var insideHeaderItem = e.target.closest('.nxl-h-item');
                    if (!insideHeaderItem) {
                        closeAllDropdowns();
                    }
                }, true); // Use capture phase
                
                // Handle touch events for mobile - using touchstart for better responsiveness
                document.addEventListener('touchstart', function(e) {
                    var toggle = e.target.closest('.header-dropdown-toggle');
                    if (toggle) {
                        e.preventDefault();
                        isProcessingTouch = true;
                        toggleDropdown(toggle);
                    }
                }, { passive: false });
                
                // Handle Escape key to close dropdowns
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        closeAllDropdowns();
                    }
                });
            }
            
            function closeAllDropdowns() {
                document.querySelectorAll('.nxl-h-item .dropdown-menu.show').forEach(function(m) {
                    m.classList.remove('show');
                    m.removeAttribute('data-just-opened');
                });
                document.querySelectorAll('.header-dropdown-toggle.active').forEach(function(t) {
                    t.classList.remove('active');
                });
            }
            
            function initMobileToggle() {
                var toggle = document.getElementById('mobile-collapse');
                var sidebarCloseBtn = document.getElementById('sidebar-close-btn');
                var miniBtn = document.getElementById('menu-mini-button');
                var expandBtn = document.getElementById('menu-expend-button');
                
                if (toggle) {
                    toggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.body.classList.toggle('nxl-navigation-show');
                    });
                }
                
                // Sidebar close button handler
                if (sidebarCloseBtn) {
                    sidebarCloseBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.body.classList.remove('nxl-navigation-show');
                    });
                }
                
                // Menu mini/expand buttons
                if (miniBtn) {
                    miniBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.documentElement.classList.add('minimenu');
                        this.style.display = 'none';
                        if (expandBtn) expandBtn.style.display = 'block';
                    });
                }
                
                if (expandBtn) {
                    expandBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        document.documentElement.classList.remove('minimenu');
                        this.style.display = 'none';
                        if (miniBtn) miniBtn.style.display = 'block';
                    });
                }
                
                // Close sidebar when clicking on overlay
                document.addEventListener('click', function(e) {
                    if (document.body.classList.contains('nxl-navigation-show')) {
                        var navigation = document.querySelector('.nxl-navigation');
                        var header = document.querySelector('.nxl-header');
                        var isClickInsideNav = navigation && navigation.contains(e.target);
                        var isClickOnToggle = toggle && toggle.contains(e.target);
                        var isClickInsideHeader = header && header.contains(e.target);
                        
                        // Don't close sidebar when clicking inside header or navigation
                        if (!isClickInsideNav && !isClickOnToggle && !isClickInsideHeader) {
                            document.body.classList.remove('nxl-navigation-show');
                        }
                    }
                });
            }
            
            function initScrollbar() {
                var nav = document.querySelector('.navbar-content');
                if (nav && typeof PerfectScrollbar !== 'undefined') {
                    new PerfectScrollbar(nav, { suppressScrollX: true });
                }
            }
            
            function initActiveMenuHighlight() {
                var currentPath = window.location.pathname.toLowerCase();
                var menuLinks = document.querySelectorAll('.nxl-navbar a[href]');
                
                menuLinks.forEach(function(link) {
                    var href = link.getAttribute('href');
                    if (href && href !== '/' && href !== '#' && href !== 'javascript:void(0);') {
                        var linkPath = href.toLowerCase();
                        if (currentPath === linkPath || currentPath.indexOf(linkPath) !== -1 || linkPath.indexOf(currentPath) !== -1) {
                            link.classList.add('active');
                            var parentMenu = link.closest('.nxl-hasmenu');
                            if (parentMenu) {
                                parentMenu.classList.add('nxl-trigger', 'open', 'active');
                                var submenu = parentMenu.querySelector('.nxl-submenu');
                                if (submenu) {
                                    submenu.style.display = 'block';
                                }
                            }
                        }
                    }
                });
                
                document.querySelectorAll('.nxl-hasmenu.active, .nxl-hasmenu.open').forEach(function(menu) {
                    menu.classList.add('nxl-trigger');
                    var submenu = menu.querySelector('.nxl-submenu');
                    if (submenu) {
                        submenu.style.display = 'block';
                    }
                });
            }
            
            function slideDown(element, duration) {
                if (!element) return;
                
                element.style.display = 'block';
                element.style.overflow = 'hidden';
                element.style.height = '0';
                element.style.paddingTop = '0';
                element.style.paddingBottom = '0';
                element.style.marginTop = '0';
                element.style.marginBottom = '0';
                element.style.transition = 'height ' + duration + 'ms ease, padding ' + duration + 'ms ease, margin ' + duration + 'ms ease';
                
                element.offsetHeight;
                
                var height = element.scrollHeight;
                var computedStyle = window.getComputedStyle(element);
                
                requestAnimationFrame(function() {
                    element.style.height = height + 'px';
                    element.style.paddingTop = computedStyle.paddingTop;
                    element.style.paddingBottom = computedStyle.paddingBottom;
                });
                
                setTimeout(function() {
                    element.style.height = '';
                    element.style.overflow = '';
                    element.style.paddingTop = '';
                    element.style.paddingBottom = '';
                    element.style.marginTop = '';
                    element.style.marginBottom = '';
                    element.style.transition = '';
                }, duration);
            }
            
            function slideUp(element, duration) {
                if (!element) return;
                
                var computedStyle = window.getComputedStyle(element);
                var height = element.scrollHeight;
                
                element.style.overflow = 'hidden';
                element.style.height = height + 'px';
                element.style.transition = 'height ' + duration + 'ms ease, padding ' + duration + 'ms ease, margin ' + duration + 'ms ease';
                
                element.offsetHeight;
                
                requestAnimationFrame(function() {
                    element.style.height = '0';
                    element.style.paddingTop = '0';
                    element.style.paddingBottom = '0';
                    element.style.marginTop = '0';
                    element.style.marginBottom = '0';
                });
                
                setTimeout(function() {
                    element.style.display = 'none';
                    element.style.height = '';
                    element.style.overflow = '';
                    element.style.paddingTop = '';
                    element.style.paddingBottom = '';
                    element.style.marginTop = '';
                    element.style.marginBottom = '';
                    element.style.transition = '';
                }, duration);
            }
        })();
    </script>
    
    <!-- Plyr Video Player -->
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
    
    <!-- Content Protection -->
    <script src="~/js/content-protection.js"></script>
    
    <!-- Secure Video Player (loaded once for lesson/course players) -->
    <script src="~/js/secure-video-player.js" asp-append-version="true"></script>
    
    <!-- Signal that secure player is ready -->
    <script>
        document.dispatchEvent(new Event('securePlayerReady'));
        // Add content-protected class to body for student area
        document.body.classList.add('content-protected');
    </script>
    
    <script src="~/js/pwa-register.js" asp-append-version="true"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>
