@model dynamic
@{
    ViewData["Title"] = Html.T("انضم للجلسة المباشرة", "Join Live Session");
    Layout = null;
    var liveClass = ViewBag.LiveClass;
}

<!DOCTYPE html>
<html lang="@Html.Lang()" dir="@Html.Dir()">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@liveClass.Title - @Html.T("جلسة مباشرة", "Live Session")</title>
    
    <link rel="stylesheet" href="~/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/assets/vendors/css/vendors.min.css" />
    <link rel="stylesheet" href="~/assets/css/theme.min.css" />
    
    <style>
        body {
            background: #1a1a1a;
            overflow: hidden;
        }
        .video-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .video-area {
            flex: 1;
            background: #000;
            position: relative;
        }
        .video-controls {
            background: #2d2d2d;
            padding: 15px;
            border-top: 1px solid #3d3d3d;
        }
        .chat-sidebar {
            height: 100vh;
            background: #1a1a1a;
            border-right: 1px solid #2d2d2d;
            display: flex;
            flex-direction: column;
        }
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        .chat-message {
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #2d2d2d;
            color: #e5e7eb;
        }
        .chat-input-area {
            border-top: 1px solid #2d2d2d;
            padding: 15px;
        }
        .live-indicator {
            background: #ef4444;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="row g-0">
        <!-- Main Video Area -->
        <div class="col-lg-9">
            <div class="video-container">
                <!-- Video Stream -->
                <div class="video-area">
                    <div id="videoStream" style="width: 100%; height: 100%;">
                        <!-- WebRTC video or embedded stream will go here -->
                        <div class="d-flex align-items-center justify-content-center h-100">
                            <div class="text-center text-white">
                                <i class="feather-video fs-1 mb-3"></i>
                                <h4 class="text-white mb-2">@liveClass.Title</h4>
                                <p class="text-muted">@Html.T("جاري تحميل البث المباشر...", "Loading live stream...")</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Live Indicator -->
                    <div class="position-absolute" style="top: 20px; left: 20px;">
                        <span class="live-indicator">
                            <i class="feather-circle me-1" style="font-size: 8px;"></i>
                            @Html.T("مباشر", "LIVE")
                        </span>
                    </div>

                    <!-- Viewers Count -->
                    <div class="position-absolute" style="top: 20px; right: 20px;">
                        <span class="badge bg-dark bg-opacity-75 text-white">
                            <i class="feather-eye me-1"></i>
                            <span id="viewersCount">45</span> @Html.T("مشاهد", "viewers")
                        </span>
                    </div>
                </div>

                <!-- Video Controls -->
                <div class="video-controls">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex gap-2">
                            <button class="btn btn-icon btn-secondary" id="muteBtn">
                                <i class="feather-mic"></i>
                            </button>
                            <button class="btn btn-icon btn-secondary" id="videoBtn">
                                <i class="feather-video"></i>
                            </button>
                            <button class="btn btn-icon btn-secondary" id="screenShareBtn">
                                <i class="feather-monitor"></i>
                            </button>
                            <button class="btn btn-icon btn-secondary" id="raiseHandBtn">
                                <i class="feather-hand"></i>
                            </button>
                        </div>
                        
                        <div class="text-white">
                            <i class="feather-clock me-2"></i>
                            <span id="duration">00:45:32</span>
                        </div>

                        <button class="btn btn-danger" onclick="leaveClass()">
                            <i class="feather-phone-off me-2"></i>
                            @Html.T("مغادرة", "Leave")
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Sidebar -->
        <div class="col-lg-3">
            <div class="chat-sidebar">
                <div class="p-3 border-bottom border-secondary">
                    <h6 class="text-white mb-0">
                        <i class="feather-message-circle me-2"></i>
                        @Html.T("الدردشة المباشرة", "Live Chat")
                    </h6>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="chat-message">
                        <strong class="text-primary">@Html.T("د. محمد", "Dr. Mohammed")</strong>
                        <p class="mb-1 fs-13">@Html.T("مرحباً بالجميع!", "Welcome everyone!")</p>
                        <small class="text-muted">10:00 @Html.T("ص", "AM")</small>
                    </div>

                    <div class="chat-message">
                        <strong class="text-success">@Html.T("أحمد", "Ahmed")</strong>
                        <p class="mb-1 fs-13">@Html.T("السلام عليكم دكتور", "Hello Doctor")</p>
                        <small class="text-muted">10:01 @Html.T("ص", "AM")</small>
                    </div>
                </div>

                <div class="chat-input-area">
                    <form id="chatForm" onsubmit="sendMessage(event)">
                        <div class="input-group">
                            <input type="text" class="form-control bg-dark text-white border-secondary" placeholder="@Html.T("اكتب رسالة...", "Type a message...")" id="chatInput" />
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-send"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="~/assets/vendors/js/vendors.min.js"></script>
    <script>
        // WebRTC or video streaming logic would go here
        var youLabel = '@Html.Raw(Html.T("أنت", "You"))';
        var nowLabel = '@Html.Raw(Html.T("الآن", "Now"))';
        var leaveConfirmMsg = '@Html.Raw(Html.T("هل أنت متأكد من مغادرة الجلسة المباشرة؟", "Are you sure you want to leave the live session?"))';

        function sendMessage(e) {
            e.preventDefault();
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                const chatMessages = document.getElementById('chatMessages');
                const messageHtml = `
                    <div class="chat-message">
                        <strong class="text-info">${youLabel}</strong>
                        <p class="mb-1 fs-13">${message}</p>
                        <small class="text-muted">${nowLabel}</small>
                    </div>
                `;
                chatMessages.insertAdjacentHTML('beforeend', messageHtml);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                input.value = '';
            }
        }

        function leaveClass() {
            if (confirm(leaveConfirmMsg)) {
                window.location.href = '@Url.Action("Index")';
            }
        }

        // Update duration every second
        let seconds = 2732;
        setInterval(() => {
            seconds++;
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            document.getElementById('duration').textContent = 
                (hours > 0 ? hours.toString().padStart(2, '0') + ':' : '') +
                minutes.toString().padStart(2, '0') + ':' +
                secs.toString().padStart(2, '0');
        }, 1000);
    </script>
</body>
</html>
