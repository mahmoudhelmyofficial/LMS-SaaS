@model List<LMS.Areas.Student.ViewModels.AvailableScheduleViewModel>
@{
    ViewData["Title"] = Html.T("جداول الحصص المباشرة", "Live Session Schedules");
}

@section Styles {
<style>
    .schedule-card {
        transition: all 0.3s ease;
        border-radius: 12px;
        overflow: hidden;
    }
    .schedule-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    .schedule-thumbnail {
        height: 180px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }
    .schedule-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .price-overlay {
        position: absolute;
        bottom: 10px;
        left: 10px;
        z-index: 5;
    }
    .enrolled-overlay {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 5;
    }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<!-- Header -->
<div class="card stretch stretch-full mb-4">
    <div class="card-body">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
            <div>
                <h3 class="fw-bold mb-2">
                    <i class="feather-calendar text-primary me-2"></i>
                    @Html.T("جداول الحصص المباشرة", "Live Session Schedules")
                </h3>
                <p class="text-muted mb-0">@Html.T("اشترك في جدول حصص كامل واحضر جميع الجلسات", "Subscribe to a full schedule and attend all sessions")</p>
            </div>
            <div class="d-flex gap-2">
                <a asp-area="Student" asp-controller="LiveSessionSchedules" asp-action="MySchedules" class="btn btn-outline-primary">
                    <i class="feather-bookmark me-2"></i>
                    @Html.T("جداولي", "My Schedules")
                </a>
                <a asp-area="Student" asp-controller="LiveClasses" asp-action="Index" class="btn btn-outline-danger">
                    <i class="feather-video me-2"></i>
                    @Html.T("الجلسات المباشرة", "Live Sessions")
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Schedules Grid -->
<div class="row g-4">
    @if (Model != null && Model.Any())
    {
        @foreach (var schedule in Model)
        {
            var hasDiscount = schedule.OriginalPrice.HasValue && schedule.OriginalPrice > schedule.Price;
            var isFull = schedule.MaxStudents.HasValue && schedule.EnrolledCount >= schedule.MaxStudents.Value;

            <div class="col-lg-4 col-md-6">
                <div class="card schedule-card stretch stretch-full">
                    <!-- Thumbnail -->
                    <div class="schedule-thumbnail">
                        @if (!string.IsNullOrEmpty(schedule.ThumbnailUrl))
                        {
                            <img src="@schedule.ThumbnailUrl" alt="@schedule.Title" />
                        }
                        else
                        {
                            <i class="feather-calendar text-white" style="font-size: 48px; opacity: 0.5;"></i>
                        }

                        <!-- Price Badge -->
                        <div class="price-overlay">
                            @if (schedule.Price == 0)
                            {
                                <span class="badge bg-success px-3 py-2 fs-6">@Html.T("مجاني", "Free")</span>
                            }
                            else
                            {
                                <span class="badge bg-warning text-dark px-3 py-2 fs-6">
                                    @if (hasDiscount)
                                    {
                                        <small class="text-decoration-line-through opacity-75 me-1">@schedule.OriginalPrice?.ToString("N0")</small>
                                    }
                                    @schedule.Price.ToEGP(0)
                                </span>
                            }
                        </div>

                        @if (schedule.IsEnrolled)
                        {
                            <div class="enrolled-overlay">
                                <span class="badge bg-success px-3 py-2">
                                    <i class="feather-check-circle me-1"></i>
                                    @Html.T("مشترك", "Enrolled")
                                </span>
                            </div>
                        }
                    </div>

                    <div class="card-body">
                        <h5 class="fw-bold mb-2">@schedule.Title</h5>
                        <p class="text-muted fs-12 mb-3">@schedule.InstructorName</p>

                        @if (!string.IsNullOrEmpty(schedule.Description))
                        {
                            <p class="text-muted small mb-3" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                @schedule.Description
                            </p>
                        }

                        <div class="d-flex align-items-center gap-3 mb-3 fs-12 text-muted">
                            <span>
                                <i class="feather-layers me-1"></i>
                                @schedule.TotalSessions @Html.T("جلسة", "session(s)")
                            </span>
                            <span>
                                <i class="feather-calendar me-1"></i>
                                @schedule.StartDate.ToString("dd/MM") - @schedule.EndDate.ToString("dd/MM")
                            </span>
                            <span>
                                <i class="feather-users me-1"></i>
                                @schedule.EnrolledCount
                                @if (schedule.MaxStudents.HasValue)
                                {
                                    <text>/@schedule.MaxStudents</text>
                                }
                            </span>
                        </div>

                        @if (schedule.IsEnrolled)
                        {
                            <a asp-action="Details" asp-route-id="@schedule.Id" class="btn btn-success w-100">
                                <i class="feather-eye me-2"></i>
                                @Html.T("عرض الجلسات", "View Sessions")
                            </a>
                        }
                        else if (isFull)
                        {
                            <button class="btn btn-secondary w-100" disabled>
                                <i class="feather-x-circle me-2"></i>
                                @Html.T("اكتمل العدد", "Fully Booked")
                            </button>
                        }
                        else if (schedule.Price == 0)
                        {
                            <a asp-action="Purchase" asp-route-id="@schedule.Id" class="btn btn-success w-100">
                                <i class="feather-user-plus me-2"></i>
                                @Html.T("اشترك مجاناً", "Subscribe for Free")
                            </a>
                        }
                        else
                        {
                            <a asp-action="Purchase" asp-route-id="@schedule.Id" class="btn btn-primary w-100">
                                <i class="feather-shopping-cart me-2"></i>
                                @Html.T("اشترك الآن", "Subscribe Now")
                            </a>
                        }
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <div class="col-12">
            <div class="card stretch stretch-full">
                <div class="card-body text-center py-5">
                    <i class="feather-calendar" style="font-size: 64px; color: #ddd;"></i>
                    <h5 class="mt-3 text-muted">@Html.T("لا توجد جداول حصص متاحة", "No session schedules available")</h5>
                    <p class="text-muted">@Html.T("لا توجد جداول حصص منشورة حالياً. تحقق مرة أخرى لاحقاً.", "No session schedules are currently published. Check back later.")</p>
                </div>
            </div>
        </div>
    }
</div>
