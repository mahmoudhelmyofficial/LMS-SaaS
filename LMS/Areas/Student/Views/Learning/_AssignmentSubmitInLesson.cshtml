@model LMS.Domain.Entities.Assessments.AssignmentSubmission
@{
    var assignment = Model.Assignment;
    var lessonId = (int)ViewBag.LessonId;
    var isOverdue = assignment.DueDate.HasValue && assignment.DueDate.Value < DateTime.UtcNow;
}
<div class="tutor-panel assignment-panel text-white">
    <div class="d-flex align-items-center justify-content-between mb-4">
        <h4 class="text-white mb-0"><i class="feather-edit me-2"></i>@assignment.Title</h4>
        <a asp-action="Lesson" asp-controller="Learning" asp-route-lessonId="@lessonId" class="btn btn-outline-light btn-sm">
            <i class="feather-arrow-right me-2"></i>@Html.T("العودة للدرس", "Back to lesson")
        </a>
    </div>
    <p class="text-muted small">@assignment.Lesson?.Module?.Course?.Title</p>
    @if (assignment.DueDate.HasValue)
    {
        <p class="text-muted small">@Html.T("الموعد النهائي:", "Due:") @assignment.DueDate.Value.ToString("yyyy-MM-dd") @(isOverdue ? Html.Raw(" <span class=\"text-danger\">(" + Html.T("متأخر", "Overdue") + ")</span>") : null)</p>
    }

    @if (!string.IsNullOrEmpty(assignment.Description))
    {
        <div class="mb-4 p-3 rounded bg-dark border border-secondary">
            @Html.Raw(assignment.Description)
        </div>
    }
    @if (!string.IsNullOrEmpty(assignment.Instructions))
    {
        <div class="alert alert-info mb-4">
            <h6 class="fw-bold mb-2">@Html.T("تعليمات التسليم", "Submission instructions")</h6>
            @Html.Raw(assignment.Instructions)
        </div>
    }

    <form asp-action="Submit" asp-controller="Assignments" asp-area="Student" method="post" enctype="multipart/form-data" id="submissionForm">
        <input type="hidden" name="assignmentId" value="@assignment.Id" />
        @Html.AntiForgeryToken()

        <div class="mb-4">
            <label class="form-label text-white">@Html.T("إجابتك / النص", "Your answer")</label>
            <textarea class="form-control bg-dark text-white border-secondary" name="content" rows="8" placeholder="@Html.T("اكتب إجابتك هنا...", "Type your answer here...")">@Model.Content</textarea>
        </div>
        <div class="mb-4">
            <label class="form-label text-white">@Html.T("المرفقات", "Attachments")</label>
            <input type="file" name="files" id="fileInput" multiple accept=".pdf,.doc,.docx,.txt,.zip,.jpg,.png" class="form-control bg-dark text-white border-secondary" />
            <small class="text-muted">PDF, DOC, DOCX, TXT, ZIP, JPG, PNG (@Html.T("حتى 10MB", "up to 10MB"))</small>
        </div>

        <input type="hidden" name="isDraft" id="isDraftValue" value="false" />
        <div class="d-flex gap-2 flex-wrap">
            <button type="submit" class="btn btn-primary">
                <i class="feather-send me-2"></i>@Html.T("تسليم نهائي", "Final submit")
            </button>
            <button type="button" class="btn btn-outline-secondary" id="btnSaveDraft">
                <i class="feather-save me-2"></i>@Html.T("حفظ كمسودة", "Save as draft")
            </button>
        </div>
    </form>
</div>
<script>
(function() {
    var form = document.getElementById('submissionForm');
    var draftInput = document.getElementById('isDraftValue');
    var btnDraft = document.getElementById('btnSaveDraft');
    if (btnDraft && form) {
        btnDraft.addEventListener('click', function() {
            if (draftInput) draftInput.value = 'true';
            form.submit();
        });
    }
})();
</script>
