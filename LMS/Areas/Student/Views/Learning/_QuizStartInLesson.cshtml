@using LMS.Areas.Student.Controllers
@model StartQuizViewModel
@{
    var lessonId = (int)ViewBag.LessonId;
}
<div class="tutor-panel quiz-start-panel text-white">
    <div class="d-flex align-items-center justify-content-between mb-4">
        <h4 class="text-white mb-0">
            <i class="feather-help-circle me-2"></i>@Model.Quiz.Title
        </h4>
        <a asp-action="Lesson" asp-controller="Learning" asp-route-lessonId="@lessonId" class="btn btn-outline-light btn-sm">
            <i class="feather-arrow-right me-2"></i>@Html.T("العودة للدرس", "Back to lesson")
        </a>
    </div>
    <p class="text-muted small">@Model.CourseName / @Model.ModuleName / @Model.LessonName</p>

    <div class="row g-3 mb-4">
        <div class="col-6 col-md-3">
            <div class="p-3 rounded bg-dark border border-secondary text-center">
                <div class="text-muted small">@Html.T("الأسئلة", "Questions")</div>
                <strong>@(Model.Quiz.Questions?.Count ?? 0)</strong>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="p-3 rounded bg-dark border border-secondary text-center">
                <div class="text-muted small">@Html.T("الوقت", "Time")</div>
                <strong>@(Model.Quiz.TimeLimit?.ToString() ?? "∞") @Html.T("دقيقة", "min")</strong>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="p-3 rounded bg-dark border border-secondary text-center">
                <div class="text-muted small">@Html.T("للنجاح", "To pass")</div>
                <strong>@Model.Quiz.PassingScore%</strong>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="p-3 rounded bg-dark border border-secondary text-center">
                <div class="text-muted small">@Html.T("محاولات متبقية", "Attempts left")</div>
                <strong>@(Model.RemainingAttempts?.ToString() ?? "∞")</strong>
            </div>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(Model.Quiz.Description))
    {
        <div class="mb-4 p-3 rounded bg-dark border border-secondary">
            <h6 class="text-white mb-2">@Html.T("عن الاختبار", "About the quiz")</h6>
            @Html.Raw(Model.Quiz.Description)
        </div>
    }

    <div class="mb-4 p-3 rounded bg-dark border border-secondary">
        <h6 class="text-white mb-2">@Html.T("تعليمات مهمة", "Important instructions")</h6>
        <ul class="list-unstyled mb-0 text-muted small">
            @if (Model.Quiz.TimeLimit.HasValue)
            {
                <li class="mb-2"><i class="feather-clock me-2 text-warning"></i>@Html.T("الوقت المحدد:", "Time limit:") @Model.Quiz.TimeLimit @Html.T("دقيقة", "min")</li>
            }
            <li class="mb-2"><i class="feather-check-circle me-2 text-success"></i>@Html.T("درجة النجاح:", "Passing score:") @Model.Quiz.PassingScore%</li>
            <li><i class="feather-alert-triangle me-2 text-danger"></i>@Html.T("لا يمكن إيقاف الاختبار بعد البدء", "The quiz cannot be paused once started")</li>
        </ul>
    </div>

    @if (!Model.RemainingAttempts.HasValue || Model.RemainingAttempts > 0)
    {
        <form asp-action="StartQuizInLesson" asp-controller="Learning" asp-route-lessonId="@lessonId" asp-route-quizId="@Model.Quiz.Id" method="post" class="mb-3">
            @Html.AntiForgeryToken()
            <button type="submit" class="btn btn-primary btn-lg w-100">
                <i class="feather-play-circle me-2"></i>@Html.T("ابدأ الاختبار الآن", "Start quiz now")
            </button>
        </form>
    }
    else
    {
        <button class="btn btn-secondary btn-lg w-100" disabled>
            <i class="feather-x-circle me-2"></i>@Html.T("لا توجد محاولات متبقية", "No attempts remaining")
        </button>
    }
</div>
