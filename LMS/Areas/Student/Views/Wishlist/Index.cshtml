@model List<LMS.Domain.Entities.Learning.WishlistItem>
@{
    ViewData["Title"] = Html.T("قائمة الرغبات", "Wishlist");
}

@section Styles {
<style>
    .wishlist-card {
        transition: all 0.3s ease;
    }
    .wishlist-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<!-- Header -->
<div class="card stretch stretch-full mb-4">
    <div class="card-body">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h3 class="fw-bold mb-2">
                    <i class="feather-heart text-danger me-2"></i>
                    @Html.T("قائمة الرغبات", "Wishlist")
                </h3>
                <p class="text-muted mb-0">@Model.Count @Html.T("دورة في قائمة رغباتك", "courses in your wishlist")</p>
            </div>
            @if (Model.Any())
            {
                <form asp-action="AddAllToCart" method="post">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-primary">
                        <i class="feather-shopping-cart me-2"></i>
                        @Html.T("إضافة الكل إلى السلة", "Add all to cart")
                    </button>
                </form>
            }
        </div>
    </div>
</div>

<!-- Wishlist Grid -->
@if (Model.Any())
{
    <div class="row g-4">
        @foreach (var item in Model)
        {
            <div class="col-lg-4 col-md-6">
                <div class="card wishlist-card stretch stretch-full">
                    <div class="position-relative">
                        @if (!string.IsNullOrEmpty(item.Course.ThumbnailUrl))
                        {
                            <img src="@item.Course.ThumbnailUrl" alt="@item.Course.Title" class="card-img-top" style="height: 200px; object-fit: cover;" />
                        }
                        <button type="button" class="btn btn-sm btn-danger position-absolute" style="top: 15px; left: 15px;" onclick="removeFromWishlist(@item.Id)">
                            <i class="feather-x"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="mb-2">
                            <span class="badge bg-soft-primary text-primary">@item.Course.Category?.Name</span>
                        </div>
                        <h5 class="fw-bold mb-2 text-truncate-2-line">@item.Course.Title</h5>
                        <p class="text-muted fs-12 mb-2">
                            <i class="feather-user me-1"></i>
                            @item.Course.Instructor.FullName
                        </p>
                        
                        <div class="d-flex align-items-center gap-3 mb-3 fs-11 text-muted">
                            <span>
                                <i class="feather-clock me-1"></i>
                                @item.Course.DurationHours.ToString("F1") @Html.T("ساعة", "hrs")
                            </span>
                            <span class="text-warning">
                                ★ @item.Course.AverageRating.ToString("F1")
                            </span>
                        </div>
                        
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            @if (item.Course.Price == 0)
                            {
                                <h5 class="fw-bold text-success mb-0">@Html.T("مجاني", "Free")</h5>
                            }
                            else if (item.Course.DiscountPercentage > 0)
                            {
                                <div>
                                    <div class="text-muted text-decoration-line-through fs-12">@item.Course.Price.ToEGP()</div>
                                    <h5 class="fw-bold text-primary mb-0">@item.Course.FinalPrice.ToEGP()</h5>
                                </div>
                            }
                            else
                            {
                                <h5 class="fw-bold text-primary mb-0">@item.Course.Price.ToEGP()</h5>
                            }
                        </div>
                        
                        <div class="d-flex gap-2">
                            <form asp-controller="Checkout" asp-action="AddToCartPost" method="post" class="flex-grow-1">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="courseId" value="@item.CourseId" />
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="feather-shopping-cart me-2"></i>
                                    @Html.T("أضف للسلة", "Add to cart")
                                </button>
                            </form>
                            <a asp-controller="Courses" asp-action="Preview" asp-route-id="@item.CourseId" class="btn btn-outline-secondary">
                                <i class="feather-eye"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="card stretch stretch-full">
        <div class="card-body">
            @{
                ViewData["Icon"] = "heart";
                ViewData["Title"] = Html.T("قائمة الرغبات فارغة", "Wishlist is empty");
                ViewData["Message"] = Html.T("لم تضف أي دورات إلى قائمة رغباتك بعد.", "You haven't added any courses to your wishlist yet.");
                ViewData["ActionText"] = Html.T("تصفح الدورات", "Browse courses");
                ViewData["ActionArea"] = "Student";
                ViewData["ActionController"] = "Courses";
                ViewData["ActionAction"] = "Browse";
            }
            @await Html.PartialAsync("_EmptyState")
        </div>
    </div>
}

<!-- Hidden form for removing items -->
<form id="removeWishlistForm" asp-action="RemoveById" method="post" style="display: none;">
    @Html.AntiForgeryToken()
    <input type="hidden" id="wishlistItemIdInput" name="wishlistItemId" value="" />
</form>

@section Scripts {
<script>
    (function(){ window.__T = window.__T || {}; window.__T.ConfirmRemoveFromWishlist = '@Html.Raw(Html.T("هل تريد إزالة هذه الدورة من قائمة رغباتك؟", "Do you want to remove this course from your wishlist?").Replace("\\", "\\\\").Replace("'", "\\'"))'; })();
    function removeFromWishlist(itemId) {
        if (confirm((window.__T && window.__T.ConfirmRemoveFromWishlist) || 'Remove from wishlist?')) {
            document.getElementById('wishlistItemIdInput').value = itemId;
            document.getElementById('removeWishlistForm').submit();
        }
    }
</script>
}

