@model LMS.Areas.Student.Controllers.QuizResultsViewModel
@{
    ViewData["Title"] = Html.T("نتائج الاختبار", "Quiz Results") + " - " + Model.QuizTitle;
    ViewData["ActiveMenu"] = "Quizzes";
    var isPassed = Model.Attempt.IsPassed;
    var percentageScore = Model.Attempt.PercentageScore;
}

@section Styles {
<style>
    .results-header {
        background: linear-gradient(135deg, @(isPassed ? "#22c55e 0%, #16a34a 100%" : "#f59e0b 0%, #d97706 100%"));
        color: white;
        border-radius: 16px;
        padding: 50px 30px;
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    .results-header::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: shimmer 3s infinite;
    }
    @@keyframes shimmer {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .score-circle {
        width: 180px;
        height: 180px;
        border-radius: 50%;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        margin: 0 auto 25px;
        box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        position: relative;
        z-index: 1;
    }
    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }
    .stat-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 12px;
        font-size: 22px;
    }
    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 4px;
    }
    .stat-label {
        color: #6c757d;
        font-size: 0.875rem;
    }
    .performance-bar {
        height: 12px;
        border-radius: 6px;
        background: #e9ecef;
        overflow: hidden;
    }
    .performance-fill {
        height: 100%;
        border-radius: 6px;
        transition: width 1s ease-out;
    }
    .action-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
</style>
}

<!-- Breadcrumb -->
<nav aria-label="@Html.T("مسار التنقل", "Breadcrumb")" class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-action="Index">@Html.T("الاختبارات", "Quizzes")</a></li>
        <li class="breadcrumb-item"><a asp-action="Results">@Html.T("نتائجي", "My results")</a></li>
        <li class="breadcrumb-item active">@Model.QuizTitle</li>
    </ol>
</nav>

<!-- Results Header -->
<div class="results-header mb-4">
    <div class="score-circle">
        <span class="text-@(isPassed ? "success" : "warning") fw-bold" style="font-size: 42px;">
            @percentageScore.ToString("F0")%
        </span>
        <small class="text-muted">@Model.CorrectAnswers / @Model.TotalQuestions</small>
    </div>
    
    <h2 class="text-white fw-bold mb-2">
        @if (isPassed)
        {
            <i class="feather-check-circle me-2"></i>
            <span>@Html.T("مبروك! لقد اجتزت الاختبار بنجاح", "Congratulations! You passed the quiz")</span>
        }
        else
        {
            <i class="feather-alert-circle me-2"></i>
            <span>@Html.T("يمكنك المحاولة مرة أخرى", "You can try again")</span>
        }
    </h2>
    <p class="text-white opacity-75 mb-0">
        <strong>@Model.QuizTitle</strong> - @Model.CourseName
    </p>
</div>

<div class="row g-4">
    <!-- Main Content -->
    <div class="col-lg-8">
        <!-- Stats Grid -->
        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon bg-@(isPassed ? "success" : "warning")-subtle text-@(isPassed ? "success" : "warning")">
                        <i class="feather-award"></i>
                    </div>
                    <div class="stat-value">@Model.Attempt.Score / @Model.Attempt.TotalScore</div>
                    <div class="stat-label">@Html.T("الدرجة النهائية", "Final score")</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon bg-success-subtle text-success">
                        <i class="feather-check-circle"></i>
                    </div>
                    <div class="stat-value text-success">@Model.CorrectAnswers</div>
                    <div class="stat-label">@Html.T("إجابات صحيحة", "Correct answers")</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon bg-danger-subtle text-danger">
                        <i class="feather-x-circle"></i>
                    </div>
                    <div class="stat-value text-danger">@(Model.TotalQuestions - Model.CorrectAnswers)</div>
                    <div class="stat-label">@Html.T("إجابات خاطئة", "Incorrect answers")</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon bg-info-subtle text-info">
                        <i class="feather-clock"></i>
                    </div>
                    <div class="stat-value">@{
                        var timeSeconds = Model.Attempt.TimeSpentSeconds;
                        var minutes = timeSeconds / 60;
                        var seconds = timeSeconds % 60;
                        @($"{minutes:D2}:{seconds:D2}")
                    }</div>
                    <div class="stat-label">@Html.T("الوقت المستغرق", "Time spent")</div>
                </div>
            </div>
        </div>

        <!-- Performance Analysis -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-transparent border-0 py-3">
                <h5 class="fw-bold mb-0">
                    <i class="feather-bar-chart-2 me-2 text-primary"></i>
                    @Html.T("تحليل الأداء", "Performance analysis")
                </h5>
            </div>
            <div class="card-body">
                <!-- Correct Answers -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="fw-medium">@Html.T("الإجابات الصحيحة", "Correct answers")</span>
                        <strong class="text-success">@Model.CorrectAnswers @Html.T("من", "of") @Model.TotalQuestions</strong>
                    </div>
                    <div class="performance-bar">
                        <div class="performance-fill bg-success" style="width: @((Model.CorrectAnswers * 100.0 / Math.Max(Model.TotalQuestions, 1)))%"></div>
                    </div>
                </div>

                <!-- Incorrect Answers -->
                <div class="mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="fw-medium">@Html.T("الإجابات الخاطئة", "Incorrect answers")</span>
                        <strong class="text-danger">@(Model.TotalQuestions - Model.CorrectAnswers) @Html.T("من", "of") @Model.TotalQuestions</strong>
                    </div>
                    <div class="performance-bar">
                        <div class="performance-fill bg-danger" style="width: @(((Model.TotalQuestions - Model.CorrectAnswers) * 100.0 / Math.Max(Model.TotalQuestions, 1)))%"></div>
                    </div>
                </div>

                <!-- Feedback Message -->
                <div class="alert alert-@(isPassed ? "success" : "warning") border-0 mb-0">
                    <div class="d-flex align-items-start">
                        <i class="feather-@(isPassed ? "check-circle" : "alert-triangle") me-3 mt-1"></i>
                        <div>
                            <strong class="d-block mb-1">@(isPassed ? Html.T("أداء ممتاز!", "Excellent performance!") : Html.T("تحتاج لمزيد من المراجعة", "Need more review"))</strong>
                            @if (isPassed)
                            {
                                <p class="mb-0">@Html.T("لقد تجاوزت درجة النجاح المطلوبة", "You exceeded the passing score") (@Model.Attempt.Quiz.PassingScore%). @Html.T("استمر في التميز وواصل رحلة التعلم!", "Keep excelling and continue your learning journey!")</p>
                            }
                            else
                            {
                                <p class="mb-0">@Html.T("درجة النجاح المطلوبة", "Passing score") @Model.Attempt.Quiz.PassingScore%. @Html.T("راجع محتوى الدرس وحاول مرة أخرى - أنت قادر على النجاح!", "Review the lesson and try again - you can do it!")</p>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="action-card">
            <h6 class="fw-bold mb-3">
                <i class="feather-navigation me-2 text-primary"></i>
@Html.T("الخطوات التالية", "Next steps")
                </h6>
                <div class="d-flex flex-wrap gap-3">
                @if (Model.ShowCorrectAnswers)
                {
                    <a asp-action="ReviewAnswers" asp-route-attemptId="@Model.Attempt.Id" class="btn btn-primary flex-fill">
                        <i class="feather-eye me-2"></i>
                        @Html.T("مراجعة الإجابات", "Review answers")
                    </a>
                }
                @if (!isPassed)
                {
                    <a asp-action="Start" asp-route-quizId="@Model.Attempt.QuizId" class="btn btn-warning flex-fill">
                        <i class="feather-repeat me-2"></i>
                        @Html.T("إعادة المحاولة", "Retry")
                    </a>
                }
                <a asp-controller="Learning" asp-action="Lesson" asp-route-lessonId="@Model.Attempt.Quiz.LessonId" class="btn btn-outline-secondary flex-fill">
                    <i class="feather-arrow-right me-2"></i>
                    @Html.T("العودة للدرس", "Back to lesson")
                </a>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- Success Badge -->
        @if (isPassed)
        {
            <div class="card border-0 bg-success text-white mb-4">
                <div class="card-body text-center py-4">
                    <div class="mb-3">
                        <i class="feather-award" style="font-size: 48px;"></i>
                    </div>
                    <h5 class="text-white fw-bold mb-2">@Html.T("تهانينا!", "Congratulations!")</h5>
                    <p class="text-white opacity-75 mb-0">
                        @Html.T("لقد اجتزت الاختبار بنجاح وحصلت على", "You passed the quiz and earned") @Model.Attempt.PointsEarned @Html.T("نقطة", "points")
                    </p>
                </div>
            </div>
        }

        <!-- Quiz Info -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-transparent border-0 py-3">
                <h6 class="fw-bold mb-0">
                    <i class="feather-info me-2"></i>
                    @Html.T("معلومات الاختبار", "Quiz info")
                </h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="d-flex justify-content-between py-2 border-bottom">
                        <span class="text-muted">@Html.T("اسم الاختبار", "Quiz name")</span>
                        <strong>@Model.QuizTitle</strong>
                    </li>
                    <li class="d-flex justify-content-between py-2 border-bottom">
                        <span class="text-muted">@Html.T("الدورة", "Course")</span>
                        <strong>@Model.CourseName</strong>
                    </li>
                    <li class="d-flex justify-content-between py-2 border-bottom">
                        <span class="text-muted">@Html.T("عدد الأسئلة", "Number of questions")</span>
                        <strong>@Model.TotalQuestions</strong>
                    </li>
                    <li class="d-flex justify-content-between py-2 border-bottom">
                        <span class="text-muted">@Html.T("تاريخ المحاولة", "Attempt date")</span>
                        <strong>@Model.Attempt.StartedAt.ToString("dd MMM yyyy")</strong>
                    </li>
                    <li class="d-flex justify-content-between py-2">
                        <span class="text-muted">@Html.T("الحالة", "Status")</span>
                        <span class="badge bg-@(isPassed ? "success" : "warning")">
                            @(isPassed ? Html.T("ناجح", "Passed") : Html.T("يحتاج إعادة", "Needs retry"))
                        </span>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Attempt History Link -->
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <a asp-action="History" asp-route-quizId="@Model.Attempt.QuizId" class="btn btn-outline-primary w-100">
                    <i class="feather-clock me-2"></i>
                    @Html.T("عرض جميع المحاولات", "View all attempts")
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    // Animate the progress bars on page load
    document.addEventListener('DOMContentLoaded', function() {
        const fills = document.querySelectorAll('.performance-fill');
        fills.forEach(fill => {
            const width = fill.style.width;
            fill.style.width = '0%';
            setTimeout(() => {
                fill.style.width = width;
            }, 100);
        });
    });
</script>
}

