@model ReviewRecommendationsViewModel
@{
    ViewData["Title"] = Html.T("ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©", "Review Recommendations");
}

@section Styles {
<style>
    .recommendation-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 16px;
        border-right: 4px solid #ef4444;
    }
    .priority-high { border-right-color: #ef4444; }
    .priority-medium { border-right-color: #f59e0b; }
    .priority-low { border-right-color: #10b981; }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<!-- Header -->
<div class="card stretch stretch-full mb-4">
    <div class="card-body">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h3 class="fw-bold mb-2">
                    <i class="feather-book text-primary me-2"></i>
                    @Html.T("ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©", "Review recommendations")
                </h3>
                <p class="text-muted mb-0">@Model.Quiz.Title</p>
            </div>
            <a asp-action="Results" asp-route-id="@Model.AttemptId" class="btn btn-outline-primary">
                <i class="feather-arrow-right me-2"></i>
                @Html.T("Ø¹ÙˆØ¯Ø© Ù„Ù„Ù†ØªØ§Ø¦Ø¬", "Back to results")
            </a>
        </div>
    </div>
</div>

<!-- Overview -->
<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="card">
            <div class="card-body text-center">
                <div style="font-size: 48px; margin-bottom: 12px;">ğŸ“š</div>
                <h4 class="fw-bold mb-1">@Model.TopicsToReview.Count</h4>
                <p class="text-muted mb-0">@Html.T("Ù…ÙˆØ¶ÙˆØ¹ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©", "Topic to review")</p>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-body text-center">
                <div style="font-size: 48px; margin-bottom: 12px;">âš ï¸</div>
                <h4 class="fw-bold mb-1">@Model.TopicsToReview.Count(t => t.Priority == "High")</h4>
                <p class="text-muted mb-0">@Html.T("Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©", "High priority")</p>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-body text-center">
                <div style="font-size: 48px; margin-bottom: 12px;">â±ï¸</div>
                <h4 class="fw-bold mb-1">@Model.EstimatedReviewTime</h4>
                <p class="text-muted mb-0">@Html.T("ÙˆÙ‚Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ù‚Ø¯Ø±", "Estimated review time")</p>
            </div>
        </div>
    </div>
</div>

<!-- Recommendations by Priority -->
@if (Model.TopicsToReview.Any())
{
    <!-- High Priority -->
    var highPriority = Model.TopicsToReview.Where(t => t.Priority == "High").ToList();
    
    @if (highPriority.Any())
    {
        <div class="card stretch stretch-full mb-4">
            <div class="card-body">
                <h5 class="fw-bold mb-4">
                    <i class="feather-alert-triangle text-danger me-2"></i>
                    @Html.T("Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ© - Ø±Ø§Ø¬Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø£ÙˆÙ„Ø§Ù‹", "High priority â€“ review these topics first")
                </h5>

                @foreach (var topic in highPriority)
                {
                    <div class="recommendation-card priority-high">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="flex-grow-1">
                                <h6 class="fw-bold mb-2">@topic.TopicName</h6>
                                <p class="text-muted small mb-2">@topic.Description</p>
                                <div class="d-flex gap-3">
                                    <small class="text-muted">
                                        <i class="feather-file-text me-1"></i>
                                        @topic.QuestionsWrong @Html.T("Ù…Ù†", "of") @topic.TotalQuestions @Html.T("Ø£Ø³Ø¦Ù„Ø© Ø®Ø§Ø·Ø¦Ø©", "wrong questions")
                                    </small>
                                    <small class="text-muted">
                                        <i class="feather-percent me-1"></i>
                                        @topic.ScorePercentage% @Html.T("Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©", "answer rate")
                                    </small>
                                </div>
                            </div>
                            <span class="badge bg-danger">@Html.T("Ø¹Ø§Ù„ÙŠ", "High")</span>
                        </div>

                        <div class="d-flex gap-2">
                            @if (!string.IsNullOrEmpty(topic.LessonUrl))
                            {
                                <a href="@topic.LessonUrl" class="btn btn-sm btn-outline-primary">
                                    <i class="feather-play-circle me-1"></i>
                                    @Html.T("Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¯Ø±Ø³", "Watch lesson")
                                </a>
                            }
                            @if (topic.RelatedQuizId.HasValue)
                            {
                                <a asp-action="PracticeMode" asp-route-quizId="@topic.RelatedQuizId" 
                                   class="btn btn-sm btn-outline-success">
                                    <i class="feather-edit-3 me-1"></i>
                                    @Html.T("ØªØ¯Ø±Ø¨", "Practice")
                                </a>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Medium Priority -->
    var mediumPriority = Model.TopicsToReview.Where(t => t.Priority == "Medium").ToList();
    
    @if (mediumPriority.Any())
    {
        <div class="card stretch stretch-full mb-4">
            <div class="card-body">
                <h5 class="fw-bold mb-4">
                    <i class="feather-alert-circle text-warning me-2"></i>
                    @Html.T("Ø£ÙˆÙ„ÙˆÙŠØ© Ù…ØªÙˆØ³Ø·Ø© - Ø­Ø³Ù‘Ù† ÙÙ‡Ù…Ùƒ", "Medium priority â€“ improve your understanding")
                </h5>

                @foreach (var topic in mediumPriority)
                {
                    <div class="recommendation-card priority-medium">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="flex-grow-1">
                                <h6 class="fw-bold mb-2">@topic.TopicName</h6>
                                <p class="text-muted small mb-2">@topic.Description</p>
                                <div class="d-flex gap-3">
                                    <small class="text-muted">
                                        <i class="feather-file-text me-1"></i>
                                        @topic.QuestionsWrong @Html.T("Ù…Ù†", "of") @topic.TotalQuestions @Html.T("Ø£Ø³Ø¦Ù„Ø© Ø®Ø§Ø·Ø¦Ø©", "wrong questions")
                                    </small>
                                    <small class="text-muted">
                                        <i class="feather-percent me-1"></i>
                                        @topic.ScorePercentage% @Html.T("Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©", "answer rate")
                                    </small>
                                </div>
                            </div>
                            <span class="badge bg-warning">@Html.T("Ù…ØªÙˆØ³Ø·", "Medium")</span>
                        </div>

                        <div class="d-flex gap-2">
                            @if (!string.IsNullOrEmpty(topic.LessonUrl))
                            {
                                <a href="@topic.LessonUrl" class="btn btn-sm btn-outline-primary">
                                    <i class="feather-play-circle me-1"></i>
                                    @Html.T("Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¯Ø±Ø³", "Watch lesson")
                                </a>
                            }
                            @if (topic.RelatedQuizId.HasValue)
                            {
                                <a asp-action="PracticeMode" asp-route-quizId="@topic.RelatedQuizId" 
                                   class="btn btn-sm btn-outline-success">
                                    <i class="feather-edit-3 me-1"></i>
                                    @Html.T("ØªØ¯Ø±Ø¨", "Practice")
                                </a>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Low Priority -->
    var lowPriority = Model.TopicsToReview.Where(t => t.Priority == "Low").ToList();
    
    @if (lowPriority.Any())
    {
        <div class="card stretch stretch-full">
            <div class="card-body">
                <h5 class="fw-bold mb-4">
                    <i class="feather-check-circle text-success me-2"></i>
                    @Html.T("Ø£ÙˆÙ„ÙˆÙŠØ© Ù…Ù†Ø®ÙØ¶Ø© - Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¥Ø¶Ø§ÙÙŠØ©", "Low priority â€“ extra review")
                </h5>

                @foreach (var topic in lowPriority)
                {
                    <div class="recommendation-card priority-low">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="flex-grow-1">
                                <h6 class="fw-bold mb-2">@topic.TopicName</h6>
                                <p class="text-muted small mb-2">@topic.Description</p>
                                <div class="d-flex gap-3">
                                    <small class="text-muted">
                                        <i class="feather-file-text me-1"></i>
                                        @topic.QuestionsWrong @Html.T("Ù…Ù†", "of") @topic.TotalQuestions @Html.T("Ø£Ø³Ø¦Ù„Ø© Ø®Ø§Ø·Ø¦Ø©", "wrong questions")
                                    </small>
                                    <small class="text-muted">
                                        <i class="feather-percent me-1"></i>
                                        @topic.ScorePercentage% @Html.T("Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©", "answer rate")
                                    </small>
                                </div>
                            </div>
                            <span class="badge bg-success">@Html.T("Ù…Ù†Ø®ÙØ¶", "Low")</span>
                        </div>

                        <div class="d-flex gap-2">
                            @if (!string.IsNullOrEmpty(topic.LessonUrl))
                            {
                                <a href="@topic.LessonUrl" class="btn btn-sm btn-outline-primary">
                                    <i class="feather-play-circle me-1"></i>
                                    @Html.T("Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¯Ø±Ø³", "Watch lesson")
                                </a>
                            }
                            @if (topic.RelatedQuizId.HasValue)
                            {
                                <a asp-action="PracticeMode" asp-route-quizId="@topic.RelatedQuizId" 
                                   class="btn btn-sm btn-outline-success">
                                    <i class="feather-edit-3 me-1"></i>
                                    @Html.T("ØªØ¯Ø±Ø¨", "Practice")
                                </a>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>
    }
}
else
{
    <div class="card stretch stretch-full">
        <div class="card-body text-center py-5">
            <div style="font-size: 64px; margin-bottom: 16px;">ğŸ‰</div>
            <h4 class="fw-bold mb-2">@Html.T("Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²!", "Excellent performance!")</h4>
            <p class="text-muted mb-0">@Html.T("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¶ÙŠØ¹ ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¹Ø§Ø¬Ù„Ø©", "No topics need urgent review")</p>
        </div>
    </div>
}
