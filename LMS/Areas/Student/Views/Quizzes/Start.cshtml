@model LMS.Areas.Student.Controllers.StartQuizViewModel
@{
    ViewData["Title"] = Html.T("بدء الاختبار", "Start Quiz");
}

@section Styles {
<style>
    .quiz-instructions {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 12px;
        padding: 40px;
    }
    .instruction-item {
        background: rgba(255,255,255,0.1);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
    }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<div class="row g-4">
    <!-- Quiz Instructions -->
    <div class="col-lg-8">
        <div class="quiz-instructions mb-4">
            <div class="text-center mb-4">
                <div class="avatar-text avatar-xl bg-white text-primary mx-auto mb-3">
                    <i class="feather-edit fs-1"></i>
                </div>
                <h2 class="text-white fw-bold mb-2">@Model.Quiz.Title</h2>
                <p class="text-white opacity-75 mb-0">@Model.CourseName</p>
                <p class="text-white opacity-75 mb-0">@Model.ModuleName - @Model.LessonName</p>
            </div>
            
            <div class="row g-3 text-center mb-4">
                <div class="col-md-3">
                    <div class="instruction-item">
                        <i class="feather-help-circle fs-2 mb-2"></i>
                        <h4 class="mb-0">@(Model.Quiz.Questions?.Count ?? 0)</h4>
                        <small>@Html.T("سؤال", "Question(s)")</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="instruction-item">
                        <i class="feather-clock fs-2 mb-2"></i>
                        <h4 class="mb-0">@(Model.Quiz.TimeLimit?.ToString() ?? "∞")</h4>
                        <small>@Html.T("دقيقة", "min")</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="instruction-item">
                        <i class="feather-target fs-2 mb-2"></i>
                        <h4 class="mb-0">@Model.Quiz.PassingScore%</h4>
                        <small>@Html.T("للنجاح", "to pass")</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="instruction-item">
                        <i class="feather-repeat fs-2 mb-2"></i>
                        <h4 class="mb-0">@(Model.RemainingAttempts?.ToString() ?? "∞")</h4>
                        <small>@Html.T("محاولة متبقية", "attempt(s) left")</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="card stretch stretch-full mb-4">
            <div class="card-header">
                <h5 class="fw-bold mb-0">
                    <i class="feather-info me-2"></i>
                    @Html.T("عن الاختبار", "About the quiz")
                </h5>
            </div>
            <div class="card-body">
                @if (!string.IsNullOrEmpty(Model.Quiz.Description))
                {
                    <p>@Model.Quiz.Description</p>
                }
                else
                {
                    <p class="text-muted">@Html.T("اختبر معرفتك في هذا الموضوع", "Test your knowledge on this topic")</p>
                }
            </div>
        </div>

        <div class="card stretch stretch-full">
            <div class="card-header">
                <h5 class="fw-bold mb-0">
                    <i class="feather-alert-circle me-2"></i>
                    @Html.T("تعليمات مهمة", "Important instructions")
                </h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    @if (Model.Quiz.TimeLimit.HasValue)
                    {
                        <li class="mb-3">
                            <i class="feather-clock text-warning me-2"></i>
                            <strong>@Html.T("الوقت المحدد:", "Time limit:")</strong> @Html.T("لديك", "You have") @Model.Quiz.TimeLimit @Html.T("دقيقة لإكمال الاختبار", "minutes to complete the quiz")
                        </li>
                    }
                    @if (Model.Quiz.PassingScore > 0)
                    {
                        <li class="mb-3">
                            <i class="feather-check-circle text-success me-2"></i>
                            <strong>@Html.T("درجة النجاح:", "Passing score:")</strong> @Html.T("يجب الحصول على", "You need at least") @Model.Quiz.PassingScore% @Html.T("للنجاح", "to pass")
                        </li>
                    }
                    @if (Model.Quiz.MaxAttempts.HasValue)
                    {
                        <li class="mb-3">
                            <i class="feather-repeat text-info me-2"></i>
                            <strong>@Html.T("المحاولات:", "Attempts:")</strong> @Html.T("يمكنك محاولة الاختبار", "You can attempt the quiz") @Model.Quiz.MaxAttempts @Html.T("مرات كحد أقصى", "times maximum")
                        </li>
                    }
                    <li class="mb-3">
                        <i class="feather-eye text-primary me-2"></i>
                        <strong>@Html.T("المراجعة:", "Review:")</strong> @Html.T("يمكنك مراجعة إجاباتك قبل التسليم النهائي", "You can review your answers before final submission")
                    </li>
                    @if (Model.Quiz.RandomizeQuestions)
                    {
                        <li class="mb-3">
                            <i class="feather-shuffle text-secondary me-2"></i>
                            <strong>@Html.T("ترتيب عشوائي:", "Random order:")</strong> @Html.T("سيتم عرض الأسئلة بترتيب عشوائي", "Questions will be shown in random order")
                        </li>
                    }
                    <li class="mb-0">
                        <i class="feather-alert-triangle text-danger me-2"></i>
                        <strong>@Html.T("تنبيه:", "Warning:")</strong> @Html.T("لا يمكن إيقاف الاختبار بعد البدء", "The quiz cannot be paused once started")
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- Quick Stats -->
        <div class="card stretch stretch-full mb-4">
            <div class="card-header">
                <h6 class="fw-bold mb-0">@Html.T("تفاصيل الاختبار", "Quiz details")</h6>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-between mb-3 pb-3 border-bottom">
                    <span class="text-muted">@Html.T("عدد الأسئلة", "Number of questions")</span>
                    <strong>@(Model.Quiz.Questions?.Count ?? 0) @Html.T("سؤال", "question(s)")</strong>
                </div>
                <div class="d-flex align-items-center justify-content-between mb-3 pb-3 border-bottom">
                    <span class="text-muted">@Html.T("عدد المحاولات السابقة", "Previous attempts")</span>
                    <strong>@Model.PreviousAttempts</strong>
                </div>
                @if (Model.Quiz.TimeLimit.HasValue)
                {
                    <div class="d-flex align-items-center justify-content-between mb-3 pb-3 border-bottom">
                        <span class="text-muted">@Html.T("الوقت المتاح", "Time available")</span>
                        <strong>@Model.Quiz.TimeLimit @Html.T("دقيقة", "min")</strong>
                    </div>
                }
                <div class="d-flex align-items-center justify-content-between">
                    <span class="text-muted">@Html.T("محاولات متبقية", "Attempts remaining")</span>
                    <strong class="text-primary">@(Model.RemainingAttempts?.ToString() ?? Html.T("غير محدود", "Unlimited").ToString())</strong>
                </div>
            </div>
        </div>

        <!-- Start Button -->
        <div class="card stretch stretch-full bg-primary text-white">
            <div class="card-body text-center">
                <i class="feather-play-circle fs-1 mb-3"></i>
                <h5 class="text-white mb-3">@Html.T("هل أنت مستعد؟", "Are you ready?")</h5>
                <p class="text-white opacity-75 mb-4">@Html.T("تأكد من قراءة جميع التعليمات قبل البدء", "Make sure you've read all instructions before starting")</p>
                
                @if (!Model.RemainingAttempts.HasValue || Model.RemainingAttempts > 0)
                {
                    <form asp-action="TakeQuiz" asp-route-quizId="@Model.Quiz.Id" method="post">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-light btn-lg w-100">
                            <i class="feather-check-circle me-2"></i>
                            @Html.T("ابدأ الاختبار الآن", "Start quiz now")
                        </button>
                    </form>
                }
                else
                {
                    <button class="btn btn-secondary btn-lg w-100" disabled>
                        <i class="feather-x-circle me-2"></i>
                        @Html.T("لا توجد محاولات متبقية", "No attempts remaining")
                    </button>
                }
                
                <a asp-action="Index" class="btn btn-outline-light btn-sm w-100 mt-2">
                    <i class="feather-arrow-right me-2"></i>
                    @Html.T("العودة للاختبارات", "Back to quizzes")
                </a>
            </div>
        </div>

        <!-- Previous Attempts -->
        @if (Model.PreviousAttempts > 0)
        {
            <div class="card stretch stretch-full mt-4">
                <div class="card-header">
                    <h6 class="fw-bold mb-0">
                        <i class="feather-clock me-2"></i>
                        @Html.T("محاولاتك السابقة", "Your previous attempts")
                    </h6>
                </div>
                <div class="card-body text-center">
                    <p class="mb-0">@Html.T("لديك", "You have") @Model.PreviousAttempts @Html.T("محاولة سابقة", "previous attempt(s)")</p>
                    <a asp-action="History" asp-route-quizId="@Model.Quiz.Id" class="btn btn-sm btn-outline-primary w-100 mt-3">
                        <i class="feather-clock me-2"></i>
                        @Html.T("عرض جميع المحاولات", "View all attempts")
                    </a>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
<script>
    // Confirm before leaving
    window.addEventListener('beforeunload', function (e) {
        if (document.querySelector('form[action*="TakeQuiz"]')) {
            e.preventDefault();
            e.returnValue = '';
        }
    });
</script>
}

