@model StudentNoteCreateViewModel
@{
    ViewData["Title"] = Html.T("Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©", "Create New Note");
}

@section Styles {
<style>
    .create-header {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border-radius: 12px;
        padding: 30px;
        margin-bottom: 30px;
    }
    
    .lesson-context {
        background: #f0fdf4;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 24px;
        border-right: 4px solid #10b981;
    }
    
    .create-card {
        background: white;
        border-radius: 12px;
        padding: 32px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .form-label {
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .form-control, .form-textarea {
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        padding: 12px 16px;
        transition: all 0.3s ease;
        font-size: 15px;
    }
    
    .form-control:focus, .form-textarea:focus {
        border-color: #10b981;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        outline: none;
    }
    
    .form-textarea {
        min-height: 250px;
        resize: vertical;
        line-height: 1.8;
        font-family: 'Cairo', sans-serif;
    }
    
    .color-picker {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }
    
    .color-option {
        width: 50px;
        height: 50px;
        border-radius: 10px;
        border: 3px solid transparent;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .color-option:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .color-option.selected {
        border-color: #1f2937;
        transform: scale(1.15);
    }
    
    .color-option.selected::after {
        content: "âœ“";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: 700;
        font-size: 20px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .color-yellow { background: #fbbf24; }
    .color-green { background: #10b981; }
    .color-blue { background: #3b82f6; }
    .color-purple { background: #8b5cf6; }
    .color-pink { background: #ec4899; }
    .color-orange { background: #f97316; }
    .color-red { background: #ef4444; }
    .color-gray { background: #6b7280; }
    
    .timestamp-input-group {
        display: flex;
        gap: 12px;
        align-items: center;
    }
    
    .timestamp-input {
        max-width: 150px;
    }
    
    .timestamp-help {
        color: #6b7280;
        font-size: 13px;
        margin-top: 4px;
    }
    
    .pin-toggle {
        display: flex;
        align-items: center;
        gap: 12px;
        background: #f9fafb;
        padding: 16px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid #e5e7eb;
    }
    
    .pin-toggle:hover {
        background: #f3f4f6;
        border-color: #d1d5db;
    }
    
    .pin-toggle.active {
        background: #fef3c7;
        border-color: #fbbf24;
    }
    
    .pin-icon {
        font-size: 24px;
        color: #6b7280;
        transition: color 0.3s ease;
    }
    
    .pin-toggle.active .pin-icon {
        color: #f59e0b;
    }
    
    .feature-box {
        background: #f0f9ff;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 24px;
    }
    
    .feature-item {
        display: flex;
        align-items: start;
        gap: 12px;
        margin-bottom: 16px;
    }
    
    .feature-item:last-child {
        margin-bottom: 0;
    }
    
    .feature-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    
    .toolbar {
        display: flex;
        gap: 8px;
        padding: 12px;
        background: #f9fafb;
        border-radius: 10px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }
    
    .toolbar-btn {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 8px 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 14px;
    }
    
    .toolbar-btn:hover {
        background: #f3f4f6;
        border-color: #d1d5db;
    }
    
    .btn-create {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        border: none;
        padding: 14px 36px;
        font-weight: 600;
        border-radius: 10px;
        color: white;
        transition: all 0.3s ease;
    }
    
    .btn-create:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        color: white;
    }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<!-- Header -->
<div class="create-header">
        <div class="d-flex align-items-center">
        <i class="feather-edit-3" style="font-size: 36px; margin-left: 16px;"></i>
            <div>
            <h2 class="mb-2">@Html.T("Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©", "Create new note")</h2>
            <p class="mb-0 opacity-75">@Html.T("Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ ÙˆØ£ÙÙƒØ§Ø±Ùƒ Ø­ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³", "Add your notes and thoughts about this lesson")</p>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="create-card">
            <!-- Lesson Context -->
            <div class="lesson-context">
                <div class="d-flex align-items-start">
                    <div class="flex-shrink-0">
                        <i class="feather-book text-success" style="font-size: 24px;"></i>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-success mb-1">@Html.T("Ø§Ù„Ø¯Ø±Ø³", "Lesson")</h6>
                        <p class="mb-1"><strong>@Model.LessonTitle</strong></p>
                        <p class="mb-0 text-muted small">
                            <i class="feather-folder me-1"></i>
                            @Model.CourseTitle
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Create Form -->
            <form asp-action="Create" asp-controller="Notes" method="post" id="createNoteForm">
                <input type="hidden" asp-for="LessonId" />
                
                <!-- Note Content -->
                    <div class="mb-4">
                    <label asp-for="Content" class="form-label">
                        <i class="feather-file-text text-primary"></i>
                        @Html.T("Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© *", "Note content *")
                        </label>
                    
                    <!-- Text Formatting Toolbar -->
                    <div class="toolbar">
                        <button type="button" class="toolbar-btn" onclick="insertSymbol('ğŸ“Œ')" title="@Html.T("Ø¯Ø¨ÙˆØ³", "Pin")">ğŸ“Œ</button>
                        <button type="button" class="toolbar-btn" onclick="insertSymbol('âœ“')" title="@Html.T("ØµØ­", "Check")">âœ“</button>
                        <button type="button" class="toolbar-btn" onclick="insertSymbol('âœ—')" title="@Html.T("Ø®Ø·Ø£", "Cross")">âœ—</button>
                        <button type="button" class="toolbar-btn" onclick="insertSymbol('â†’')" title="@Html.T("Ø³Ù‡Ù…", "Arrow")">â†’</button>
                        <button type="button" class="toolbar-btn" onclick="insertSymbol('â˜…')" title="@Html.T("Ù†Ø¬Ù…Ø©", "Star")">â˜…</button>
                        <button type="button" class="toolbar-btn" onclick="insertSymbol('ğŸ’¡')" title="@Html.T("ÙÙƒØ±Ø©", "Idea")">ğŸ’¡</button>
                        <button type="button" class="toolbar-btn" onclick="insertSymbol('â“')" title="@Html.T("Ø³Ø¤Ø§Ù„", "Question")">â“</button>
                        <button type="button" class="toolbar-btn" onclick="insertSymbol('âš ï¸')" title="@Html.T("ØªØ­Ø°ÙŠØ±", "Warning")">âš ï¸</button>
                    </div>
                    
                    <textarea asp-for="Content" 
                              class="form-control form-textarea" 
                              id="noteContent"
                              placeholder="@Html.T("Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§...", "Write your notes here...")"
                              required></textarea>
                    <span asp-validation-for="Content" class="text-danger"></span>
                    </div>

                    <!-- Video Timestamp -->
                    <div class="mb-4">
                    <label asp-for="VideoTimestamp" class="form-label">
                        <i class="feather-clock text-info"></i>
                        @Html.T("Ø§Ù„ÙˆÙ‚Øª ÙÙŠ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)", "Video time (optional)")
                        </label>
                    <div class="timestamp-input-group">
                            <input asp-for="VideoTimestamp" 
                                   type="number" 
                               class="form-control timestamp-input" 
                               placeholder="@Html.T("Ø«ÙˆØ§Ù†ÙŠ", "seconds")"
                               min="0"
                               id="timestampInput">
                        <span class="text-muted">@Html.T("Ø«Ø§Ù†ÙŠØ©", "sec")</span>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="getCurrentTimestamp()">
                            <i class="feather-video me-1"></i>
                            @Html.T("Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ", "Current time")
                        </button>
                        </div>
                    <div class="timestamp-help">
                            <i class="feather-info me-1"></i>
                        @Html.T("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆÙ‚Øª Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ø¬Ø²Ø¡ Ù…Ø¹ÙŠÙ† Ù…Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ", "Enter time in seconds to link note to a specific part of the video")
                    </div>
                    <span asp-validation-for="VideoTimestamp" class="text-danger"></span>
                    </div>

                    <!-- Highlight Color -->
                    <div class="mb-4">
                    <label asp-for="HighlightColor" class="form-label">
                        <i class="feather-droplet text-warning"></i>
                            @Html.T("Ù„ÙˆÙ† Ø§Ù„ØªÙ…ÙŠÙŠØ² (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)", "Highlight color (optional)")
                        </label>
                        <div class="color-picker">
                        <input type="hidden" asp-for="HighlightColor" id="highlightColorInput" value="">
                        <div class="color-option color-yellow" data-color="Yellow" onclick="selectColor(this, 'Yellow')"></div>
                        <div class="color-option color-green" data-color="Green" onclick="selectColor(this, 'Green')"></div>
                        <div class="color-option color-blue selected" data-color="Blue" onclick="selectColor(this, 'Blue')"></div>
                        <div class="color-option color-purple" data-color="Purple" onclick="selectColor(this, 'Purple')"></div>
                        <div class="color-option color-pink" data-color="Pink" onclick="selectColor(this, 'Pink')"></div>
                        <div class="color-option color-orange" data-color="Orange" onclick="selectColor(this, 'Orange')"></div>
                        <div class="color-option color-red" data-color="Red" onclick="selectColor(this, 'Red')"></div>
                        <div class="color-option color-gray" data-color="Gray" onclick="selectColor(this, 'Gray')"></div>
                    </div>
                    <span asp-validation-for="HighlightColor" class="text-danger"></span>
                    </div>

                    <!-- Pin Note -->
                    <div class="mb-4">
                    <label class="pin-toggle" id="pinToggle" onclick="togglePin()">
                        <input type="checkbox" asp-for="IsPinned" id="isPinnedInput" style="display: none;">
                        <div class="pin-icon">
                            <i class="feather-thumbtack"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1">@Html.T("ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©", "Pin note")</h6>
                            <small class="text-muted">@Html.T("Ø§Ø¬Ø¹Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¯Ø§Ø¦Ù…Ø§Ù‹", "Keep this note at the top")</small>
                        </div>
                    </label>
                    <span asp-validation-for="IsPinned" class="text-danger"></span>
                </div>
                
                <!-- Action Buttons -->
                <div class="d-flex gap-3">
                    <button type="submit" class="btn btn-create flex-grow-1">
                        <i class="feather-plus-circle me-2"></i>
                        @Html.T("Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©", "Create note")
                    </button>
                    <a href="@Url.Action("Index", "Notes", new { lessonId = Model.LessonId })" class="btn btn-outline-secondary">
                        <i class="feather-x me-2"></i>
                        @Html.T("Ø¥Ù„ØºØ§Ø¡", "Cancel")
                    </a>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- Features -->
        <div class="feature-box">
            <h6 class="mb-3">
                <i class="feather-star me-2 text-success"></i>
                @Html.T("Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª", "Note features")
            </h6>
            
            <div class="feature-item">
                <div class="feature-icon">
                    <i class="feather-link"></i>
                </div>
                <div>
                    <h6 class="mb-1">@Html.T("Ø±Ø¨Ø· Ø¨Ø§Ù„ÙÙŠØ¯ÙŠÙˆ", "Video link")</h6>
                    <small class="text-muted">@Html.T("Ø§Ø±Ø¨Ø· Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø¨ÙˆÙ‚Øª Ù…Ø¹ÙŠÙ† ÙÙŠ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ", "Link notes to a specific time in the video")</small>
                </div>
            </div>
            
            <div class="feature-item">
                <div class="feature-icon">
                    <i class="feather-bookmark"></i>
                </div>
                <div>
                    <h6 class="mb-1">@Html.T("Ø£Ù„ÙˆØ§Ù† Ù…Ù…ÙŠØ²Ø©", "Highlight colors")</h6>
                    <small class="text-muted">@Html.T("Ù…ÙŠØ² Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø¨Ø£Ù„ÙˆØ§Ù† Ù…Ø®ØªÙ„ÙØ©", "Highlight notes with different colors")</small>
                        </div>
                    </div>

            <div class="feature-item">
                <div class="feature-icon">
                    <i class="feather-thumbtack"></i>
                </div>
                            <div>
                    <h6 class="mb-1">@Html.T("ØªØ«Ø¨ÙŠØª", "Pin")</h6>
                    <small class="text-muted">@Html.T("Ø§Ø¬Ø¹Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰", "Keep important notes at the top")</small>
                            </div>
                        </div>
                    </div>

        <!-- Tips -->
        <div class="card">
            <div class="card-body">
                <h6 class="mb-3">
                    <i class="feather-lightbulb text-warning me-2"></i>
                    @Html.T("Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙØ¹Ù‘Ø§Ù„Ø©", "Tips for effective notes")
                </h6>
                <ul class="mb-0 small">
                    <li class="mb-2">@Html.T("Ø§Ø³ØªØ®Ø¯Ù… Ø±Ù…ÙˆØ² Ù…Ø«Ù„ âœ“ Ùˆ âœ— Ùˆ â†’ Ù„Ù„ØªÙ†Ø¸ÙŠÙ…", "Use symbols like âœ“ âœ— â†’ to organize")</li>
                    <li class="mb-2">@Html.T("Ø§ÙƒØªØ¨ Ø¨ÙƒÙ„Ù…Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ÙÙ‡Ù…", "Write in your own words to improve understanding")</li>
                    <li class="mb-2">@Html.T("Ø£Ø¶Ù Ø£Ø³Ø¦Ù„Ø© ØªØ­ØªØ§Ø¬ Ù„Ù„Ø¨Ø­Ø« Ø¹Ù†Ù‡Ø§", "Add questions to look up later")</li>
                    <li class="mb-2">@Html.T("Ù„Ø®Ù‘Øµ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ø¥ÙŠØ¬Ø§Ø²", "Summarize key points briefly")</li>
                    <li class="mb-2">@Html.T("Ø±Ø¨Ø· Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨ÙˆÙ‚Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØ³Ø§Ø¹Ø¯ ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©", "Linking to video time helps review")</li>
                    <li>@Html.T("Ø±Ø§Ø¬Ø¹ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø¨Ø§Ù†ØªØ¸Ø§Ù…", "Review your notes regularly")</li>
                </ul>
            </div>
                    </div>
        
        <!-- Shortcuts -->
        <div class="card mt-3">
            <div class="card-body">
                <h6 class="mb-3">
                    <i class="feather-command text-primary me-2"></i>
                    @Html.T("Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­", "Keyboard shortcuts")
                </h6>
                <table class="table table-sm mb-0">
                    <tr>
                        <td><kbd>Ctrl</kbd> + <kbd>S</kbd></td>
                        <td>@Html.T("Ø­ÙØ¸", "Save")</td>
                    </tr>
                    <tr>
                        <td><kbd>Ctrl</kbd> + <kbd>Enter</kbd></td>
                        <td>@Html.T("Ø¥Ù†Ø´Ø§Ø¡", "Create")</td>
                    </tr>
                    <tr>
                        <td><kbd>Esc</kbd></td>
                        <td>@Html.T("Ø¥Ù„ØºØ§Ø¡", "Cancel")</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
    (function(){ window.__T = window.__T || {}; window.__T.VideoTimestampTip = '@Html.Raw(Html.T("Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ø³ØªØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹", "This feature will integrate with the video player to capture the current time automatically").ToString().Replace("'", "\\'"))'; window.__T.ConfirmCancelNote = '@Html.Raw(Html.T("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© ÙˆØ§Ù„Ø¹ÙˆØ¯Ø©ØŸ", "Do you want to cancel creating the note and go back?").ToString().Replace("'", "\\'"))'; })();
    </script>
    <script>
    // Set default color to Blue
    document.getElementById('highlightColorInput').value = 'Blue';
    
    // Color selection
    function selectColor(element, color) {
        document.querySelectorAll('.color-option').forEach(opt => {
            opt.classList.remove('selected');
        });
        element.classList.add('selected');
        document.getElementById('highlightColorInput').value = color;
    }
    
    // Pin toggle
    function togglePin() {
        const toggle = document.getElementById('pinToggle');
        const input = document.getElementById('isPinnedInput');
        
        toggle.classList.toggle('active');
        input.checked = !input.checked;
    }
    
    // Insert symbol at cursor position
    function insertSymbol(symbol) {
        const textarea = document.getElementById('noteContent');
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const text = textarea.value;
        
        textarea.value = text.substring(0, start) + symbol + ' ' + text.substring(end);
        textarea.focus();
        textarea.selectionStart = textarea.selectionEnd = start + symbol.length + 1;
    }
    
    // Get current video timestamp (placeholder - would integrate with video player)
    function getCurrentTimestamp() {
        // TODO: Integrate with actual video player
        // For now, just use a sample timestamp
        alert((window.__T && window.__T.VideoTimestampTip) || 'This feature will integrate with the video player to capture the current time automatically');
        
        // Sample: set a timestamp
        document.getElementById('timestampInput').value = 120; // 2 minutes
    }
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        // Ctrl+S or Ctrl+Enter to submit
        if ((e.ctrlKey && e.key === 's') || (e.ctrlKey && e.key === 'Enter')) {
            e.preventDefault();
            document.getElementById('createNoteForm').submit();
        }
        
        // Esc to cancel
        if (e.key === 'Escape') {
            if (confirm((window.__T && window.__T.ConfirmCancelNote) || 'Do you want to cancel creating the note and go back?')) {
                window.location.href = '@Url.Action("Index", "Notes", new { lessonId = Model.LessonId })';
            }
        }
    });
    
    // Auto-save draft
    const textarea = document.getElementById('noteContent');
    let autoSaveTimer;
    
    textarea.addEventListener('input', () => {
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(() => {
            const draft = {
                content: textarea.value,
                timestamp: document.getElementById('timestampInput').value,
                color: document.getElementById('highlightColorInput').value,
                isPinned: document.getElementById('isPinnedInput').checked
            };
            localStorage.setItem('note_draft_@Model.LessonId', JSON.stringify(draft));
        }, 1000);
    });
    
    // Restore draft on page load
    window.addEventListener('DOMContentLoaded', () => {
        const draftStr = localStorage.getItem('note_draft_@Model.LessonId');
        if (draftStr) {
            const draft = JSON.parse(draftStr);
                if (confirm('@Html.Raw(Html.T("ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³ÙˆØ¯Ø© Ù…Ø­ÙÙˆØ¸Ø©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§ØŸ", "A saved draft was found. Do you want to restore it?").Replace("'", "\\'"))')) {
                textarea.value = draft.content;
                document.getElementById('timestampInput').value = draft.timestamp || '';
                if (draft.color) {
                    const colorElement = document.querySelector(`[data-color="${draft.color}"]`);
                    if (colorElement) selectColor(colorElement, draft.color);
                }
                if (draft.isPinned) {
                    document.getElementById('pinToggle').classList.add('active');
                    document.getElementById('isPinnedInput').checked = true;
                }
            } else {
                localStorage.removeItem('note_draft_@Model.LessonId');
            }
        }
            });

            // Clear draft on successful submit
    document.getElementById('createNoteForm').addEventListener('submit', () => {
        localStorage.removeItem('note_draft_@Model.LessonId');
    });
    
    // Warn before leaving with unsaved changes
    let contentChanged = false;
    textarea.addEventListener('input', () => {
        contentChanged = textarea.value.trim().length > 0;
    });
    
    window.addEventListener('beforeunload', (e) => {
        if (contentChanged) {
            e.preventDefault();
            e.returnValue = '';
        }
    });
    
    document.getElementById('createNoteForm').addEventListener('submit', () => {
        contentChanged = false;
        });
    </script>
}
