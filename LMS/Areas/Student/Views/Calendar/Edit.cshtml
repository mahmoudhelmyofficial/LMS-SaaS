@model LMS.Areas.Student.ViewModels.CalendarEventViewModel
@{
    ViewData["Title"] = Html.T("تعديل الحدث", "Edit Event");
}

@section Styles {
<style>
    .color-picker {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    .color-option {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        cursor: pointer;
        border: 3px solid transparent;
        transition: all 0.3s ease;
    }
    .color-option:hover {
        transform: scale(1.1);
    }
    .color-option.selected {
        border-color: #1e293b;
        transform: scale(1.15);
    }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<!-- Breadcrumb -->
<nav aria-label="@Html.T("مسار التنقل", "Breadcrumb")">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-action="Index" asp-controller="Dashboard">@Html.T("لوحة التحكم", "Dashboard")</a></li>
        <li class="breadcrumb-item"><a asp-action="Index">@Html.T("التقويم", "Calendar")</a></li>
        <li class="breadcrumb-item"><a asp-action="Details" asp-route-id="@Model.Id">@Model.Title</a></li>
        <li class="breadcrumb-item active">@Html.T("تعديل", "Edit")</li>
    </ol>
</nav>

<!-- Header -->
<div class="card stretch stretch-full mb-4">
    <div class="card-body">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h3 class="fw-bold mb-2">
                    <i class="feather-edit text-primary me-2"></i>
                    @Html.T("تعديل الحدث", "Edit event")
                </h3>
                <p class="text-muted mb-0">@Html.T("قم بتحديث تفاصيل الحدث", "Update the event details")</p>
            </div>
            <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-light">
                <i class="feather-arrow-right me-2"></i>
                @Html.T("رجوع للتفاصيل", "Back to details")
            </a>
        </div>
    </div>
</div>

<!-- Form -->
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card stretch stretch-full">
            <div class="card-body">
                <form asp-action="Edit" asp-route-id="@Model.Id" method="post">
                    @Html.AntiForgeryToken()
                    @Html.HiddenFor(m => m.Id)
                    
                    <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                    <div class="row g-3">
                        <!-- Title -->
                        <div class="col-12">
                            <label asp-for="Title" class="form-label fw-semibold required"></label>
                            <input asp-for="Title" class="form-control" placeholder="@Html.T("مثال: جلسة دراسة، اجتماع، موعد هام", "e.g. Study session, meeting, important date")" />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>

                        <!-- Description -->
                        <div class="col-12">
                            <label asp-for="Description" class="form-label fw-semibold"></label>
                            <textarea asp-for="Description" class="form-control" rows="3" placeholder="@Html.T("وصف الحدث (اختياري)", "Event description (optional)")"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <!-- Event Type -->
                        <div class="col-md-6">
                            <label asp-for="EventType" class="form-label fw-semibold required"></label>
                            <select asp-for="EventType" class="form-select">
                                <option value="Personal">@Html.T("شخصي", "Personal")</option>
                                <option value="Study">@Html.T("جلسة دراسة", "Study session")</option>
                                <option value="Assignment">@Html.T("واجب", "Assignment")</option>
                                <option value="Quiz">@Html.T("اختبار", "Quiz")</option>
                                <option value="LiveClass">@Html.T("جلسة مباشرة", "Live class")</option>
                                <option value="Deadline">@Html.T("موعد نهائي", "Deadline")</option>
                                <option value="Other">@Html.T("أخرى", "Other")</option>
                            </select>
                            <span asp-validation-for="EventType" class="text-danger"></span>
                        </div>

                        <!-- Course -->
                        <div class="col-md-6">
                            <label asp-for="CourseId" class="form-label fw-semibold"></label>
                            <select asp-for="CourseId" class="form-select">
                                <option value="">-- @Html.T("اختر الدورة (اختياري)", "Select course (optional)") --</option>
                                @foreach (var course in ViewBag.Courses as List<LMS.Domain.Entities.Courses.Course>)
                                {
                                    <option value="@course.Id">@course.Title</option>
                                }
                            </select>
                            <span asp-validation-for="CourseId" class="text-danger"></span>
                        </div>

                        <!-- Start Time -->
                        <div class="col-md-6">
                            <label asp-for="StartTime" class="form-label fw-semibold required"></label>
                            <input asp-for="StartTime" type="datetime-local" class="form-control" />
                            <span asp-validation-for="StartTime" class="text-danger"></span>
                        </div>

                        <!-- End Time -->
                        <div class="col-md-6">
                            <label asp-for="EndTime" class="form-label fw-semibold"></label>
                            <input asp-for="EndTime" type="datetime-local" class="form-control" />
                            <span asp-validation-for="EndTime" class="text-danger"></span>
                            <small class="form-text text-muted">@Html.T("يجب أن يكون بعد وقت البدء", "Must be after start time")</small>
                        </div>

                        <!-- Location -->
                        <div class="col-md-6">
                            <label asp-for="Location" class="form-label fw-semibold"></label>
                            <input asp-for="Location" class="form-control" placeholder="@Html.T("الموقع أو رابط الاجتماع", "Location or meeting link")" />
                            <span asp-validation-for="Location" class="text-danger"></span>
                        </div>

                        <!-- Is All Day -->
                        <div class="col-md-6">
                            <label class="form-label fw-semibold d-block">&nbsp;</label>
                            <div class="form-check form-switch">
                                <input asp-for="IsAllDay" class="form-check-input" type="checkbox" role="switch" />
                                <label asp-for="IsAllDay" class="form-check-label">@Html.T("طوال اليوم", "All day")</label>
                            </div>
                        </div>

                        <!-- Color -->
                        <div class="col-12">
                            <label class="form-label fw-semibold d-block">@Html.T("اللون", "Color")</label>
                            <input asp-for="Color" type="hidden" id="selectedColor" />
                            <div class="color-picker">
                                <div class="color-option" data-color="#3788d8" style="background-color: #3788d8;"></div>
                                <div class="color-option" data-color="#10b981" style="background-color: #10b981;"></div>
                                <div class="color-option" data-color="#ef4444" style="background-color: #ef4444;"></div>
                                <div class="color-option" data-color="#f59e0b" style="background-color: #f59e0b;"></div>
                                <div class="color-option" data-color="#8b5cf6" style="background-color: #8b5cf6;"></div>
                                <div class="color-option" data-color="#ec4899" style="background-color: #ec4899;"></div>
                                <div class="color-option" data-color="#14b8a6" style="background-color: #14b8a6;"></div>
                                <div class="color-option" data-color="#6366f1" style="background-color: #6366f1;"></div>
                            </div>
                        </div>

                        <!-- Reminder Settings -->
                        <div class="col-12">
                            <div class="card bg-light border-0">
                                <div class="card-body">
                                    <h6 class="fw-bold mb-3">
                                        <i class="feather-bell me-2"></i>
                                        @Html.T("إعدادات التذكير", "Reminder settings")
                                    </h6>
                                    
                                    <div class="form-check form-switch mb-3">
                                        <input asp-for="SendReminder" class="form-check-input" type="checkbox" role="switch" id="SendReminder" />
                                        <label asp-for="SendReminder" class="form-check-label"></label>
                                    </div>

                                    <div id="reminderSettings" style="display: @(Model.SendReminder ? "block" : "none")">
                                        <label asp-for="ReminderMinutesBefore" class="form-label fw-semibold"></label>
                                        <select asp-for="ReminderMinutesBefore" class="form-select">
                                            <option value="5">5 @Html.T("دقائق قبل", "minutes before")</option>
                                            <option value="15">15 @Html.T("دقيقة قبل", "minute before")</option>
                                            <option value="30">30 @Html.T("دقيقة قبل", "minutes before")</option>
                                            <option value="60">@Html.T("ساعة قبل", "1 hour before")</option>
                                            <option value="120">@Html.T("ساعتين قبل", "2 hours before")</option>
                                            <option value="1440">@Html.T("يوم قبل", "1 day before")</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="col-12">
                            <hr class="my-4" />
                            <div class="d-flex gap-2 justify-content-end">
                                <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-light">
                                    <i class="feather-x me-2"></i>
                                    @Html.T("إلغاء", "Cancel")
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="feather-check me-2"></i>
                                    @Html.T("حفظ التعديلات", "Save changes")
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<partial name="_ValidationScriptsPartial" />
<script>
    // Color picker
    document.querySelectorAll('.color-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
            document.getElementById('selectedColor').value = this.dataset.color;
        });
    });

    // Reminder toggle
    document.getElementById('SendReminder').addEventListener('change', function() {
        document.getElementById('reminderSettings').style.display = this.checked ? 'block' : 'none';
    });

    // Initialize color from model
    document.getElementById('selectedColor').value = '@Model.Color';
    document.querySelectorAll('.color-option').forEach(option => {
        if (option.dataset.color === '@Model.Color') {
            option.classList.add('selected');
        }
    });

    // Format datetime-local inputs
    @if (Model.StartTime != DateTime.MinValue)
    {
        <text>
        var startInput = document.querySelector('input[name="StartTime"]');
        if (startInput) {
            startInput.value = '@Model.StartTime.ToString("yyyy-MM-ddTHH:mm")';
        }
        </text>
    }

    @if (Model.EndTime.HasValue && Model.EndTime.Value != DateTime.MinValue)
    {
        <text>
        var endInput = document.querySelector('input[name="EndTime"]');
        if (endInput) {
            endInput.value = '@Model.EndTime.Value.ToString("yyyy-MM-ddTHH:mm")';
        }
        </text>
    }
</script>
}

