@model LMS.Areas.Student.Controllers.AchievementsDashboardViewModel
@{
    ViewData["Title"] = Html.T("الإنجازات", "Achievements");
}

@section Styles {
<style>
    .achievements-header {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        border-radius: 12px;
        padding: 40px;
        color: white;
        margin-bottom: 30px;
    }
    .badge-card {
        transition: all 0.3s ease;
        text-align: center;
    }
    .badge-card:hover {
        transform: translateY(-5px);
    }
    .badge-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 15px;
        font-size: 32px;
    }
    .badge-locked {
        filter: grayscale(100%);
        opacity: 0.5;
    }
    .level-progress {
        height: 12px;
        border-radius: 6px;
    }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<!-- Header -->
<div class="achievements-header">
    <div class="row align-items-center">
        <div class="col-lg-8">
            <h2 class="fw-bold mb-2">
                <i class="feather-award me-2"></i>
                @Html.T("إنجازاتي", "My Achievements")
            </h2>
            <p class="mb-0 opacity-75">@Html.T("مرحباً", "Hello") @Model.UserName! @Html.T("تتبع شاراتك ومستوى تقدمك", "Track your badges and progress level")</p>
        </div>
        <div class="col-lg-4">
            <div class="row text-center g-2">
                <div class="col-4">
                    <h3 class="fw-bold mb-0">@Model.CurrentLevel</h3>
                    <small class="opacity-75">@Html.T("المستوى", "Level")</small>
                </div>
                <div class="col-4">
                    <h3 class="fw-bold mb-0">@Model.CurrentPoints</h3>
                    <small class="opacity-75">@Html.T("النقاط", "Points")</small>
                </div>
                <div class="col-4">
                    <h3 class="fw-bold mb-0">@Model.TotalBadges</h3>
                    <small class="opacity-75">@Html.T("الشارات", "Badges")</small>
                </div>
            </div>
        </div>
    </div>
    <!-- Level Progress -->
    <div class="mt-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <span>@Html.T("المستوى", "Level") @Model.CurrentLevel</span>
            <span>@Html.T("المستوى", "Level") @(Model.CurrentLevel + 1)</span>
        </div>
        <div class="progress level-progress bg-white bg-opacity-25">
            <div class="progress-bar bg-white" style="width: @Model.ProgressToNextLevel%"></div>
        </div>
        <div class="text-center mt-2">
            <small class="opacity-75">@Model.PointsToNextLevel @Html.T("نقطة للمستوى التالي", "points to next level")</small>
        </div>
    </div>
</div>

<!-- Quick Stats -->
<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="card stretch stretch-full">
            <div class="card-body text-center">
                <div class="avatar-text avatar-lg bg-soft-success text-success mx-auto mb-3">
                    <i class="feather-book-open"></i>
                </div>
                <h3 class="fw-bold mb-0">@Model.CompletedCourses</h3>
                <p class="text-muted mb-0">@Html.T("دورات مكتملة", "Completed courses")</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stretch stretch-full">
            <div class="card-body text-center">
                <div class="avatar-text avatar-lg bg-soft-primary text-primary mx-auto mb-3">
                    <i class="feather-clock"></i>
                </div>
                <h3 class="fw-bold mb-0">@Model.TotalStudyHours</h3>
                <p class="text-muted mb-0">@Html.T("ساعات دراسة", "Study hours")</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <a asp-action="Points" class="text-decoration-none">
            <div class="card stretch stretch-full">
                <div class="card-body text-center">
                    <div class="avatar-text avatar-lg bg-soft-warning text-warning mx-auto mb-3">
                        <i class="feather-star"></i>
                    </div>
                    <h3 class="fw-bold mb-0 text-body">@Model.CurrentPoints</h3>
                    <p class="text-muted mb-0">@Html.T("إجمالي النقاط", "Total points")</p>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- Earned Badges -->
<div class="card stretch stretch-full mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">
            <i class="feather-star text-warning me-2"></i>
            @Html.T("الشارات المكتسبة", "Earned badges") (@Model.EarnedBadges.Count)
        </h5>
    </div>
    <div class="card-body">
        @if (Model.EarnedBadges.Any())
        {
            <div class="row g-4">
                @foreach (var userBadge in Model.EarnedBadges)
                {
                    <div class="col-lg-2 col-md-3 col-4">
                        <div class="badge-card p-3">
                            <div class="badge-icon bg-soft-warning text-warning">
                                <i class="@(userBadge.Badge.IconClass ?? "feather-award")"></i>
                            </div>
                            <h6 class="fw-bold mb-1">@userBadge.Badge.Name</h6>
                            <small class="text-muted">@userBadge.AwardedAt.ToString("dd/MM/yyyy")</small>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="text-center py-4">
                <i class="feather-award fs-1 text-muted mb-3 d-block"></i>
                <p class="text-muted">@Html.T("لم تكتسب أي شارات بعد. استمر في التعلم!", "You haven't earned any badges yet. Keep learning!")</p>
            </div>
        }
    </div>
</div>

<!-- Locked Badges -->
@if (Model.LockedBadges.Any())
{
    <div class="card stretch stretch-full mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="feather-lock text-muted me-2"></i>
                @Html.T("شارات يمكنك الحصول عليها", "Badges you can earn")
            </h5>
        </div>
        <div class="card-body">
            <div class="row g-4">
                @foreach (var badge in Model.LockedBadges.Take(8))
                {
                    <div class="col-lg-2 col-md-3 col-4">
                        <div class="badge-card badge-locked p-3">
                            <div class="badge-icon bg-light text-muted">
                                <i class="@(badge.IconClass ?? "feather-award")"></i>
                            </div>
                            <h6 class="fw-bold mb-1">@badge.Name</h6>
                            <small class="text-muted">@badge.RequiredPoints @Html.T("نقطة", "points")</small>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
}

<!-- Recent Points -->
<div class="card stretch stretch-full">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="card-title mb-0">@Html.T("النقاط الأخيرة", "Recent points")</h5>
        <a asp-action="Points" class="btn btn-sm btn-outline-primary">@Html.T("عرض الكل", "View all")</a>
    </div>
    <div class="card-body">
        @if (Model.RecentPointTransactions.Any())
        {
            <div class="list-group list-group-flush">
                @foreach (var transaction in Model.RecentPointTransactions)
                {
                    <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                        <div>
                            <strong>@transaction.Reason</strong>
                            <div class="fs-12 text-muted">@transaction.CreatedAt.ToString("dd/MM/yyyy HH:mm")</div>
                        </div>
                        <span class="badge @(transaction.Points > 0 ? "bg-success" : "bg-danger") fs-12">
                            @(transaction.Points > 0 ? "+" : "")@transaction.Points
                        </span>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="text-center py-4">
                <p class="text-muted mb-0">@Html.T("لا توجد معاملات نقاط حتى الآن", "No point transactions yet")</p>
            </div>
        }
    </div>
</div>

<!-- Action Buttons -->
<div class="d-flex gap-3 mt-4">
    <a asp-action="Leaderboard" class="btn btn-primary">
        <i class="feather-bar-chart-2 me-2"></i>
        @Html.T("لوحة المتصدرين", "Leaderboard")
    </a>
    <a asp-action="Points" class="btn btn-outline-primary">
        <i class="feather-list me-2"></i>
        @Html.T("سجل النقاط", "Points history")
    </a>
</div>

