@model LMS.Areas.Student.Controllers.StudentSettingsViewModel
@{
    ViewData["Title"] = Html.T("الإعدادات", "Settings");
    var activeTab = ViewBag.ActiveTab as string ?? "account";
}

@section Styles {
<style>
    .settings-header {
        background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
        border-radius: 12px;
        padding: 40px;
        color: white;
        margin-bottom: 30px;
    }
    .settings-section {
        margin-bottom: 30px;
    }
    .settings-card {
        transition: all 0.2s ease;
    }
    .nav-pills .nav-link {
        color: #6b7280;
        padding: 12px 20px;
        border-radius: 8px;
    }
    .nav-pills .nav-link.active {
        background-color: #6366f1;
        color: white;
    }
    .nav-pills .nav-link:hover:not(.active) {
        background-color: #f3f4f6;
    }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<!-- Header -->
<div class="settings-header">
    <h2 class="fw-bold mb-2">
        <i class="feather-settings me-2"></i>
        @Html.T("الإعدادات", "Settings")
    </h2>
    <p class="mb-0 opacity-75">@Html.T("إدارة حسابك وتفضيلاتك", "Manage your account and preferences")</p>
</div>

<div class="row">
    <!-- Sidebar -->
    <div class="col-lg-3">
        <div class="card stretch stretch-full mb-4">
            <div class="card-body">
                <ul class="nav nav-pills flex-column" id="settingsTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <a asp-action="Index" asp-route-tab="account" class="nav-link @(activeTab == "account" ? "active" : "") w-100 text-start">
                            <i class="feather-user me-2"></i>
                            @Html.T("الحساب", "Account")
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a asp-action="Index" asp-route-tab="notifications" class="nav-link @(activeTab == "notifications" ? "active" : "") w-100 text-start">
                            <i class="feather-bell me-2"></i>
                            @Html.T("الإشعارات", "Notifications")
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a asp-action="Index" asp-route-tab="privacy" class="nav-link @(activeTab == "privacy" ? "active" : "") w-100 text-start">
                            <i class="feather-lock me-2"></i>
                            @Html.T("الخصوصية", "Privacy")
                        </a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a asp-action="Index" asp-route-tab="security" class="nav-link @(activeTab == "security" ? "active" : "") w-100 text-start">
                            <i class="feather-shield me-2"></i>
                            @Html.T("الأمان", "Security")
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="col-lg-9">
        <div class="tab-content" id="settingsTabContent">
            <!-- Account Settings -->
            <div class="tab-pane fade @(activeTab == "account" ? "show active" : "")" id="account" role="tabpanel">
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title mb-0">@Html.T("إعدادات الحساب", "Account settings")</h5>
                    </div>
                    <div class="card-body">
                        <form asp-action="UpdateAccount" method="post">
                            @Html.AntiForgeryToken()
                            <div class="mb-3">
                                <label class="form-label">@Html.T("البريد الإلكتروني", "Email")</label>
                                <input type="email" class="form-control" value="@Model.Email" disabled />
                                <small class="text-muted">@Html.T("لا يمكن تغيير البريد الإلكتروني", "Email cannot be changed")</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">@Html.T("رقم الهاتف", "Phone number")</label>
                                <input type="tel" name="PhoneNumber" class="form-control" value="@Model.PhoneNumber" />
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">@Html.T("اللغة", "Language")</label>
                                    <select name="Language" class="form-select">
                                        @if (Model.Language == "ar")
                                        {
                                            <option value="ar" selected="selected">@Html.T("العربية", "Arabic")</option>
                                            <option value="en">@Html.T("English", "English")</option>
                                        }
                                        else
                                        {
                                            <option value="ar">@Html.T("العربية", "Arabic")</option>
                                            <option value="en" selected="selected">@Html.T("English", "English")</option>
                                        }
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">@Html.T("المنطقة الزمنية", "Time zone")</label>
                                    <select name="TimeZone" class="form-select">
                                        @if (Model.TimeZone == "Africa/Cairo") { <option value="Africa/Cairo" selected="selected">@Html.T("القاهرة", "Cairo")</option> } else { <option value="Africa/Cairo">@Html.T("القاهرة", "Cairo")</option> }
                                        @if (Model.TimeZone == "Asia/Riyadh") { <option value="Asia/Riyadh" selected="selected">@Html.T("الرياض", "Riyadh")</option> } else { <option value="Asia/Riyadh">@Html.T("الرياض", "Riyadh")</option> }
                                        @if (Model.TimeZone == "Asia/Dubai") { <option value="Asia/Dubai" selected="selected">@Html.T("دبي", "Dubai")</option> } else { <option value="Asia/Dubai">@Html.T("دبي", "Dubai")</option> }
                                        @if (Model.TimeZone == "Asia/Kuwait") { <option value="Asia/Kuwait" selected="selected">@Html.T("الكويت", "Kuwait")</option> } else { <option value="Asia/Kuwait">@Html.T("الكويت", "Kuwait")</option> }
                                        @if (Model.TimeZone == "UTC") { <option value="UTC" selected="selected">@Html.T("UTC", "UTC")</option> } else { <option value="UTC">@Html.T("UTC", "UTC")</option> }
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3 pt-2 border-top">
                                <h6 class="fw-bold mb-2">@Html.T("الفواتير والدفع", "Billing & Payment")</h6>
                                <div class="d-flex flex-wrap gap-2">
                                    <a asp-area="Student" asp-controller="Invoices" asp-action="Index" class="btn btn-outline-secondary btn-sm">
                                        <i class="feather-file me-1"></i>@Html.T("الفواتير", "Invoices")
                                    </a>
                                    <a asp-area="Student" asp-controller="Subscriptions" asp-action="Index" class="btn btn-outline-secondary btn-sm">
                                        <i class="feather-repeat me-1"></i>@Html.T("الاشتراكات", "Subscriptions")
                                    </a>
                                    <a asp-area="Student" asp-controller="PaymentMethods" asp-action="Index" class="btn btn-outline-secondary btn-sm">
                                        <i class="feather-credit-card me-1"></i>@Html.T("طرق الدفع", "Payment Methods")
                                    </a>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-save me-2"></i>
                                @Html.T("حفظ التغييرات", "Save changes")
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Notifications Settings -->
            <div class="tab-pane fade @(activeTab == "notifications" ? "show active" : "")" id="notifications" role="tabpanel">
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title mb-0">@Html.T("إعدادات الإشعارات", "Notification settings")</h5>
                    </div>
                    <div class="card-body">
                        <form asp-action="UpdateNotifications" method="post">
                            @Html.AntiForgeryToken()
                            <div class="mb-4">
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" name="EmailNotifications" 
                                           id="emailNotifications" @(Model.EmailNotifications ? "checked" : "") />
                                    <label class="form-check-label" for="emailNotifications">
                                        <strong>@Html.T("إشعارات البريد الإلكتروني", "Email notifications")</strong>
                                        <div class="text-muted fs-12">@Html.T("تلقي الإشعارات عبر البريد الإلكتروني", "Receive notifications by email")</div>
                                    </label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" name="PushNotifications" 
                                           id="pushNotifications" @(Model.PushNotifications ? "checked" : "") />
                                    <label class="form-check-label" for="pushNotifications">
                                        <strong>@Html.T("الإشعارات الفورية", "Push notifications")</strong>
                                        <div class="text-muted fs-12">@Html.T("تلقي إشعارات المتصفح", "Receive browser notifications")</div>
                                    </label>
                                </div>
                            </div>
                            <hr />
                            <div class="mb-4">
                                <h6 class="fw-bold mb-3">@Html.T("أنواع الإشعارات", "Notification types")</h6>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" name="CourseUpdates" 
                                           id="courseUpdates" @(Model.CourseUpdates ? "checked" : "") />
                                    <label class="form-check-label" for="courseUpdates">@Html.T("تحديثات الدورات", "Course updates")</label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" name="AssignmentReminders" 
                                           id="assignmentReminders" @(Model.AssignmentReminders ? "checked" : "") />
                                    <label class="form-check-label" for="assignmentReminders">@Html.T("تذكيرات الواجبات", "Assignment reminders")</label>
                                </div>
                                <div class="form-check form-switch mb-3">
                                    <input class="form-check-input" type="checkbox" name="WeeklyDigest" 
                                           id="weeklyDigest" @(Model.WeeklyDigest ? "checked" : "") />
                                    <label class="form-check-label" for="weeklyDigest">@Html.T("الملخص الأسبوعي", "Weekly digest")</label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <a asp-area="Student" asp-controller="Profile" asp-action="NotificationPreferences" class="btn btn-outline-secondary btn-sm">
                                    <i class="feather-settings me-1"></i>@Html.T("تفضيلات الإشعارات المتقدمة", "Advanced notification preferences")
                                </a>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-save me-2"></i>
                                @Html.T("حفظ التغييرات", "Save changes")
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Privacy Settings -->
            <div class="tab-pane fade @(activeTab == "privacy" ? "show active" : "")" id="privacy" role="tabpanel">
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title mb-0">@Html.T("إعدادات الخصوصية", "Privacy settings")</h5>
                    </div>
                    <div class="card-body">
                        <form asp-action="UpdatePrivacy" method="post">
                            @Html.AntiForgeryToken()
                            <div class="mb-3">
                                <label class="form-label">@Html.T("ظهور الملف الشخصي", "Profile visibility")</label>
                                    <select name="ProfileVisibility" class="form-select">
                                        @if (Model.ProfileVisibility == "Public")
                                        {
                                            <option value="Public" selected="selected">@Html.T("عام", "Public")</option>
                                            <option value="StudentsOnly">@Html.T("الطلاب المسجلين فقط", "Registered Students Only")</option>
                                            <option value="Private">@Html.T("خاص", "Private")</option>
                                        }
                                        else if (Model.ProfileVisibility == "StudentsOnly")
                                        {
                                            <option value="Public">@Html.T("عام", "Public")</option>
                                            <option value="StudentsOnly" selected="selected">@Html.T("الطلاب المسجلين فقط", "Registered Students Only")</option>
                                            <option value="Private">@Html.T("خاص", "Private")</option>
                                        }
                                        else
                                        {
                                            <option value="Public">@Html.T("عام", "Public")</option>
                                            <option value="StudentsOnly">@Html.T("الطلاب المسجلين فقط", "Registered Students Only")</option>
                                            <option value="Private" selected="selected">@Html.T("خاص", "Private")</option>
                                        }
                                    </select>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="ShowEmailPublicly" value="false" />
                                <input class="form-check-input" type="checkbox" name="ShowEmailPublicly" id="showEmailPublicly" value="true" @(Model.ShowEmailPublicly ? "checked" : "") />
                                <label class="form-check-label" for="showEmailPublicly">@Html.T("إظهار البريد الإلكتروني للعامة", "Show email publicly")</label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="ShowProgressPublicly" value="false" />
                                <input class="form-check-input" type="checkbox" name="ShowProgressPublicly" id="showProgressPublicly" value="true" @(Model.ShowProgressPublicly ? "checked" : "") />
                                <label class="form-check-label" for="showProgressPublicly">@Html.T("إظهار تقدم التعلم للعامة", "Show learning progress publicly")</label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="ShowBadgesPublicly" value="false" />
                                <input class="form-check-input" type="checkbox" name="ShowBadgesPublicly" id="showBadgesPublicly" value="true" @(Model.ShowBadgesPublicly ? "checked" : "") />
                                <label class="form-check-label" for="showBadgesPublicly">@Html.T("إظهار الأوسمة للعامة", "Show badges publicly")</label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="ShowCertificatesPublicly" value="false" />
                                <input class="form-check-input" type="checkbox" name="ShowCertificatesPublicly" id="showCertificatesPublicly" value="true" @(Model.ShowCertificatesPublicly ? "checked" : "") />
                                <label class="form-check-label" for="showCertificatesPublicly">@Html.T("إظهار الشهادات للعامة", "Show certificates publicly")</label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input type="hidden" name="AllowMessages" value="false" />
                                <input class="form-check-input" type="checkbox" name="AllowMessages" id="allowMessages" value="true" @(Model.AllowMessages ? "checked" : "") />
                                <label class="form-check-label" for="allowMessages">@Html.T("السماح للآخرين بإرسال رسائل لي", "Allow others to send me messages")</label>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="feather-save me-2"></i>
                                @Html.T("حفظ التغييرات", "Save changes")
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Security Settings -->
            <div class="tab-pane fade @(activeTab == "security" ? "show active" : "")" id="security" role="tabpanel">
                <div class="card stretch stretch-full">
                    <div class="card-header">
                        <h5 class="card-title mb-0">@Html.T("إعدادات الأمان", "Security settings")</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <h6 class="fw-bold mb-3">@Html.T("المصادقة الثنائية", "Two-factor authentication")</h6>
                            <div class="d-flex align-items-center justify-content-between p-3 bg-light rounded">
                                <div>
                                    <strong>@Html.T("المصادقة الثنائية", "Two-factor authentication")</strong>
                                    <div class="text-muted fs-12">@Html.T("إضافة طبقة أمان إضافية لحسابك", "Add an extra layer of security to your account")</div>
                                </div>
                                <span class="badge @(Model.TwoFactorEnabled ? "bg-success" : "bg-secondary")">
                                    @(Model.TwoFactorEnabled ? Html.T("مفعّل", "Enabled") : Html.T("غير مفعّل", "Disabled"))
                                </span>
                            </div>
                        </div>
                        <hr />
                        <div class="mb-4">
                            <h6 class="fw-bold mb-3">@Html.T("حالة الحساب", "Account status")</h6>
                            <div class="d-flex align-items-center gap-3 mb-2">
                                <span class="badge @(Model.EmailConfirmed ? "bg-success" : "bg-warning")">
                                    <i class="feather-@(Model.EmailConfirmed ? "check" : "alert-circle") me-1"></i>
                                    @Html.T("البريد الإلكتروني:", "Email:") @(Model.EmailConfirmed ? Html.T("مؤكد", "Confirmed") : Html.T("غير مؤكد", "Unconfirmed"))
                                </span>
                                @if (Model.PhoneNumberConfirmed)
                                {
                                    <span class="badge bg-success">
                                        <i class="feather-check me-1"></i>
                                        @Html.T("الهاتف: مؤكد", "Phone: Confirmed")
                                    </span>
                                }
                            </div>
                        </div>
                        <hr />
                        <div>
                            <a asp-area="Student" asp-controller="Profile" asp-action="SecuritySettings" class="btn btn-outline-primary">
                                <i class="feather-key me-2"></i>
                                @Html.T("تغيير كلمة المرور", "Change password")
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

