@model LMS.Services.Interfaces.StudentLearningStats
@{
    ViewData["Title"] = Html.T("Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ¹Ù„Ù…", "Learning Statistics");
    var enrollments = ViewBag.Enrollments as List<LMS.Domain.Entities.Learning.Enrollment> ?? new List<LMS.Domain.Entities.Learning.Enrollment>();
    var monthlyStats = ViewBag.MonthlyStats as List<MonthlyLearningStats> ?? new List<MonthlyLearningStats>();
}

@section Styles {
<style>
    .stats-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        height: 100%;
    }
    .stats-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        color: white;
    }
    .milestone-card {
        background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
    }
    .achievement-icon {
        font-size: 48px;
        margin-bottom: 12px;
    }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<!-- Header -->
<div class="card stretch stretch-full mb-4">
    <div class="card-body">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h3 class="fw-bold mb-2">
                    <i class="feather-bar-chart-2 text-primary me-2"></i>
                    @Html.T("Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©", "Overall Learning Statistics")
                </h3>
                <p class="text-muted mb-0">@Html.T("Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø±Ø­Ù„ØªÙƒ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©", "A comprehensive overview of your learning journey")</p>
            </div>
        </div>
    </div>
</div>

<!-- Main Stats -->
<div class="row g-4 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="stats-card">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                    <p class="text-muted mb-1">@Html.T("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙˆØ±Ø§Øª", "Total Courses")</p>
                    <h2 class="fw-bold mb-0">@Model.TotalEnrolledCourses</h2>
                </div>
                <div class="stats-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="feather-book-open"></i>
                </div>
            </div>
            <small class="text-muted">@Model.ActiveCourses @Html.T("Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©", "in progress")</small>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stats-card">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                    <p class="text-muted mb-1">@Html.T("Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©", "Completed Courses")</p>
                    <h2 class="fw-bold mb-0">@Model.CompletedCourses</h2>
                </div>
                <div class="stats-icon" style="background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);">
                    <i class="feather-check-circle"></i>
                </div>
            </div>
            <small class="text-muted">@Model.CertificatesEarned @Html.T("Ø´Ù‡Ø§Ø¯Ø© Ù…Ø­ØµÙ„Ø©", "certificates earned")</small>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stats-card">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                    <p class="text-muted mb-1">@Html.T("Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ¹Ù„Ù…", "Learning Hours")</p>
                    <h2 class="fw-bold mb-0">@((Model.TotalStudyMinutes / 60.0).ToString("F1"))</h2>
                </div>
                <div class="stats-icon" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);">
                    <i class="feather-clock"></i>
                </div>
            </div>
            <small class="text-muted">@Model.TotalStudyMinutes @Html.T("Ø¯Ù‚ÙŠÙ‚Ø© Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©", "total minutes")</small>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stats-card">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                    <p class="text-muted mb-1">@Html.T("Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚Ø¯Ù…", "Average Progress")</p>
                    <h2 class="fw-bold mb-0">@(Model.AverageCompletionRate.ToString("F0"))%</h2>
                </div>
                <div class="stats-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                    <i class="feather-trending-up"></i>
                </div>
            </div>
            <small class="text-muted">@Html.T("Ø¹Ø¨Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª", "across all courses")</small>
        </div>
    </div>
</div>

<!-- Additional Stats -->
<div class="row g-4 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="stats-card">
            <div class="text-center">
                <div class="achievement-icon">ğŸ”¥</div>
                <h3 class="fw-bold mb-1">@Model.CurrentStreak</h3>
                <p class="text-muted mb-0">@Html.T("Ø£ÙŠØ§Ù… Ù…ØªÙˆØ§ØµÙ„Ø©", "consecutive days")</p>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stats-card">
            <div class="text-center">
                <div class="achievement-icon">â­</div>
                <h3 class="fw-bold mb-1">@Model.LongestStreak</h3>
                <p class="text-muted mb-0">@Html.T("Ø£Ø·ÙˆÙ„ Ø³Ù„Ø³Ù„Ø©", "longest streak")</p>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stats-card">
            <div class="text-center">
                <div class="achievement-icon">ğŸ†</div>
                <h3 class="fw-bold mb-1">@Model.TotalPoints</h3>
                <p class="text-muted mb-0">@Html.T("Ù†Ù‚Ø§Ø· Ù…Ø­ØµÙ„Ø©", "points earned")</p>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="stats-card">
            <div class="text-center">
                <div class="achievement-icon">ğŸ–ï¸</div>
                <h3 class="fw-bold mb-1">@Model.BadgesEarned</h3>
                <p class="text-muted mb-0">@Html.T("Ø´Ø§Ø±Ø© Ù…Ø­ØµÙ„Ø©", "badges earned")</p>
            </div>
        </div>
    </div>
</div>

<!-- Charts -->
<div class="row g-4 mb-4">
    <div class="col-lg-8">
        <div class="card stretch stretch-full">
            <div class="card-body">
                <h5 class="fw-bold mb-4">
                    <i class="feather-trending-up text-primary me-2"></i>
                    @Html.T("Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø´Ù‡Ø±ÙŠ", "Monthly Progress")
                </h5>
                <canvas id="monthlyProgressChart" height="80"></canvas>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card stretch stretch-full">
            <div class="card-body">
                <h5 class="fw-bold mb-4">
                    <i class="feather-pie-chart text-success me-2"></i>
                    @Html.T("ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¯ÙˆØ±Ø§Øª", "Course Distribution")
                </h5>
                <canvas id="courseDistributionChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Timeline -->
<div class="card stretch stretch-full">
    <div class="card-body">
        <h5 class="fw-bold mb-4">
            <i class="feather-calendar text-info me-2"></i>
            @Html.T("Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù„ØªØ¹Ù„Ù…", "Learning Timeline")
        </h5>
        
        @if (enrollments.Any())
        {
            <div class="timeline">
                @foreach (var enrollment in enrollments.OrderBy(e => e.EnrolledAt))
                {
                    <div class="milestone-card">
                        <div class="d-flex align-items-start">
                            <div class="avatar-text avatar-md @(enrollment.Status == LMS.Domain.Enums.EnrollmentStatus.Completed ? "bg-success" : "bg-primary") text-white me-3">
                                <i class="feather-@(enrollment.Status == LMS.Domain.Enums.EnrollmentStatus.Completed ? "check-circle" : "book-open")"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <h6 class="fw-bold mb-1">@enrollment.Course.Title</h6>
                                        <p class="text-muted small mb-0">
                                            @Html.T("Ø¨Ø¯Ø£Øª ÙÙŠ", "Started on") @enrollment.EnrolledAt.ToString("yyyy/MM/dd")
                                            @if (enrollment.CompletedAt.HasValue)
                                            {
                                                <span> â€¢ @Html.T("Ø£ÙƒÙ…Ù„Øª ÙÙŠ", "Completed on") @enrollment.CompletedAt.Value.ToString("yyyy/MM/dd")</span>
                                            }
                                        </p>
                                    </div>
                                    <span class="badge @(enrollment.Status == LMS.Domain.Enums.EnrollmentStatus.Completed ? "bg-success" : "bg-primary")">
                                        @enrollment.ProgressPercentage%
                                    </span>
                                </div>
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar @(enrollment.Status == LMS.Domain.Enums.EnrollmentStatus.Completed ? "bg-success" : "bg-primary")" 
                                         style="width: @(enrollment.ProgressPercentage)%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            ViewData["Icon"] = "calendar";
            ViewData["Title"] = Html.T("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ±Ø§Øª Ø¨Ø¹Ø¯", "No courses yet");
            ViewData["Message"] = Html.T("Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù†", "Start your learning journey now");
            @await Html.PartialAsync("_EmptyState")
        }
    </div>
</div>

@section Scripts {
<script>
    // Monthly Progress Chart
    const monthlyCtx = document.getElementById('monthlyProgressChart').getContext('2d');
    new Chart(monthlyCtx, {
        type: 'line',
        data: {
            labels: @Html.Raw(Json.Serialize(monthlyStats.Select(m => m.Month))),
            datasets: [{
                label: '@Html.T("Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©", "Enrolled Courses")',
                data: @Html.Raw(Json.Serialize(monthlyStats.Select(m => m.CoursesEnrolled))),
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                tension: 0.4
            }, {
                label: '@Html.T("Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©", "Completed Courses")',
                data: @Html.Raw(Json.Serialize(monthlyStats.Select(m => m.CoursesCompleted))),
                borderColor: '#22c55e',
                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom'
                }
            }
        }
    });

    // Course Distribution Chart
    const distributionCtx = document.getElementById('courseDistributionChart').getContext('2d');
    new Chart(distributionCtx, {
        type: 'doughnut',
        data: {
            labels: ['@Html.T("Ù‚ÙŠØ¯ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©", "In Progress")', '@Html.T("Ù…ÙƒØªÙ…Ù„Ø©", "Completed")', '@Html.T("Ù„Ù… ØªØ¨Ø¯Ø£", "Not Started")'],
            datasets: [{
                data: [@Model.ActiveCourses, @Model.CompletedCourses, @(Model.TotalEnrolledCourses - Model.ActiveCourses - Model.CompletedCourses)],
                backgroundColor: ['#667eea', '#22c55e', '#e5e7eb']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom'
                }
            }
        }
    });
</script>
}
