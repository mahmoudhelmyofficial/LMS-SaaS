@model EditGoalViewModel
@{
    ViewData["Title"] = Html.T("ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø¯Ù ØªØ¹Ù„ÙŠÙ…ÙŠ", "Edit Learning Goal");
    var enrollments = ViewBag.Enrollments as List<LMS.Domain.Entities.Learning.Enrollment>;
}

@section Styles {
<style>
    .goal-type-card {
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        padding: 24px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        height: 100%;
    }
    .goal-type-card:hover {
        border-color: #667eea;
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
    }
    .goal-type-card.selected {
        border-color: #667eea;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    }
    .goal-type-card .icon {
        font-size: 48px;
        margin-bottom: 16px;
    }
</style>
}

<!-- Alert Messages -->
@await Html.PartialAsync("_AlertMessage")

<!-- Page Header -->
<div class="card stretch stretch-full mb-4">
    <div class="card-body">
        <div class="d-flex align-items-center">
            <a asp-action="Index" class="btn btn-light me-3">
                <i class="feather-arrow-right"></i>
            </a>
            <div>
                <h3 class="fw-bold mb-2">
                    <i class="feather-edit text-primary me-2"></i>
                    @Html.T("ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø¯Ù ØªØ¹Ù„ÙŠÙ…ÙŠ", "Edit learning goal")
                </h3>
                <p class="text-muted mb-0">@Html.T("Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« ØªÙØ§ØµÙŠÙ„ Ù‡Ø¯ÙÙƒ", "Update your goal details")</p>
            </div>
        </div>
    </div>
</div>

<!-- Edit Goal Form -->
<div class="row">
    <div class="col-lg-10 mx-auto">
        <form asp-action="Edit" method="post">
            @Html.AntiForgeryToken()
            <input asp-for="Id" type="hidden" />

            <!-- Goal Type Selection -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="fw-bold mb-0">
                        <span class="badge bg-primary me-2">1</span>
                        @Html.T("Ù†ÙˆØ¹ Ø§Ù„Ù‡Ø¯Ù", "Goal type")
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <div class="col-md-3">
                            <div class="goal-type-card @(Model.GoalType == "CompleteCourse" ? "selected" : "")" data-type="CompleteCourse">
                                <div class="icon">ğŸ¯</div>
                                <h6 class="fw-bold mb-2">@Html.T("Ø¥ÙƒÙ…Ø§Ù„ Ø¯ÙˆØ±Ø©", "Complete course")</h6>
                                <p class="text-muted small mb-0">@Html.T("Ø¥Ù†Ù‡Ø§Ø¡ Ø¯ÙˆØ±Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙƒØ§Ù…Ù„Ø©", "Finish a full course")</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="goal-type-card @(Model.GoalType == "StudyHours" ? "selected" : "")" data-type="StudyHours">
                                <div class="icon">â°</div>
                                <h6 class="fw-bold mb-2">@Html.T("Ø³Ø§Ø¹Ø§Øª Ø¯Ø±Ø§Ø³Ø©", "Study hours")</h6>
                                <p class="text-muted small mb-0">@Html.T("ØªØ­Ù‚ÙŠÙ‚ Ø¹Ø¯Ø¯ Ù…Ø­Ø¯Ø¯ Ù…Ù† Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ¹Ù„Ù…", "Reach a set number of learning hours")</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="goal-type-card @(Model.GoalType == "EarnCertificates" ? "selected" : "")" data-type="EarnCertificates">
                                <div class="icon">ğŸ†</div>
                                <h6 class="fw-bold mb-2">@Html.T("Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø´Ù‡Ø§Ø¯Ø§Øª", "Earn certificates")</h6>
                                <p class="text-muted small mb-0">@Html.T("Ø¬Ù…Ø¹ Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©", "Collect a number of verified certificates")</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="goal-type-card @(Model.GoalType == "Custom" ? "selected" : "")" data-type="Custom">
                                <div class="icon">âœ¨</div>
                                <h6 class="fw-bold mb-2">@Html.T("Ù‡Ø¯Ù Ù…Ø®ØµØµ", "Custom goal")</h6>
                                <p class="text-muted small mb-0">@Html.T("Ø­Ø¯Ø¯ Ù‡Ø¯ÙØ§Ù‹ Ø®Ø§ØµØ§Ù‹ Ø¨Ùƒ", "Set your own goal")</p>
                            </div>
                        </div>
                    </div>
                    <input asp-for="GoalType" type="hidden" id="goalTypeInput" />
                    <span asp-validation-for="GoalType" class="text-danger"></span>
                </div>
            </div>

            <!-- Goal Details -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="fw-bold mb-0">
                        <span class="badge bg-primary me-2">2</span>
                        @Html.T("ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‡Ø¯Ù", "Goal details")
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <!-- Title -->
                        <div class="col-12">
                            <label asp-for="Title" class="form-label fw-bold">
                                <i class="feather-edit-3 me-2"></i>
                                @Html.T("Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‡Ø¯Ù", "Goal title")
                            </label>
                            <input asp-for="Title" 
                                   class="form-control form-control-lg" 
                                   placeholder="@Html.T("Ù…Ø«Ø§Ù„: Ø¥ÙƒÙ…Ø§Ù„ Ø¯ÙˆØ±Ø© ØªØ·ÙˆÙŠØ± Ø§Ù„ÙˆÙŠØ¨ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…", "e.g. Complete advanced web development course")" />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>

                        <!-- Description -->
                        <div class="col-12">
                            <label asp-for="Description" class="form-label fw-bold">
                                <i class="feather-file-text me-2"></i>
                                @Html.T("ÙˆØµÙ Ø§Ù„Ù‡Ø¯Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)", "Goal description (optional)")
                            </label>
                            <textarea asp-for="Description" 
                                      class="form-control" 
                                      rows="4" 
                                      placeholder="@Html.T("Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ Ù…ÙØµÙ„Ø§Ù‹ Ù„Ù‡Ø¯ÙÙƒ ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©...", "Write a detailed description of your goal and expected outcomes...")"></textarea>
                            <span asp-validation-for="Description" class="text-danger"></span>
                        </div>

                        <!-- Course Selection -->
                        <div class="col-md-6" id="courseSelection" style="display: @(Model.GoalType == "CompleteCourse" ? "block" : "none");">
                            <label asp-for="CourseId" class="form-label fw-bold">
                                <i class="feather-book-open me-2"></i>
                                @Html.T("Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ±Ø©", "Select course")
                            </label>
                            <select asp-for="CourseId" class="form-select">
                                <option value="">-- @Html.T("Ø§Ø®ØªØ± Ø¯ÙˆØ±Ø©", "Select course") --</option>
                                @if (enrollments != null)
                                {
                                    foreach (var enrollment in enrollments)
                                    {
                                        <option value="@enrollment.CourseId" selected="@(Model.CourseId == enrollment.CourseId)">
                                            @enrollment.Course.Title (@enrollment.ProgressPercentage% @Html.T("Ù…ÙƒØªÙ…Ù„", "complete"))
                                        </option>
                                    }
                                }
                            </select>
                            <span asp-validation-for="CourseId" class="text-danger"></span>
                        </div>

                        <!-- Target Value -->
                        <div class="col-md-6">
                            <label asp-for="TargetValue" class="form-label fw-bold">
                                <i class="feather-activity me-2"></i>
                                <span id="targetLabel">@Html.T("Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©", "Target value")</span>
                            </label>
                            <div class="input-group">
                                <input asp-for="TargetValue" 
                                       type="number" 
                                       class="form-control" 
                                       min="1"
                                       placeholder="@Html.T("Ù…Ø«Ø§Ù„: 100", "e.g. 100")" />
                                <span class="input-group-text" id="targetUnit">@Html.T("ÙˆØ­Ø¯Ø©", "units")</span>
                            </div>
                            <span asp-validation-for="TargetValue" class="text-danger"></span>
                            <div class="form-text" id="targetHelp"></div>
                        </div>

                        <!-- Target Date -->
                        <div class="col-md-6">
                            <label asp-for="TargetDate" class="form-label fw-bold">
                                <i class="feather-calendar me-2"></i>
                                @Html.T("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù", "Target completion date")
                            </label>
                            <input asp-for="TargetDate" 
                                   type="date" 
                                   class="form-control"
                                   value="@(Model.TargetDate?.ToString("yyyy-MM-dd"))" />
                            <span asp-validation-for="TargetDate" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Goal Settings -->
            <div class="card stretch stretch-full mb-4">
                <div class="card-header">
                    <h5 class="fw-bold mb-0">
                        <span class="badge bg-primary me-2">3</span>
                        @Html.T("Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‡Ø¯Ù", "Goal settings")
                    </h5>
                </div>
                <div class="card-body">
                    <div class="form-check form-switch">
                        <input asp-for="IsPublic" 
                               class="form-check-input" 
                               type="checkbox" 
                               role="switch" />
                        <label asp-for="IsPublic" class="form-check-label fw-bold">
                            <i class="feather-globe me-2"></i>
                            @Html.T("Ù‡Ø¯Ù Ø¹Ø§Ù… (ÙŠÙ…ÙƒÙ† Ù„Ù„Ø¢Ø®Ø±ÙŠÙ† Ø±Ø¤ÙŠØªÙ‡)", "Public goal (others can see it)")
                        </label>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="d-flex gap-3 justify-content-end mb-4">
                <a asp-action="Index" class="btn btn-secondary">
                    <i class="feather-x me-2"></i>
                    @Html.T("Ø¥Ù„ØºØ§Ø¡", "Cancel")
                </a>
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="feather-check me-2"></i>
                    @Html.T("Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª", "Save changes")
                </button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        window.__T = window.__T || {};
        window.__T.GoalTargetCourses = '@Html.Raw(Html.T("Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª", "Number of courses").ToString().Replace("'", "\\'"))';
        window.__T.GoalUnitCourse = '@Html.Raw(Html.T("Ø¯ÙˆØ±Ø©", "course").ToString().Replace("'", "\\'"))';
        window.__T.GoalHelpCourses = '@Html.Raw(Html.T("Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¥ÙƒÙ…Ø§Ù„Ù‡Ø§", "Number of courses you want to complete").ToString().Replace("'", "\\'"))';
        window.__T.GoalTargetHours = '@Html.Raw(Html.T("Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª", "Number of hours").ToString().Replace("'", "\\'"))';
        window.__T.GoalUnitHour = '@Html.Raw(Html.T("Ø³Ø§Ø¹Ø©", "hour").ToString().Replace("'", "\\'"))';
        window.__T.GoalHelpHours = '@Html.Raw(Html.T("Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©", "Target study hours").ToString().Replace("'", "\\'"))';
        window.__T.GoalTargetCerts = '@Html.Raw(Html.T("Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª", "Number of certificates").ToString().Replace("'", "\\'"))';
        window.__T.GoalUnitCert = '@Html.Raw(Html.T("Ø´Ù‡Ø§Ø¯Ø©", "certificate").ToString().Replace("'", "\\'"))';
        window.__T.GoalHelpCerts = '@Html.Raw(Html.T("Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©", "Target number of certificates").ToString().Replace("'", "\\'"))';
        window.__T.GoalTargetValue = '@Html.Raw(Html.T("Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©", "Target value").ToString().Replace("'", "\\'"))';
        window.__T.GoalUnitUnit = '@Html.Raw(Html.T("ÙˆØ­Ø¯Ø©", "unit").ToString().Replace("'", "\\'"))';
        window.__T.GoalHelpCustom = '@Html.Raw(Html.T("Ø­Ø¯Ø¯ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ù„Ù‡Ø¯ÙÙƒ", "Set the numeric value for your goal").ToString().Replace("'", "\\'"))';
        $(document).ready(function() {
            updateGoalTypeUI('@Model.GoalType');

            $('.goal-type-card').click(function() {
                $('.goal-type-card').removeClass('selected');
                $(this).addClass('selected');
                var type = $(this).data('type');
                $('#goalTypeInput').val(type);
                updateGoalTypeUI(type);
            });

            function updateGoalTypeUI(type) {
                var T = window.__T || {};
                if (type === 'CompleteCourse') {
                    $('#courseSelection').slideDown();
                } else {
                    $('#courseSelection').slideUp();
                }

                switch(type) {
                    case 'CompleteCourse':
                        $('#targetLabel').text(T.GoalTargetCourses || 'Number of courses');
                        $('#targetUnit').text(T.GoalUnitCourse || 'course');
                        $('#targetHelp').text(T.GoalHelpCourses || 'Number of courses you want to complete');
                        break;
                    case 'StudyHours':
                        $('#targetLabel').text(T.GoalTargetHours || 'Number of hours');
                        $('#targetUnit').text(T.GoalUnitHour || 'hour');
                        $('#targetHelp').text(T.GoalHelpHours || 'Target study hours');
                        break;
                    case 'EarnCertificates':
                        $('#targetLabel').text(T.GoalTargetCerts || 'Number of certificates');
                        $('#targetUnit').text(T.GoalUnitCert || 'certificate');
                        $('#targetHelp').text(T.GoalHelpCerts || 'Target number of certificates');
                        break;
                    case 'Custom':
                        $('#targetLabel').text(T.GoalTargetValue || 'Target value');
                        $('#targetUnit').text(T.GoalUnitUnit || 'unit');
                        $('#targetHelp').text(T.GoalHelpCustom || 'Set the numeric value for your goal');
                        break;
                }
            }
        });
    </script>
}

