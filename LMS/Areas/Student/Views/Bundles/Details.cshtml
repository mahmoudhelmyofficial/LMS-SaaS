@model LMS.Areas.Student.ViewModels.BundleDetailsViewModel
@{
    ViewData["Title"] = Model.Name;
    ViewData["ActiveMenu"] = "Bundles";
}

<div class="container-fluid py-4">
    <!-- Breadcrumb -->
    <nav aria-label="@Html.T("مسار التنقل", "Breadcrumb")" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-area="Student" asp-controller="Dashboard" asp-action="Index">@Html.T("الرئيسية", "Home")</a></li>
            <li class="breadcrumb-item"><a asp-action="Index">@Html.T("الباقات", "Bundles")</a></li>
            <li class="breadcrumb-item active">@Model.Name</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Bundle Header -->
            <div class="card border-0 shadow-sm mb-4">
                @if (!string.IsNullOrEmpty(Model.ThumbnailUrl))
                {
                    <div class="card-img-top" style="height: 300px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <img src="@Model.ThumbnailUrl" alt="@Model.Name" class="w-100 h-100 object-fit-cover">
                    </div>
                }
                else
                {
                    <div class="card-img-top d-flex align-items-center justify-content-center" 
                         style="height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="fas fa-box-open fa-5x text-white opacity-50"></i>
                    </div>
                }
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start flex-wrap gap-2 mb-3">
                        <div>
                            @if (Model.IsFeatured)
                            {
                                <span class="badge bg-warning text-dark mb-2">
                                    <i class="fas fa-star me-1"></i> @Html.T("باقة مميزة", "Featured Bundle")
                                </span>
                            }
                            <h1 class="h2 mb-0">@Model.Name</h1>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-success fs-6">
                                @Html.T("وفّر", "Save") @Model.SavingsPercentage%
                            </span>
                        </div>
                    </div>
                    
                    @if (!string.IsNullOrEmpty(Model.ShortDescription))
                    {
                        <p class="lead text-muted">@Model.ShortDescription</p>
                    }
                    
                    <!-- Stats -->
                    <div class="row g-3 mt-3">
                        <div class="col-6 col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <i class="fas fa-graduation-cap fa-2x text-primary mb-2"></i>
                                <div class="h4 mb-0">@Model.CoursesCount</div>
                                <small class="text-muted">@Html.T("دورات", "Courses")</small>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <i class="fas fa-clock fa-2x text-primary mb-2"></i>
                                <div class="h4 mb-0">@Model.TotalDurationHours</div>
                                <small class="text-muted">@Html.T("ساعة", "hrs")</small>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                <div class="h4 mb-0">@Model.SalesCount</div>
                                <small class="text-muted">@Html.T("مشترك", "Subscribers")</small>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="text-center p-3 bg-light rounded">
                                <i class="fas fa-piggy-bank fa-2x text-success mb-2"></i>
                                <div class="h4 mb-0 text-success">@Model.FormattedSavings</div>
                                <small class="text-muted">@Html.T("توفير", "Savings")</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Description -->
            @if (!string.IsNullOrEmpty(Model.Description))
            {
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-transparent">
                        <h5 class="mb-0">
                            <i class="fas fa-info-circle text-primary me-2"></i>
                            @Html.T("وصف الباقة", "Bundle Description")
                        </h5>
                    </div>
                    <div class="card-body">
                        @Html.Raw(Model.Description)
                    </div>
                </div>
            }

            <!-- Courses Included -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-transparent">
                    <h5 class="mb-0">
                        <i class="fas fa-list-ul text-primary me-2"></i>
                        @Html.T("الدورات المضمنة", "Included Courses") (@Model.CoursesCount @Html.T("دورات", "courses"))
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush">
                        @foreach (var course in Model.Courses)
                        {
                            <div class="list-group-item p-3 @(course.IsEnrolled ? "bg-success-subtle" : "")">
                                <div class="row align-items-center">
                                    <div class="col-auto">
                                        @if (!string.IsNullOrEmpty(course.ThumbnailUrl))
                                        {
                                            <img src="@course.ThumbnailUrl" alt="@course.Title" 
                                                 class="rounded" style="width: 80px; height: 60px; object-fit: cover;">
                                        }
                                        else
                                        {
                                            <div class="bg-primary rounded d-flex align-items-center justify-content-center" 
                                                 style="width: 80px; height: 60px;">
                                                <i class="fas fa-play text-white"></i>
                                            </div>
                                        }
                                    </div>
                                    <div class="col">
                                        <h6 class="mb-1">
                                            <a asp-area="Student" asp-controller="Courses" asp-action="Preview" 
                                               asp-route-id="@course.CourseId" class="text-decoration-none">
                                                @course.Title
                                            </a>
                                            @if (course.IsEnrolled)
                                            {
                                                <span class="badge bg-success ms-2">
                                                    <i class="fas fa-check me-1"></i> @Html.T("مسجل", "Enrolled")
                                                </span>
                                            }
                                        </h6>
                                        <div class="d-flex flex-wrap gap-2 small text-muted">
                                            @if (!string.IsNullOrEmpty(course.InstructorName))
                                            {
                                                <span><i class="fas fa-user me-1"></i> @course.InstructorName</span>
                                            }
                                            <span><i class="fas fa-clock me-1"></i> @(course.DurationMinutes / 60) @Html.T("ساعة", "hrs")</span>
                                            <span><i class="fas fa-play-circle me-1"></i> @course.LessonsCount @Html.T("درس", "lessons")</span>
                                            @if (course.Rating > 0)
                                            {
                                                <span><i class="fas fa-star text-warning me-1"></i> @course.Rating.ToString("F1")</span>
                                            }
                                        </div>
                                    </div>
                                    <div class="col-auto text-end">
                                        @if (course.DiscountPrice.HasValue)
                                        {
                                            <div class="text-decoration-line-through text-muted small">
                                                @course.Price.ToEGP(0)
                                            </div>
                                            <div class="fw-bold">@course.DiscountPrice.Value.ToEGP(0)</div>
                                        }
                                        else
                                        {
                                            <div class="fw-bold">@course.Price.ToEGP(0)</div>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm sticky-top" style="top: 100px;">
                <div class="card-body">
                    <!-- Price -->
                    <div class="text-center mb-4">
                        <div class="text-decoration-line-through text-muted fs-5">
                            @Model.FormattedOriginalPrice
                        </div>
                        <div class="display-5 fw-bold text-primary">
                            @Model.FormattedPrice
                        </div>
                        <div class="badge bg-success fs-6 mt-2">
                            <i class="fas fa-tags me-1"></i>
                            @Html.T("وفّر", "Save") @Model.FormattedSavings (@Model.SavingsPercentage%)
                        </div>
                    </div>

                    @if (Model.OwnedCoursesCount > 0 && !Model.IsFullyOwned)
                    {
                        <div class="alert alert-info small mb-3">
                            <i class="fas fa-info-circle me-1"></i>
                            @Html.T("لديك", "You have") @Model.OwnedCoursesCount @Html.T("من", "of") @Model.CoursesCount @Html.T("دورات. سيتم إضافة الدورات المتبقية لك.", "courses. Remaining courses will be added to you.")
                        </div>
                    }

                    @if (Model.RemainingSlots.HasValue && Model.RemainingSlots < 20)
                    {
                        <div class="alert alert-warning small mb-3">
                            <i class="fas fa-fire me-1"></i>
                            @Html.T("متبقي", "Only") @Model.RemainingSlots @Html.T("فقط!", "left!")
                        </div>
                    }

                    @if (Model.ValidTo.HasValue)
                    {
                        <div class="alert alert-warning small mb-3">
                            <i class="fas fa-clock me-1"></i>
                            @Html.T("ينتهي العرض:", "Offer ends:") @Model.ValidTo.Value.ToString("dd/MM/yyyy")
                        </div>
                    }

                    @if (!Model.IsFullyOwned)
                    {
                        <form asp-action="AddToCart" method="post">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="bundleId" value="@Model.Id" />
                            <button type="submit" class="btn btn-primary btn-lg w-100 mb-2">
                                <i class="fas fa-cart-plus me-2"></i> @Html.T("أضف إلى السلة", "Add to Cart")
                            </button>
                        </form>
                        
                        <a asp-action="QuickBuy" asp-route-id="@Model.Id" class="btn btn-outline-primary w-100">
                            <i class="fas fa-bolt me-2"></i> @Html.T("اشتري الآن", "Buy Now")
                        </a>
                    }
                    else
                    {
                        <div class="alert alert-success text-center mb-0">
                            <i class="fas fa-check-circle fa-2x mb-2"></i>
                            <div>@Html.T("أنت تمتلك جميع دورات هذه الباقة", "You own all courses in this bundle")</div>
                        </div>
                    }

                    <!-- Features -->
                    <hr class="my-4">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            @Html.T("وصول مدى الحياة", "Lifetime access")
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            @Html.T("شهادات إتمام", "Completion certificates")
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            @Html.T("مشاهدة على جميع الأجهزة", "Watch on all devices")
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            @Html.T("دعم فني مستمر", "Ongoing technical support")
                        </li>
                        <li>
                            <i class="fas fa-check text-success me-2"></i>
                            @Html.T("ضمان استرداد 30 يوم", "30-day money-back guarantee")
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
<style>
    .object-fit-cover {
        object-fit: cover;
    }
</style>
}

